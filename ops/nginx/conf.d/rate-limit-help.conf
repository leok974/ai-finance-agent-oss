# Rate limiting for Help/Explain endpoints
# Add this to your main nginx.conf in the http {} block

# Define rate limit zone for help endpoints
# 10MB zone can store ~160k IP addresses
# 10 requests per minute per IP (generous for help tooltips)
limit_req_zone $binary_remote_addr zone=help_rl:10m rate=10r/m;

# Example usage in server {} block:
# location ^~ /agent/describe/ {
#   limit_req zone=help_rl burst=5 nodelay;
#   proxy_pass http://backend:8000;
#   proxy_set_header Host $host;
#   proxy_set_header X-Real-IP $remote_addr;
#   proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
# }

# Optional: More restrictive for production
# limit_req_zone $binary_remote_addr zone=help_strict:10m rate=5r/m;

# Optional: Log rate limit events
# limit_req_log_level warn;
# limit_req_status 429;
