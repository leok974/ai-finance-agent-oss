FROM nginx:1.27-alpine

ARG EDGE_GIT_COMMIT=unknown
ARG EDGE_BUILD_TIME=unknown

# Create a version metadata JSON baked into the image.
RUN mkdir -p /usr/share/nginx/html && echo "{\n  \"commit\": \"$EDGE_GIT_COMMIT\",\n  \"built_at\": \"$EDGE_BUILD_TIME\"\n}" > /usr/share/nginx/html/version.json

# Copy nginx configuration (self-contained http/server layout)
COPY ./deploy/nginx.conf /etc/nginx/nginx.conf

# Remove default config to avoid accidental overlap.
RUN rm -f /etc/nginx/conf.d/default.conf 2>/dev/null || true
