name: backend-split
on:
  pull_request:

jobs:
  fast:
    name: Fast Focused Backend Tests
    runs-on: ubuntu-latest
    timeout-minutes: 15
    steps:
      - uses: actions/checkout@v4
      - name: Start services (backend only)
        run: |
          docker compose up -d --quiet-pull --wait backend
      - name: Focused pytest subset
        run: |
          docker compose run --rm backend pytest -q -k "metrics_alias or edge_metrics_token_paths or dev_allow_no_llm_dynamic"
  full:
    name: Full Backend Suite
    runs-on: ubuntu-latest
    needs: fast
    timeout-minutes: 45
    steps:
      - uses: actions/checkout@v4
      - name: Start services (full backend)
        run: |
          docker compose up -d --quiet-pull --wait backend db
      - name: Full pytest run
        run: |
          docker compose run --rm backend pytest -q
