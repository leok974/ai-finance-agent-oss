@tailwind base;
@tailwind components;
@tailwind utilities;

/* shadcn-style design tokens (HSL variables) */
:root{
  --background: 240 5% 6%;
  --foreground: 220 13% 95%;
  --card: 220 10% 9%;
  --card-foreground: 220 13% 95%;
  --popover: 220 10% 9%;
  --popover-foreground: 220 13% 95%;
  --primary: 221 83% 53%;
  --primary-foreground: 0 0% 100%;
  --secondary: 240 4% 16%;
  --secondary-foreground: 220 13% 95%;
  --muted: 240 4% 16%;
  --muted-foreground: 240 5% 64%;
  --accent: 240 4% 18%;
  --accent-foreground: 220 13% 95%;
  --destructive: 0 84% 60%;
  --destructive-foreground: 0 0% 100%;
  --border: 240 4% 24%;
  --input: 240 4% 24%;
  --ring: 221 83% 53%;
  --radius: 0.75rem;
}

:root { color-scheme: dark; }

/* Chat host safety: hidden until ready (prevents black box on error) */
lm-chatdock-host {
  background: transparent !important;
  opacity: 0 !important;
  pointer-events: none !important;
}
lm-chatdock-host.ready {
  opacity: 1 !important;
  pointer-events: auto !important;
}

/* ===== CHAT LAUNCHER WRAPPER (Bubble + Backdrop + Shell) ===== */
.lm-chat-launcher {
  position: fixed;
  right: 1.75rem;
  bottom: 1.75rem;
  z-index: 2147483640;
}

/* Shell transitions */
.lm-chat-shell {
  transition: opacity 200ms ease, transform 200ms ease;
}

.lm-chat-launcher--closed .lm-chat-shell {
  opacity: 0;
  transform: scale(0.9);
  pointer-events: none;
}

.lm-chat-launcher--open .lm-chat-shell {
  opacity: 1;
  transform: scale(1);
  pointer-events: auto;
}

/* Backdrop transitions */
.lm-chat-backdrop {
  transition: opacity 200ms ease;
}

.lm-chat-launcher--closed .lm-chat-backdrop {
  opacity: 0;
  pointer-events: none;
  z-index: -1;
}

.lm-chat-launcher--open .lm-chat-backdrop {
  opacity: 1;
  pointer-events: auto;
  z-index: 2147483639;
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.3);
}

/* Production safety net: hide local auth form even if old bundle cached */
:root[data-prod="true"] .local-auth-form {
  display: none !important;
}

/* ---------- Global tooltip look & feel + panel utilities ---------- */
@layer components {
  /* Subtle, reusable card/panel surfaces */
  .panel{
    @apply rounded-2xl bg-white/5 border border-white/5 shadow-sm;
  }
  .panel-tight{
    @apply panel p-3 md:p-4;
  }

  /* Inputs & chips */
  .input-muted{
    @apply rounded-xl bg-white/5 border border-white/10 focus:outline-none focus:ring-2 focus:ring-white/10;
  }
  .pill{
    @apply inline-flex items-center rounded-full px-2 py-0.5 text-xs opacity-80 bg-white/5 border border-white/10;
  }

  /* Charts container helper */
  .chart-panel{
    @apply panel-tight;
  }

  /* Soft panel without visible border (for charts/overview tiles) */
  .panel-no-border {
    @apply rounded-2xl bg-white/5 shadow-sm border-0;
  }

  /* Overview mini tiles use this to avoid inner bright outlines */
  .tile-no-border {
    @apply rounded-xl bg-white/5 border-0;
  }

  /* If any child within a no-border panel forces a border, remove it */
  .panel-no-border :is(.border, [class*="border-"]) {
    border-width: 0 !important;
    border-color: transparent !important;
  }

  /* Chart card + title */
  .chart-card { @apply panel-no-border p-4 md:p-5; }
  .chart-title { @apply text-sm md:text-base font-medium tracking-tight mb-3 opacity-90; }

  /* Help long text wrap inside rows/lists */
  .wrap{
    @apply whitespace-normal break-words;
  }

  /* kill nested double borders when a panel sits inside another panel container */
  .panel .panel {
    @apply border-0 bg-transparent shadow-none p-0;
  }

  /* page section spacing */
  .section {
    @apply space-y-6;
  }

  /* Optional muted helpers */
  .card-muted { @apply rounded-2xl border border-white/10 bg-white/5; }

  /* Form grid + fields */
  .form-grid {
  @apply grid gap-x-4 gap-y-5 mb-6;
  }
  .field {
    @apply flex flex-col gap-1;
  }
  .field-label {
    @apply text-xs opacity-70 leading-5 flex items-center gap-1;
  }
  .label-nowrap {
    @apply whitespace-nowrap overflow-hidden text-ellipsis;
  }
  .field-input {
  @apply w-full min-w-0 px-3 h-10 rounded-xl border bg-background;
  }
  /* Generic input (legacy utility used in a few places) */
  .input { @apply bg-background border border-border rounded-xl px-3 py-2; }
  .field-help {
    @apply text-xs opacity-70;
  }

  /* keep legacy helpers if referenced elsewhere */

  /* Action rows */
  .actions-row {
    @apply flex flex-wrap items-center gap-3;
  }

  /* Buttons */
  .btn {
    @apply inline-flex items-center justify-center h-10 px-3 rounded-xl border font-medium whitespace-nowrap;
  }

  .btn-sm {
    @apply h-8 px-2 text-sm;
  }

  .btn-lg {
    @apply h-12 px-4 text-base;
  }

  /* Button-like checkbox label */
  .btn-toggle {
    @apply btn btn-sm select-none gap-2;
  }
  .btn-toggle input[type="checkbox"] {
    /* keep visible & accessible but sized neatly */
    @apply h-4 w-4;
  }

  .ui-tooltip {
    @apply rounded-xl border shadow-lg px-3 py-2 text-sm leading-snug z-50
      max-w-64 break-words
      bg-white text-gray-900 border-gray-200;
  }

  /* Optional: dark mode emphasis */
  .dark .ui-tooltip {
    @apply bg-neutral-900 text-neutral-50 border-neutral-800 shadow-black/20;
  }
}

/* === Global dark theme tokens === */
:root {
  /* surfaces */
  --bg-app:        #0b0b0d;   /* page background */
  --bg-card:       #0f0f13;   /* cards/panels */
  --bg-card-alt:   #141419;   /* zebra rows / subtler blocks */
  --bg-elevated:   #0f0f13;   /* modals, dock */
  --panel:         26 28 33;  /* brighter elevated panel (drawer, explain) */

  /* borders & grid lines */
  --border-subtle: #2f3037;   /* neutral-700ish */
  --grid-line:     #25262c;

  /* text */
  --text-strong:   #fafafa;   /* titles/figures */
  --text:          #e6e6e7;   /* body */
  --text-muted:    #a6a7ad;   /* captions/labels */

  /* accents */
  --accent-good:   #34d399;   /* emerald-400 */
  --accent-bad:    #fb7185;   /* rose-400 */
  --accent-warn:   #f59e0b;   /* amber-500 */

  /* badges / chips */
  --chip-warn-bg:  rgba(245, 158, 11, 0.15);
  --chip-warn-br:  rgba(245, 158, 11, 0.4);

  /* tooltip */
  --tooltip-bg:    #0b0b0d;
  --tooltip-br:    #2f3037;
  --tooltip-text:  #e6e6e7;
}

body { @apply bg-neutral-950 text-neutral-100; }
.card { @apply bg-card border border-border rounded-2xl; }

/* Utility wrappers (optional but handy) */
.card-dark {
  background: var(--bg-card);
  border: 1px solid var(--border-subtle);
  color: var(--text);
  border-radius: 1rem; /* â‰ˆ rounded-2xl */
  box-shadow: 0 6px 20px rgba(0,0,0,0.35);
}
.card-title   { color: var(--text); font-weight: 600; }
.card-subtle  { color: var(--text-muted); }
.badge-warn {
  display: inline-flex; align-items: center; gap: .25rem;
  background: var(--chip-warn-bg);
  border: 1px solid var(--chip-warn-br);
  color: var(--accent-warn);
  border-radius: 9999px; padding: .125rem .5rem; font-size: .75rem;
}

/* Tailwind utility: fade-out animation for transient badges/notes */
@layer utilities {
  @keyframes fadeOut {
    0% { opacity: 1; }
    80% { opacity: 1; }
    100% { opacity: 0; }
  }
  .animate-fade-out {
    animation: fadeOut 4.5s forwards;
  }
}

/* Grounded badge styling for AgentChat */
.chat-badge-grounded {
  display: inline-block;
  font-size: 10px;
  letter-spacing: .06em;
  text-transform: uppercase;
  padding: 2px 6px;
  border-radius: 9999px;
  border: 1px solid hsl(var(--border));
  background: linear-gradient(0deg, hsla(var(--muted-foreground), .06), hsla(var(--muted-foreground), .10));
  margin-right: .5rem;
}

/* Demo polish: hide noisy chart footnotes that clip */
[data-testid="chart-tip"],
.card .tip { display: none !important; }


/* Robot thinking animations */
@keyframes robot-blink { 0%, 8%, 100% { transform: scaleY(1) } 4% { transform: scaleY(.1) } }
@keyframes robot-float { 0%,100% { transform: translateY(0) } 50% { transform: translateY(-4px) } }
@keyframes robot-mouth { 0% { transform: scaleY(.25) } 50% { transform: scaleY(1) } 100% { transform: scaleY(.25) } }
@keyframes robot-glow  { 0%,100% { opacity:.4 } 50% { opacity:.9 } }

.robot-animate-blink  { animation: robot-blink 3.2s infinite; transform-origin: center }
.robot-animate-float  { animation: robot-float 3s ease-in-out infinite }
.robot-animate-mouth  { animation: robot-mouth 1.2s ease-in-out infinite; transform-origin: bottom }
.robot-animate-mouth2 { animation: robot-mouth 1.2s ease-in-out .15s infinite; transform-origin: bottom }
.robot-animate-mouth3 { animation: robot-mouth 1.2s ease-in-out .30s infinite; transform-origin: bottom }
.robot-animate-glow   { animation: robot-glow 2.2s ease-in-out infinite }

/* Tiny polish: smooth chat autoscroll */
.chat-scroll { scroll-behavior: smooth; }


/* --- AGUI streaming status chips & ribbon --- */
@layer components {
  .agui-ribbon {
    @apply flex flex-wrap items-center gap-1.5 mb-2; /* sits above messages input */
  }
  .agui-chip-base {
    @apply inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-[10px] font-medium tracking-wide uppercase border select-none;
    letter-spacing: .06em;
  }
  .agui-chip-pending { @apply agui-chip-base bg-white/5 border-white/15 text-white/70; }
  .agui-chip-active  { @apply agui-chip-base bg-blue-500/15 border-blue-400/40 text-blue-300; }
  .agui-chip-done    { @apply agui-chip-base bg-emerald-500/15 border-emerald-400/40 text-emerald-300; }
  .agui-chip-error   { @apply agui-chip-base bg-rose-500/15 border-rose-400/40 text-rose-300; }
  .agui-chip-warn    { @apply agui-chip-base bg-amber-500/15 border-amber-400/40 text-amber-300; }

  /* subtle pulsing dot for active tool */
  @keyframes agui-pulse { 0%,100% { opacity:.35 } 50% { opacity:1 } }
  .agui-dot { @apply w-1.5 h-1.5 rounded-full bg-current opacity-60; }
  .agui-dot-pulse { animation: agui-pulse 1.2s ease-in-out infinite; }

  /* container that fades out after completion */
  @keyframes agui-fade-away { 0% { opacity:1 } 80% { opacity:1 } 100% { opacity:0 } }
  .agui-ribbon-fade { animation: agui-fade-away 5.5s forwards; }
}

/* Transaction row hover effects - ring highlight for better contrast */
@layer components {
  .transaction-row {
    @apply relative rounded-lg px-3 py-2 transition-shadow;
  }
  .transaction-row:hover {
    @apply ring-2 ring-primary/50 ring-offset-0;
  }
  .transaction-row:focus-visible {
    @apply ring-2 ring-primary/60 outline-none;
  }

  /* Pulse animation for successful category save */
  @keyframes pulse-success {
    0%, 100% {
      background-color: transparent;
    }
    50% {
      background-color: hsl(var(--primary) / 0.05);
    }
  }
  .animate-pulse-success {
    animation: pulse-success 1.5s ease-in-out;
  }
}

/* Optional: brighten grid lines slightly in transactions drawer */
.transactions-drawer .table {
  --tw-border-opacity: 0.2;
}

/* Hard neutralizer for brand logo: avoid accidental blending/filters */
img[data-brand-logo] {
  filter: none !important;
  mix-blend-mode: normal !important;
  opacity: 1 !important;
}

/* ---- Help mode highlight & stacking ---- */
html[data-help] [data-help-key] { position: relative; z-index: 9600; }
.help-popover { position: fixed; z-index: 70; max-width: 360px; }
html[data-help] [data-help-active="true"]::after {
  content: "";
  position: absolute; inset: -6px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,.18);
  box-shadow: 0 0 0 3px rgba(251,191,36,.25), 0 6px 22px rgba(0,0,0,.55);
  pointer-events: none;
}
