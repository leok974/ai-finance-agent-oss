[{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\App.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useMemo' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getMonthMerchants' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":55},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getMonthFlows' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":57,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":70},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'api' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":84,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":87},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":55,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3140,3143],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3140,3143],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3531,3534],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3531,3534],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'alerts' is assigned a value but never used. Allowed unused elements of array destructuring patterns must match /^_/u.","line":62,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":62,"endColumn":16},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":62,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3582,3585],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3582,3585],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":81,"column":114,"nodeType":"BlockStatement","messageId":"unexpected","endLine":81,"endColumn":116,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[4675,4675],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":86,"column":114,"nodeType":"BlockStatement","messageId":"unexpected","endLine":86,"endColumn":116,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[4940,4940],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":89,"column":15,"nodeType":"BlockStatement","messageId":"unexpected","endLine":89,"endColumn":17,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[4999,4999],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":115,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6009,6012],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6009,6012],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","message":"Definition for rule 'react-hooks/exhaustive-deps' was not found.","line":131,"column":5,"endLine":131,"endColumn":60,"severity":2,"nodeType":null},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":140,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":140,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6887,6890],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6887,6890],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":164,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":164,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7842,7845],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7842,7845],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":164,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":164,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7869,7872],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7869,7872],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":165,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":165,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7931,7934],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7931,7934],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":165,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":165,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7957,7960],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7957,7960],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":180,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":180,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[8516,8516],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":248,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":248,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11175,11178],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11175,11178],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":249,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":249,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11250,11253],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11250,11253],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":252,"column":134,"nodeType":"BlockStatement","messageId":"unexpected","endLine":252,"endColumn":136,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[11498,11498],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":16,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo, useState, useCallback, useEffect, useRef } from \"react\";\r\nimport { MonthContext } from \"./context/MonthContext\";\r\nimport UploadCsv from \"./components/UploadCsv\";\r\nimport UnknownsPanel from \"./components/UnknownsPanel\";\r\nimport SuggestionsPanel from \"./components/SuggestionsPanel\";\r\n// import RuleTesterPanel from \"./components/RuleTesterPanel\"; // rendered only inside DevDock\r\nimport { AgentResultRenderer } from \"./components/AgentResultRenderers\";\r\nimport { emitToastSuccess } from \"@/lib/toast-helpers\";\r\nimport { t } from '@/lib/i18n';\r\n// import RulesPanel from \"./components/RulesPanel\";\r\nimport { getAlerts, getMonthSummary, getMonthMerchants, getMonthFlows, getHealthz, api, resolveMonthFromCharts, agentTools } from './lib/api'\r\nimport { flags } from \"@/lib/flags\";\r\nimport AboutDrawer from './components/AboutDrawer';\r\nimport RulesPanel from \"./components/RulesPanel\";\r\nimport ChatDock from \"./components/ChatDock\";\r\nimport { useChatDockStore } from \"./stores/chatdock\";\r\nimport DevDock from \"@/components/dev/DevDock\";\r\nimport PlannerDevPanel from \"@/components/dev/PlannerDevPanel\";\r\nimport RuleTesterPanel from \"@/components/RuleTesterPanel\";\r\nimport { isDevUIEnabled, setDevUIEnabled, useDevUI } from \"@/state/useDevUI\";\r\nimport MLStatusCard from \"@/components/MLStatusCard\";\r\nimport { ChatDockProvider } from \"./context/ChatDockContext\";\r\nimport ChartsPanel from \"./components/ChartsPanel\";\r\nimport TopEmptyBanner from \"./components/TopEmptyBanner\";\r\n// import MLStatusCard from \"./components/MLStatusCard\"; // rendered only inside DevDock\r\nimport NetActivityBlip from \"@/components/NetActivityBlip\";\r\nimport LoginForm from \"@/components/LoginForm\";\r\nimport AccountMenu from \"@/components/AccountMenu\";\r\nimport { useAuth } from \"@/state/auth\";\r\n// import AgentChat from \"./components/AgentChat\"; // legacy chat bubble disabled\r\nimport { setGlobalMonth } from \"./state/month\";\r\n// Providers are applied at the top-level (main.tsx)\r\nimport RuleSuggestionsPersistentPanel from \"@/components/RuleSuggestionsPersistentPanel\";\r\nimport InsightsAnomaliesCard from \"./components/InsightsAnomaliesCard\";\r\nimport ErrorBoundary from \"@/components/ErrorBoundary\";\r\nimport DevBadge from \"@/components/dev/DevBadge\";\r\nimport HelpMode from \"@/components/HelpMode\";\r\nimport AppHelpMode from \"./AppHelpMode\";\r\nimport HelpExplainListener from \"@/components/HelpExplainListener\";\r\nimport { HelpPanelHost } from \"@/features/help/HelpPanel\";\r\nimport ForecastCard from \"@/components/ForecastCard\";\r\nimport TransactionsDrawer from \"@/components/TransactionsDrawer\";\r\nimport Brand from \"@/components/Brand\";\r\nimport TransactionsButton from \"@/components/header/TransactionsButton\";\r\nimport MonthPicker from \"@/components/header/MonthPicker\";\r\nimport DevMenu from \"@/components/dev/DevMenu\";\r\nimport logoPng from \"@/assets/ledgermind-lockup-1024.png\";\r\nimport { useLlmStore } from '@/state/llmStore';\r\n\r\n// Log frontend version info\r\nconsole.info(\"[Web] branch=\", __WEB_BRANCH__, \"commit=\", __WEB_COMMIT__);\r\n\r\n\r\nconst App: React.FC = () => {\r\n  const [devDockOpen, setDevDockOpen] = useState<boolean>(() => (import.meta as any).env?.VITE_DEV_UI === '1' || localStorage.getItem('DEV_DOCK') !== '0');\r\n  const devUI = useDevUI();\r\n  const [month, setMonth] = useState<string>(\"\");\r\n  const [ready, setReady] = useState<boolean>(false);\r\n  const [refreshKey, setRefreshKey] = useState<number>(0);\r\n  // Legacy report removed: using expanded insights and charts exclusively\r\n  const [insights, setInsights] = useState<any>(null)\r\n  const [alerts, setAlerts] = useState<any>(null)\r\n  const [empty, setEmpty] = useState<boolean>(false)\r\n  const [bannerDismissed, setBannerDismissed] = useState<boolean>(false)\r\n  const [txPanelOpen, setTxPanelOpen] = useState<boolean>(false)\r\n  const booted = useRef(false)\r\n  const [dbRev, setDbRev] = useState<string | null>(null);\r\n  const [inSync, setInSync] = useState<boolean | undefined>(undefined);\r\n\r\n  // Keyboard toggles: Ctrl+Alt+D soft session toggle (no reload), Ctrl+Shift+D hard persistent toggle (reload)\r\n  useEffect(() => {\r\n    const onKey = (e: KeyboardEvent) => {\r\n      try {\r\n        const keyD = e.key.toLowerCase() === 'd';\r\n        if (!keyD || !e.ctrlKey) return;\r\n        if (e.altKey && !e.shiftKey) {\r\n          // Soft toggle (session only)\r\n          const next = !isDevUIEnabled();\r\n          window.dispatchEvent(new CustomEvent('devui:soft', { detail: { value: next }}));\r\n          window.dispatchEvent(new CustomEvent('devui:changed', { detail: { value: next, soft: true }}));\r\n          try { emitToastSuccess?.(next ? t('ui.toast.dev_ui_soft_on') : t('ui.toast.dev_ui_soft_off')); } catch {}\r\n        } else if (e.shiftKey) {\r\n          // Hard persistent toggle\r\n          const next = !isDevUIEnabled();\r\n          setDevUIEnabled(next);\r\n          try { emitToastSuccess?.(next ? t('ui.toast.dev_ui_enabled') : t('ui.toast.dev_ui_disabled')); } catch {}\r\n          location.reload();\r\n        }\r\n      } catch {}\r\n    };\r\n    window.addEventListener(\"keydown\", onKey);\r\n    return () => window.removeEventListener(\"keydown\", onKey);\r\n  }, []);\r\n\r\n  // Initialize month once\r\n  async function resolveMonth(): Promise<string> {\r\n    // GET-only path compatible with older backend\r\n    const viaCharts = await resolveMonthFromCharts();\r\n    return viaCharts || \"\";\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (booted.current) return; // guard re-run in dev (StrictMode)\r\n    booted.current = true;\r\n    (async () => {\r\n      // Core readiness gate: fetch /api/status to decide whether to defer heavier chart calls\r\n      try {\r\n        const statusResp = await fetch('/api/status', { credentials: 'include' });\r\n        if (statusResp.ok) {\r\n          const st = await statusResp.json();\r\n          const coreReady = st?.db?.ok && st?.migrations?.ok;\r\n          if (!coreReady) {\r\n            console.warn('[boot] backend core not ready (db/migrations). Charts fetch will be deferred.');\r\n          } else {\r\n            (window as any).__CORE_READY__ = true;\r\n          }\r\n        }\r\n      } catch (e) {\r\n        console.warn('[boot] status probe failed', e);\r\n      }\r\n      console.info(\"[boot] resolving month…\");\r\n      const m = (await resolveMonth())\r\n        ?? (() => {\r\n             const now = new Date();\r\n             return `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,\"0\")}`;\r\n           })();\r\n      console.info(\"[boot] resolved month =\", m);\r\n      setMonth(m);\r\n      setReady(true);\r\n    })();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  const { user, authReady, logout } = useAuth();\r\n  const authOk = !!user;\r\n  // Load dashboard data whenever month changes (only when authenticated)\r\n  useEffect(() => {\r\n    if (!authOk || !month) return;\r\n    console.info(\"[boot] loading dashboards for month\", month);\r\n    const coreReady = (window as any).__CORE_READY__ === true;\r\n    if (!coreReady) {\r\n      console.info('[boot] skipping charts prefetch (core not ready)');\r\n      return;\r\n    }\r\n    void Promise.allSettled([\r\n      agentTools.chartsSummary({ month }),\r\n      agentTools.chartsMerchants({ month, limit: 10 }),\r\n      agentTools.chartsFlows({ month }),\r\n      agentTools.chartsSpendingTrends({ month, months_back: 6 }),\r\n    ]);\r\n  }, [authOk, month]);\r\n\r\n  // Log DB health once after CORS/DB are good (boot complete) and capture db revision\r\n  useEffect(() => {\r\n    let alive = true;\r\n    (async () => {\r\n      try {\r\n        const h = await getHealthz();\r\n        if (!alive) return;\r\n        const db = h?.db_engine || 'unknown-db';\r\n        const mig = h?.alembic_ok ?? h?.alembic?.in_sync ?? 'unknown';\r\n        // models_ok was formerly supplied by backend; prefer llmStore derived state now\r\n        const llmModelsOk = useLlmStore.getState().modelsOk;\r\n        setDbRev((h as any)?.db_revision ?? (h as any)?.alembic?.db_revision ?? null);\r\n        setInSync((h as any)?.alembic_ok ?? (h as any)?.alembic?.in_sync);\r\n        console.log(`[db] ${db} loaded | alembic_ok=${String(mig)} | models_ok=${String(llmModelsOk)}`);\r\n      } catch (e) {\r\n        console.warn('[db] healthz failed:', e);\r\n      }\r\n    })();\r\n    return () => { alive = false; };\r\n  }, []);\r\n\r\n  // Load insights and alerts separately for state management\r\n  useEffect(()=>{ (async()=>{\r\n  if (!authOk || !ready || !month) return;\r\n    try {\r\n      setInsights(await agentTools.insightsExpanded({ month, large_limit: 10 }))\r\n      setAlerts(await getAlerts(month))\r\n    } catch {}\r\n  })() }, [authOk, ready, month, refreshKey])\r\n\r\n  // Probe backend emptiness (latest by default). If charts summary returns null or month:null, show banner.\r\n  useEffect(() => { (async () => {\r\n  if (!authOk || !ready || !month) return;\r\n    try {\r\n      const s = await getMonthSummary(month);\r\n      setEmpty(!s || s?.month == null);\r\n    } catch {\r\n      setEmpty(true);\r\n    }\r\n  })() }, [authOk, ready, month, refreshKey])\r\n\r\n  const onCsvUploaded = useCallback(() => {\r\n    setRefreshKey((k) => k + 1);\r\n  emitToastSuccess(t('ui.toast.csv_ingested_title'), { description: t('ui.toast.csv_ingested_description') });\r\n  }, []);\r\n\r\n  const refreshLlm = useLlmStore(s => s.refresh);\r\n  useEffect(() => { refreshLlm({ refreshModels: true }); }, [refreshLlm]);\r\n\r\n  const showChatDock = useChatDockStore(s => s.visible);\r\n\r\n  // Always call hooks above; render gates below\r\n  if (!ready || !authReady) return <div className=\"p-6 text-[color:var(--text-muted)]\">Loading…</div>;\r\n  if (!authOk) return (\r\n    <div className=\"p-6\">\r\n      <div className=\"max-w-md mx-auto\">\r\n        <div className=\"mb-6 flex items-center justify-center\">\r\n          <img\r\n            src={logoPng}\r\n            alt=\"\"\r\n            width={40}\r\n            height={40}\r\n            decoding=\"async\"\r\n            fetchPriority=\"high\"\r\n            className=\"mr-2 h-10 w-10 rounded-[8px] ring-1 ring-white/10\"\r\n          />\r\n          <span className=\"text-xl font-semibold\">LedgerMind</span>\r\n        </div>\r\n        <LoginForm />\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  return (\r\n  <MonthContext.Provider value={{ month, setMonth }}>\r\n      <ChatDockProvider>\r\n  <NetActivityBlip />\r\n      <div className=\"min-h-screen bg-gray-50 text-gray-900 p-6 dark:bg-gray-950 dark:text-gray-100\">\r\n  <HelpMode />\r\n  <AppHelpMode />\r\n  <HelpPanelHost />\r\n  <HelpExplainListener />\r\n  {/* Ensure this container is relative so ChatDock (absolute) positions within it */}\r\n  <div className=\"relative\">\r\n          <div className=\"mx-auto max-w-6xl space-y-6\">\r\n  <header className=\"flex items-center justify-between gap-3 min-h-24 md:min-h-28 lg:min-h-32 xl:min-h-36 2xl:min-h-40\">\r\n          <Brand />\r\n          <div className=\"flex items-center gap-3\">\r\n            <AboutDrawer showButton={false} />\r\n            <TransactionsButton open={txPanelOpen} onOpen={() => setTxPanelOpen(true)} />\r\n            <MonthPicker value={month} onChange={(m)=>{ setMonth(m); setGlobalMonth(m); }} />\r\n            {flags.dev && <DevMenu />}\r\n            {flags.dev && (\r\n              <DevBadge\r\n                // show branch/commit if available via globals\r\n                branch={String((globalThis as any).__WEB_BRANCH__ ?? '')}\r\n                commit={String((globalThis as any).__WEB_COMMIT__ ?? '')}\r\n                openDevDock={devDockOpen}\r\n                onToggleDevDock={() => {\r\n                  const next = !devDockOpen; setDevDockOpen(next); try { localStorage.setItem('DEV_DOCK', next ? '1' : '0'); } catch {}\r\n                }}\r\n              />\r\n            )}\r\n            {authOk && (\r\n              <AccountMenu email={user?.email} onLogout={logout} />\r\n            )}\r\n          </div>\r\n        </header>\r\n  {/* Global mount of RuleTesterPanel (portal overlay) gated by dev flag */}\r\n  {devUI && <RuleTesterPanel />}\r\n\r\n        {!bannerDismissed && empty && (\r\n          <TopEmptyBanner dbRev={dbRev ?? undefined} inSync={inSync} onDismiss={() => setBannerDismissed(true)} />\r\n        )}\r\n\r\n        {/* Upload CSV */}\r\n        <section className=\"panel p-4 md:p-5\">\r\n          <UploadCsv defaultReplace={true} onUploaded={onCsvUploaded} />\r\n        </section>\r\n\r\n        {/* Insights */}\r\n        <div className=\"section\">\r\n          {insights && <AgentResultRenderer tool=\"insights.expanded\" data={insights} />}\r\n          {/* Anomalies quick card */}\r\n          <InsightsAnomaliesCard />\r\n        </div>\r\n  {/* Agent chat box (legacy) — disabled; use ChatDock instead */}\r\n  {/* <AgentChat /> */}\r\n  {/* ChartsPanel now requires month; always pass the selected month */}\r\n  <ChartsPanel month={month} refreshKey={refreshKey} />\r\n\r\n        {/* Forecast (model + CI controls) */}\r\n        <div className=\"section\">\r\n          <ForecastCard />\r\n        </div>\r\n\r\n        {/* Main grid */}\r\n        <div className=\"section\">\r\n          <div className=\"grid grid-cols-1 gap-6 md:grid-cols-2\">\r\n            <UnknownsPanel month={month} refreshKey={refreshKey} />\r\n            <SuggestionsPanel />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Persistent rule suggestions table */}\r\n        <div id=\"rule-suggestions\" className=\"section\">\r\n          <ErrorBoundary fallback={(e)=> <div className=\"text-sm text-red-500\">Failed to render suggestions: {String(e?.message||e)}</div>}>\r\n            <RuleSuggestionsPersistentPanel />\r\n          </ErrorBoundary>\r\n        </div>\r\n\r\n        {/* Rules + Rule Tester + ML Status */}\r\n        <div className=\"section\">\r\n          <div className=\"grid gap-6 lg:grid-cols-2\">\r\n            <RulesPanel refreshKey={refreshKey} />\r\n            {(devUI && flags.ruleTester) ? <RuleTesterPanel /> : <div className=\"hidden lg:block\" />}\r\n            {flags.mlSelftest ? (\r\n              <div className=\"lg:col-span-2\">\r\n                <MLStatusCard />\r\n              </div>\r\n            ) : null}\r\n          </div>\r\n        </div>\r\n          {showChatDock && <ChatDock data-chatdock-root />}\r\n\r\n          {/* Dev Dock at very bottom: only Planner DevTool */}\r\n          {flags.dev && (\r\n            <DevDock open={devDockOpen}>\r\n              {flags.planner && <PlannerDevPanel />}\r\n            </DevDock>\r\n          )}\r\n          {/* DevFab & DevModeSwitch removed to reduce redundancy; dropdown + keyboard remain */}\r\n        </div>\r\n      </div>\r\n  </div>\r\n      <TransactionsDrawer open={txPanelOpen} onClose={() => setTxPanelOpen(false)} />\r\n  </ChatDockProvider>\r\n    </MonthContext.Provider>\r\n  );\r\n};\r\n\r\nexport default App;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\AppHelpMode.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\__tests__\\ChatDock.saveRuleButton.smoke.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[527,530],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[527,530],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, beforeAll, vi } from 'vitest';\r\nimport { render, screen } from '@testing-library/react';\r\nimport userEvent from '@testing-library/user-event';\r\n\r\n// Silence AGUI streaming side-effects\r\nvi.mock('@/lib/aguiStream', () => ({\r\n  wireAguiStream: vi.fn(() => ({ start: () => {}, stop: () => {} })),\r\n}));\r\n\r\nimport Providers from '@/components/Providers';\r\nimport ChatDock from '@/components/ChatDock';\r\n\r\ndescribe('ChatDock — Save Rule button smoke', () => {\r\n  beforeAll(() => {\r\n    (globalThis as any).__FORCE_SAVE_RULE_BUTTON__ = true;\r\n  });\r\n\r\n  it('renders the manual Save Rule… button and opens the modal', async () => {\r\n    render(\r\n      <Providers>\r\n        <ChatDock />\r\n      </Providers>\r\n    );\r\n\r\n    const user = userEvent.setup();\r\n    // Open the panel first (bubble button with title)\r\n    const bubble = await screen.findByRole('button', { name: /open agent chat/i });\r\n    await user.click(bubble);\r\n  const saveButtons = await screen.findAllByRole('button', { name: /save rule/i });\r\n  expect(saveButtons.length).toBeGreaterThan(0);\r\n  // Prefer the test-only button with aria-label exactly 'Save Rule…'\r\n  const target = saveButtons.find(b => b.getAttribute('aria-label')?.toLowerCase().startsWith('save rule')) || saveButtons[0];\r\n  await user.click(target);\r\n\r\n    const title = await screen.findByText(/save as rule/i);\r\n    expect(title).toBeTruthy();\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\__tests__\\ChatDock.skipped-tools.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[305,308],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[305,308],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[366,369],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[366,369],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[381,384],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[381,384],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[665,668],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[665,668],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[684,687],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[684,687],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[708,711],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[708,711],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi } from 'vitest'\r\nimport { render, screen, waitFor, act } from '@testing-library/react'\r\nimport userEvent from '@testing-library/user-event'\r\n\r\n// Mock aguiStream with the actual two-arg signature used in ChatDock\r\nvi.mock('@/lib/aguiStream', () => {\r\n  let lastHandlers: any = null;\r\n  return {\r\n    wireAguiStream: vi.fn((_params: any, handlers: any) => { lastHandlers = handlers; return () => {}; }),\r\n    __getHandlers: () => lastHandlers,\r\n  };\r\n});\r\n\r\nimport Providers from '@/components/Providers'\r\nimport ChatDock from '@/components/ChatDock'\r\nimport { wireAguiStream } from '@/lib/aguiStream'\r\n\r\nfunction latestHandlers(): any {\r\n  const fn: any = wireAguiStream as any;\r\n  const calls = fn.mock?.calls || [];\r\n  if (!calls.length) return null;\r\n  return calls[calls.length - 1][1];\r\n}\r\n\r\ndescribe('ChatDock — skipped tools summary', () => {\r\n  it('renders chips and a “Skipped:” summary with prettified names', async () => {\r\n    render(\r\n      <Providers>\r\n        <ChatDock />\r\n      </Providers>\r\n    )\r\n\r\n    const user = userEvent.setup()\r\n    // Open floating bubble first\r\n    const bubble = await screen.findByRole('button', { name: /open agent chat/i });\r\n    await user.click(bubble);\r\n    // Click forecast quick button\r\n    const forecastBtn = await screen.findByRole('button', { name: /^forecast$/i });\r\n    await user.click(forecastBtn);\r\n\r\n    await waitFor(() => expect(wireAguiStream).toHaveBeenCalledTimes(1));\r\n    const h = latestHandlers();\r\n    expect(h).toBeTruthy();\r\n    await act(async () => {\r\n      h.onStart?.({ intent: 'forecast', month: '2025-08' });\r\n      h.onIntent?.('forecast', { intent: 'forecast' });\r\n      h.onToolStart?.('analytics.kpis');\r\n      h.onToolEnd?.('analytics.kpis', true);\r\n      h.onToolStart?.('analytics.alerts');\r\n      h.onToolEnd?.('analytics.alerts', false, 'no anomalies window');\r\n      h.onToolStart?.('analytics.forecast.cashflow');\r\n      h.onToolEnd?.('analytics.forecast.cashflow', false, 'not enough history');\r\n      h.onChunk?.('Partial results; some tools were skipped.');\r\n      h.onFinish?.();\r\n    });\r\n\r\n    // Locate the assistant message containing the skipped summary (scan textContent to avoid node splitting quirks)\r\n    await waitFor(() => expect(document.body.textContent).toMatch(/Skipped/i));\r\n    const txt = document.body.textContent || '';\r\n    expect(txt).toMatch(/alerts/);\r\n    expect(txt).toMatch(/forecast\\.cashflow/);\r\n  })\r\n})\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\__tests__\\RuleTesterPanel.save.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[331,334],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[331,334],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[478,481],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[478,481],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1238,1241],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1238,1241],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1492,1495],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1492,1495],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":46,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1719,1722],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1719,1722],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":46,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1741,1744],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1741,1744],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1827,1830],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1827,1830],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1863,1866],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1863,1866],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi } from 'vitest';\r\nimport { render, screen, waitFor } from '@testing-library/react';\r\nimport userEvent from '@testing-library/user-event';\r\nimport React from 'react';\r\n\r\n// Do not override crypto; treat idempotency key as opaque.\r\n\r\nvi.mock('@/lib/schemas', () => ({ ThresholdsSchema: { parse: (x: any) => x || {} } }));\r\n\r\nvi.mock('@/api', () => {\r\n  const saveRule = vi.fn(async () => ({ display_name: 'Auto: test rule' }));\r\n  (globalThis as any).__saveRuleSpy = saveRule;\r\n  return { saveRule, testRule: vi.fn(async () => []), saveTrainReclassify: vi.fn() };\r\n});\r\nvi.mock('@/lib/toast-helpers', () => {\r\n  const success = vi.fn();\r\n  const error = vi.fn();\r\n  return {\r\n    toast: { success, error },\r\n    emitToastSuccess: success,\r\n    emitToastError: error,\r\n    showToast: success,\r\n    useOkErrToast: () => ({ ok: success, err: error })\r\n  };\r\n});\r\n\r\nimport RuleTesterPanel from '@/components/RuleTesterPanel';\r\nimport { TooltipProvider } from '@radix-ui/react-tooltip';\r\n\r\ndescribe('RuleTesterPanel simple save', () => {\r\n  it('calls saveRule with draft-derived payload', async () => {\r\n  render(<TooltipProvider><RuleTesterPanel /></TooltipProvider>);\r\n  await waitFor(() => expect((window as any).__openRuleTester).toBeTypeOf('function'));\r\n    const draft = {\r\n      name: 'If merchant contains \"STARBUCKS\"',\r\n      when: { merchant: 'STARBUCKS', thresholds: { minConfidence: 0.66 } },\r\n      then: { category: 'Coffee' },\r\n    };\r\n  (window as any).__openRuleTester(draft);\r\n\r\n    const user = userEvent.setup();\r\n    const btn = await screen.findByRole('button', { name: /save/i });\r\n    await user.click(btn);\r\n\r\n    await waitFor(() => {\r\n      expect(((globalThis as any).__saveRuleSpy as any).mock.calls.length).toBe(1);\r\n    });\r\n    const [payload, opts] = (globalThis as any).__saveRuleSpy.mock.calls[0] as any;\r\n    expect(payload).toMatchObject({\r\n      rule: {\r\n        name: expect.stringMatching(/STARBUCKS/i),\r\n    when: { description_like: 'STARBUCKS' },\r\n        then: { category: 'Coffee' },\r\n      },\r\n    });\r\n  expect(typeof opts?.idempotencyKey).toBe('string');\r\n  expect((opts?.idempotencyKey as string).length).toBeGreaterThan(10);\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\__tests__\\RuleTesterPanel.seed.event.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[337,340],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[337,340],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[481,484],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[481,484],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1499,1502],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1499,1502],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2007,2010],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2007,2010],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2096,2099],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2096,2099],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2132,2135],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2132,2135],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi } from 'vitest';\r\nimport { render, screen, waitFor } from '@testing-library/react';\r\nimport userEvent from '@testing-library/user-event';\r\nimport React from 'react';\r\n\r\n// No need to override crypto; idempotency key not asserted here.\r\n\r\nvi.mock('@/lib/schemas', () => ({ ThresholdsSchema: { parse: (x: any) => x || {} } }));\r\n\r\nvi.mock('@/api', () => {\r\n  const saveRule = vi.fn(async () => ({ display_name: 'Auto: seeded' }));\r\n  (globalThis as any).__saveRuleSpy = saveRule; // expose for assertions\r\n  return { saveRule, testRule: vi.fn(async () => []), saveTrainReclassify: vi.fn() };\r\n});\r\nvi.mock('@/lib/toast-helpers', () => {\r\n  const success = vi.fn((msg: string) => {\r\n    const div = document.createElement('div');\r\n    div.dataset['sonnerToast'] = 'true';\r\n    div.textContent = msg || '';\r\n    document.body.appendChild(div);\r\n  });\r\n  const error = vi.fn();\r\n  return {\r\n    toast: { success, error },\r\n    emitToastSuccess: success,\r\n    emitToastError: error,\r\n    showToast: success,\r\n    useOkErrToast: () => ({ ok: success, err: error })\r\n  };\r\n});\r\n\r\nimport RuleTesterPanel from '@/components/RuleTesterPanel';\r\nimport { TooltipProvider } from '@radix-ui/react-tooltip';\r\nimport type { SeedDraft } from '@/lib/rulesSeed';\r\n\r\ndescribe('RuleTesterPanel seeded month flow', () => {\r\n  it('uses seeded month in save payload', async () => {\r\n  render(<TooltipProvider><RuleTesterPanel /></TooltipProvider>);\r\n  await waitFor(() => expect((window as any).__openRuleTester).toBeTypeOf('function'));\r\n    const user = userEvent.setup();\r\n\r\n    const draft: SeedDraft = {\r\n      name: 'If merchant contains \"STARBUCKS\"',\r\n      when: { merchant: 'STARBUCKS' },\r\n      then: { category: 'Coffee' },\r\n      month: '2025-08',\r\n    };\r\n    window.dispatchEvent(new CustomEvent('ruleTester:seed', { detail: draft }));\r\n\r\n    const btn = await screen.findByRole('button', { name: /save/i });\r\n    await user.click(btn);\r\n\r\n  await waitFor(() => expect((globalThis as any).__saveRuleSpy).toHaveBeenCalledTimes(1));\r\n  const [payload, opts] = (globalThis as any).__saveRuleSpy.mock.calls[0] as any;\r\n    expect(payload).toMatchObject({\r\n      month: '2025-08',\r\n      rule: {\r\n        when: { description_like: 'STARBUCKS' },\r\n        then: { category: 'Coffee' },\r\n      },\r\n    });\r\n  expect(opts?.idempotencyKey).toBeTruthy();\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\__tests__\\RuleTesterPanel.seed.queue.test.tsx","messages":[{"ruleId":"@typescript-eslint/triple-slash-reference","severity":2,"message":"Do not use a triple slash reference for vitest, use `import` style instead.","line":1,"column":1,"nodeType":"Line","messageId":"tripleSlashReference","endLine":1,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'waitFor' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":33},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":11,"column":3,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":11,"endColumn":16,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[379,392],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":14,"column":3,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":14,"endColumn":16,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[471,484],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[735,738],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[735,738],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":68,"column":5,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":68,"endColumn":40,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[2397,2432],"text":"// @ts-expect-error (global augmentation)"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/// <reference types=\"vitest\" />\r\n/// <reference types=\"vite/client\" />\r\nimport { describe, it, beforeEach, expect, vi } from 'vitest';\r\nimport { render, screen, waitFor } from '@testing-library/react';\r\nimport React from 'react';\r\n\r\n// Provide deterministic crypto for idempotency key path if triggered\r\nbeforeEach(() => {\r\n  // No crypto override needed\r\n  // Clean globals\r\n  // @ts-ignore\r\n  delete window.__openRuleTester;\r\n  // Queue pending seed prior to mount\r\n  // @ts-ignore\r\n  window.__pendingRuleSeed = {\r\n    name: 'If merchant contains \"QUEUED\"',\r\n    when: { merchant: 'QUEUED' },\r\n    then: { category: 'QueuedCat' },\r\n    month: '2025-09'\r\n  };\r\n});\r\n\r\nvi.mock('@/lib/schemas', () => ({ ThresholdsSchema: { parse: (x: any) => x || {} } }));\r\n\r\n// Avoid network code paths; we only assert the queued draft populates form on mount.\r\nvi.mock('@/api', () => ({\r\n  saveRule: vi.fn(),\r\n  testRule: vi.fn(async () => []),\r\n  saveTrainReclassify: vi.fn()\r\n}));\r\nvi.mock('@/lib/toast-helpers', () => {\r\n  const success = vi.fn();\r\n  const error = vi.fn();\r\n  return {\r\n    toast: { success, error },\r\n    emitToastSuccess: success,\r\n    emitToastError: error,\r\n    showToast: success,\r\n    useOkErrToast: () => ({ ok: success, err: error })\r\n  };\r\n});\r\n\r\nimport RuleTesterPanel from '@/components/RuleTesterPanel';\r\nimport { TooltipProvider } from '@radix-ui/react-tooltip';\r\n\r\n/*\r\n  This test simulates a seed arriving before the panel mounts by priming window.__pendingRuleSeed.\r\n  On mount, the panel should consume it, open itself, and populate description/category fields.\r\n*/\r\n\r\ndescribe('RuleTesterPanel queued seed consumption', () => {\r\n  it('opens and populates from __pendingRuleSeed on first mount', async () => {\r\n  render(<TooltipProvider><RuleTesterPanel /></TooltipProvider>);\r\n\r\n    // The panel renders as a portal overlay when open: look for heading\r\n    const heading = await screen.findByRole('heading', { name: /rule tester/i });\r\n    expect(heading).toBeInTheDocument();\r\n\r\n    // Merchant / description_like field becomes the match input\r\n    const matchInput = await screen.findByPlaceholderText(/case-insensitive/i);\r\n    expect(matchInput).toHaveValue('QUEUED');\r\n\r\n    // Category field\r\n    const categoryField = await screen.findByPlaceholderText(/subscriptions/i);\r\n    expect(categoryField).toHaveValue('QueuedCat');\r\n\r\n    // Ensure queue was cleared\r\n    // @ts-ignore (global augmentation)\r\n    expect(window.__pendingRuleSeed).toBeNull();\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\__tests__\\RuleTesterPanel.seed.replace.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[325,328],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[325,328],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi } from 'vitest';\r\nimport { render, screen, waitFor } from '@testing-library/react';\r\nimport userEvent from '@testing-library/user-event';\r\nimport React from 'react';\r\n\r\n// No need to stub crypto; test does not perform save\r\n\r\nvi.mock('@/lib/schemas', () => ({ ThresholdsSchema: { parse: (x: any) => x || {} } }));\r\n\r\nvi.mock('@/api', () => ({\r\n  saveRule: async () => ({ display_name: 'n/a' }),\r\n  testRule: async () => [],\r\n  saveTrainReclassify: async () => ({})\r\n}));\r\nvi.mock('@/lib/toast-helpers', () => {\r\n  const success = vi.fn();\r\n  const error = vi.fn();\r\n  return {\r\n    toast: { success, error },\r\n    emitToastSuccess: success,\r\n    emitToastError: error,\r\n    showToast: success,\r\n    useOkErrToast: () => ({ ok: success, err: error })\r\n  };\r\n});\r\n\r\nimport RuleTesterPanel from '@/components/RuleTesterPanel';\r\nimport { TooltipProvider } from '@radix-ui/react-tooltip';\r\nimport type { SeedDraft } from '@/lib/rulesSeed';\r\n\r\n/*\r\n  This test validates that when the panel is already open with an existing draft,\r\n  a subsequent live ruleTester:seed event fully overwrites the editable draft fields\r\n  (match description_like, category, name) and updates the seededMonth used for saving.\r\n*/\r\n\r\ndescribe('RuleTesterPanel replacement seed events', () => {\r\n  it('overwrites existing draft fields & month on second seed event', async () => {\r\n    render(\r\n      <TooltipProvider>\r\n        <RuleTesterPanel />\r\n      </TooltipProvider>\r\n    );\r\n    const user = userEvent.setup();\r\n\r\n    const first: SeedDraft = {\r\n      name: 'First seed',\r\n      when: { merchant: 'FIRST' },\r\n      then: { category: 'CatA' },\r\n      month: '2025-07'\r\n    };\r\n    window.dispatchEvent(new CustomEvent('ruleTester:seed', { detail: first }));\r\n\r\n    // Ensure first seed populated\r\n  const matchInput = await screen.findByPlaceholderText(/case-insensitive/);\r\n    expect(matchInput).toHaveValue('FIRST');\r\n    const categoryField = await screen.findByPlaceholderText(/subscriptions/i);\r\n    expect(categoryField).toHaveValue('CatA');\r\n\r\n    // Modify locally to ensure replacement truly overrides user edits\r\n    await user.clear(matchInput); await user.type(matchInput, 'LOCAL');\r\n    await user.clear(categoryField); await user.type(categoryField, 'LocalCat');\r\n\r\n    const second: SeedDraft = {\r\n      name: 'Second seed',\r\n      when: { merchant: 'SECOND' },\r\n      then: { category: 'CatB' },\r\n      month: '2025-08'\r\n    };\r\n    window.dispatchEvent(new CustomEvent('ruleTester:seed', { detail: second }));\r\n\r\n    // Fields should reflect second seed, not prior local edits (allow state flush)\r\n    await waitFor(() => {\r\n      expect(matchInput).toHaveValue('SECOND');\r\n      expect(categoryField).toHaveValue('CatB');\r\n    });\r\n\r\n    // Replacement success criteria: fields reflect second seed; no need to assert save path here\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\__tests__\\RulesPanel.badge.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[207,210],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[207,210],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[280,283],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[280,283],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[314,317],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[314,317],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[358,361],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[358,361],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[984,987],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[984,987],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1185,1188],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1185,1188],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, beforeEach, vi } from 'vitest'\r\nimport { render, screen, waitFor } from '@testing-library/react'\r\nimport React from 'react'\r\n\r\nvi.mock('@/api', async (orig) => {\r\n  const mod: any = await orig();\r\n  return {\r\n    ...mod,\r\n    getRules: async (...a: any[]) => {\r\n      (globalThis as any).__rules_getCalls = [ ...(globalThis as any).__rules_getCalls || [], a ];\r\n      return {\r\n        items: [\r\n          {\r\n            id: 'r1',\r\n            display_name: 'Rule A',\r\n            name: 'Rule A',\r\n            when: { thresholds: { minConfidence: 0.66, budgetPercent: 25, limit: 200 }, merchant: 'STARBUCKS' },\r\n            then: { category: 'Coffee' },\r\n            active: true,\r\n          },\r\n        ],\r\n        total: 1,\r\n      }\r\n    }\r\n  }\r\n});\r\n\r\nimport RulesPanel from '@/components/RulesPanel'\r\nimport { TooltipProvider } from '@/components/ui/tooltip'\r\n\r\ndescribe('RulesPanel — thresholds badge', () => {\r\n  beforeEach(() => { (globalThis as any).__rules_getCalls = [] })\r\n\r\n  it('renders a badge summarizing thresholds', async () => {\r\n  render(<TooltipProvider><RulesPanel /></TooltipProvider>)\r\n  await waitFor(() => expect(((globalThis as any).__rules_getCalls || []).length).toBeGreaterThan(0))\r\n\r\n    expect(await screen.findByText(/Rule A/i)).toBeInTheDocument();\r\n\r\n    const badge = await screen.findByText(/Thresholds:.*0\\.66/i)\r\n    expect(badge.textContent).toMatch(/25%/)\r\n    expect(badge.textContent).toMatch(/200/) // limit indicator\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\__tests__\\SaveRuleModal.basic.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[551,554],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[551,554],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[661,664],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[661,664],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1438,1441],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1438,1441],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1471,1474],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1471,1474],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1522,1525],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1522,1525],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1555,1558],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1555,1558],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1599,1602],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1599,1602],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":66,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2552,2555],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2552,2555],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2685,2688],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2685,2688],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":71,"column":61,"nodeType":"BlockStatement","messageId":"unexpected","endLine":71,"endColumn":63,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[2789,2789],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2823,2826],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2823,2826],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi } from 'vitest';\r\nimport { render, screen, waitFor, fireEvent } from '@testing-library/react';\r\nimport { clickToastAction } from './utils/toast';\r\nimport userEvent from '@testing-library/user-event';\r\n\r\nvi.mock('@/lib/api', () => {\r\n  const saveRule = vi.fn(async () => ({ display_name: 'Auto: Dining spend -10%' }));\r\n  return { saveRule, __saveRuleMock: saveRule };\r\n});\r\n\r\n// Simplify thresholds parsing to avoid zod dependency differences in test\r\nvi.mock('@/lib/schemas', () => ({ ThresholdsSchema: { parse: (x: any) => x || {} } }));\r\n\r\nvi.mock('@/lib/toast-helpers', () => {\r\n  const success = vi.fn((msg: string, opts: any = {}) => {\r\n    const div = document.createElement('div');\r\n    div.dataset['sonnerToast'] = 'true';\r\n    div.textContent = msg || 'Rule saved';\r\n    document.body.appendChild(div);\r\n    if (opts?.action?.label) {\r\n      const btn = document.createElement('button');\r\n      btn.textContent = opts.action.label;\r\n      div.appendChild(btn);\r\n    }\r\n  });\r\n  const error = vi.fn();\r\n  return {\r\n    showToast: success,\r\n    toast: { success, error },\r\n    emitToastSuccess: success,\r\n    emitToastError: error,\r\n    useOkErrToast: () => ({ ok: success, err: error })\r\n  };\r\n});\r\n\r\nimport SaveRuleModal from '@/components/SaveRuleModal';\r\nimport * as apiModule from '@/lib/api';\r\n\r\n// Ensure crypto.randomUUID exists for idempotencyKey usage in component\r\nif (!(globalThis as any).crypto) {\r\n  (globalThis as any).crypto = { randomUUID: () => 'test-uuid' } as any;\r\n} else if (!(globalThis as any).crypto.randomUUID) {\r\n  (globalThis as any).crypto.randomUUID = () => 'test-uuid';\r\n}\r\n\r\nfunction setup() {\r\n  const onOpenChange = vi.fn();\r\n  render(<SaveRuleModal open={true} onOpenChange={onOpenChange} month=\"2025-08\" scenario=\"Dining spend -10%\" defaultCategory=\"Dining\" />);\r\n  return { onOpenChange };\r\n}\r\n\r\ndescribe('SaveRuleModal (unit)', () => {\r\n  it('submits with scenario + category and calls saveRule', async () => {\r\n    const { onOpenChange } = setup();\r\n    const nameInput = await screen.findByLabelText(/rule name/i);\r\n    expect((nameInput as HTMLInputElement).value).toMatch(/Dining spend -10%/i);\r\n\r\n    // Adjust a threshold field for coverage\r\n    const minConf = await screen.findByLabelText(/min confidence/i);\r\n    await userEvent.clear(minConf);\r\n    await userEvent.type(minConf, '0.7');\r\n\r\n    const submit = screen.getByRole('button', { name: /save rule/i });\r\n    await userEvent.click(submit);\r\n    const form = submit.closest('form');\r\n    if ((apiModule as any).saveRule.mock.calls.length === 0 && form) {\r\n      fireEvent.submit(form);\r\n    }\r\n\r\n  await waitFor(() => expect((apiModule as any).saveRule).toHaveBeenCalledTimes(1));\r\n  try { await clickToastAction(/view rules/i, 300); } catch {}\r\n    const call = (apiModule as any).saveRule.mock.calls[0][0];\r\n    expect(call).toEqual(expect.objectContaining({\r\n      rule: expect.objectContaining({ name: expect.stringMatching(/Dining spend -10%/i) }),\r\n      month: '2025-08'\r\n    }));\r\n    expect(onOpenChange).toHaveBeenCalledWith(false);\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\__tests__\\SaveRuleModal.unit.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[318,321],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[318,321],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[338,341],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[338,341],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[877,880],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[877,880],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2351,2354],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2351,2354],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":115,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4029,4032],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4029,4032],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, beforeAll, vi } from \"vitest\";\r\nimport { render, screen, waitFor, fireEvent } from \"@testing-library/react\";\r\nimport userEvent from \"@testing-library/user-event\";\r\nimport React from \"react\";\r\n\r\n// --- Stable UUID so we can assert/avoid randomness ---\r\nbeforeAll(() => {\r\n  const target: any = globalThis as any;\r\n  if (target.crypto && typeof target.crypto.randomUUID === 'function') {\r\n    vi.spyOn(target.crypto, 'randomUUID').mockReturnValue('00000000-0000-4000-8000-000000000000');\r\n  } else {\r\n    Object.defineProperty(target, 'crypto', { value: { randomUUID: () => '00000000-0000-4000-8000-000000000000' }, configurable: true });\r\n  }\r\n});\r\n\r\n// --- MOCK: schemas parse (bypass validation) ---\r\n// Important: this mock must be hoisted before SaveRuleModal import\r\nvi.mock(\"@/lib/schemas\", () => ({\r\n  ThresholdsSchema: {\r\n    parse: (obj: any) => obj, // permissive passthrough\r\n  },\r\n}));\r\n\r\n// --- MOCK: saveRule capture (define inside factory to avoid TDZ) ---\r\nvi.mock(\"@/lib/api\", () => {\r\n  const saveRuleSpy = vi.fn(async () => ({\r\n    ok: true,\r\n    id: \"r-123\",\r\n    display_name: \"Auto: cut groceries 20%\",\r\n    source: \"json\",\r\n    idempotency_reused: false,\r\n    ack: \"[ack] rules.save: ok (1)\",\r\n  }));\r\n  return { saveRule: saveRuleSpy, __saveRuleSpy: saveRuleSpy };\r\n});\r\n\r\n// --- MOCK: hush toasts ---\r\nvi.mock(\"@/lib/toast-helpers\", () => {\r\n  const success = vi.fn();\r\n  const error = vi.fn();\r\n  return {\r\n    showToast: success,\r\n    emitToastSuccess: success,\r\n    emitToastError: error,\r\n    toast: { success, error },\r\n    useOkErrToast: () => ({ ok: success, err: error })\r\n  };\r\n});\r\n\r\n// Import after mocks so ESM hoist doesn’t beat us\r\nimport SaveRuleModal from \"@/components/SaveRuleModal\";\r\nimport * as apiModule from \"@/lib/api\";\r\n\r\ndescribe(\"SaveRuleModal — isolated submit flow\", () => {\r\n  it(\"submits with thresholds + category + scenario and calls saveRule once\", async () => {\r\n    const Wrapper = () => {\r\n      const [open, setOpen] = React.useState(true);\r\n      return (\r\n        <SaveRuleModal\r\n          open={open}\r\n          onOpenChange={setOpen}\r\n          month=\"2025-08\"\r\n          scenario=\"cut groceries 20%\"\r\n          defaultCategory=\"Groceries\"\r\n        />\r\n      );\r\n    };\r\n\r\n  const { container } = render(<Wrapper />);\r\n  const saveRuleSpy = (apiModule as any).__saveRuleSpy as ReturnType<typeof vi.fn>;\r\n  saveRuleSpy.mockClear();\r\n    const user = userEvent.setup();\r\n\r\n    // Fill/adjust fields\r\n    const nameInput = await screen.findByLabelText(/rule name/i);\r\n    await user.clear(nameInput);\r\n  await user.clear(nameInput as HTMLInputElement);\r\n  await user.type(nameInput as HTMLInputElement, \"Auto: cut groceries 20%\");\r\n\r\n    const categoryInput = screen.getByLabelText(/category/i) as HTMLInputElement;\r\n    await user.clear(categoryInput);\r\n    await user.type(categoryInput, \"Groceries\");\r\n\r\n    const minConf = screen.getByLabelText(/min confidence/i) as HTMLInputElement;\r\n    await user.clear(minConf);\r\n    await user.type(minConf, \"0.7\");\r\n\r\n    const budgetPct = screen.getByLabelText(/budget %/i) as HTMLInputElement;\r\n    await user.clear(budgetPct);\r\n    await user.type(budgetPct, \"25\");\r\n\r\n    const limit = screen.getByLabelText(/limit/i) as HTMLInputElement;\r\n    await user.clear(limit);\r\n    await user.type(limit, \"200\");\r\n\r\n    // Click submit first (normal path)\r\n    const submitBtn = screen.getByRole(\"button\", { name: /save rule/i });\r\n    await user.click(submitBtn);\r\n\r\n    // Fallback: explicitly dispatch submit if click doesn’t propagate in happy-dom\r\n  if (!saveRuleSpy.mock.calls.length) {\r\n      const form = container.querySelector(\"form\");\r\n      expect(form).toBeTruthy();\r\n      if (form) {\r\n        fireEvent.submit(form);\r\n      }\r\n      // flush queued microtasks\r\n      await Promise.resolve();\r\n      await Promise.resolve();\r\n    }\r\n\r\n    await waitFor(() => expect(saveRuleSpy).toHaveBeenCalledTimes(1));\r\n\r\n    // Assert payload shape\r\n  const call = saveRuleSpy.mock.calls[0] as any[];\r\n  const payload = call?.[0];\r\n  const opts = call?.[1];\r\n    expect(payload).toMatchObject({\r\n      month: \"2025-08\",\r\n      rule: {\r\n        name: \"Auto: cut groceries 20%\",\r\n        when: {\r\n          scenario: \"cut groceries 20%\",\r\n          thresholds: {\r\n            minConfidence: 0.7,\r\n            budgetPercent: 25,\r\n            limit: 200,\r\n          },\r\n          category: \"Groceries\",\r\n        },\r\n        then: { category: \"Groceries\" },\r\n      },\r\n    });\r\n    // Idempotency header provided\r\n    expect(opts?.idempotencyKey).toBe(\"00000000-0000-4000-8000-000000000000\");\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\__tests__\\Toaster.bridge.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\__tests__\\apiUrl.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\__tests__\\helpKeys.guard.test.ts","messages":[{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":29,"column":43,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":29,"endColumn":44,"suggestions":[{"messageId":"removeEscape","fix":{"range":[1179,1180],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[1179,1179],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":29,"column":62,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":29,"endColumn":63,"suggestions":[{"messageId":"removeEscape","fix":{"range":[1198,1199],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[1198,1198],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1485,1488],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1485,1488],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect } from 'vitest';\r\nimport { dictionaries } from '@/lib/i18n';\r\nimport fs from 'fs';\r\nimport path from 'path';\r\n\r\n// Guard test: ensure all cardId/data-help-key usages correspond to known card keys or explicitly whitelisted extra keys.\r\n\r\ndescribe('Help key integrity', () => {\r\n  it('contains no unknown help component names', () => {\r\n  // Scan only real source (exclude test files themselves to avoid synthetic keys in fixtures)\r\n  const root = path.resolve(__dirname, '..');\r\n    const files: string[] = [];\r\n    function walk(dir: string) {\r\n      for (const entry of fs.readdirSync(dir)) {\r\n        const full = path.join(dir, entry);\r\n        const stat = fs.statSync(full);\r\n        if (stat.isDirectory()) {\r\n          if (!/node_modules|dist|coverage|__tests__/.test(full)) walk(full);\r\n        } else if (/\\.(tsx|ts|jsx|js)$/.test(entry)) {\r\n          if (!/__tests__/.test(full)) files.push(full);\r\n        }\r\n      }\r\n    }\r\n    walk(root);\r\n\r\n    const content = files.map(f => fs.readFileSync(f, 'utf8')).join('\\n');\r\n\r\n    // Match cardId=\"cards.something\" or data-help-key=\"cards.something\"\r\n  const regex = /(?:cardId|data-help-key)=\\\"([a-zA-Z0-9_.-]+)\\\"/g;\r\n    const found = new Set<string>();\r\n    let m: RegExpExecArray | null;\r\n    while ((m = regex.exec(content))) {\r\n      found.add(m[1]);\r\n    }\r\n\r\n    // Derive allowed base keys from dictionaries.en.cards + explicit additional namespaces we use\r\n    const en = (dictionaries as any).en || {};\r\n    const cardsDict = en.cards || {};\r\n    const chartsDict = en.charts || {};\r\n    const allowed = new Set<string>([\r\n      ...Object.keys(cardsDict).map(k => `cards.${k}`),\r\n      ...Object.keys(chartsDict).map(k => `charts.${k}`),\r\n    ]);\r\n\r\n    // You can add manual exceptions here if needed\r\n    const exceptions: string[] = [\r\n      // Non-card namespaced keys intentionally used:\r\n      'card.forecast',\r\n      'anomalies.month',\r\n      'cards.insights_list'\r\n    ];\r\n    exceptions.forEach(e => allowed.add(e));\r\n\r\n  // Only enforce for known prefixes we manage.\r\n  const enforced = [...found].filter(k => /^(cards|charts|card\\.|anomalies\\.)/.test(k));\r\n  const unknown = enforced.filter(k => !allowed.has(k));\r\n    if (unknown.length) {\r\n      // Provide a helpful diff for developers\r\n      console.error('Unknown help keys encountered:', unknown);\r\n    }\r\n    expect(unknown).toEqual([]);\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\__tests__\\prettyToolName.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\__tests__\\setup.fetch-mock.ts","messages":[{"ruleId":"@typescript-eslint/triple-slash-reference","severity":2,"message":"Do not use a triple slash reference for vitest, use `import` style instead.","line":1,"column":1,"nodeType":"Line","messageId":"tripleSlashReference","endLine":1,"endColumn":33},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[298,301],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[298,301],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[574,577],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[574,577],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/// <reference types=\"vitest\" />\r\n// Mini fetch mock to prevent ECONNREFUSED noise in unit tests\r\nimport { vi, beforeAll, afterAll } from 'vitest';\r\n\r\nconst okJson = async () => ({ ok: true });\r\n\r\nbeforeAll(() => {\r\n  // Basic stub; tweak per test if you need different responses\r\n  (globalThis as any).fetch = vi.fn(async () => ({\r\n    ok: true,\r\n    status: 200,\r\n    statusText: 'OK',\r\n    headers: { get: (k: string) => (k.toLowerCase() === 'content-type' ? 'application/json' : '') },\r\n    json: okJson,\r\n    text: async () => JSON.stringify(await okJson()),\r\n  })) as any;\r\n\r\n  // Optionally hush console errors/warns from network layers\r\n  vi.spyOn(console, 'error').mockImplementation(() => {});\r\n  vi.spyOn(console, 'warn').mockImplementation(() => {});\r\n});\r\n\r\nafterAll(() => {\r\n  vi.restoreAllMocks();\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\__tests__\\suggestions.dedupe.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\__tests__\\toastLiterals.guard.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'expect' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { readFileSync, readdirSync } from 'fs';\r\nimport path from 'path';\r\nimport { describe, it, expect } from 'vitest';\r\n\r\n// Guard: ensure emitToastSuccess/Error calls use i18n (heuristic — looks for t('...') usage)\r\n// Allows dynamic variables but disallows raw quoted literals as first arg.\r\n\r\nfunction listTsx(dir: string, acc: string[] = []) {\r\n  for (const entry of readdirSync(dir, { withFileTypes: true })) {\r\n    if (entry.name.startsWith('.') || entry.name === '__tests__') continue;\r\n    const full = path.join(dir, entry.name);\r\n    if (entry.isDirectory()) listTsx(full, acc); else if (/\\.(tsx?|jsx?)$/.test(entry.name)) acc.push(full);\r\n  }\r\n  return acc;\r\n}\r\n\r\n// Rough pattern: emitToastSuccess(<expr>) where <expr> starts with a quote\r\n// We'll flag if not containing t(' inside the parentheses before first comma\r\nconst TOAST_CALL_RE = /(emitToastSuccess|emitToastError)\\s*\\(([^)]*)\\)/g;\r\n\r\nfunction isViolation(argSrc: string): boolean {\r\n  const trimmed = argSrc.trim();\r\n  if (trimmed.startsWith('t(')) return false;\r\n  if (trimmed.startsWith('`')) return true; // template literal raw\r\n  if (trimmed.startsWith(\"'\") || trimmed.startsWith('\"')) return true; // plain string literal\r\n  return false; // variable or expression assumed fine\r\n}\r\n\r\ndescribe('toast literals guard', () => {\r\n  it('disallows raw string literals in emitToast* calls', () => {\r\n    const root = path.join(__dirname, '..');\r\n    const files = listTsx(root);\r\n    const violations: { file: string; snippet: string }[] = [];\r\n    for (const f of files) {\r\n      const text = readFileSync(f, 'utf8');\r\n      let m: RegExpExecArray | null;\r\n      while ((m = TOAST_CALL_RE.exec(text))) {\r\n        const argSrc = m[2].split(',')[0];\r\n        if (isViolation(argSrc)) {\r\n          // Allowlist some legacy components if any (none expected now)\r\n          violations.push({ file: f, snippet: argSrc.slice(0, 80) });\r\n        }\r\n      }\r\n    }\r\n    if (violations.length) {\r\n      const lines = violations.map(v => ` - ${v.file}: ${v.snippet}`).join('\\n');\r\n      throw new Error(`Raw toast string literals detected (use t(...)):\\n${lines}`);\r\n    }\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\__tests__\\utils\\dom.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\__tests__\\utils\\toast.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\__tests__\\vite-config.basic.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[474,477],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[474,477],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[542,545],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[542,545],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[723,726],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[723,726],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[979,982],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[979,982],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1185,1188],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1185,1188],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1377,1380],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1377,1380],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1439,1442],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1439,1442],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":4,"column":1,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":4,"endColumn":43,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[175,217],"text":"// @ts-expect-error - vite config is ESM TS file"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect } from 'vitest';\r\n// Import Vite root config (two levels up from src/__tests__).\r\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n// @ts-ignore - vite config is ESM TS file\r\nimport config from '../../vite.config.ts';\r\n\r\ndescribe('vite config basics', () => {\r\n  it('defines branch/commit globals', () => {\r\n    // define is a plain object with our injected globals\r\n    expect(config.define).toBeTruthy();\r\n    expect((config as any).define.__WEB_BRANCH__).toMatch(/\".*\"/);\r\n    expect((config as any).define.__WEB_COMMIT__).toMatch(/\"[0-9a-f]{4,40}\"/i);\r\n  });\r\n\r\n  it('has at least one plugin object and vendor chunk logic configured', () => {\r\n    const plugins = (config as any).plugins;\r\n    expect(Array.isArray(plugins)).toBe(true);\r\n    expect(plugins.length).toBeGreaterThanOrEqual(1);\r\n    // Heuristic: at least one plugin exposes either name or enforce or has a transform hook\r\n    const representative = plugins.some((p: any) => p && (p.name || p.enforce || typeof p.transform === 'function'));\r\n    expect(representative).toBe(true);\r\n  });\r\n\r\n  it('configures alias for @ and Recharts', () => {\r\n    const alias = (config as any).resolve?.alias || {};\r\n    expect(alias['@']).toBeDefined();\r\n    expect(alias['Recharts']).toBe('recharts');\r\n  });\r\n\r\n  it('sets jsdom test environment', () => {\r\n    expect((config as any).test?.environment).toBe('jsdom');\r\n    expect((config as any).test?.setupFiles).toContain('./src/test/setup.ts');\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\api.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\app\\rules\\suggestions\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\AboutDrawer.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1248,1251],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1248,1251],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":47,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1832,1835],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1832,1835],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":47,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1863,1866],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1863,1866],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from 'react';\nimport { getMetaInfo, MetaInfo, getHealthz, Healthz, getLlmHealth, LlmHealth } from '../lib/api';\nimport { Info } from 'lucide-react';\n\ntype RowProps = { label: string; value?: React.ReactNode };\nconst Row = ({ label, value }: RowProps) => (\n  <div className=\"flex items-start gap-3 py-1\">\n    <div className=\"w-32 shrink-0 text-sm text-muted-foreground\">{label}</div>\n    <div className=\"text-sm break-all\">{value ?? '—'}</div>\n  </div>\n);\n\ntype AboutDrawerProps = { showButton?: boolean };\nexport default function AboutDrawer({ showButton = true }: AboutDrawerProps) {\n  const [open, setOpen] = React.useState(false);\n  const [data, setData] = React.useState<MetaInfo | null>(null);\n  const [health, setHealth] = React.useState<Healthz | null>(null);\n  const [llm, setLlm] = React.useState<LlmHealth | null>(null);\n  const [loading, setLoading] = React.useState(false);\n  const [error, setError] = React.useState<string | null>(null);\n\n  const load = React.useCallback(async () => {\n    setLoading(true);\n    setError(null);\n    try {\n      const [m, h, l] = await Promise.all([getMetaInfo(), getHealthz(), getLlmHealth().catch(() => null)]);\n      setData(m);\n      setHealth(h);\n      setLlm(l);\n    } catch (e: any) {\n      setError(e?.message ?? String(e));\n    } finally { setLoading(false); }\n  }, []);\n\n  React.useEffect(() => {\n    if (open && !data && !health && !loading && !error) { load(); }\n  }, [open, data, health, loading, error, load]);\n\n  // Support global open event\n  React.useEffect(() => {\n    const openEvt = () => setOpen(true)\n    window.addEventListener('about:open', openEvt)\n    return () => window.removeEventListener('about:open', openEvt)\n  }, [])\n\n  const dbRevFromHealth = health?.db_revision ?? health?.alembic?.db_revision ?? null;\n  const inSyncRaw = (health as any)?.alembic_ok ?? (health as any)?.alembic?.in_sync ?? null;\n  const inSync: boolean | null = (inSyncRaw === true) ? true : (inSyncRaw === false) ? false : null;\n  const head = data?.alembic?.code_head ?? null;\n  const heads = data?.alembic?.code_heads ?? [];\n  const migs = data?.alembic?.recent_migrations ?? [];\n  const codeError = data?.alembic?.code_error ?? null;\n\n  return (\n    <>\n      {showButton && (\n        <button\n          onClick={() => setOpen(true)}\n          className=\"inline-flex items-center gap-2 rounded-2xl border px-3 py-1.5 text-sm\n                     bg-card border-border hover:bg-accent/20 transition\"\n          title=\"About / System Info\"\n        >\n          <Info className=\"h-4 w-4\" />\n          About\n        </button>\n      )}\n\n      {open && (\n        <div className=\"fixed inset-0 z-50 flex\">\n          {/* backdrop */}\n          <div className=\"absolute inset-0 bg-black/50\" onClick={() => setOpen(false)} />\n          {/* panel */}\n          <div className=\"ml-auto h-full w-full max-w-xl bg-background border-l border-border p-4 overflow-auto\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <div className=\"text-lg font-semibold\">About this app</div>\n              <button className=\"text-sm opacity-70 hover:opacity-100\" onClick={() => setOpen(false)}>Close</button>\n            </div>\n\n            {loading && <div className=\"text-sm opacity-70\">Loading…</div>}\n            {error && (\n              <div className=\"text-sm text-amber-300/90 bg-amber-500/10 border border-amber-500/30 rounded-xl p-3\">\n                Failed to load meta info: <code>{error}</code>\n                <div className=\"mt-2\">\n                  <button onClick={load} className=\"text-xs underline\">Retry</button>\n                </div>\n              </div>\n            )}\n\n            {data && (\n              <div className=\"space-y-4\">\n                {codeError && (\n                  <div className=\"text-sm bg-red-500/10 text-red-300 border border-red-500/30 rounded-xl p-3\">\n                    <div className=\"font-semibold mb-1\">Alembic error</div>\n                    <code className=\"break-all\">{codeError}</code>\n                    <div className=\"mt-2 text-xs opacity-80\">\n                      Tip: ensure <code>apps/backend/alembic.ini</code> exists and points\n                      to <code>apps/backend/alembic</code>.\n                    </div>\n                  </div>\n                )}\n                <div className=\"flex items-center gap-2\">\n                  <span\n                    className={[\n                      'inline-flex items-center gap-2 text-xs font-medium px-2 py-0.5 rounded-2xl border',\n                      inSync === true ? 'bg-emerald-500/10 text-emerald-300 border-emerald-500/30' :\n                      inSync === false ? 'bg-amber-500/10 text-amber-300 border-amber-500/30' :\n                                         'bg-zinc-700/20 text-zinc-300 border-zinc-600/30'\n                    ].join(' ')}\n                  >\n                    <span className=\"w-2 h-2 rounded-full border border-current\" />\n                    {inSync === true ? 'DB ok' : inSync === false ? 'DB out of sync' : 'DB status unknown'}\n                  </span>\n                </div>\n\n                <div className=\"space-y-1\">\n                  <Row label=\"Engine\" value={<code>{data.engine}</code>} />\n                  <Row label=\"DB revision (healthz)\" value={<code>{dbRevFromHealth || '—'}</code>} />\n                  <Row label=\"Code head\" value={<code>{head || '—'}</code>} />\n                  <Row label=\"All heads\" value={<code>{heads?.length ? heads.join(', ') : '—'}</code>} />\n                  <Row label=\"OpenAI key\" value={(\n                    llm?.openai_key\n                      ? (\n                        llm.openai_key.present\n                          ? <span className=\"inline-flex items-center gap-1 rounded-full border border-emerald-400/40 bg-emerald-500/10 px-2 py-0.5 text-[11px] text-emerald-300\">present ({llm.openai_key.source})</span>\n                          : <span className=\"inline-flex items-center gap-1 rounded-full border border-rose-400/40 bg-rose-500/10 px-2 py-0.5 text-[11px] text-rose-300\">absent</span>\n                      )\n                      : <span className=\"text-xs opacity-70\">—</span>\n                  )} />\n                </div>\n\n                <div className=\"mt-2\">\n                  <div className=\"text-sm font-semibold mb-2 opacity-80\">Recent migrations</div>\n                  <div className=\"border border-border rounded-2xl divide-y divide-border\">\n                    {migs.length === 0 && <div className=\"p-3 text-sm opacity-70\">No migrations found</div>}\n                    {migs.map((m) => (\n                      <div key={m.revision} className=\"p-3\">\n                        <div className=\"flex items-center justify-between\">\n                          <code className=\"text-xs\">{m.revision}</code>\n                          {m.is_head && <span className=\"text-[10px] px-2 py-0.5 rounded-full border border-border\">HEAD</span>}\n                        </div>\n                        {m.message && <div className=\"text-xs mt-1 opacity-80\">{m.message}</div>}\n                        <div className=\"text-[11px] mt-1 opacity-60\">\n                          <span className=\"mr-2\">down:</span>\n                          <code>{Array.isArray(m.down_revision) ? m.down_revision.join(', ') : (m.down_revision ?? 'None')}</code>\n                        </div>\n                        {m.filename && (\n                          <div className=\"text-[11px] mt-1 opacity-60\">\n                            <span className=\"mr-2\">file:</span>\n                            <code>{m.filename}</code>\n                          </div>\n                        )}\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n    </>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\AccountMenu.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1117,1120],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1117,1120],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuContent,\r\n  DropdownMenuItem,\r\n  DropdownMenuLabel,\r\n  DropdownMenuSeparator,\r\n  DropdownMenuTrigger,\r\n} from \"@/components/ui/dropdown-menu\";\r\nimport { Mail, LogOut, UserRound, ChevronDown } from \"lucide-react\";\r\nimport { emitToastSuccess, emitToastError } from \"@/lib/toast-helpers\";\r\nimport { t } from '@/lib/i18n';\r\n\r\ntype Props = {\r\n  email?: string | null;\r\n  onLogout?: () => Promise<void> | void;\r\n  avatarUrl?: string | null;\r\n};\r\n\r\nfunction initials(email?: string | null) {\r\n  if (!email) return \"U\";\r\n  const name = (email.split(\"@\")[0] || \"\").replace(/[^a-z0-9]+/gi, \" \").trim();\r\n  const parts = name.split(/\\s+/);\r\n  const a = parts[0] || name;\r\n  const b = parts[1] || \"\";\r\n  return (a[0] || \"U\").toUpperCase() + (b[0]?.toUpperCase() || \"\");\r\n}\r\n\r\nexport default function AccountMenu({ email, onLogout, avatarUrl }: Props) {\r\n  const handleLogout = async () => {\r\n    try {\r\n      await onLogout?.();\r\n      emitToastSuccess(t('ui.toast.signed_out_title'));\r\n    } catch (err: any) {\r\n      emitToastError(t('ui.toast.sign_out_failed_title'), { description: String(err?.message || err) });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <DropdownMenu>\r\n      <DropdownMenuTrigger asChild>\r\n        <Button\r\n          variant=\"pill\"\r\n          size=\"sm\"\r\n          aria-label=\"Account\"\r\n          className={[\r\n            \"gap-2 pl-2 pr-2\",\r\n            // glow the pill while the menu is open (Radix adds data-state)\r\n            \"data-[state=open]:from-emerald-700 data-[state=open]:to-emerald-800 data-[state=open]:text-emerald-50\",\r\n          ].join(\" \")}\r\n          data-testid=\"account-menu-trigger\"\r\n          title={email || \"Account\"}\r\n        >\r\n          {avatarUrl ? (\r\n            <img\r\n              src={avatarUrl}\r\n              alt=\"User avatar\"\r\n              className=\"h-5 w-5 rounded-full object-cover ring-1 ring-white/10\"\r\n            />\r\n          ) : email ? (\r\n            <span className=\"h-5 w-5 rounded-full bg-white/10 border border-white/10 flex items-center justify-center text-[10px]\">\r\n              {initials(email)}\r\n            </span>\r\n          ) : (\r\n            <span className=\"h-5 w-5 rounded-full bg-white/10 border border-white/10 flex items-center justify-center\">\r\n              <UserRound className=\"h-3.5 w-3.5 opacity-80\" />\r\n            </span>\r\n          )}\r\n\r\n          <span className=\"hidden sm:inline\">Account</span>\r\n          <ChevronDown className=\"h-3.5 w-3.5 opacity-75\" aria-hidden=\"true\" />\r\n        </Button>\r\n      </DropdownMenuTrigger>\r\n\r\n      <DropdownMenuContent align=\"end\" className=\"min-w-[220px]\">\r\n        <DropdownMenuLabel>Account</DropdownMenuLabel>\r\n        {email && (\r\n          <DropdownMenuItem\r\n            onClick={() =>\r\n              navigator.clipboard\r\n                .writeText(email)\r\n                .then(() => emitToastSuccess(t('ui.toast.email_copied_title')))\r\n            }\r\n            className=\"flex items-center gap-2 cursor-pointer\"\r\n          >\r\n            <Mail className=\"h-4 w-4 opacity-70\" />\r\n            <span title={email} className=\"truncate\">\r\n              {email}\r\n            </span>\r\n          </DropdownMenuItem>\r\n        )}\r\n        <DropdownMenuSeparator />\r\n        <DropdownMenuItem\r\n          onClick={handleLogout}\r\n          className=\"flex items-center gap-2 cursor-pointer text-red-300 focus:text-red-300\"\r\n        >\r\n          <LogOut className=\"h-4 w-4 opacity-70\" />\r\n          <span>Logout</span>\r\n        </DropdownMenuItem>\r\n      </DropdownMenuContent>\r\n    </DropdownMenu>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\AgentAvatar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\AgentChat.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[517,520],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[517,520],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[592,595],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[592,595],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":62,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2431,2434],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2431,2434],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":111,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3874,3877],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3874,3877],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":115,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3996,3999],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3996,3999],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":117,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4131,4134],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4131,4134],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":118,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4185,4188],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4185,4188],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":118,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4206,4209],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4206,4209],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":119,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4252,4255],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4252,4255],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":119,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4285,4288],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4285,4288],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":123,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4475,4478],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4475,4478],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":142,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5093,5096],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5093,5096],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":145,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5252,5255],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5252,5255],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":147,"column":99,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":147,"endColumn":102,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5467,5470],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5467,5470],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":150,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":150,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5613,5616],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5613,5616],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":157,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":157,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5919,5922],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5919,5922],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":166,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":166,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6401,6404],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6401,6404],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":173,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":173,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6664,6667],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6664,6667],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":191,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":191,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7151,7154],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7151,7154],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":260,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":260,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10364,10367],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10364,10367],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":269,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":269,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11035,11038],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11035,11038],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":284,"column":37,"nodeType":"BlockStatement","messageId":"unexpected","endLine":284,"endColumn":39,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[11926,11926],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":297,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":297,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12626,12629],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12626,12629],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":298,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":298,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12696,12699],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12696,12699],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":299,"column":93,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":299,"endColumn":96,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12799,12802],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12799,12802],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":299,"column":132,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":299,"endColumn":135,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12838,12841],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12838,12841],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":300,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":300,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12915,12918],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12915,12918],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":300,"column":97,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":300,"endColumn":100,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12956,12959],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12956,12959],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":303,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":303,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13127,13130],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13127,13130],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":311,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":311,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13494,13497],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13494,13497],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":313,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":313,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13611,13614],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13611,13614],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":314,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":314,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13695,13698],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13695,13698],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":332,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":332,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14812,14815],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14812,14815],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":334,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":334,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14929,14932],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14929,14932],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":335,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":335,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15005,15008],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15005,15008],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":355,"column":91,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":355,"endColumn":94,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16331,16334],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16331,16334],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":357,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":357,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16448,16451],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16448,16451],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":385,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":385,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18104,18107],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18104,18107],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":399,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":399,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18889,18892],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18889,18892],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":428,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":428,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20318,20321],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20318,20321],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":429,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":429,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20389,20392],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20389,20392],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":431,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":431,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20526,20529],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20526,20529],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":434,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":434,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20838,20841],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20838,20841],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":436,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":436,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20983,20986],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20983,20986],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":439,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":439,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21136,21139],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21136,21139],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":439,"column":124,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":439,"endColumn":127,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21216,21219],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21216,21219],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":45,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\nimport { agentChat, getAgentModels, type AgentChatRequest, type AgentChatResponse, type AgentModelsResponse, type ChatMessage, txnsQueryCsv, applyBudgets, downloadReportPdf, type Anomaly, clearTempBudget, unignoreAnomaly } from \"../lib/api\";\nimport { emitToastSuccess } from \"@/lib/toast-helpers\";\nimport { t } from '@/lib/i18n';\n\ninterface ExtendedMessage extends ChatMessage {\n  meta?: {\n    citations?: { type: string; id?: string; count?: number }[];\n    ctxMonth?: string;\n    trace?: any[];\n    model?: string;\n    mode?: string;\n    filters?: Record<string, any> | undefined;\n    q?: string;        // original NL query text\n    intent?: string;   // nl_txns intent (e.g., list)\n  // insights.anomalies payload (inline render)\n  anomalies?: Anomaly[];\n  anomaliesMonth?: string | null;\n  };\n}\n\nfunction saveBlob(blob: Blob, filename: string) {\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = filename;\n  document.body.appendChild(a);\n  a.click();\n  a.remove();\n  URL.revokeObjectURL(url);\n}\n\nfunction modeLabel(mode?: string) {\n  if (!mode) return undefined;\n  if (mode === 'nl_txns') return 'Transactions';\n  if (mode.startsWith('charts.')) return 'Charts';\n  if (mode.startsWith('insights.')) return 'Insights';\n  if (mode === 'report.link') return 'Report';\n  if (mode === 'budgets.read' || mode === 'budgets.recommendations') return 'Budgets';\n  return undefined;\n}\n\nexport default function AgentChat() {\n  const [messages, setMessages] = React.useState<ExtendedMessage[]>([\n    { role: \"system\", content: \"You are a finance agent.\" },\n  ]);\n  const [input, setInput] = React.useState(\"\");\n  const [loading, setLoading] = React.useState(false);\n  const [advancedOpen, setAdvancedOpen] = React.useState(false);\n  const [modelsInfo, setModelsInfo] = React.useState<AgentModelsResponse | null>(null);\n  const [selectedModel, setSelectedModel] = React.useState<string>(\"\"); // empty => use server default\n\n  // add state to track a single in-flight action\n  const [busyAction, setBusyAction] = React.useState<string | null>(null);\n\n  // tiny helper to run an async action with auto-disable + error logging\n  async function runAction(key: string, fn: () => Promise<void>) {\n    if (busyAction) return; // prevent parallel runs; switch to a Set for multi if desired\n    setBusyAction(key);\n    try {\n      await fn();\n    } catch (e: any) {\n      // keep this no-op (console) so callers can decide how to display errors\n      console.error(e);\n    } finally {\n      setBusyAction(null);\n    }\n  }\n\n  // Persist selected model per tab session\n  React.useEffect(() => {\n    const saved = sessionStorage.getItem('fa.model');\n    if (saved) setSelectedModel(saved);\n  }, []);\n  React.useEffect(() => {\n    if (selectedModel) sessionStorage.setItem('fa.model', selectedModel);\n    else sessionStorage.removeItem('fa.model');\n  }, [selectedModel]);\n\n  React.useEffect(() => {\n    let ignore = false;\n    (async () => {\n      try {\n        const info = await getAgentModels();\n        if (!ignore) setModelsInfo(info);\n      } catch {\n        // ignore fetch errors; UI will just hide advanced section\n      }\n    })();\n    return () => { ignore = true; };\n  }, []);\n\n  async function send() {\n    if (!input.trim() || loading) return;\n    const userMsg: ExtendedMessage = { role: \"user\", content: input };\n    const next: ExtendedMessage[] = [...messages, userMsg];\n    setMessages(next);\n    setInput(\"\");\n    setLoading(true);\n    \n    try {\n      const req: AgentChatRequest = {\n        messages: next.filter(m => m.role !== \"system\").map(m => ({\n          role: m.role,\n          content: m.content\n        })),\n        // no context on purpose — server will auto-enrich (month, rules, alerts, etc.)\n        intent: 'general',\n      };\n      if (selectedModel) {\n        (req as any).model = selectedModel;\n      }\n      \n      const resp: AgentChatResponse = await agentChat(req);\n      if ((resp as any).mode === \"nl_txns\") {\n        const lastUser = next.slice().reverse().find(m => m.role === 'user');\n        const mode = (resp as any).mode as string;\n        const filters = (resp as any).nlq || (resp as any).filters;\n        const intent = (resp as any)?.result?.intent || (resp as any)?.nlq?.intent;\n        // Grounded NL transactions branch: show compact badge + summary\n        const msg1: ExtendedMessage = {\n          role: \"assistant\",\n          content: ((resp as any).message || resp.rephrased?.trim() || resp.summary || resp.reply),\n          meta: {\n            citations: resp.citations,\n            ctxMonth: resp.used_context?.month,\n            trace: resp.tool_trace,\n            model: resp.model,\n            mode,\n            filters,\n            q: lastUser?.content,\n            intent,\n          },\n        };\n        // Append optional details block\n        const msg2: ExtendedMessage = {\n          role: \"assistant\",\n          content: `Details:\\n\\n${resp.reply}`,\n        };\n        setMessages([...next, msg1, msg2]);\n      } else {\n        const mode = (resp as any).mode as string | undefined;\n        // Special: inline anomalies rendering\n        if (mode === 'insights.anomalies') {\n          const result = (resp as any)?.result || {};\n          const anomalies: Anomaly[] = Array.isArray(result?.anomalies) ? result.anomalies : [];\n          const anomaliesMonth: string | null = (result?.month as string | undefined) ?? (resp as any)?.used_context?.month ?? null;\n          const groundedMsg: ExtendedMessage = {\n            role: \"assistant\",\n            content: ((resp as any).message || resp.reply || 'Unusual spending categories detected.'),\n            meta: {\n              citations: resp.citations,\n              ctxMonth: resp.used_context?.month,\n              trace: resp.tool_trace,\n              model: resp.model,\n              mode,\n              filters: (resp as any).filters,\n              anomalies,\n              anomaliesMonth,\n            }\n          };\n          setMessages([...next, groundedMsg]);\n  } else if (mode && [\"charts.summary\",\"charts.flows\",\"charts.merchants\",\"charts.categories\",\"charts.category\",\"report.link\",\"budgets.read\",\"budgets.recommendations\",\"budgets.temp\",\"insights.anomalies.ignore\"].includes(mode)) {\n          const groundedMsg: ExtendedMessage = {\n            role: \"assistant\",\n            content: ((resp as any).message || resp.reply),\n            meta: {\n              citations: resp.citations,\n              ctxMonth: resp.used_context?.month,\n              trace: resp.tool_trace,\n              model: resp.model,\n              mode,\n              filters: (resp as any).filters,\n            }\n          };\n          setMessages([...next, groundedMsg]);\n        } else {\n        const assistantMsg: ExtendedMessage = {\n          role: \"assistant\",\n          content: resp.reply,\n          meta: {\n            citations: resp.citations,\n            ctxMonth: resp.used_context?.month,\n            trace: resp.tool_trace,\n            model: resp.model\n          }\n        };\n        setMessages([...next, assistantMsg]);\n        }\n      }\n    } catch (e: any) {\n      const errorMsg: ExtendedMessage = {\n        role: \"assistant\",\n        content: `(Error) ${e?.message ?? e}`\n      };\n      setMessages([...next, errorMsg]);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  return (\n    <div className=\"rounded-xl border border-neutral-700 p-3 bg-neutral-900 text-neutral-100\">\n      {modelsInfo ? (\n        <div className=\"mb-2\">\n          <button\n            className=\"text-xs text-neutral-400 hover:text-neutral-200\"\n            onClick={() => setAdvancedOpen(v => !v)}\n          >\n            {advancedOpen ? \"Hide advanced\" : \"Show advanced\"}\n          </button>\n          {advancedOpen && (\n            <div className=\"mt-2 p-2 rounded-lg border border-neutral-800 bg-neutral-800/50\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"text-xs text-neutral-400\">\n                  Provider: <span className=\"text-neutral-200\">{modelsInfo.provider}</span>\n                  {modelsInfo.default ? (\n                    <>\n                      <span className=\"mx-2\">·</span>\n                      Default: <span className=\"text-neutral-200\">{modelsInfo.default}</span>\n                    </>\n                  ) : null}\n                </div>\n                <div className=\"ml-auto\" />\n                <select\n                  className=\"px-2 py-1 text-sm rounded-md bg-neutral-800 border border-neutral-700 text-neutral-100\"\n                  value={selectedModel}\n                  onChange={(e) => setSelectedModel(e.target.value)}\n                >\n                  <option value=\"\">Use default</option>\n                  {modelsInfo.models?.map(m => (\n                    <option key={m.id} value={m.id}>{m.id}</option>\n                  ))}\n                </select>\n              </div>\n            </div>\n          )}\n        </div>\n      ) : null}\n      <div className=\"space-y-2 max-h-64 overflow-auto text-sm\">\n        {messages.filter(m => m.role !== \"system\").map((m, i) => (\n          <div key={i} className={m.role === \"user\" ? \"text-right\" : \"\"}>\n            <div className={`inline-block px-3 py-2 rounded-2xl ${m.role === \"user\" ? \"bg-blue-600\" : \"bg-neutral-800\"}`}>\n              <div className=\"flex items-center gap-2\">\n                <div>{m.content}</div>\n                {m.role === \"assistant\" && m.meta?.mode ? (\n                  <>\n                    <span className=\"ml-2 chat-badge-grounded text-[10px] px-2 py-0.5 rounded-full\" title=\"This reply is grounded in data\">grounded</span>\n                    {modeLabel(m.meta.mode) ? (\n                      <span className=\"text-[10px] px-2 py-0.5 rounded-full bg-neutral-900 border border-neutral-700\" title={`Tool: ${m.meta.mode}`}>{modeLabel(m.meta.mode)}</span>\n                    ) : null}\n                  </>\n                ) : null}\n              </div>\n              {/* Render assistant message with light metadata, filters, and actions */}\n              {m.role === \"assistant\" && (m.meta?.citations?.length || m.meta?.filters) ? (\n                <div className=\"mt-2 text-xs opacity-70\">\n                  {m.meta?.citations?.length ? (\n                    <>\n                      Used data: {m.meta.citations.map((c: any) => c.count ? `${c.type} ${c.count}` : `${c.type}`).join(' · ')}\n                      {m.meta.ctxMonth ? ` · month ${m.meta.ctxMonth}` : ''}\n                      {m.meta.model ? ` · ${m.meta.model}` : ''}\n                    </>\n                  ) : null}\n                  {m.meta?.filters ? (\n                    <div className=\"mt-1 flex flex-wrap items-center gap-1\">\n                      {['month','start','end','window','flow'].filter(k => k in (m.meta!.filters||{})).map((k) => (\n                        <span key={k} className=\"px-2 py-0.5 rounded-full bg-neutral-900 border border-neutral-700\">\n                          {k}: {String((m.meta!.filters as any)[k])}\n                        </span>\n                      ))}\n                      {Object.entries(m.meta.filters).filter(([k]) => !['month','start','end','window','flow'].includes(k)).map(([k, v]) => (\n                        <span key={k} className=\"px-2 py-0.5 rounded-full bg-neutral-900 border border-neutral-700\">\n                          {k}: {String(v)}\n                        </span>\n                      ))}\n                      {m.meta?.mode === 'insights.anomalies' ? (\n                        <button\n                          className=\"ml-2 text-[11px] px-2 py-0.5 rounded-md border border-neutral-700 hover:bg-neutral-900\"\n                          title=\"Open Insights\"\n                          onClick={() => {\n                            try {\n                              window.scrollTo({ top: 0, behavior: 'smooth' });\n                            } catch {}\n                          }}\n                        >\n                          Open Insights\n                        </button>\n                      ) : null}\n                      {m.meta?.mode === 'nl_txns' && m.meta.intent === 'list' && m.meta.q ? (\n                        <button\n                          className=\"ml-2 text-[11px] px-2 py-0.5 rounded-md bg-white text-black hover:opacity-90\"\n                          title=\"Download CSV of these results\"\n                          onClick={async () => {\n                            try {\n                              const { blob, filename } = await txnsQueryCsv(m.meta!.q!, {\n                                start: (m.meta!.filters as any)?.start,\n                                end: (m.meta!.filters as any)?.end,\n                                page_size: Math.max(100, Math.min(1000, (m.meta!.filters as any)?.page_size || (m.meta!.filters as any)?.limit || 200)),\n                                ...(m.meta!.filters as any)?.flow ? { flow: (m.meta!.filters as any)?.flow } : {},\n                              });\n                              saveBlob(blob, filename || 'txns_query.csv');\n                            } catch (err: any) {\n                              alert(`CSV export failed: ${err?.message || String(err)}`);\n                            }\n                          }}\n                        >\n                          Download CSV\n                        </button>\n                      ) : null}\n                      {m.meta?.mode === 'charts.category' && (m.meta.filters as any)?.category ? (\n                        (() => {\n                          const cat = String((m.meta!.filters as any).category);\n                          const months = Number((m.meta!.filters as any).months ?? 6);\n                          const actionKey = `charts.category:${cat}`;\n                          const label = busyAction === actionKey ? 'Opening…' : 'Open full chart';\n                          const disabled = !!busyAction && busyAction !== actionKey;\n                          return (\n                            <button\n                              className=\"ml-2 text-[11px] px-2 py-0.5 rounded-md border border-neutral-700 hover:bg-neutral-900 disabled:opacity-60\"\n                              title=\"Open full chart\"\n                              disabled={disabled}\n                              onClick={() => runAction(actionKey, async () => {\n                                window.dispatchEvent(new CustomEvent('open-category-chart', { detail: { category: cat, months } }));\n                              })}\n                            >\n                              {label}\n                            </button>\n                          );\n                        })()\n                      ) : null}\n                      {m.meta?.mode === 'budgets.temp' && (m.meta.filters as any)?.category ? (\n                        (() => {\n                          const cat = String((m.meta!.filters as any).category);\n                          const month = (m.meta!.filters as any)?.month as string | undefined;\n                          const actionKey = `budgets.temp.undo:${cat}`;\n                          const label = busyAction === actionKey ? 'Undoing…' : 'Undo temp budget';\n                          const disabled = !!busyAction && busyAction !== actionKey;\n                          return (\n                            <button\n                              className=\"ml-2 text-[11px] px-2 py-0.5 rounded-md border border-neutral-700 hover:bg-neutral-900 disabled:opacity-60\"\n                              title=\"Undo temp budget\"\n                              disabled={disabled}\n                              onClick={() => runAction(actionKey, async () => {\n                                const r = await clearTempBudget(cat, month);\n                                const amt = r?.deleted?.amount ?? 0;\n                                emitToastSuccess(t('ui.toast.temp_budget_removed_title'), { description: `${cat}${amt ? ` ($${Number(amt).toFixed(2)})` : ''}` });\n                              })}\n                            >\n                              {label}\n                            </button>\n                          );\n                        })()\n                      ) : null}\n                      {m.meta?.mode === 'insights.anomalies.ignore' && (m.meta.filters as any)?.category ? (\n                        (() => {\n                          const cat = String((m.meta!.filters as any).category);\n                          const actionKey = `anomalies.unignore:${cat}`;\n                          const label = busyAction === actionKey ? 'Reinstating…' : 'Undo ignore';\n                          const disabled = !!busyAction && busyAction !== actionKey;\n                          return (\n                            <button\n                              className=\"ml-2 text-[11px] px-2 py-0.5 rounded-md border border-neutral-700 hover:bg-neutral-900 disabled:opacity-60\"\n                              title=\"Undo ignore\"\n                              disabled={disabled}\n                              onClick={() => runAction(actionKey, async () => {\n                                await unignoreAnomaly(cat);\n                                emitToastSuccess(t('ui.toast.anomaly_unignored_title'), { description: cat });\n                              })}\n                            >\n                              {label}\n                            </button>\n                          );\n                        })()\n                      ) : null}\n                      {m.meta?.mode === 'budgets.recommendations' ? (\n                        <>\n                          <button\n                            className=\"ml-2 text-[11px] px-2 py-0.5 rounded-md bg-white text-black hover:opacity-90\"\n                            title=\"Apply budgets (median)\"\n                            onClick={async () => {\n                              try {\n                                await applyBudgets({ strategy: 'median' });\n                                alert('Applied budgets (median).');\n                              } catch (err: any) {\n                                alert(`Apply budgets failed: ${err?.message || String(err)}`);\n                              }\n                            }}\n                          >\n                            Apply budgets\n                          </button>\n                          <button\n                            className=\"ml-2 text-[11px] px-2 py-0.5 rounded-md border border-neutral-700 hover:bg-neutral-900\"\n                            title=\"Export PDF report\"\n                            onClick={async () => {\n                              try {\n                                const { blob, filename } = await downloadReportPdf();\n                                saveBlob(blob, filename || 'finance_report.pdf');\n                              } catch (err: any) {\n                                alert(`PDF export failed: ${err?.message || String(err)}`);\n                              }\n                            }}\n                          >\n                            Export PDF\n                          </button>\n                        </>\n                      ) : null}\n                    </div>\n                  ) : null}\n                  {m.meta?.trace?.length ? (\n                    <details className=\"mt-1\">\n                      <summary className=\"cursor-pointer hover:text-neutral-300\">Trace</summary>\n                      <pre className=\"whitespace-pre-wrap text-[10px] mt-1 p-2 bg-neutral-900 rounded overflow-auto max-h-32\">\n                        {JSON.stringify(m.meta.trace, null, 2)}\n                      </pre>\n                    </details>\n                  ) : null}\n                </div>\n              ) : null}\n              {/* Inline renderer for anomalies result */}\n              {m.role === 'assistant' && m.meta?.mode === 'insights.anomalies' && (m.meta?.anomalies?.length ?? 0) > 0 ? (\n                <div className=\"mt-2 text-xs\">\n                  {m.meta?.anomaliesMonth ? (\n                    <div className=\"mb-1 opacity-70\">{m.meta.anomaliesMonth}</div>\n                  ) : null}\n                  <ul className=\"space-y-1\">\n                    {m.meta.anomalies!.map((a) => {\n                      const pct = Math.round((a as any).pct_from_median * 100);\n                      const badge = (a as any).direction === 'high' ? 'bg-yellow-500/20' : 'bg-cyan-500/20';\n                      return (\n                        <li key={(a as any).category} className=\"flex items-center justify-between border-t border-neutral-700/50 py-1 first:border-t-0\">\n                          <div className=\"flex items-center gap-2\">\n                            <span className={`text-[10px] px-1.5 py-0.5 rounded ${badge}`}>\n                              {(a as any).direction === 'high' ? 'High' : 'Low'}\n                            </span>\n                            <span className=\"font-medium\">{(a as any).category}</span>\n                          </div>\n                          <div className=\"opacity-80\">\n                            ${Number((a as any).current).toFixed(2)} <span className=\"opacity-60\">vs</span> ${Number((a as any).median).toFixed(2)}\n                            <span className=\"ml-2\">{pct > 0 ? `+${pct}%` : `${pct}%`}</span>\n                          </div>\n                        </li>\n                      );\n                    })}\n                  </ul>\n                </div>\n              ) : null}\n            </div>\n          </div>\n        ))}\n      </div>\n      <div className=\"mt-3 flex gap-2\">\n        <input\n          className=\"flex-1 px-3 py-2 rounded-xl bg-neutral-800 border border-neutral-700\"\n          value={input}\n          onChange={(e) => setInput(e.target.value)}\n          onKeyDown={(e) => e.key === \"Enter\" && send()}\n          placeholder=\"Ask the agent…\"\n        />\n        <button\n          className=\"px-4 py-2 rounded-xl bg-white text-black disabled:opacity-50\"\n          onClick={send}\n          disabled={loading}\n        >\n          {loading ? \"…\" : \"Send\"}\n        </button>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\AgentResultRenderers.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cats' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":373,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":373,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'merch' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":374,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":374,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":555,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":555,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20294,20297],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20294,20297],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":562,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":562,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20637,20640],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20637,20640],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/AgentResultRenderers.tsx\nimport React from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tooltip, TooltipTrigger, TooltipContent } from \"@/components/ui/tooltip\";\nimport { InfoDot } from \"./InfoDot\";\nimport { money, shortDate } from \"../utils/format\";\nimport ExplainSignalDrawer from \"./ExplainSignalDrawer\";\nimport type {\n  TransactionsSearchResult,\n  CategorizeResult,\n  BudgetSummaryResult,\n  BudgetCheckResult,\n  InsightSummaryResult,\n  InsightsExpandedResult,\n  MoMStat,\n  ChartsSummaryResult,\n  ChartsMerchantsResult,\n  ChartsFlowsResult,\n  ChartsTrendsResult,\n  RulesTestResult,\n  RulesApplyResult,\n  Txn,\n} from \"../types/agentToolsResults\";\nimport type { ToolKey } from \"../types/agentTools\";\n\n/** ---------- Shared primitives ---------- */\n\nfunction Card({\n  title,\n  children,\n  right,\n}: React.PropsWithChildren<{ title: React.ReactNode; right?: React.ReactNode }>) {\n  return (\n    <div className=\"rounded-2xl border border-[color:var(--border-subtle)] bg-[var(--bg-card)] shadow-sm p-4 text-[var(--text)]\">\n      <div className=\"flex items-center justify-between mb-2\">\n        <h3 className=\"font-semibold text-[var(--text)]\">{title}</h3>\n        {right}\n      </div>\n      {children}\n    </div>\n  );\n}\n\nfunction T({ header, rows }: { header: string[]; rows: React.ReactNode[][] }) {\n  return (\n    <div className=\"overflow-auto\">\n      <table className=\"w-full text-sm\">\n        <thead>\n          <tr className=\"text-left text-[color:var(--text-muted)] border-b\" style={{ borderColor: \"var(--border-subtle)\" }}>\n            {header.map((h) => (\n              <th key={h} className=\"py-2 pr-4 font-medium\">\n                {h}\n              </th>\n            ))}\n          </tr>\n        </thead>\n        <tbody className=\"text-[var(--text)]\">\n          {rows.map((r, i) => (\n            <tr key={i} className=\"border-b last:border-b-0\" style={{ borderColor: \"var(--border-subtle)\" }}>\n              {r.map((c, j) => (\n                <td key={j} className=\"py-2 pr-4 align-top\">\n                  {c}\n                </td>\n              ))}\n            </tr>\n          ))}\n        </tbody>\n      </table>\n    </div>\n  );\n}\n\n/** ---------- Transactions ---------- */\n\nexport function TransactionsSearchCard({ data }: { data: TransactionsSearchResult }) {\n  const [open, setOpen] = React.useState(false);\n  const [txnId, setTxnId] = React.useState<number | null>(null);\n  const rows = (data.items ?? []).slice(0, 50).map((t: Txn) => [\n    shortDate(t.date),\n    t.merchant || \"—\",\n    t.description || \"—\",\n    t.category || \"Unknown\",\n    <span className={Number(t.amount) < 0 ? \"text-[var(--accent-bad)]\" : \"text-[var(--accent-good)]\"}>\n      {money(t.amount)}\n    </span>,\n    <Button\n      variant=\"pill-outline\"\n      className=\"h-8 px-3 text-xs\"\n      onClick={() => { const id = Number(t.id); if (!isNaN(id)) { setTxnId(id); setOpen(true); } }}\n    >\n      Explain\n    </Button>,\n  ]);\n  return (\n    <Card title={`Transactions (${data.total ?? rows.length})`}>\n      <T header={[\"Date\", \"Merchant\", \"Description\", \"Category\", \"Amount\", \"\"]} rows={rows} />\n      <ExplainSignalDrawer txnId={txnId} open={open} onOpenChange={setOpen} />\n    </Card>\n  );\n}\n\nexport function CategorizeResultCard({ data }: { data: CategorizeResult }) {\n  const rows = (data.updated ?? []).map((u) => [String(u.id), u.category]);\n  return (\n    <Card\n      title=\"Categorize Result\"\n      right={<span className=\"text-xs text-[color:var(--text-muted)]\">{rows.length} updated</span>}\n    >\n      <T header={[\"Txn ID\", \"New Category\"]} rows={rows} />\n      {data.skipped ? (\n        <p className=\"mt-2 text-xs text-[color:var(--text-muted)]\">\n          {data.skipped} skipped (already labeled)\n        </p>\n      ) : null}\n    </Card>\n  );\n}\n\n/** ---------- Budget ---------- */\n\nexport function BudgetSummaryCard({ data }: { data: BudgetSummaryResult }) {\n  const rows = (data.totals ?? []).map((x) => [x.category, money(x.budget ?? null), money(x.actual)]);\n  return (\n    <Card\n      title={\n        <div className=\"flex items-center gap-2\">\n          <span>Budget Summary {data.month ? `— ${data.month}` : \"\"}</span>\n          <Tooltip>\n            <TooltipTrigger asChild>\n              <InfoDot />\n            </TooltipTrigger>\n            <TooltipContent>\n              Shows budgeted vs actual by category for the selected month.\n            </TooltipContent>\n          </Tooltip>\n        </div>\n      }\n    >\n      <T header={[\"Category\", \"Budget\", \"Actual\"]} rows={rows} />\n    </Card>\n  );\n}\n\nexport function BudgetCheckCard({ data }: { data: BudgetCheckResult }) {\n  const rows = (data.utilization ?? []).map((x) => [\n    x.category,\n    money(x.budget ?? null),\n    money(x.actual),\n    `${Math.round((x.ratio ?? 0) * 100)}%`,\n  ]);\n  return (\n    <Card title={`Budget Check ${data.month ? `— ${data.month}` : \"\"}`}>\n      <T header={[\"Category\", \"Budget\", \"Actual\", \"Utilization\"]} rows={rows} />\n    </Card>\n  );\n}\n\n/** ---------- Insights (Summary) ---------- */\n\nexport function InsightSummaryCard({ data }: { data: InsightSummaryResult }) {\n  const [open, setOpen] = React.useState(false);\n  const [txnId, setTxnId] = React.useState<number | null>(null);\n  const topCats = (data.topCategories ?? []).slice(0, 5).map((c) => [c.category, money(c.amount)]);\n  const topMerch = (data.topMerchants ?? []).slice(0, 5).map((m) => [m.merchant, money(m.amount)]);\n  const large = (data.largeTransactions ?? []).slice(0, 5).map((t) => [\n    shortDate(t.date),\n    t.merchant || \"—\",\n    t.category || \"Unknown\",\n    money(t.amount),\n    <Button\n      variant=\"pill-outline\"\n      className=\"h-8 px-3 text-xs\"\n      onClick={() => { const id = Number(t.id); if (!isNaN(id)) { setTxnId(id); setOpen(true); } }}\n    >\n      Explain\n    </Button>,\n  ]);\n\n  const income = data.summary?.income ?? 0;\n  const spend = data.summary?.spend ?? 0; // negative\n  const net = data.summary?.net ?? 0;\n\n  return (\n    <div className=\"grid md:grid-cols-2 gap-3\">\n      <Card\n        title={\n          <div className=\"flex items-center gap-2\">\n            <span>Summary {data.month ? `— ${data.month}` : \"\"}</span>\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <InfoDot />\n              </TooltipTrigger>\n              <TooltipContent>\n                Shows total income, spending, and net balance for the selected month.\n              </TooltipContent>\n            </Tooltip>\n          </div>\n        }\n      >\n        <div className=\"text-sm space-y-1\">\n          <div className=\"text-[color:var(--text-muted)]\">Income</div>\n          <div className=\"text-2xl font-semibold text-[var(--text-strong)]\">{money(income)}</div>\n\n          <div className=\"text-[color:var(--text-muted)] mt-2\">Spend</div>\n          <div className=\"text-2xl font-semibold text-[var(--text-strong)]\">{money(Math.abs(spend))}</div>\n\n          <div className=\"text-[color:var(--text-muted)] mt-2\">Net</div>\n          <div\n            className={`text-2xl font-semibold ${\n              net > 0\n                ? \"text-[var(--accent-good)]\"\n                : net < 0\n                ? \"text-[var(--accent-bad)]\"\n                : \"text-[var(--text-strong)]\"\n            }`}\n          >\n            {money(net)}\n          </div>\n\n          {data.unknownSpend ? (\n            <div className=\"mt-2 inline-flex items-center gap-1 badge-warn\">\n              Unknown spend: {money(Math.abs(data.unknownSpend.amount))} ({data.unknownSpend.count} txns)\n            </div>\n          ) : null}\n        </div>\n      </Card>\n\n      <Card title=\"Top Categories\">\n        <T header={[\"Category\", \"Amount\"]} rows={topCats} />\n      </Card>\n\n      <Card title=\"Top Merchants\">\n        <T header={[\"Merchant\", \"Amount\"]} rows={topMerch} />\n      </Card>\n\n      <Card title=\"Large Transactions\">\n        <T header={[\"Date\", \"Merchant\", \"Category\", \"Amount\", \"\"]} rows={large} />\n        <ExplainSignalDrawer txnId={txnId} open={open} onOpenChange={setOpen} />\n      </Card>\n    </div>\n  );\n}\n\n/** ---------- Charts ---------- */\n\nexport function ChartsSummaryCard({ data }: { data: ChartsSummaryResult }) {\n  return (\n    <Card\n      title={\n        <div className=\"flex items-center gap-2\">\n          <span>Chart Summary {data.month ? `— ${data.month}` : \"\"}</span>\n          <Tooltip>\n            <TooltipTrigger asChild>\n              <InfoDot />\n            </TooltipTrigger>\n            <TooltipContent>\n              High‑level totals (income, spend, net) for the selected month.\n            </TooltipContent>\n          </Tooltip>\n        </div>\n      }\n    >\n      <div className=\"grid grid-cols-3 gap-3 text-sm\">\n        <div>\n          <div className=\"text-[color:var(--text-muted)]\">Income</div>\n          <div className=\"font-semibold text-[var(--text-strong)]\">{money(data.income)}</div>\n        </div>\n        <div>\n          <div className=\"text-[color:var(--text-muted)]\">Spend</div>\n          <div className=\"font-semibold text-[var(--text-strong)]\">{money(Math.abs(data.spend))}</div>\n        </div>\n        <div>\n          <div className=\"text-[color:var(--text-muted)]\">Net</div>\n          <div className=\"font-semibold text-[var(--text-strong)]\">{money(data.net)}</div>\n        </div>\n      </div>\n    </Card>\n  );\n}\n\nexport function ChartsMerchantsCard({ data }: { data: ChartsMerchantsResult }) {\n  const rows = (data.merchants ?? []).map((m) => [m.merchant, money(m.amount)]);\n  return (\n    <Card title={`Top Merchants ${data.month ? `— ${data.month}` : \"\"}`}>\n      <T header={[\"Merchant\", \"Amount\"]} rows={rows} />\n    </Card>\n  );\n}\n\nexport function ChartsFlowsCard({ data }: { data: ChartsFlowsResult }) {\n  const inflow = (data.inflow ?? []).map((x) => [x.name, money(x.amount)]);\n  const outflow = (data.outflow ?? []).map((x) => [x.name, money(x.amount)]);\n  return (\n    <div className=\"grid md:grid-cols-2 gap-3\">\n      <Card title=\"Inflow\">\n        <T header={[\"Source\", \"Amount\"]} rows={inflow} />\n      </Card>\n      <Card title=\"Outflow\">\n        <T header={[\"Sink\", \"Amount\"]} rows={outflow} />\n      </Card>\n    </div>\n  );\n}\n\nexport function ChartsTrendsCard({ data }: { data: ChartsTrendsResult }) {\n  const rows = (data.series ?? []).map((s) => [s.month, money(s.income), money(Math.abs(s.spend)), money(s.net)]);\n  return <Card title=\"Spending Trends\">\n    <T header={[\"Month\", \"Income\", \"Spend\", \"Net\"]} rows={rows} />\n  </Card>;\n}\n\n/** ---------- Rules ---------- */\n\nexport function RulesTestCard({ data }: { data: RulesTestResult }) {\n  const rows = (data.matched ?? []).slice(0, 50).map((t) => [\n    String(t.id),\n    shortDate(t.date),\n    t.merchant ?? \"—\",\n    t.description ?? \"—\",\n    t.category ?? \"Unknown\",\n    money(t.amount),\n  ]);\n  return (\n    <Card title=\"Rule Test — Matches\">\n      <T header={[\"ID\", \"Date\", \"Merchant\", \"Description\", \"Category\", \"Amount\"]} rows={rows} />\n    </Card>\n  );\n}\n\nexport function RulesApplyCard({ data }: { data: RulesApplyResult }) {\n  return (\n    <Card title=\"Rule Apply\">\n      <div className=\"text-sm\">\n        Applied to <b>{data.applied}</b> transactions\n        {typeof data.preview === \"number\" ? ` (preview: ${data.preview})` : \"\"}.\n      </div>\n    </Card>\n  );\n}\n\n/** ---------- Insights Expanded ---------- */\n\nconst pctFmt = (p: number | null) => (p == null ? \"—\" : `${Math.round(p * 100)}%`);\nconst deltaBadge = (v: number) => (\n  <span\n    className={`px-2 py-0.5 rounded-full text-xs ${\n      v > 0\n        ? \"bg-[rgba(251,113,133,0.15)] text-[var(--accent-bad)] border border-[rgba(251,113,133,0.35)]\"\n        : v < 0\n        ? \"bg-[rgba(52,211,153,0.15)] text-[var(--accent-good)] border border-[rgba(52,211,153,0.35)]\"\n        : \"bg-[color:var(--bg-card-alt)] text-[color:var(--text-muted)] border border-[color:var(--border-subtle)]\"\n    }`}\n  >\n    {v > 0 ? \"▲\" : v < 0 ? \"▼\" : \"•\"} {Math.abs(v).toFixed(2)}\n  </span>\n);\n\nfunction MoMRow({ label, stat }: { label: string; stat: MoMStat }) {\n  return (\n    <tr className=\"border-b last:border-b-0\" style={{ borderColor: \"var(--border-subtle)\" }}>\n      <td className=\"py-2 pr-4 text-[color:var(--text-muted)]\">{label}</td>\n      <td className=\"py-2 pr-4\">{stat.prev.toFixed(2)}</td>\n      <td className=\"py-2 pr-4\">{stat.curr.toFixed(2)}</td>\n      <td className=\"py-2 pr-4\">{deltaBadge(stat.delta)}</td>\n      <td className=\"py-2 pr-4\">{pctFmt(stat.pct)}</td>\n    </tr>\n  );\n}\n\nexport function InsightsExpandedCard({ data }: { data: InsightsExpandedResult }) {\n  const sum = data.summary;\n  const mom = data.mom;\n  const cats = data.anomalies?.categories ?? [];\n  const merch = data.anomalies?.merchants ?? [];\n\n  return (\n  <section className=\"panel p-4 space-y-3\">\n      <div className=\"rounded-2xl border border-[color:var(--border-subtle)] bg-[var(--bg-card)] p-4 shadow-lg text-[var(--text)]\">\n        <div className=\"flex items-baseline justify-between mb-2\">\n          <h3 className=\"text-sm font-semibold text-[var(--text)]\">\n            Expanded Insights — {data.month || \"(latest)\"}\n          </h3>\n          {data.prev_month ? (\n            <span className=\"text-xs text-[color:var(--text-muted)]\">vs {data.prev_month}</span>\n          ) : (\n            <span className=\"text-xs text-[color:var(--text-muted)]\">no prior month</span>\n          )}\n        </div>\n\n        {sum ? (\n          <div className=\"grid grid-cols-3 gap-4 mb-3\">\n            <div>\n              <div className=\"text-xs text-[color:var(--text-muted)]\">Income</div>\n              <div className=\"text-2xl font-semibold text-[var(--text-strong)]\">{money(sum.income)}</div>\n            </div>\n            <div>\n              <div className=\"text-xs text-[color:var(--text-muted)]\">Spend</div>\n              <div className=\"text-2xl font-semibold text-[var(--text-strong)]\">{money(Math.abs(sum.spend))}</div>\n            </div>\n            <div>\n              <div className=\"text-xs text-[color:var(--text-muted)]\">Net</div>\n              <div\n                className={`text-2xl font-semibold ${\n                  sum.net > 0\n                    ? \"text-[var(--accent-good)]\"\n                    : sum.net < 0\n                    ? \"text-[var(--accent-bad)]\"\n                    : \"text-[var(--text-strong)]\"\n                }`}\n              >\n                {money(sum.net)}\n              </div>\n            </div>\n          </div>\n        ) : (\n          <div className=\"text-sm text-[color:var(--text-muted)]\">No data for this month.</div>\n        )}\n\n        {data.unknown_spend && (\n          <span className=\"inline-flex items-center gap-1 badge-warn\">\n            Unknown spend: {money(Math.abs(data.unknown_spend.amount))} ({data.unknown_spend.count} txns)\n          </span>\n        )}\n      </div>\n\n      {mom ? (\n        <Card title=\"Month-over-Month\">\n          <div className=\"overflow-auto\">\n            <table className=\"w-full text-sm\">\n              <thead>\n                <tr className=\"text-left text-[color:var(--text-muted)] border-b\" style={{ borderColor: \"var(--border-subtle)\" }}>\n                  <th className=\"py-2 pr-4\">Metric</th>\n                  <th className=\"py-2 pr-4\">Prev</th>\n                  <th className=\"py-2 pr-4\">Curr</th>\n                  <th className=\"py-2 pr-4\">Δ</th>\n                  <th className=\"py-2 pr-4\">% Δ</th>\n                </tr>\n              </thead>\n              <tbody>\n                <MoMRow label=\"Income\" stat={mom.income} />\n                <MoMRow label=\"Spend\" stat={mom.spend} />\n                <MoMRow label=\"Net\" stat={mom.net} />\n              </tbody>\n            </table>\n          </div>\n        </Card>\n      ) : null}\n\n      <div className=\"grid md:grid-cols-2 gap-3\">\n        <div className=\"rounded-2xl border border-[color:var(--border-subtle)] bg-[var(--bg-card)] p-4 shadow-lg text-[var(--text)]\">\n          <h3 className=\"text-sm font-semibold mb-2 text-[var(--text)]\">Top Categories</h3>\n          <table className=\"w-full text-sm\">\n            <thead className=\"border-b\" style={{ borderColor: \"var(--border-subtle)\" }}>\n              <tr className=\"text-left text-[color:var(--text-muted)]\">\n                <th className=\"py-2 font-medium\">Category</th>\n                <th className=\"py-2 text-right font-medium\">Amount</th>\n              </tr>\n            </thead>\n            <tbody>\n              {(data.top_categories ?? []).map((c, i) => (\n                <tr key={i} className=\"hover:bg-[color:var(--bg-card-alt)]\">\n                  <td className=\"py-2\">{c.category}</td>\n                  <td className=\"py-2 text-right text-[var(--text-strong)]\">{money(c.amount)}</td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n\n        <div className=\"rounded-2xl border border-[color:var(--border-subtle)] bg-[var(--bg-card)] p-4 shadow-lg text-[var(--text)]\">\n          <h3 className=\"text-sm font-semibold mb-2 text-[var(--text)]\">Top Merchants</h3>\n          <table className=\"w-full text-sm\">\n            <thead className=\"border-b\" style={{ borderColor: \"var(--border-subtle)\" }}>\n              <tr className=\"text-left text-[color:var(--text-muted)]\">\n                <th className=\"py-2 font-medium\">Merchant</th>\n                <th className=\"py-2 text-right font-medium\">Amount</th>\n              </tr>\n            </thead>\n            <tbody>\n              {(data.top_merchants ?? []).map((m, i) => (\n                <tr key={i} className=\"hover:bg-[color:var(--bg-card-alt)]\">\n                  <td className=\"py-2\">{m.merchant}</td>\n                  <td className=\"py-2 text-right text-[var(--text-strong)]\">{money(m.amount)}</td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      </div>\n\n      <div className=\"rounded-2xl border border-[color:var(--border-subtle)] bg-[var(--bg-card)] p-4 shadow-lg text-[var(--text)]\">\n        <h3 className=\"text-sm font-semibold mb-2 text-[var(--text)]\">Large Transactions</h3>\n        <table className=\"w-full text-sm\">\n          <thead className=\"border-b\" style={{ borderColor: \"var(--border-subtle)\" }}>\n            <tr className=\"text-left text-[color:var(--text-muted)]\">\n              <th className=\"py-2 font-medium\">Date</th>\n              <th className=\"py-2 font-medium\">Merchant</th>\n              <th className=\"py-2 font-medium\">Category</th>\n              <th className=\"py-2 text-right font-medium\">Amount</th>\n            </tr>\n          </thead>\n          <tbody>\n            {(data.large_transactions ?? []).map((t, i) => (\n              <tr key={i} className=\"hover:bg-[color:var(--bg-card-alt)]\">\n                <td className=\"py-2\">{shortDate(t.date ?? undefined)}</td>\n                <td className=\"py-2\">{t.merchant || \"—\"}</td>\n                <td className=\"py-2\">{t.category || \"Unknown\"}</td>\n                <td className=\"py-2 text-right text-[var(--text-strong)]\">{money(t.amount)}</td>\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      </div>\n\n      <div className=\"grid md:grid-cols-2 gap-3\">\n        <Card title=\"Anomalies — Categories\">\n          {(data.anomalies?.categories ?? []).length ? (\n            <T\n              header={[\"Category\", \"Prev\", \"Curr\", \"Δ\", \"% Δ\"]}\n              rows={(data.anomalies?.categories ?? []).map((a) => [\n                a.key,\n                a.prev.toFixed(2),\n                a.curr.toFixed(2),\n                a.delta.toFixed(2),\n                pctFmt(a.pct),\n              ])}\n            />\n          ) : (\n            <div className=\"text-sm text-[color:var(--text-muted)]\">No category spikes detected.</div>\n          )}\n        </Card>\n        <Card title=\"Anomalies — Merchants\">\n          {(data.anomalies?.merchants ?? []).length ? (\n            <T\n              header={[\"Merchant\", \"Prev\", \"Curr\", \"Δ\", \"% Δ\"]}\n              rows={(data.anomalies?.merchants ?? []).map((a) => [\n                a.key,\n                a.prev.toFixed(2),\n                a.curr.toFixed(2),\n                a.delta.toFixed(2),\n                pctFmt(a.pct),\n              ])}\n            />\n          ) : (\n            <div className=\"text-sm text-[color:var(--text-muted)]\">No merchant spikes detected.</div>\n          )}\n        </Card>\n      </div>\n  </section>\n  );\n}\n\n/** ---------- Dispatcher ---------- */\n\nexport function AgentResultRenderer({ tool, data }: { tool: ToolKey; data: any }) {\n  switch (tool) {\n    case \"transactions.search\":\n      return <TransactionsSearchCard data={data as TransactionsSearchResult} />;\n    case \"transactions.categorize\":\n      return <CategorizeResultCard data={data as CategorizeResult} />;\n    case \"transactions.get_by_ids\":\n      return <TransactionsSearchCard data={{ items: data as any[] } as TransactionsSearchResult} />;\n    case \"budget.summary\":\n      return <BudgetSummaryCard data={data as BudgetSummaryResult} />;\n    case \"budget.check\":\n      return <BudgetCheckCard data={data as BudgetCheckResult} />;\n    case \"insights.expanded\":\n      return <InsightsExpandedCard data={data as InsightsExpandedResult} />;\n    case \"charts.summary\":\n      return <ChartsSummaryCard data={data as ChartsSummaryResult} />;\n    case \"charts.merchants\":\n      return <ChartsMerchantsCard data={data as ChartsMerchantsResult} />;\n    case \"charts.flows\":\n      return <ChartsFlowsCard data={data as ChartsFlowsResult} />;\n    case \"charts.trends\":\n      return <ChartsTrendsCard data={data as ChartsTrendsResult} />;\n    case \"rules.test\":\n      return <RulesTestCard data={data as RulesTestResult} />;\n    case \"rules.apply\":\n      return <RulesApplyCard data={data as RulesApplyResult} />;\n    default:\n      return <pre className=\"text-xs whitespace-pre-wrap break-all\">{JSON.stringify(data, null, 2)}</pre>;\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\AgentTools.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[761,764],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[761,764],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { focusComposer, getComposerValue, SEARCH_PLACEHOLDER, setComposerPlaceholder } from \"@/state/chat/ui\";\nimport { pushAssistant, callTool } from \"@/state/chat\";\nimport type { ChipAction } from \"@/components/QuickChips\";\n\nexport const EXAMPLES: { label: string; action: ChipAction }[] = [\n  { label: \"Starbucks this month\", action: { type: \"nl_search\", query: \"Starbucks this month\" } },\n  { label: \"Delta in Aug 2025\", action: { type: \"nl_search\", query: \"Delta in Aug 2025\" } },\n  { label: \"Transactions > $50 last 90 days\", action: { type: \"nl_search\", query: \"transactions > $50 last 90 days\" } },\n  { label: \"Refunds last month\", action: { type: \"nl_search\", query: \"refunds last month\" } },\n];\n\ntype TransactionsPayload = { query?: string; filters?: any };\n\nlet lastTransactionsPayload: TransactionsPayload | null = null;\n\nexport async function handleTransactionsNL(payload?: TransactionsPayload) {\n  const raw = payload?.query ?? getComposerValue();\n  const q = (raw || \"\").trim();\n\n  if (!q && !payload?.filters) {\n    pushAssistant({\n      reply:\n        \"Type what to search, e.g., ‘Starbucks this month’, ‘Delta in Aug 2025’, ‘transactions > $50 last 90 days’.\",\n      rephrased: false,\n      suggestions: EXAMPLES,\n      meta: { tool: \"transactions.nl\", reason: \"empty\" },\n    });\n    setComposerPlaceholder(SEARCH_PLACEHOLDER);\n    focusComposer();\n    return;\n  }\n\n  const nextPayload: TransactionsPayload = payload?.filters\n    ? { filters: payload.filters }\n    : { query: q };\n\n  lastTransactionsPayload = nextPayload;\n  await callTool(\"transactions.nl\", nextPayload);\n}\n\nif (typeof window !== \"undefined\") {\n  const key = \"__transactionsNlChipListener__\" as const;\n  const win = window as typeof window & { [key]?: boolean };\n  if (!win[key]) {\n    win[key] = true;\n    window.addEventListener(\n      \"chip-action\",\n      (e: Event) => {\n        const evt = e as CustomEvent<ChipAction>;\n        const action = evt.detail;\n        if (!action) return;\n        if (action.type === \"nl_search\") {\n          void handleTransactionsNL({ query: action.query });\n        } else if (action.type === \"nl_search_filters\") {\n          void handleTransactionsNL({ filters: action.filters });\n        } else if (action.type === \"toggle\" && action.key === \"insightsExpanded\") {\n          document.querySelector<HTMLButtonElement>(\"#toggle-insights-expanded\")?.click();\n          if (lastTransactionsPayload) {\n            void handleTransactionsNL(lastTransactionsPayload);\n          }\n        } else if (action.type === \"nav\") {\n          window.location.href = action.href;\n        }\n      },\n      false\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\AnalyticsPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ForecastChart' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[290,293],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[290,293],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":112,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":115,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[744,747],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[744,747],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":114,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":117,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1088,1091],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1088,1091],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { analytics } from \"@/lib/api\";\nimport { useMonth } from \"@/context/MonthContext\";\nimport ForecastChart from \"@/components/ForecastChart\";\n\nexport function ForecastControls({ onLoad }: { onLoad: (data: any) => void }) {\n  const { month } = useMonth();\n  const [model, setModel] = React.useState<\"auto\" | \"ema\" | \"sarimax\">(\"auto\");\n  const [ci, setCi] = React.useState<0 | 0.8 | 0.9 | 0.95>(0.8);\n  const [h, setH] = React.useState(3);\n\n  return (\n    <div className=\"flex gap-2 items-end\">\n      <label className=\"text-sm\">\n        Model<br />\n        <select className=\"border rounded px-2 py-1\" value={model} onChange={(e) => setModel(e.target.value as any)}>\n          <option value=\"auto\">Auto</option>\n          <option value=\"sarimax\">SARIMAX</option>\n          <option value=\"ema\">EMA</option>\n        </select>\n      </label>\n\n      <label className=\"text-sm\">\n        CI<br />\n        <select className=\"border rounded px-2 py-1\" value={ci} onChange={(e) => setCi(Number(e.target.value) as any)}>\n          <option value={0}>Off</option>\n          <option value={0.8}>80%</option>\n          <option value={0.9}>90%</option>\n          <option value={0.95}>95%</option>\n        </select>\n      </label>\n\n      <label className=\"text-sm\">\n        Horizon<br />\n        <input\n          className=\"border rounded px-2 py-1 w-16\"\n          type=\"number\"\n          min={1}\n          max={12}\n          value={h}\n          onChange={(e) => setH(Math.max(1, Math.min(12, Number(e.target.value))))}\n        />\n      </label>\n\n      <Button\n        variant=\"pill-primary\"\n        className=\"ml-2 h-9 px-4\"\n        onClick={async () => {\n          const data = await analytics.forecast(month, h, { model, ciLevel: ci });\n          onLoad(data);\n        }}\n      >\n        Run\n      </Button>\n    </div>\n  );\n}\n\n// ForecastCard moved to separate component\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\AvatarSkeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\Brand.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\BudgetRecommendationsPanel.tsx","messages":[{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":29,"column":65,"nodeType":"BlockStatement","messageId":"unexpected","endLine":29,"endColumn":67,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[1339,1339],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1849,1852],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1849,1852],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2559,2562],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2559,2562],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":119,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5769,5772],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5769,5772],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":145,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6999,7002],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6999,7002],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\nimport { getBudgetRecommendations, type BudgetRecommendation, applyBudgets, downloadReportPdf } from \"@/lib/api\";\nimport Card from \"./Card\";\nimport { emitToastSuccess, emitToastError } from \"@/lib/toast-helpers\";\nimport CardHelpTooltip from \"./CardHelpTooltip\";\nimport { getHelpBaseText } from '@/lib/helpBaseText';\nimport { t } from '@/lib/i18n';\n\nconst LS_KEY = \"budgets_lookback_months\";\n\nexport default function BudgetRecommendationsPanel() {\n  const [months, setMonths] = React.useState<number>(() => {\n    try {\n      const raw = localStorage.getItem(LS_KEY);\n      const m = raw ? parseInt(raw, 10) : 6;\n      return Number.isFinite(m) ? m : 6;\n    } catch { return 6; }\n  });\n  const [loading, setLoading] = React.useState(false);\n  const [data, setData] = React.useState<BudgetRecommendation[]>([]);\n  const [error, setError] = React.useState<string | null>(null);\n  const [include, setInclude] = React.useState<string>(\"\");\n  const [exclude, setExclude] = React.useState<string>(\"\");\n  const [onlyRisky, setOnlyRisky] = React.useState(false);\n  const [applyBusy, setApplyBusy] = React.useState<\"\" | \"median\" | \"p75\" | \"median_plus_10\">(\"\");\n  const [busyRow, setBusyRow] = React.useState<string | null>(null);\n\n  React.useEffect(() => {\n    try { localStorage.setItem(LS_KEY, String(months)); } catch {}\n  }, [months]);\n\n  const load = React.useCallback(async (m: number) => {\n    setLoading(true);\n    setError(null);\n    try {\n      const res = await getBudgetRecommendations(m, {\n        include_current: true,\n        include_only_over_p75: onlyRisky,\n        include: include ? include.split(\",\").map(s => s.trim()).filter(Boolean) : undefined,\n        exclude: exclude ? exclude.split(\",\").map(s => s.trim()).filter(Boolean) : undefined,\n      });\n      setData(res.recommendations ?? []);\n    } catch (e: any) {\n      setError(e?.message ?? \"Failed to load recommendations\");\n    } finally {\n      setLoading(false);\n    }\n  }, [include, exclude, onlyRisky]);\n\n  React.useEffect(() => {\n    load(months);\n  }, [months, load]);\n\n  async function applySingleCategory(category: string, strategy: \"median\" | \"p75\" | \"median_plus_10\" = \"median\") {\n    setBusyRow(category);\n    try {\n      const resp = await applyBudgets({ strategy, months, categories_include: [category] });\n      const amt = resp.applied?.[0]?.amount ?? 0;\n      emitToastSuccess(t('ui.toast.budget_single_applied_title'), { description: t('ui.toast.budget_single_applied_description', { category, amount: `$${amt.toFixed(2)}` }) });\n    } catch (e: any) {\n      emitToastError(t('ui.toast.budget_single_apply_failed_title', { category }), { description: e?.message });\n    } finally {\n      setBusyRow(null);\n      load(months);\n    }\n  }\n\n  return (\n    <Card className=\"w-full\" title=\"Smart Budget Recommendations\">\n      <div className=\"flex items-center justify-between mb-2\">\n        <h3 className=\"text-base font-semibold flex items-center\">\n          Smart Budget Recommendations\n          <CardHelpTooltip cardId=\"cards.budget_recommendations\" ctx={{ data }} baseText={getHelpBaseText('cards.budget_recommendations')} className=\"ml-2\" />\n        </h3>\n      </div>\n      <div className=\"flex flex-col gap-3 pb-2 mb-3\">\n        <div className=\"flex items-center justify-between gap-3\">\n          <div className=\"flex items-center gap-2\">\n            <label className=\"text-sm opacity-70\">Lookback</label>\n            <select\n              className=\"rounded-md border border-border bg-card px-2 py-1 text-sm\"\n              value={months}\n              onChange={(e) => setMonths(parseInt(e.target.value, 10))}\n            >\n              {[3, 6, 9, 12, 18, 24].map((m) => (\n                <option key={m} value={m}>{m} months</option>\n              ))}\n            </select>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <label className=\"text-sm opacity-70\">Include</label>\n            <input className=\"w-40 rounded-md border border-border bg-card px-2 py-1 text-sm\" placeholder=\"cat1, cat2\" value={include} onChange={(e)=>setInclude(e.target.value)} />\n            <label className=\"text-sm opacity-70\">Exclude</label>\n            <input className=\"w-40 rounded-md border border-border bg-card px-2 py-1 text-sm\" placeholder=\"catA, catB\" value={exclude} onChange={(e)=>setExclude(e.target.value)} />\n            <label className=\"flex items-center gap-1 text-sm\">\n              <input type=\"checkbox\" checked={onlyRisky} onChange={(e)=>setOnlyRisky(e.target.checked)} />\n              only risky (over p75)\n            </label>\n            <button\n              className=\"ml-2 text-xs px-2 py-1 rounded-md border border-border hover:bg-neutral-800\"\n              onClick={()=>load(months)}\n            >Apply Filters</button>\n          </div>\n        </div>\n\n        <div className=\"flex items-center gap-2\">\n          <span className=\"text-xs opacity-70\">One-click:</span>\n    {([\"median\",\"p75\",\"median_plus_10\"] as const).map((strategy) => (\n            <button\n              key={strategy}\n              disabled={applyBusy === strategy}\n              onClick={async ()=>{\n                try {\n                  setApplyBusy(strategy);\n                  const includeList = include ? include.split(\",\").map(s=>s.trim()).filter(Boolean) : undefined;\n                  const excludeList = exclude ? exclude.split(\",\").map(s=>s.trim()).filter(Boolean) : undefined;\n      const r = await applyBudgets({ strategy, months, categories_include: includeList, categories_exclude: excludeList });\n  emitToastSuccess(t('ui.toast.budget_bulk_applied_title'), { description: t('ui.toast.budget_bulk_applied_description', { count: r.applied_count, total: `$${r.applied_total.toFixed(2)}` }) });\n                } catch (e: any) {\n  emitToastError(t('ui.toast.budget_bulk_apply_failed_title'), { description: e?.message });\n                } finally {\n                  setApplyBusy(\"\");\n                }\n              }}\n              className=\"text-xs px-2 py-1 rounded-md bg-white text-black hover:opacity-90 disabled:opacity-50\"\n              title={strategy === 'median_plus_10' ? 'Median + 10%' : strategy.toUpperCase()}\n            >\n              {strategy === 'median' ? 'Apply Median' : strategy === 'p75' ? 'Apply p75' : 'Apply Median+10%'}\n            </button>\n          ))}\n          <button\n            className=\"ml-2 text-[11px] px-2 py-1 rounded-md border border-neutral-700 hover:bg-neutral-900\"\n            title=\"Export PDF report\"\n            onClick={async () => {\n              try {\n                const { blob, filename } = await downloadReportPdf();\n                const url = URL.createObjectURL(blob);\n                const a = document.createElement('a');\n                a.href = url;\n                a.download = filename || 'finance_report.pdf';\n                document.body.appendChild(a);\n                a.click();\n                a.remove();\n                URL.revokeObjectURL(url);\n              } catch (err: any) {\n                alert(`PDF export failed: ${err?.message || String(err)}`);\n              }\n            }}\n          >\n            Export PDF\n          </button>\n        </div>\n      </div>\n\n      {loading && <div className=\"text-sm opacity-70\">Loading…</div>}\n      {error && <div className=\"text-sm text-red-500\">{error}</div>}\n\n      {!loading && !error && (\n        <div className=\"overflow-x-auto\">\n      <table className=\"w-full text-sm\">\n            <thead className=\"text-left opacity-70\">\n              <tr>\n                <th className=\"py-2 pr-3\">Category</th>\n                <th className=\"py-2 pr-3\">Median</th>\n                <th className=\"py-2 pr-3\">p75</th>\n                <th className=\"py-2 pr-3\">Avg</th>\n                <th className=\"py-2 pr-3\">Months</th>\n                <th className=\"py-2 pr-3\">Current</th>\n                <th className=\"py-2 pr-0 text-right\">Actions</th>\n              </tr>\n            </thead>\n            <tbody>\n              {data.length === 0 && (\n                <tr>\n                  <td colSpan={7} className=\"py-3 opacity-70\">\n                    No recommendations yet. Ingest more data or widen the lookback.\n                  </td>\n                </tr>\n              )}\n              {data.map((r) => {\n                const risky = !!r.over_p75;\n                return (\n                  <tr key={r.category} className={`border-t border-border/50 ${risky ? 'bg-rose-900/10' : ''}`}>\n                    <td className=\"py-2 pr-3 flex items-center gap-1\">\n                      {risky ? <span title=\"Above p75\" className=\"text-rose-400\">⚠</span> : null}\n                      <span>{r.category}</span>\n                    </td>\n                    <td className=\"py-2 pr-3\">${r.median.toFixed(2)}</td>\n                    <td className=\"py-2 pr-3\">${r.p75.toFixed(2)}</td>\n                    <td className=\"py-2 pr-3\">${r.avg.toFixed(2)}</td>\n                    <td className=\"py-2 pr-3\">{r.sample_size}</td>\n                    <td className=\"py-2 pr-3\">{r.current_month !== undefined && r.current_month !== null ? `$${r.current_month.toFixed(2)}` : '-'}</td>\n                    <td className=\"py-2 pr-0\">\n                      <div className=\"flex justify-end gap-2\">\n                        <button\n                          className=\"rounded-md border border-border px-2 py-1 text-xs disabled:opacity-60\"\n                          disabled={busyRow === r.category}\n                          title=\"Apply this category (Median)\"\n                          onClick={() => applySingleCategory(r.category, \"median\")}\n                        >\n                          {busyRow === r.category ? \"…\" : \"Apply\"}\n                        </button>\n                        <button\n                          className=\"rounded-md border border-border px-2 py-1 text-xs disabled:opacity-60\"\n                          disabled={busyRow === r.category}\n                          title=\"Apply this category (p75)\"\n                          onClick={() => applySingleCategory(r.category, \"p75\")}\n                        >\n                          p75\n                        </button>\n                      </div>\n                    </td>\n                  </tr>\n                );\n              })}\n            </tbody>\n          </table>\n        </div>\n      )}\n    </Card>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\BudgetsPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[644,647],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[644,647],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1104,1107],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1104,1107],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":64,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2593,2596],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2593,2596],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from \"react\";\nimport Card from \"./Card\";\nimport BudgetRecommendationsPanel from \"./BudgetRecommendationsPanel\";\nimport { getBudgetCheck } from \"../lib/api\";\nimport EmptyState from \"./EmptyState\";\nimport CardHelpTooltip from \"./CardHelpTooltip\";\nimport { getHelpBaseText } from '@/lib/helpBaseText';\nimport { t } from '@/lib/i18n';\n\ninterface Props {\n  /** Optional. If omitted, backend uses latest month. */\n  month?: string;\n  refreshKey?: number;\n}\n\nconst BudgetsPanel: React.FC<Props> = ({ month, refreshKey = 0 }) => {\n  const [loading, setLoading] = useState(true);\n  const [data, setData] = useState<any | null>(null);\n  const [error, setError] = useState<string | null>(null);\n  const [empty, setEmpty] = useState(false);\n\n  useEffect(() => {\n    let alive = true;\n    (async () => {\n      setLoading(true); setError(null);\n      setEmpty(false);\n      try {\n        const res = await getBudgetCheck(month); // 👈 month optional\n        if (!alive) return;\n        if (!res) { setEmpty(true); setData(null); }\n        else { setData(res); }\n      } catch (e: any) {\n        if (!alive) return;\n        setError(e?.message ?? String(e));\n      } finally {\n        if (alive) setLoading(false);\n      }\n    })();\n    return () => { alive = false; };\n  }, [month, refreshKey]);\n\n  const resolvedMonth = data?.month ?? month ?? \"(latest)\";\n  const items = data?.budget_items ?? [];\n\n  return (\n    <div className=\"grid grid-cols-1 gap-6 lg:grid-cols-2\">\n  <Card title={t('ui.cards.budgets_title', { month: resolvedMonth })}>\n        <div className=\"flex items-center justify-between mb-2\">\n          <h3 className=\"text-base font-semibold flex items-center\">\n            {t('ui.cards.budgets_title', { month: resolvedMonth })}\n            <CardHelpTooltip cardId=\"cards.budgets\" ctx={{ data }} baseText={getHelpBaseText('cards.budgets', { month: resolvedMonth })} className=\"ml-2\" />\n          </h3>\n        </div>\n        {loading && <p className=\"text-sm text-gray-400\">{t('cards.budgets.base', { month: resolvedMonth })}</p>}\n        {error && !empty && <p className=\"text-sm text-rose-300\">Error: {error}</p>}\n        {empty && !error && (\n          <EmptyState title={t('ui.empty.no_budgets_title')} note={t('ui.empty.no_budgets_note')} />\n        )}\n        {!loading && !error && !empty && items.length === 0 && (\n          <p className=\"text-sm text-gray-400\">{t('ui.empty.no_budgets_title')}</p>\n        )}\n        {!loading && !error && !empty && items.length > 0 && (\n          <div className=\"space-y-2 text-sm\">\n            {items.map((b: any, i: number) => {\n              const over = (b.over ?? 0) > 0;\n              return (\n                <div\n                  key={i}\n                  className={`flex items-center justify-between rounded-lg border px-3 py-2 ${\n                    over\n                      ? \"border-rose-700 bg-rose-900/20 text-rose-100\"\n                      : \"border-emerald-700 bg-emerald-900/20 text-emerald-100\"\n                  }`}\n                >\n                  <div className=\"font-medium\">{b.category}</div>\n                  <div className=\"text-right\">\n                    <div>Spent: ${Math.abs(b.spent ?? 0).toFixed(0)}</div>\n                    <div>Limit: ${Math.abs(b.limit ?? 0).toFixed(0)}</div>\n                    {over && <div className=\"font-semibold\">Over: ${Math.abs(b.over ?? 0).toFixed(0)}</div>}\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        )}\n      </Card>\n      <div data-explain-key=\"cards.budget_check\">\n        <BudgetRecommendationsPanel />\n      </div>\n    </div>\n  );\n};\n\nexport default BudgetsPanel;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\Card.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"This rule can't verify that `export *` only exports components.","line":1,"column":1,"nodeType":"ExportAllDeclaration","messageId":"exportAll","endLine":1,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export * from \"./ui/card\";\nexport { Card as default } from \"./ui/card\";\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\CardHeaderRow.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[251,254],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[251,254],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport CardHelpTooltip from \"./CardHelpTooltip\";\n\ntype Props = {\n  title: React.ReactNode | string;\n  helpKey?: string; // maps to cardId\n  month?: string;\n  actions?: React.ReactNode;\n  className?: string;\n  helpCtx?: any; // deterministic context object for the card\n  helpBaseText?: string; // base summary for why mode\n};\n\nexport default function CardHeaderRow({ title, helpKey, month, actions, className = \"mb-2\", helpCtx, helpBaseText }: Props) {\n  return (\n    <div className={`flex items-center justify-between ${className}`}>\n      <h3 className=\"text-base font-semibold flex items-center\">\n        {title}\n        {helpKey ? (\n          <CardHelpTooltip\n            cardId={helpKey}\n            month={month}\n            ctx={helpCtx || {}}\n            baseText={helpBaseText || null}\n            className=\"ml-2\"\n          />\n        ) : null}\n      </h3>\n      {actions ? <div className=\"ml-auto flex items-center gap-2\">{actions}</div> : null}\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\CardHelpTooltip.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[788,791],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[788,791],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":74,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2453,2456],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2453,2456],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":91,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2973,2976],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2973,2976],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from 'react';\r\nimport { getHelp } from '@/lib/helpTooltip';\r\nimport { Button, pillIconClass } from '@/components/ui/button';\r\nimport { t } from '@/lib/i18n';\r\n\r\n/**\r\n * CardHelpTooltip\r\n * Unified tooltip component that can show deterministic \"what\" help immediately\r\n * and optionally allow switching to a \"why\" rephrased explanation.\r\n *\r\n * Props:\r\n *  - cardId: stable id for caching (matches backend card_id)\r\n *  - month: optional month string for context\r\n *  - ctx: deterministic context object (mirrors render data; must be JSON-serializable)\r\n *  - baseText: optional base summary text (required for why mode)\r\n *  - className: optional button class overrides\r\n */\r\nexport interface CardHelpTooltipProps {\r\n  cardId: string;\r\n  month?: string | null;\r\n  ctx?: any;\r\n  baseText?: string | null;\r\n  className?: string;\r\n  variant?: 'icon' | 'text';\r\n  autoOpenWhyOnShift?: boolean; // if true, Shift+Click jumps directly to why\r\n}\r\n\r\ninterface HelpState {\r\n  mode: 'what' | 'why';\r\n  source?: string;\r\n  text: string;\r\n  etag?: string;\r\n  cached?: boolean;\r\n  stale?: boolean;\r\n  error?: string;\r\n}\r\n\r\nconst WIDTH = 360;\r\n\r\nexport default function CardHelpTooltip({\r\n  cardId,\r\n  month,\r\n  ctx = {},\r\n  baseText = null,\r\n  className = 'ml-2',\r\n  variant = 'icon',\r\n  autoOpenWhyOnShift = true,\r\n}: CardHelpTooltipProps) {\r\n  const btnRef = React.useRef<HTMLButtonElement | null>(null);\r\n  const [open, setOpen] = React.useState(false);\r\n  const [pos, setPos] = React.useState({ top: 0, left: 0 });\r\n  const [loadingWhat, setLoadingWhat] = React.useState(false);\r\n  const [loadingWhy, setLoadingWhy] = React.useState(false);\r\n  const [data, setData] = React.useState<HelpState | null>(null);\r\n  const [whyData, setWhyData] = React.useState<HelpState | null>(null);\r\n  const [activeTab, setActiveTab] = React.useState<'what' | 'why'>('what');\r\n  const popId = React.useId();\r\n\r\n  function position() {\r\n    const rect = btnRef.current?.getBoundingClientRect();\r\n    const padding = 8;\r\n    setPos({\r\n      top: (rect?.bottom || 0) + 8,\r\n      left: Math.max(padding, Math.min(rect?.left || 0, window.innerWidth - WIDTH - padding)),\r\n    });\r\n  }\r\n\r\n  async function fetchMode(mode: 'what' | 'why') {\r\n    const existing = mode === 'what' ? data : whyData;\r\n    if (existing && !existing.stale) return;\r\n    const setLoading = mode === 'what' ? setLoadingWhat : setLoadingWhy;\r\n    setLoading(true);\r\n    try {\r\n      const resp: any = await getHelp({\r\n        cardId,\r\n        mode,\r\n        month: month || undefined,\r\n        ctx,\r\n        baseText: mode === 'why' ? baseText || '(no base text provided)' : undefined,\r\n      });\r\n      const payload: HelpState = {\r\n        mode,\r\n        source: resp.source,\r\n        text: resp.text,\r\n        etag: resp.etag,\r\n        cached: resp.cached,\r\n        stale: resp.stale,\r\n        error: resp.error,\r\n      };\r\n      if (mode === 'what') setData(payload); else setWhyData(payload);\r\n    } catch (e: any) {\r\n      const payload: HelpState = {\r\n        mode,\r\n        text: 'Help unavailable.',\r\n        error: e?.message || String(e),\r\n      };\r\n      if (mode === 'what') setData(payload); else setWhyData(payload);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  async function openPopover(e: React.MouseEvent) {\r\n    const shift = e.shiftKey;\r\n    position();\r\n    setOpen(true);\r\n    if (shift && autoOpenWhyOnShift && baseText) {\r\n      setActiveTab('why');\r\n      await fetchMode('why');\r\n    } else {\r\n      await fetchMode('what');\r\n    }\r\n  }\r\n\r\n  function closePopover() {\r\n    setOpen(false);\r\n    btnRef.current?.focus?.();\r\n  }\r\n\r\n  React.useEffect(() => {\r\n    if (!open) return;\r\n    function onKey(ev: KeyboardEvent) { if (ev.key === 'Escape') closePopover(); }\r\n    function onDoc(ev: MouseEvent) {\r\n      const t = ev.target as HTMLElement;\r\n      const pop = document.querySelector('[data-popover-role=\"card-help\"]');\r\n      if (pop && !pop.contains(t) && btnRef.current && !btnRef.current.contains(t)) {\r\n        closePopover();\r\n      }\r\n    }\r\n    function onReposition() { position(); }\r\n    window.addEventListener('keydown', onKey);\r\n    window.addEventListener('click', onDoc, true);\r\n    window.addEventListener('resize', onReposition);\r\n    window.addEventListener('scroll', onReposition, true);\r\n    return () => {\r\n      window.removeEventListener('keydown', onKey);\r\n      window.removeEventListener('click', onDoc, true);\r\n      window.removeEventListener('resize', onReposition);\r\n      window.removeEventListener('scroll', onReposition, true);\r\n    };\r\n  }, [open]);\r\n\r\n  async function onSwitch(mode: 'what' | 'why') {\r\n    setActiveTab(mode);\r\n    await fetchMode(mode);\r\n  }\r\n\r\n  const showWhy = !!baseText; // only enable why tab if base text provided\r\n\r\n  const triggerLabel = variant === 'icon' ? '?' : t('ui.help.what'); // reuse 'What' as generic label when variant=text\r\n\r\n  return (\r\n    <>\r\n      <button\r\n        ref={btnRef}\r\n        aria-label=\"Card help\"\r\n        aria-expanded={open}\r\n        aria-controls={open ? popId : undefined}\r\n        onClick={open ? closePopover : openPopover}\r\n        className={`${variant === 'icon' ? pillIconClass + ' h-5 w-5 text-[11px]' : 'text-xs underline decoration-dotted'} ${className}`}\r\n  title={showWhy ? `${t('ui.help.what')} (Shift+Click ${t('ui.help.why')})` : t('ui.help.what')}\r\n      >\r\n        {triggerLabel}\r\n      </button>\r\n\r\n      {open && (\r\n        <div\r\n          id={popId}\r\n          data-popover-role=\"card-help\"\r\n          className=\"fixed z-[9999] w-[360px] rounded-xl border bg-background p-3 shadow-xl animate-in fade-in-0 zoom-in-95\"\r\n          style={{ top: pos.top, left: pos.left }}\r\n          role=\"dialog\"\r\n        >\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"font-medium\">Card Help</div>\r\n            <Button variant=\"pill-ghost\" className=\"h-7 px-2 text-xs\" onClick={closePopover}>{t('ui.help.close')}</Button>\r\n          </div>\r\n          <div className=\"mt-3 border-b pb-2 flex items-center gap-2 text-xs\">\r\n            <button\r\n              onClick={() => onSwitch('what')}\r\n              className={`px-2 py-1 rounded-md ${activeTab === 'what' ? 'bg-accent text-accent-foreground' : 'hover:bg-muted'}`}\r\n            >{t('ui.help.what')}</button>\r\n            {showWhy && (\r\n              <button\r\n                onClick={() => onSwitch('why')}\r\n                className={`px-2 py-1 rounded-md ${activeTab === 'why' ? 'bg-accent text-accent-foreground' : 'hover:bg-muted'}`}\r\n              >{t('ui.help.why')}</button>\r\n            )}\r\n            {(activeTab === 'why' ? whyData : data)?.source && (\r\n              <span className=\"ml-auto text-[10px] uppercase tracking-wide opacity-60\">\r\n                {(activeTab === 'why' ? whyData : data)?.source}\r\n              </span>\r\n            )}\r\n          </div>\r\n          <div className=\"mt-3 text-sm whitespace-pre-wrap max-h-[50vh] overflow-auto\">\r\n            {activeTab === 'what' && loadingWhat && !data && 'Loading…'}\r\n            {activeTab === 'why' && loadingWhy && !whyData && 'Loading…'}\r\n            {activeTab === 'what' && !loadingWhat && data?.text}\r\n            {activeTab === 'why' && !loadingWhy && whyData?.text}\r\n          </div>\r\n          {showWhy && activeTab === 'why' && whyData?.error && (\r\n            <div className=\"mt-2 text-xs text-rose-400\">{whyData.error}</div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\ChartsPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[662,665],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[662,665],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[730,733],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[730,733],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[782,785],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[782,785],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[834,837],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[834,837],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[890,893],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[890,893],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[944,947],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[944,947],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1002,1005],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1002,1005],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1050,1053],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1050,1053],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1110,1113],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1110,1113],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1160,1163],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1160,1163],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1210,1213],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1210,1213],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1617,1620],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1617,1620],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1681,1684],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1681,1684],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1737,1740],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1737,1740],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1795,1798],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1795,1798],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'selectedCategory' is assigned a value but never used. Allowed unused elements of array destructuring patterns must match /^_/u.","line":48,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":48,"endColumn":26},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3094,3097],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3094,3097],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":105,"column":17,"nodeType":"BlockStatement","messageId":"unexpected","endLine":105,"endColumn":19,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[3807,3807],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":108,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3889,3892],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3889,3892],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":109,"column":83,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":109,"endColumn":86,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3977,3980],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3977,3980],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":116,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4288,4291],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4288,4291],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":128,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4799,4802],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4799,4802],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":129,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4935,4938],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4935,4938],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":246,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":246,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10668,10671],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10668,10671],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":293,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":293,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12958,12961],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12958,12961],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":24,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useMemo, useState } from \"react\";\nimport Card from \"./Card\";\nimport ExportMenu from \"./ExportMenu\";\nimport CardHelpTooltip from \"./CardHelpTooltip\";\nimport { getHelpBaseText } from '@/lib/helpBaseText';\nimport CardHeaderRow from \"./CardHeaderRow\";\nimport EmptyState from \"./EmptyState\";\nimport { t } from '@/lib/i18n';\nimport * as RC from \"recharts\";\nimport {\n  getMonthSummary,\n  getMonthMerchants,\n  getMonthFlows,\n  getSpendingTrends,\n} from \"../lib/api\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\n\n// Cast so TS treats them as FCs (safe for now)\nconst ResponsiveContainer = RC.ResponsiveContainer as unknown as React.FC<any>;\nconst CartesianGrid = RC.CartesianGrid as unknown as React.FC<any>;\nconst XAxis = RC.XAxis as unknown as React.FC<any>;\nconst YAxis = RC.YAxis as unknown as React.FC<any>;\nconst Tooltip = RC.Tooltip as unknown as React.FC<any>;\nconst Legend = RC.Legend as unknown as React.FC<any>;\nconst BarChart = RC.BarChart as unknown as React.FC<any>;\nconst Bar = RC.Bar as unknown as React.FC<any>;\nconst LineChart = RC.LineChart as unknown as React.FC<any>;\nconst Line = RC.Line as unknown as React.FC<any>;\nconst Cell = RC.Cell as unknown as React.FC<any>;\n\ninterface Props {\n  /** Required: charts endpoints require month */\n  month: string;\n  refreshKey?: number;\n}\n\nconst currency = (n: number) =>\n  n.toLocaleString(undefined, { style: \"currency\", currency: \"USD\", maximumFractionDigits: 0 });\n\nconst ChartsPanel: React.FC<Props> = ({ month, refreshKey = 0 }) => {\n  const [loading, setLoading] = useState(true);\n  const [summary, setSummary] = useState<any | null>(null);\n  const [merchants, setMerchants] = useState<any | null>(null);\n  const [flows, setFlows] = useState<any | null>(null);\n  const [trends, setTrends] = useState<any | null>(null);\n  const [empty, setEmpty] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [selectedCategory, setSelectedCategory] = useState<string | null>(null);\n  const [monthsWindow, setMonthsWindow] = useState<number>(6);\n\n  // resolvedMonth prefers server-returned month, falls back to prop\n  const resolvedMonth = summary?.month ?? month;\n\n  useEffect(() => {\n    let alive = true;\n    async function run() {\n      setLoading(true);\n      setError(null);\n      setEmpty(false);\n      try {\n        const [s, m, f, t] = await Promise.all([\n          getMonthSummary(month),\n          getMonthMerchants(month),\n          getMonthFlows(month),\n          getSpendingTrends(6),\n        ]);\n        if (!alive) return;\n        // consider backend-empty cases: nulls from 400 handler, or objects with month: null\n        const isEmpty = (!s && !m && !f) || ((s?.month ?? null) === null && (m?.month ?? null) === null && (f?.month ?? null) === null);\n        if (isEmpty) {\n          setEmpty(true);\n          setSummary(null);\n          setMerchants(null);\n          setFlows(null);\n          setTrends(t ?? null);\n        } else {\n          setSummary(s);\n          setMerchants(m);\n          setFlows(f);\n          setTrends(t);\n        }\n      } catch (e: any) {\n        if (!alive) return;\n        setError(e?.message ?? String(e));\n      } finally {\n        if (alive) setLoading(false);\n      }\n    }\n    run();\n    return () => {\n      alive = false;\n    };\n  }, [month, refreshKey]);\n\n  // Optional: allow opening a specific category chart from AgentChat\n  useEffect(() => {\n    function onOpenChart(e: Event) {\n      const { category, months } = (e as CustomEvent).detail || {};\n      if (category) {\n        try {\n          setSelectedCategory(String(category));\n          setMonthsWindow(Number(months ?? 6));\n          // Scroll to this panel's root\n          document.getElementById('charts-panel')?.scrollIntoView?.({ behavior: 'smooth' });\n        } catch {}\n      }\n    }\n    window.addEventListener('open-category-chart', onOpenChart as any);\n    return () => window.removeEventListener('open-category-chart', onOpenChart as any);\n  }, []);\n\n  const categoriesData = useMemo(() => summary?.categories ?? [], [summary]);\n  const merchantsData = useMemo(() => merchants?.merchants ?? [], [merchants]);\n  const flowsData = useMemo(() => flows?.series ?? [], [flows]);\n  const trendsData = useMemo(\n    () => (trends?.trends ?? []).map((t: any) => ({ month: t.month, spent: t.spent ?? t.spending ?? 0 })),\n    [trends]\n  );\n\n  // Color helpers for bars\n  function pickColor(v: number, max: number) {\n    if (!Number.isFinite(max) || max <= 0) return \"#60a5fa\"; // blue fallback\n    const pct = Math.abs(v) / max;\n    if (pct <= 0.33) return \"#22c55e\";   // green-500\n    if (pct <= 0.66) return \"#f59e0b\";   // amber-500\n    return \"#ef4444\";                    // red-500\n  }\n  const maxCategory = useMemo(() => Math.max(1, ...categoriesData.map((d: any) => Math.abs(Number(d?.amount ?? 0)))), [categoriesData]);\n  const maxMerchant = useMemo(() => Math.max(1, ...merchantsData.map((d: any) => Math.abs(Number(d?.amount ?? 0)))), [merchantsData]);\n\n  // Dark tooltip style\n  const tooltipStyle = useMemo(() => ({\n    backgroundColor: \"rgba(17,24,39,.95)\",\n    border: \"1px solid rgba(255,255,255,.1)\",\n    borderRadius: 8,\n    color: \"#fff\",\n    boxShadow: \"0 6px 18px rgba(0,0,0,.35)\",\n  } as const), []);\n  const tooltipItemStyle = useMemo(() => ({ color: \"#fff\" } as const), []);\n  const tooltipLabelStyle = useMemo(() => ({ color: \"#fff\" } as const), []);\n  const legendTextStyle = useMemo(() => ({ color: \"#e5e7eb\" } as const), []);\n\n  // Custom legend for bar charts to reflect multi-color palette\n  const BarPaletteLegend: React.FC<{ label?: string }> = ({ label = \"Spend\" }) => (\n    <div className=\"flex items-center gap-3 text-xs\" style={{ color: \"#e5e7eb\" }}>\n      <span className=\"opacity-90\">{label}</span>\n      <div className=\"flex items-center gap-1\">\n        <span className=\"inline-block w-3 h-3 rounded-[2px]\" style={{ backgroundColor: \"#22c55e\" }} />\n        <span className=\"inline-block w-3 h-3 rounded-[2px]\" style={{ backgroundColor: \"#f59e0b\" }} />\n        <span className=\"inline-block w-3 h-3 rounded-[2px]\" style={{ backgroundColor: \"#ef4444\" }} />\n      </div>\n      <span className=\"opacity-60\">low → high</span>\n    </div>\n  );\n\n  return (\n    <div id=\"charts-panel\" className=\"grid gap-6 md:gap-7 grid-cols-1 lg:grid-cols-2\">\n      {empty && !error && (\n        <div className=\"lg:col-span-2\">\n          <EmptyState title={t('ui.empty.no_transactions_title')} note={t('ui.empty.charts_note')} />\n        </div>\n      )}\n  <div className=\"chart-card\" data-explain-key=\"cards.overview\" data-month={resolvedMonth}>\n  <Card className=\"border-0 bg-transparent shadow-none p-0\">\n        <CardHeaderRow\n          title={t('ui.charts.overview_title', { month: resolvedMonth })}\n          helpKey=\"cards.overview\"\n          month={resolvedMonth}\n          helpCtx={{ summary, merchants, flows }}\n          helpBaseText={getHelpBaseText('cards.overview', { month: resolvedMonth })}\n          actions={<ExportMenu month={resolvedMonth} />}\n          className=\"mb-2\"\n        />\n        {loading && (\n          <div className=\"grid grid-cols-3 gap-4 text-sm\">\n            {[0, 1, 2].map((i) => (\n              <div key={i} className=\"tile-no-border p-3\">\n                <Skeleton className=\"h-4 w-24\" />\n                <div className=\"mt-2\">\n                  <Skeleton className=\"h-6 w-28\" />\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n        {error && !empty && <p className=\"text-sm text-rose-300\">Error: {error}</p>}\n        {!loading && !error && summary && (\n          <div className=\"grid grid-cols-3 gap-4 text-sm\">\n            <div className=\"tile-no-border p-3\">\n              <div className=\"text-gray-400\">{t('ui.metrics.total_spend')}</div>\n              <div className=\"mt-1 text-lg font-semibold text-rose-300\">\n                {currency(summary.total_spend || 0)}\n              </div>\n            </div>\n            <div className=\"tile-no-border p-3\">\n              <div className=\"text-gray-400\">{t('ui.metrics.total_income')}</div>\n              <div className=\"mt-1 text-lg font-semibold text-emerald-300\">\n                {currency(summary.total_income || 0)}\n              </div>\n            </div>\n            <div className=\"tile-no-border p-3\">\n              <div className=\"text-gray-400\">{t('ui.metrics.net')}</div>\n              <div className=\"mt-1 text-lg font-semibold text-indigo-300\">\n                {currency(summary.net || 0)}\n              </div>\n            </div>\n          </div>\n        )}\n  </Card>\n  </div>\n\n  <div className=\"chart-card\" data-explain-key=\"charts.top_categories\" data-month={resolvedMonth}>\n  <Card className=\"border-0 bg-transparent shadow-none p-0\">\n        <div className=\"flex items-center justify-between mb-2\">\n          <h3 className=\"chart-title flex items-center\">\n            {t('ui.charts.top_categories_title', { month: resolvedMonth })}\n            <CardHelpTooltip cardId=\"charts.top_categories\" month={resolvedMonth} ctx={{ data: categoriesData }} baseText={getHelpBaseText('charts.top_categories', { month: resolvedMonth })} />\n          </h3>\n        </div>\n        {loading && (\n          <div className=\"h-64\">\n            <div className=\"h-full w-full flex items-end gap-2\">\n              {[...Array(8)].map((_, i) => (\n                <Skeleton key={i} className=\"w-8\" style={{ height: `${20 + (i % 5) * 12}%` }} />\n              ))}\n            </div>\n          </div>\n        )}\n        {!loading && categoriesData.length === 0 && (\n          <p className=\"text-sm text-gray-400\">{t('ui.charts.empty_categories')}</p>\n        )}\n        {!loading && categoriesData.length > 0 && (\n          <div className=\"h-64\">\n            <ResponsiveContainer width=\"100%\" height=\"100%\">\n              <BarChart data={categoriesData}>\n                <CartesianGrid stroke=\"var(--grid-line)\" />\n                <XAxis dataKey=\"name\" tick={{ fill: \"var(--text-muted)\" }} stroke=\"var(--border-subtle)\" />\n                <YAxis\n                  tick={{ fill: \"var(--text-muted)\" }}\n                  stroke=\"var(--border-subtle)\"\n                  label={{ value: t('ui.charts.axis_spend'), angle: -90, position: \"insideLeft\", fill: \"var(--text-muted)\" }}\n                />\n                <Tooltip contentStyle={tooltipStyle} itemStyle={tooltipItemStyle} labelStyle={tooltipLabelStyle} />\n                <Legend content={<BarPaletteLegend label={t('ui.charts.legend_spend')} />} />\n                <Bar dataKey=\"amount\" name={t('ui.charts.legend_spend')} activeBar={{ fillOpacity: 1, stroke: \"#fff\", strokeWidth: 1 }} fillOpacity={0.9}>\n                  {categoriesData.map((d: any, i: number) => (\n                    <Cell key={i} fill={pickColor(Number(d?.amount ?? 0), maxCategory)} />\n                  ))}\n                </Bar>\n              </BarChart>\n            </ResponsiveContainer>\n          </div>\n        )}\n  </Card>\n  </div>\n\n  <div className=\"chart-card\" data-explain-key=\"charts.month_merchants\" data-month={resolvedMonth}>\n  <Card className=\"border-0 bg-transparent shadow-none p-0\">\n        <CardHeaderRow\n          title={t('ui.charts.merchants_title', { month: resolvedMonth })}\n          helpKey=\"charts.month_merchants\"\n          month={resolvedMonth}\n          helpCtx={{ data: merchantsData }}\n          helpBaseText={getHelpBaseText('charts.month_merchants', { month: resolvedMonth })}\n          className=\"mb-2\"\n        />\n        {loading && (\n          <div className=\"h-64\">\n            <div className=\"h-full w-full flex items-end gap-2\">\n              {[...Array(8)].map((_, i) => (\n                <Skeleton key={i} className=\"w-8\" style={{ height: `${18 + (i % 4) * 14}%` }} />\n              ))}\n            </div>\n          </div>\n        )}\n        {!loading && merchantsData.length === 0 && (\n          <p className=\"text-sm text-gray-400\">{t('ui.charts.empty_merchants')}</p>\n        )}\n        {!loading && merchantsData.length > 0 && (\n          <div className=\"h-64\">\n            <ResponsiveContainer width=\"100%\" height=\"100%\">\n              <BarChart data={merchantsData}>\n                <CartesianGrid stroke=\"var(--grid-line)\" />\n                <XAxis dataKey=\"merchant\" tick={{ fill: \"var(--text-muted)\" }} stroke=\"var(--border-subtle)\" />\n                <YAxis\n                  tick={{ fill: \"var(--text-muted)\" }}\n                  stroke=\"var(--border-subtle)\"\n                  label={{ value: t('ui.charts.axis_spend'), angle: -90, position: \"insideLeft\", fill: \"var(--text-muted)\" }}\n                />\n                <Tooltip contentStyle={tooltipStyle} itemStyle={tooltipItemStyle} labelStyle={tooltipLabelStyle} />\n                <Legend content={<BarPaletteLegend label={t('ui.charts.legend_spend')} />} />\n                <Bar dataKey=\"amount\" name={t('ui.charts.legend_spend')} activeBar={{ fillOpacity: 1, stroke: \"#fff\", strokeWidth: 1 }} fillOpacity={0.9}>\n                  {merchantsData.map((d: any, i: number) => (\n                    <Cell key={i} fill={pickColor(Number(d?.amount ?? 0), maxMerchant)} />\n                  ))}\n                </Bar>\n              </BarChart>\n            </ResponsiveContainer>\n            {/* Tip removed per request */}\n          </div>\n        )}\n  </Card>\n  </div>\n\n  <div className=\"chart-card\" data-explain-key=\"charts.daily_flows\" data-month={resolvedMonth}>\n  <Card className=\"border-0 bg-transparent shadow-none p-0\">\n        <div className=\"flex items-center justify-between mb-2\">\n          <h3 className=\"chart-title flex items-center\">\n            {t('ui.charts.daily_flows_title', { month: resolvedMonth })}\n            <CardHelpTooltip cardId=\"charts.daily_flows\" month={resolvedMonth} ctx={{ data: flowsData }} baseText={getHelpBaseText('charts.daily_flows', { month: resolvedMonth })} />\n          </h3>\n        </div>\n        {loading && (\n          <div className=\"h-64\">\n            <div className=\"h-full w-full flex items-center\">\n              <Skeleton className=\"h-32 w-full\" />\n            </div>\n          </div>\n        )}\n        {!loading && flowsData.length === 0 && (\n          <p className=\"text-sm text-gray-400\">{t('ui.charts.empty_flows')}</p>\n        )}\n        {!loading && flowsData.length > 0 && (\n          <div className=\"h-64\">\n            <ResponsiveContainer width=\"100%\" height=\"100%\">\n              <LineChart data={flowsData}>\n                <CartesianGrid stroke=\"var(--grid-line)\" />\n                <XAxis dataKey=\"date\" tick={{ fill: \"var(--text-muted)\" }} stroke=\"var(--border-subtle)\" />\n                <YAxis\n                  tick={{ fill: \"var(--text-muted)\" }}\n                  stroke=\"var(--border-subtle)\"\n                  label={{ value: t('ui.charts.axis_amount'), angle: -90, position: \"insideLeft\", fill: \"var(--text-muted)\" }}\n                />\n                <Tooltip contentStyle={tooltipStyle} itemStyle={tooltipItemStyle} labelStyle={tooltipLabelStyle} />\n                <Legend wrapperStyle={legendTextStyle} />\n                <Line type=\"monotone\" dataKey=\"in\"  name={t('ui.charts.line_in')}  stroke=\"#22c55e\" strokeWidth={2} dot={false} />\n                <Line type=\"monotone\" dataKey=\"out\" name={t('ui.charts.line_out')} stroke=\"#ef4444\" strokeWidth={2} dot={false} />\n                <Line type=\"monotone\" dataKey=\"net\" name={t('ui.charts.line_net')} stroke=\"#60a5fa\" strokeWidth={2} dot={false} />\n              </LineChart>\n            </ResponsiveContainer>\n          </div>\n        )}\n  </Card>\n  </div>\n\n  <div className=\"chart-card\" data-explain-key=\"charts.spending_trends\">\n  <Card className=\"border-0 bg-transparent shadow-none p-0\">\n        <div className=\"flex items-center justify-between mb-2\">\n          <h3 className=\"chart-title flex items-center\">\n            {t('ui.charts.spending_trends_title', { months: monthsWindow })}\n            <CardHelpTooltip cardId=\"charts.spending_trends\" month={resolvedMonth} ctx={{ data: trendsData }} baseText={getHelpBaseText('charts.spending_trends', { monthsWindow })} />\n          </h3>\n        </div>\n        {loading && (\n          <div className=\"h-64\">\n            <div className=\"h-full w-full flex items-center\">\n              <Skeleton className=\"h-32 w-full\" />\n            </div>\n          </div>\n        )}\n        {!loading && trendsData.length === 0 && (\n          <p className=\"text-sm text-gray-400\">{t('ui.charts.empty_trends')}</p>\n        )}\n        {!loading && trendsData.length > 0 && (\n          <div className=\"h-64\">\n            <ResponsiveContainer width=\"100%\" height=\"100%\">\n              <LineChart data={trendsData}>\n                <CartesianGrid stroke=\"var(--grid-line)\" />\n                <XAxis dataKey=\"month\" tick={{ fill: \"var(--text-muted)\" }} stroke=\"var(--border-subtle)\" />\n                <YAxis\n                  tick={{ fill: \"var(--text-muted)\" }}\n                  stroke=\"var(--border-subtle)\"\n                  label={{ value: t('ui.charts.axis_spend'), angle: -90, position: \"insideLeft\", fill: \"var(--text-muted)\" }}\n                />\n                <Tooltip contentStyle={tooltipStyle} itemStyle={tooltipItemStyle} labelStyle={tooltipLabelStyle} />\n                <Legend wrapperStyle={legendTextStyle} />\n                <Line type=\"monotone\" dataKey=\"spent\" name=\"Spent\" stroke=\"#f59e0b\" strokeWidth={2} dot={false} />\n              </LineChart>\n            </ResponsiveContainer>\n          </div>\n        )}\n  </Card>\n  </div>\n    </div>\n  );\n};\n\nexport default ChartsPanel;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\ChartsTheme.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\ChartsTheme.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\ChatDock.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useMemo' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":4,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChatMessage' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":127,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":138},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getMonthSummary' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":220,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":235},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getMonthMerchants' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":237,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":254},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getMonthFlows' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":256,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":269},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getSpendingTrends' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":271,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":288},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getBudgetCheck' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":290,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":304},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'remarkGfm' is defined but never used. Allowed unused vars must match /^_/u.","line":17,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AgentResultRenderer' is defined but never used. Allowed unused vars must match /^_/u.","line":20,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ErrorBoundary' is defined but never used. Allowed unused vars must match /^_/u.","line":21,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'QuickChips' is defined but never used. Allowed unused vars must match /^_/u.","line":22,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChipAction' is defined but never used. Allowed unused vars must match /^_/u.","line":22,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":37},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2690,2693],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2690,2693],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Spinner' is defined but never used. Allowed unused vars must match /^_/u.","line":99,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":99,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":106,"column":152,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":106,"endColumn":155,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6260,6263],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6260,6263],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'clickGuard' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":160,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":160,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setTool' is assigned a value but never used. Allowed unused elements of array destructuring patterns must match /^_/u.","line":162,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":162,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'state' is assigned a value but never used. Allowed unused elements of array destructuring patterns must match /^_/u.","line":167,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":167,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":191,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":191,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10320,10323],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10320,10323],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":204,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":204,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11280,11283],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11280,11283],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'activePreset' is assigned a value but never used. Allowed unused elements of array destructuring patterns must match /^_/u.","line":208,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":208,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setActivePreset' is assigned a value but never used. Allowed unused elements of array destructuring patterns must match /^_/u.","line":208,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":208,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'toolPayload' is assigned a value but never used. Allowed unused elements of array destructuring patterns must match /^_/u.","line":209,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":209,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setToolPayload' is assigned a value but never used. Allowed unused elements of array destructuring patterns must match /^_/u.","line":209,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":209,"endColumn":37},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":290,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":290,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[15265,15265],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":307,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":307,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15835,15838],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15835,15838],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":309,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":309,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15910,15913],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15910,15913],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":320,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":320,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[16412,16412],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":332,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":332,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16979,16982],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16979,16982],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":340,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":340,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17292,17295],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17292,17295],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":340,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":340,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17322,17325],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17322,17325],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":353,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":353,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17808,17811],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17808,17811],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":353,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":353,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17867,17870],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17867,17870],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":354,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":354,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17924,17927],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17924,17927],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":354,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":354,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17947,17950],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17947,17950],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":375,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":375,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19240,19243],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19240,19243],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":398,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":398,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20587,20590],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20587,20590],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":411,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":411,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21173,21176],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21173,21176],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":458,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":458,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23235,23238],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23235,23238],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":464,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":464,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23441,23444],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23441,23444],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":465,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":465,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23509,23512],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23509,23512],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'snap' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":503,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":503,"endColumn":15},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":522,"column":81,"nodeType":"BlockStatement","messageId":"unexpected","endLine":522,"endColumn":83,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[25702,25702],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":525,"column":98,"nodeType":"BlockStatement","messageId":"unexpected","endLine":525,"endColumn":100,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[25890,25890],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mapBasicToMsg' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":533,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":533,"endColumn":22},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":579,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":579,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[27997,27997],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":587,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":587,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[28215,28215],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ensureMonth' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":626,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":626,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":626,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":626,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29677,29680],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29677,29680],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":644,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":644,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30212,30215],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30212,30215],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":699,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":699,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32902,32905],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32902,32905],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":710,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":710,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[33709,33712],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[33709,33712],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":714,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":714,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[34044,34047],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[34044,34047],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":729,"column":19,"nodeType":"BlockStatement","messageId":"unexpected","endLine":729,"endColumn":21,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[35132,35132],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":738,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":738,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[35487,35490],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[35487,35490],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":751,"column":175,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":751,"endColumn":178,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[36118,36121],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[36118,36121],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":754,"column":84,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":754,"endColumn":87,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[36245,36248],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[36245,36248],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":767,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":767,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[36777,36780],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[36777,36780],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":771,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":771,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[36957,36960],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[36957,36960],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":771,"column":98,"nodeType":"BlockStatement","messageId":"unexpected","endLine":771,"endColumn":100,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[37017,37017],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":807,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":807,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[38734,38737],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[38734,38737],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":807,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":807,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[38757,38760],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[38757,38760],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":816,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":816,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[39137,39140],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[39137,39140],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":816,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":816,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[39160,39163],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[39160,39163],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":847,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":847,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[40357,40360],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[40357,40360],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":853,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":853,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[40556,40559],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[40556,40559],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":874,"column":88,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":874,"endColumn":91,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[41554,41557],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[41554,41557],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":875,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":875,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[41574,41577],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[41574,41577],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":901,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":901,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[42659,42662],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[42659,42662],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":923,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":923,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[43664,43667],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[43664,43667],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":942,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":942,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[44515,44518],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[44515,44518],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":960,"column":84,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":960,"endColumn":87,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[45289,45292],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[45289,45292],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":961,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":961,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[45302,45305],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[45302,45305],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1045,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1045,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[48978,48981],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[48978,48981],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'runAnalyticsForecast' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":1054,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":1054,"endColumn":29},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1063,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1063,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[49807,49810],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[49807,49810],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1081,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1081,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[50597,50600],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[50597,50600],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1099,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1099,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[51416,51419],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[51416,51419],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1117,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1117,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[52263,52266],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[52263,52266],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1126,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1126,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[52780,52783],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[52780,52783],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1144,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1144,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[53218,53221],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[53218,53221],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1146,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1146,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[53366,53369],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[53366,53369],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1150,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1150,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[53574,53577],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[53574,53577],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1156,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1156,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[53872,53875],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[53872,53875],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1162,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1162,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[54076,54079],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[54076,54079],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1167,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1167,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[54180,54183],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[54180,54183],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1212,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1212,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[57123,57126],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[57123,57126],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1212,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1212,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[57146,57149],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[57146,57149],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1214,"column":112,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1214,"endColumn":115,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[57350,57353],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[57350,57353],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1250,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1250,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[59073,59076],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[59073,59076],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1250,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1250,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[59096,59099],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[59096,59099],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1265,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1265,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[59819,59822],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[59819,59822],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1280,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1280,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[60680,60683],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[60680,60683],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1283,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1283,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[60877,60880],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[60877,60880],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1305,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1305,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[61749,61752],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[61749,61752],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1307,"column":165,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1307,"endColumn":168,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[62022,62025],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[62022,62025],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1307,"column":186,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1307,"endColumn":189,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[62043,62046],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[62043,62046],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1362,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1362,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[64281,64284],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[64281,64284],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1597,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1597,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[75073,75076],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[75073,75076],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1613,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1613,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[75740,75743],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[75740,75743],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1614,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1614,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[75984,75987],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[75984,75987],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1615,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1615,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[76228,76231],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[76228,76231],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1616,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1616,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[76463,76466],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[76463,76466],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1617,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1617,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[76691,76694],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[76691,76694],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1618,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1618,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[76926,76929],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[76926,76929],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1619,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1619,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[77173,77176],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[77173,77176],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1620,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1620,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[77416,77419],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[77416,77419],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1621,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1621,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[77648,77651],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[77648,77651],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1623,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1623,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[77925,77928],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[77925,77928],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used. Allowed unused args must match /^_/u.","line":1624,"column":45,"nodeType":null,"messageId":"unusedVar","endLine":1624,"endColumn":46},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1625,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1625,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[78454,78457],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[78454,78457],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1626,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1626,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[78695,78698],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[78695,78698],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1627,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1627,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[78940,78943],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[78940,78943],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1655,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1655,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[80681,80684],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[80681,80684],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1660,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1660,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[80898,80901],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[80898,80901],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1689,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1689,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[82379,82382],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[82379,82382],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1694,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1694,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[82570,82573],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[82570,82573],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1695,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1695,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[82671,82674],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[82671,82674],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1697,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1697,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[82742,82745],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[82742,82745],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1699,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1699,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[82792,82795],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[82792,82795],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1726,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1726,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[84338,84341],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[84338,84341],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1731,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1731,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[84529,84532],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[84529,84532],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1732,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1732,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[84630,84633],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[84630,84633],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1734,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1734,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[84701,84704],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[84701,84704],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1736,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1736,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[84751,84754],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[84751,84754],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":1870,"column":34,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":1870,"endColumn":35,"suggestions":[{"messageId":"removeEscape","fix":{"range":[90201,90202],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[90201,90201],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":1870,"column":39,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":1870,"endColumn":40,"suggestions":[{"messageId":"removeEscape","fix":{"range":[90206,90207],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[90206,90206],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\\".","line":1870,"column":49,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":1870,"endColumn":50,"suggestions":[{"messageId":"removeEscape","fix":{"range":[90216,90217],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[90216,90216],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1918,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1918,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[91931,91934],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[91931,91934],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1921,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1921,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[92189,92192],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[92189,92192],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1935,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1935,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[92780,92783],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[92780,92783],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1936,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1936,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[92820,92823],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[92820,92823],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1937,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1937,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[92849,92852],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[92849,92852],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1937,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1937,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[92863,92866],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[92863,92866],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1960,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1960,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[94312,94315],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[94312,94315],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1960,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1960,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[94327,94330],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[94327,94330],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1963,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1963,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[94539,94542],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[94539,94542],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1963,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1963,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[94562,94565],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[94562,94565],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1969,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1969,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[94905,94908],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[94905,94908],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2009,"column":114,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2009,"endColumn":117,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[96850,96853],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[96850,96853],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":129,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport { stripToolNamespaces } from \"@/utils/prettyToolName\";\nimport SaveRuleModal from '@/components/SaveRuleModal';\nconst { useEffect, useMemo, useRef, useState } = React;\nimport { wireAguiStream } from \"@/lib/aguiStream\";\nimport RobotThinking from \"@/components/ui/RobotThinking\";\nimport EnvAvatar from \"@/components/EnvAvatar\";\nimport { useAuth } from \"@/state/auth\";\nimport { createPortal } from \"react-dom\";\nimport { ChevronUp, Wrench } from \"lucide-react\";\nimport { agentTools, agentChat, getAgentModels, type AgentChatRequest, type AgentChatResponse, type AgentModelsResponse, type ChatMessage, txnsQueryCsv, txnsQuery, type TxnQueryResult, explainTxnForChat, agentRephrase, getMonthSummary, getMonthMerchants, getMonthFlows, getSpendingTrends, getBudgetCheck, analytics, transactionsNl, telemetry } from \"../lib/api\";\nimport { fmtMonthSummary, fmtTopMerchants, fmtCashflow, fmtTrends } from \"../lib/formatters\";\nimport { runToolWithRephrase } from \"../lib/tools-runner\";\nimport { saveAs } from \"../utils/save\";\n// import { useOkErrToast } from \"../lib/toast-helpers\";\nimport RestoredBadge from \"./RestoredBadge\";\nimport remarkGfm from \"remark-gfm\";\nimport Markdown from \"./Markdown\";\nimport type { ToolKey, ToolSpec, ToolRunState } from \"../types/agentTools\";\nimport { AgentResultRenderer } from \"./AgentResultRenderers\";\nimport ErrorBoundary from \"./ErrorBoundary\";\nimport { QuickChips, type ChipAction } from \"./QuickChips\";\nimport { useMonth } from \"../context/MonthContext\";\nimport { useChatDock } from \"../context/ChatDockContext\";\nimport { exportThreadAsJSON, exportThreadAsMarkdown } from \"../utils/chatExport\";\nimport { chatStore, type BasicMsg, snapshot as chatSnapshot, restoreFromSnapshot as chatRestoreFromSnapshot, discardSnapshot as chatDiscardSnapshot } from \"../utils/chatStore\";\nimport runAndRephrase from \"./agent-tools/runAndRephrase\";\nimport { registerChatHandlers } from \"@/state/chat\";\nimport { DEFAULT_PLACEHOLDER, focusComposer, registerComposerControls, setComposer, setComposerPlaceholder as setComposerPlaceholderUI } from \"@/state/chat/ui\";\nimport { handleTransactionsNL } from \"./AgentTools\";\nimport FallbackBadge from \"./FallbackBadge\";\n// Minimal process env typing for test gating without pulling full @types/node\ndeclare const process: { env?: Record<string,string|undefined> } | undefined;\n// --- layout constants (right/bottom anchored) ---\nconst MARGIN = 24;     // default bottom-right margin\nconst BUBBLE = 48;     // bubble size (px)\nconst PANEL_W_GUESS = 640;\nconst PANEL_H_GUESS = 420;\n\n// Local message types\ntype MsgRole = 'user' | 'assistant';\ntype Msg = { role: MsgRole; text: string; ts: number; meta?: any };\n\n// Clamp right/bottom within viewport using element size\nfunction clampRB(next: { right: number; bottom: number }, w: number, h: number) {\n  const min = 8;\n  const maxRight = Math.max(min, window.innerWidth  - min - w);\n  const maxBottom= Math.max(min, window.innerHeight - min - h);\n  return {\n    right: Math.min(Math.max(min, next.right), maxRight),\n    bottom: Math.min(Math.max(min, next.bottom), maxBottom),\n  };\n}\n// Tool groups/specs for legacy form defaults and lookups\nconst TOOL_GROUPS: Array<{ label: string; items: ToolSpec[] }> = [\n  {\n    label: \"Insights\",\n    items: [\n      { key: \"insights.expanded\", label: \"Insights: Expanded (MoM + anomalies)\", path: \"/agent/tools/insights/expanded\", examplePayload: { month: undefined, large_limit: 10 } },\n    ],\n  },\n  {\n    label: \"Transactions\",\n    items: [\n      { key: \"transactions.search\", label: \"Transactions: Search\", path: \"/agent/tools/transactions/search\", examplePayload: { month: undefined, limit: 20, filters: { labeled: false } } },\n      { key: \"transactions.categorize\", label: \"Transactions: Categorize\", path: \"/agent/tools/transactions/categorize\", examplePayload: { updates: [{ id: 1, category: \"Groceries\" }], onlyIfUnlabeled: true } },\n      { key: \"transactions.get_by_ids\", label: \"Transactions: Get by IDs\", path: \"/agent/tools/transactions/get_by_ids\", examplePayload: { ids: [1,2,3] } },\n    ],\n  },\n  {\n    label: \"Budget\",\n    items: [\n      { key: \"budget.summary\", label: \"Budget: Summary\", path: \"/agent/tools/budget/summary\", examplePayload: { month: undefined } },\n      { key: \"budget.check\",   label: \"Budget: Check\",   path: \"/agent/tools/budget/check\",   examplePayload: { month: undefined } },\n    ],\n  },\n  {\n    label: \"Charts\",\n    items: [\n  { key: \"charts.summary\",   label: \"Charts: Summary\",         path: \"/agent/tools/charts/summary\",          examplePayload: { month: undefined } },\n  { key: \"charts.merchants\", label: \"Charts: Top Merchants\",   path: \"/agent/tools/charts/merchants\",        examplePayload: { month: undefined, limit: 10 } },\n  { key: \"charts.flows\",     label: \"Charts: Flows\",           path: \"/agent/tools/charts/flows\",            examplePayload: { month: undefined } },\n  { key: \"charts.trends\",    label: \"Charts: Spending Trends\", path: \"/agent/tools/charts/spending-trends\",  examplePayload: { month: undefined, months_back: 6 } },\n    ],\n  },\n  {\n    label: \"Rules\",\n    items: [\n      { key: \"rules.test\",     label: \"Rules: Test\",      path: \"/agent/tools/rules/test\",      examplePayload: { month: undefined, rule: { merchant: \"Starbucks\", category: \"Dining out\" } } },\n      { key: \"rules.apply\",    label: \"Rules: Apply\",     path: \"/agent/tools/rules/apply\",     examplePayload: { month: undefined, onlyIfUnlabeled: true, rule: { merchant: \"Starbucks\", category: \"Dining out\" } } },\n      { key: \"rules.apply_all\",label: \"Rules: Apply All\", path: \"/agent/tools/rules/apply_all\", examplePayload: { month: undefined } },\n    ],\n  },\n];\n\nconst TOOLS = TOOL_GROUPS.flatMap(g => g.items);\nconst findSpec = (k: ToolKey) => TOOLS.find(t => t.key === k)!;\n\nfunction Spinner() {\n  return <div className=\"animate-spin h-4 w-4 rounded-full border-2 border-gray-400 border-t-transparent\" aria-label=\"loading\" />;\n}\n\n// -------------------- Tool presets (tiny tool panel) --------------------\ntype ToolPresetKey = 'month_summary' | 'find_subs' | 'insights_expanded' | 'cashflow';\n\nconst TOOL_PRESETS: Record<ToolPresetKey, { label: string; intent: 'general'|'explain_txn'|'budget_help'|'rule_seed'; prompt: string; defaultPayload?: any }>\n = {\n  month_summary: {\n    label: 'Month summary',\n    intent: 'general',\n    prompt: 'Summarize my spending this month in 4 bullets and one next step.',\n  },\n  find_subs: {\n    label: 'Find subscriptions',\n    intent: 'general',\n    prompt: 'Identify recurring subscriptions this month and suggest which I could cancel, with reasoning.',\n  },\n  insights_expanded: {\n    label: 'Insights: Expanded (MoM + anomalies)',\n    intent: 'general',\n    prompt: 'Give an expanded month overview with MoM notes and any anomalies. Keep it concise and clear.',\n    defaultPayload: { large_limit: 10 },\n  },\n  cashflow: {\n    label: 'Cashflow trend',\n    intent: 'general',\n    prompt: 'Describe my cashflow trend this month in 3 bullets and one recommendation.',\n    defaultPayload: { window: 7 },\n  },\n};\n\ndeclare global { interface Window { __CHATDOCK_MOUNT_COUNT__?: number } }\n\n// Module-scoped singleton tracker\nlet __CHATDOCK_ACTIVE__: symbol | null = null;\n\nexport default function ChatDock() {\n  // Safe singleton: claim primary in effect; always run hooks, render only if primary\n  const idRef = useRef(Symbol(\"chatdock\"));\n  const [isPrimary, setIsPrimary] = useState(false);\n  useEffect(() => {\n    if (__CHATDOCK_ACTIVE__ === null) {\n      __CHATDOCK_ACTIVE__ = idRef.current;\n      setIsPrimary(true);\n    } else {\n      setIsPrimary(__CHATDOCK_ACTIVE__ === idRef.current);\n    }\n    return () => {\n      if (__CHATDOCK_ACTIVE__ === idRef.current) {\n        __CHATDOCK_ACTIVE__ = null;\n      }\n    };\n  }, []);\n  const { month } = useMonth();\n  const chat = useChatDock();\n  const [open, setOpen] = React.useState<boolean>(false);\n  // one shared right/bottom position for bubble and panel (no persistence)\n  const [rb, setRb] = React.useState<{ right: number; bottom: number }>(() => ({ right: MARGIN, bottom: MARGIN }));\n  const panelRef = useRef<HTMLDivElement | null>(null);\n  const clickGuard = useRef(false);\n\n  const [tool, setTool] = React.useState<ToolKey>(\"insights.expanded\");\n  const spec = React.useMemo(() => findSpec(tool), [tool]);\n\n  const [payloads, setPayloads] = React.useState<Record<string, string>>({});\n  const [payloadText, setPayloadText] = React.useState<string>(() => JSON.stringify(spec.examplePayload, null, 2));\n  const [state, setState] = React.useState<ToolRunState>({ loading: false, error: null, data: null });\n  const [lastRunForTool, setLastRunForTool] = React.useState<Record<string, string | undefined>>({});\n  const runningRef = React.useRef<AbortController | null>(null);\n  const lastClickAtRef = React.useRef<number>(0);\n  const [monthReady, setMonthReady] = React.useState<boolean>(false);\n  // unified chat state\n  const [modelsInfo, setModelsInfo] = React.useState<AgentModelsResponse | null>(null);\n  const [showAdvanced, setShowAdvanced] = React.useState(false);\n  const [selectedModel, setSelectedModel] = React.useState<string>(\"\"); // empty => server default\n  const [busy, setBusy] = React.useState(false);\n  const [chatResp, setChatResp] = React.useState<AgentChatResponse | null>(null);\n  const [input, setInput] = useState(\"\");\n  const composerRef = React.useRef<HTMLTextAreaElement | null>(null);\n  const [composerPlaceholder, setComposerPlaceholderState] = useState(DEFAULT_PLACEHOLDER);\n  // AGUI streaming run state (moved earlier so handleSend can reference)\n  const [aguiTools, setAguiTools] = useState<Array<{ name: string; status: 'pending'|'active'|'done'|'error'; startedAt?: number; endedAt?: number }>>([]);\n  const aguiToolsRef = React.useRef<typeof aguiTools>(aguiTools);\n  React.useEffect(()=>{ aguiToolsRef.current = aguiTools; }, [aguiTools]);\n  // Track last what-if scenario text for rule saving\n  const lastWhatIfScenarioRef = useRef<string>(\"\");\n  // Save Rule modal state (new component)\n  const [showSaveRuleModal, setShowSaveRuleModal] = useState(false);\n  const [saveRuleScenario, setSaveRuleScenario] = useState(\"\");\n  // Test-only toggle to expose a deterministic Save Rule button in smoke tests\n  const forceSaveRuleButton = typeof window !== 'undefined' && (window as any).__FORCE_SAVE_RULE_BUTTON__ === true;\n  // Alias for last what-if scenario (if tracked elsewhere adjust accordingly)\n  const lastWhatIfScenario = lastWhatIfScenarioRef.current;\n  // Track if a what-if run happened this session\n  const hadWhatIfRunRef = useRef(false);\n  // Stricter: require a what-if run unless forced by test flag\n  const IS_TEST = typeof process !== 'undefined' && process.env?.NODE_ENV === 'test';\n  const canSaveRule = forceSaveRuleButton || (hadWhatIfRunRef.current && typeof lastWhatIfScenario === 'string' && lastWhatIfScenario.trim().length > 0);\n  const [aguiRunActive, setAguiRunActive] = useState(false);\n  const listRef = useRef<HTMLDivElement>(null);\n  const bottomRef = useRef<HTMLDivElement>(null);\n  const syncTimerRef = useRef<number | null>(null);\n  // Persist the last successful NL query + resolved filters so we can export without re-prompting\n  type LastNlq = { q: string; flow?: \"expenses\"|\"income\"|\"all\"; filters?: any; intent?: string };\n  const lastNlqRef = useRef<LastNlq | null>(null);\n  // NEW: Tiny tools panel state\n  const [showTools, setShowTools] = useState<boolean>(true);\n  const [activePreset, setActivePreset] = useState<ToolPresetKey>('insights_expanded');\n  const [toolPayload, setToolPayload] = useState<string>(() => JSON.stringify(TOOL_PRESETS['insights_expanded'].defaultPayload ?? {}, null, 2));\n  // ML selftest UI removed\n  // Undo snackbar (animated) for destructive actions like Clear\n  const [undoVisible, setUndoVisible] = React.useState(false);\n  const [undoClosing, setUndoClosing] = React.useState(false);\n  const [undoMsg, setUndoMsg] = React.useState<string>(\"Cleared\");\n  const undoActionRef = React.useRef<null | (() => void)>(null);\n  const [restoredVisible, setRestoredVisible] = React.useState(false);\n\n  useEffect(() => {\n    return registerComposerControls({\n      setValue: (value: string) => setInput(value),\n      focus: () => composerRef.current?.focus(),\n      setPlaceholder: (value: string) => setComposerPlaceholderState(value),\n      getValue: () => composerRef.current?.value ?? \"\",\n    });\n  }, [setInput, setComposerPlaceholderState]);\n\n  // --- feature flags to forcibly hide legacy UI ---\n  const ENABLE_TOPBAR_TOOL_BUTTONS = false;   // keep a single \"Agent tools\" toggle\n  const ENABLE_LEGACY_TOOL_FORM    = false;   // hide Payload/Result/Insert context/Run\n  const ENABLE_AGUI = ((): boolean => {\n    try { return String(import.meta.env.VITE_ENABLE_AGUI || '').trim() === '1'; } catch { return false; }\n  })();   // experimental AGUI integration\n\n  // Live message stream (render from UI state, persist via chatStore)\n  const [uiMessages, setUiMessages] = useState<Msg[]>([]);\n  // Equality guard to avoid redundant setState on cross-tab updates\n  const sameTimeline = React.useCallback((ui: Msg[], basic: BasicMsg[]) => {\n    if (!Array.isArray(ui) || !Array.isArray(basic)) return false;\n    if (ui.length !== basic.length) return false;\n    if (ui.length === 0) return true;\n    const lu = ui[ui.length - 1];\n    const lb = basic[basic.length - 1];\n    if (!lu || !lb) return false;\n    const lbRole = lb.role === 'assistant' ? 'assistant' : 'user';\n    return lu.role === lbRole && lu.text === String(lb.content || '') && lu.ts === Number(lb.createdAt || 0);\n  }, []);\n\n  const syncFromStore = React.useCallback(() => {\n    try {\n      const basic = chatStore.get() || [];\n      setUiMessages(cur => {\n        if (sameTimeline(cur, basic)) return cur;\n        const mapped: Msg[] = (basic || []).map((b: { role: string; content: string; createdAt: number }) => ({ role: (b.role === 'assistant' ? 'assistant' : 'user') as MsgRole, text: String(b.content || ''), ts: Number(b.createdAt) || Date.now() }));\n        return mapped;\n      });\n    } catch { /* ignore */ }\n  }, [sameTimeline]);\n\n  const syncFromStoreDebounced = React.useCallback((ms = 120) => {\n    if (syncTimerRef.current) window.clearTimeout(syncTimerRef.current);\n    syncTimerRef.current = window.setTimeout(() => {\n      syncTimerRef.current = null;\n      syncFromStore();\n    }, ms);\n  }, [syncFromStore]);\n\n  useEffect(() => {\n    bottomRef.current?.scrollIntoView({ behavior: 'smooth', block: 'end' });\n  }, [uiMessages, busy]);\n\n  // quick sanity ping so you can confirm the file actually recompiled\n  useEffect(() => {\n    if (isPrimary) {\n      console.log(\"[ChatDock] v0906f loaded\");\n    }\n    return () => { if (syncTimerRef.current) window.clearTimeout(syncTimerRef.current); };\n  }, [isPrimary]);\n\n  // If chat was restored very recently (in this tab), briefly show a Restored badge\n  useEffect(() => {\n    try {\n      const raw = sessionStorage.getItem('chat:restored_at');\n      if (!raw) return;\n      const t = Number(raw);\n      if (Number.isFinite(t) && Date.now() - t < 30_000) {\n        setRestoredVisible(true);\n        window.setTimeout(() => setRestoredVisible(false), 4500);\n      }\n      sessionStorage.removeItem('chat:restored_at');\n    } catch {}\n  }, []);\n\n  // --- helpers for timestamps & day dividers ---\n  const pad = (n: number) => String(n).padStart(2, \"0\");\n  const toDayKey = (ms: number) => {\n    const d = new Date(ms);\n    return `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())}`;\n  };\n  const toTimeHM = (ms: number) => {\n    const d = new Date(ms);\n    return d.toLocaleTimeString([], { hour: \"2-digit\", minute: \"2-digit\" });\n  };\n\n  const { user } = useAuth();\n  const userName = user?.email?.split(\"@\")[0] ?? \"You\";\n\n  const appendAssistant = React.useCallback((text: string, meta?: any) => {\n    const ts = Date.now();\n    const metaPayload: Record<string, any> = { ...(meta ?? {}) };\n    if (!metaPayload.used_context && metaPayload.ctxMonth) {\n      metaPayload.used_context = { month: metaPayload.ctxMonth };\n    }\n    setUiMessages(cur => [...cur, { role: 'assistant', text, ts, meta: metaPayload }]);\n    chatStore.append({ role: 'assistant', content: text, createdAt: ts });\n    try {\n      const provider = metaPayload?.fallback;\n      if (provider) {\n        telemetry.track('chat_fallback_used', { provider: String(provider) });\n      }\n    } catch {}\n    try { chatDiscardSnapshot(); } catch { /* ignore */ }\n    setChatResp({\n      reply: text,\n      citations: metaPayload.citations || [],\n      used_context: metaPayload.used_context || { month: metaPayload.ctxMonth },\n      tool_trace: metaPayload.trace || metaPayload.tool_trace || [],\n      model: metaPayload.model || \"\",\n      mode: metaPayload.mode,\n      args: metaPayload.args,\n      suggestions: metaPayload.suggestions || [],\n      rephrased: Object.prototype.hasOwnProperty.call(metaPayload, 'rephrased') ? metaPayload.rephrased : undefined,\n    } as any);\n  }, [setUiMessages, setChatResp]);\n\n  // Build rendered list with day dividers and per-message timestamps\n  const renderedMessages = React.useMemo(() => {\n    const out: React.ReactNode[] = [];\n    let lastDay: string | null = null;\n    (uiMessages || []).forEach((m, i) => {\n      const ts = typeof (m as any)?.ts === 'number' ? (m as any).ts : Date.now();\n      const day = toDayKey(ts);\n      if (day !== lastDay) {\n        lastDay = day;\n        out.push(\n          <div key={`day-${day}`} className=\"my-3 flex items-center gap-3\">\n            <div className=\"flex-1 h-px bg-neutral-800\" />\n            <div className=\"text-xs text-neutral-400\">{day}</div>\n            <div className=\"flex-1 h-px bg-neutral-800\" />\n          </div>\n        );\n      }\n      const isUser = m.role === 'user';\n      const meta = ((m as any).meta ?? (i === (uiMessages.length - 1) ? (chatResp as any) : undefined)) || {};\n      const isThinking = (m as any).thinking || (m as any).meta?.thinking;\n      out.push(\n        <div key={`${m.role}-${ts}-${i}`} className={`px-3 py-2 my-1 flex items-end gap-2 ${isUser ? 'justify-end' : 'justify-start'}`}>\n          {!isUser && <EnvAvatar who=\"agent\" className=\"size-7\" />}\n          <div className={`max-w-[72%] rounded-2xl px-3 py-2 text-sm leading-relaxed ${isUser ? 'bg-blue-600 text-white rounded-br-sm' : 'bg-slate-800 text-slate-100 rounded-bl-sm'}`}>\n            {isThinking ? (\n              <div className=\"py-1\"><span className=\"sr-only\">Thinking.</span><RobotThinking size={32} /></div>\n            ) : (\n              m.role === 'assistant' ? <div className=\"chat-markdown\"><Markdown>{m.text}</Markdown></div> : <>{m.text}</>\n            )}\n          </div>\n          {isUser && <EnvAvatar who=\"user\" className=\"size-7\" title={userName} />}\n        </div>\n      );\n      // Meta line under each message (add ModeChip + ForecastFollowUps when applicable)\n      out.push(\n        <div key={`${m.role}-${ts}-${i}-meta`} className=\"px-3\">\n          <div className=\"mt-2 text-xs opacity-70 flex items-center gap-2 flex-wrap\">\n            {m.role === 'assistant' && Array.isArray(meta.citations) && meta.citations.length ? (\n              <>\n                <span>\n                  Used data: {meta.citations.map((c: any) => c.count ? `${c.type} ${c.count}` : `${c.type}`).join(' | ')}\n                </span>\n                {meta.used_context?.month ? <span>- month {meta.used_context.month}</span> : null}\n                {meta.model ? <span>- {meta.model}</span> : null}\n              </>\n            ) : null}\n            {m.role === 'assistant' && meta?.fallback ? (\n              <FallbackBadge provider={String(meta.fallback)} />\n            ) : null}\n            {m.role === 'assistant' && meta.intent_label ? (\n              <span className=\"intent-badge\">{meta.intent_label}</span>\n            ) : null}\n            {m.role === 'assistant' ? <ModeChip mode={meta.mode} args={meta.args} /> : null}\n            <span className=\"ml-auto text-neutral-400\">{toTimeHM(ts)}</span>\n          </div>\n          {m.role === 'assistant' && meta.mode === 'analytics.forecast' ? (\n            <ForecastFollowUps month={meta.used_context?.month} append={appendAssistant} setThinking={setBusy} />\n          ) : null}\n          {m.role === 'assistant' ? (() => {\n            const model = Array.isArray(meta.suggestionsLLM) ? meta.suggestionsLLM : [];\n            const gateway = Array.isArray(meta.suggestions) ? meta.suggestions : [];\n            const raw = [...model, ...gateway];\n            const seen = new Set<string>();\n            const chips = raw.filter((c: any) => {\n              if (!c || typeof c !== 'object') return false;\n              const label = String(c.label || c.query || c.value || '').trim();\n              if (!label) return false;\n              const key = (c.action || '') + '::' + label;\n              if (seen.has(key)) return false;\n              seen.add(key);\n              c.label = label;\n              return true;\n            });\n            if (!chips.length && !canSaveRule) return null;\n            return (\n              <div className=\"flex flex-wrap gap-2 mt-2 items-center\">\n                {chips.map((chip: any) => (\n                  <button\n                    key={(chip.action || 'noop') + chip.label}\n                    type=\"button\"\n                    role=\"button\"\n                    tabIndex={0}\n                    aria-label={`Suggestion: ${chip.label}`}\n                    className={`chip ${chip.source === 'gateway' ? 'chip-suggest-gw' : 'chip-suggest'}`}\n                    onKeyDown={(e)=>{ if (e.key==='Enter'||e.key===' ') { e.preventDefault(); handleSuggestionChip({ label: chip.label, action: chip.action || chip.label, source: chip.source }); } }}\n                    onClick={()=>handleSuggestionChip({ label: chip.label, action: chip.action || chip.label, source: chip.source })}\n                  >{chip.label}</button>\n                ))}\n                {canSaveRule && (\n                  <button\n                    type=\"button\"\n                    aria-label=\"Save Rule…\"\n                    className=\"chip ml-auto\"\n                    onClick={() => { setSaveRuleScenario(lastWhatIfScenarioRef.current || ''); setShowSaveRuleModal(true); }}\n                  >\n                    Save Rule…\n                  </button>\n                )}\n              </div>\n            );\n          })() : null}\n        </div>\n      );\n    });\n    return out;\n  }, [appendAssistant, setBusy, uiMessages, userName, chatResp]);\n\n  // Event delegation for Explain buttons inside rendered markdown\n  useEffect(() => {\n    const root = listRef.current;\n    if (!root) return;\n    const onClick = async (e: MouseEvent) => {\n      const target = e.target as HTMLElement;\n      const btn = target.closest('[data-explain-id]') as HTMLElement | null;\n      if (!btn) return;\n      e.preventDefault();\n      const id = btn.getAttribute('data-explain-id');\n      if (!id) return;\n      try {\n        setBusy(true);\n        const res = await explainTxnForChat(id);\n        const text = res.reply || \"(no explanation)\";\n        appendAssistant(text, { citations: res.meta?.citations, ctxMonth: res.meta?.ctxMonth, model: res.meta?.model });\n      } catch (err: any) {\n        appendAssistant(`Failed to explain transaction ${id}: ${err?.message || String(err)}`);\n      } finally {\n        setBusy(false);\n      }\n    };\n    root.addEventListener('click', onClick as any);\n    return () => root.removeEventListener('click', onClick as any);\n  }, [listRef, appendAssistant, setBusy]);\n\n  // Helper to show the Undo snackbar with exit animation.\n  function showUndo(msg: string, onUndo?: () => void) {\n    setUndoMsg(msg);\n    undoActionRef.current = onUndo ?? null;\n    setUndoClosing(false);\n    setUndoVisible(true);\n    // Auto-close after 5s, then animate out for 4.5s\n    window.setTimeout(() => {\n      setUndoClosing(true); // triggers animate-fade-slide-up\n      window.setTimeout(() => setUndoVisible(false), 4500);\n    }, 5000);\n  }\n\n  const appendUser = React.useCallback((text: string) => {\n    const ts = Date.now();\n    setUiMessages(cur => [...cur, { role: 'user', text, ts }]); // optimistic UI\n    chatStore.append({ role: 'user', content: text, createdAt: ts });\n  // If a snapshot exists from a recent Clear, discard it once new chat starts\n  try { chatDiscardSnapshot(); } catch { /* ignore */ }\n  }, [setUiMessages]);\n\n  // (appendAssistant moved above first usage)\n\n  // History toggle (reads directly from messages)\n  const [historyOpen, setHistoryOpen] = useState<boolean>(false);\n\n  // Clear history handler (with snapshot + animated Undo)\n  const handleClearHistory = React.useCallback(() => {\n    const existing = chatStore.get();\n    if (!existing?.length) return;\n    try {\n      const ok = window.confirm('Clear chat history across tabs?');\n      if (!ok) return;\n    } catch { /* ignore */ }\n    // 1) take snapshot for undo\n    const snap = chatSnapshot();\n    // 2) clear store and local UI\n    try {\n      chatStore.clear();\n      setUiMessages([]);\n    } catch (e) { /* ignore */ }\n    // 3) offer undo that restores snapshot via chatStore\n    showUndo('Chat cleared', () => {\n      const res = chatRestoreFromSnapshot();\n      if (res.ok) {\n        try {\n          const restored = chatStore.get() || [];\n          const mapped = (restored || []).map(b => ({\n            role: (b.role === 'assistant' ? 'assistant' : 'user') as MsgRole,\n            text: String(b.content || ''),\n            ts: Number(b.createdAt) || Date.now(),\n          }));\n          setUiMessages(mapped);\n        } catch { /* ignore */ }\n  try { sessionStorage.setItem('chat:restored_at', String(Date.now())); } catch {}\n  setRestoredVisible(true);\n  window.setTimeout(() => setRestoredVisible(false), 4500);\n        try { /* optional: clear snapshot explicitly if needed */ chatDiscardSnapshot(); } catch {}\n      }\n      // close snackbar shortly after click\n      setUndoClosing(true);\n      window.setTimeout(() => setUndoVisible(false), 800);\n    });\n  }, []);\n\n  const mapBasicToMsg = React.useCallback((arr: BasicMsg[]): Msg[] => {\n    return (arr || []).map(b => ({ role: (b.role === 'assistant' ? 'assistant' : 'user') as MsgRole, text: String(b.content || ''), ts: Number(b.createdAt) || Date.now() }));\n  }, []);\n\n  // no-op cleanup needed for new snackbar timers (scoped to showUndo)\n  \n  // Auto-run state for debounced month changes\n  const isAutoRunning = useRef(false);\n  const debounceTimer = useRef<number | null>(null);\n\n  // stop saving/restoring \"open\"; clean any legacy value once\n  React.useEffect(() => { localStorage.removeItem(\"chatdock_open\"); }, []);\n  // no persistence for positions\n  // keep coords sane on resize\n  useEffect(() => {\n    const onResize = () => {\n    const rect = panelRef.current?.getBoundingClientRect();\n    const w = rect?.width ?? (open ? PANEL_W_GUESS : BUBBLE);\n    const h = rect?.height ?? (open ? PANEL_H_GUESS : BUBBLE);\n  setRb((prev: { right: number; bottom: number }) => clampRB(prev, w, h));\n    };\n    window.addEventListener(\"resize\", onResize);\n    return () => window.removeEventListener(\"resize\", onResize);\n  }, [open]);\n  // fetch models (best-effort)\n  React.useEffect(() => { (async () => {\n    try { const info = await getAgentModels(); setModelsInfo(info || null); } catch { /* ignore */ }\n  })(); }, []);\n\n  // When opening the panel, immediately clamp rb to the actual panel size\n  useEffect(() => {\n    if (!open) return;\n    // wait for layout to settle then measure and clamp\n    requestAnimationFrame(() => {\n      const rect = panelRef.current?.getBoundingClientRect();\n      const w = rect?.width ?? PANEL_W_GUESS;\n      const h = rect?.height ?? PANEL_H_GUESS;\n  setRb((prev: { right: number; bottom: number }) => clampRB(prev, w, h));\n    });\n  }, [open]);\n\n  // Load saved model (per-tab)\n  useEffect(() => {\n    try {\n      const saved = sessionStorage.getItem('fa.model');\n      if (saved) setSelectedModel(saved);\n    } catch {}\n  }, []);\n\n  // Save when it changes (per-tab)\n  useEffect(() => {\n    try {\n      if (selectedModel) sessionStorage.setItem('fa.model', selectedModel);\n      else sessionStorage.removeItem('fa.model');\n    } catch {}\n  }, [selectedModel]);\n\n  // handle keyboard\n  React.useEffect(() => {\n    const onKey = (e: KeyboardEvent) => {\n      if (e.key === \"Escape\" && open) setOpen(false);\n  if (e.key.toLowerCase() === \"k\" && e.shiftKey && e.ctrlKey) { e.preventDefault(); setOpen((v: boolean) => !v); }\n    };\n    window.addEventListener(\"keydown\", onKey);\n    return () => window.removeEventListener(\"keydown\", onKey);\n  }, [open]);\n\n  // switch tool keeps per-tool payload\n  React.useEffect(() => {\n    const existing = payloads[tool];\n    setPayloadText(existing ?? JSON.stringify(spec.examplePayload, null, 2));\n  }, [tool, spec, payloads]);\n\n  // mark month ready once a non-empty month is available\n  React.useEffect(() => { if (month) setMonthReady(true); }, [month]);\n\n  // helper: force-set month into payload text\n  const setMonthInPayload = React.useCallback((m: string | undefined) => {\n    try {\n      const obj = payloadText.trim() ? JSON.parse(payloadText) : {};\n      obj.month = m;\n      const newText = JSON.stringify(obj, null, 2);\n      setPayloadText(newText);\n  setPayloads((p: Record<string, string>) => ({ ...p, [tool]: newText }));\n    } catch { /* ignore bad json */ }\n  }, [payloadText, tool]);\n\n  // simplify insert: always overwrite month with current context\n  const insertContext = React.useCallback(() => {\n    setMonthInPayload(month);\n  }, [month, setMonthInPayload]);\n\n  // ensure month exists for tools that require it\n  const ensureMonth = (b: any) => {\n    if (b == null || typeof b !== \"object\") return b;\n    if (b.month === undefined || b.month === null || b.month === \"\") {\n      b.month = month;\n    }\n    return b;\n  };\n\n  const run = React.useCallback(async () => {\n    // simple cooldown (prevents quick double-click flicker)\n    const now = Date.now();\n  if (now - lastClickAtRef.current < 300) return;\n    lastClickAtRef.current = now;\n\n    // prevent overlap\n    if (runningRef.current) return;\n\n    // parse a FRESH body (never mutate previous object)\n    let body: any = {};\n    try {\n      body = payloadText.trim() ? JSON.parse(payloadText) : {};\n    } catch {\n      setState({ loading:false, error:\"Invalid JSON payload.\", data:null });\n      return;\n    }\n\n    // inject/snap month for month-required tools\n    const monthRequired = new Set<ToolKey>([\n      \"transactions.search\",\n      \"insights.expanded\",\n      \"charts.summary\",\n      \"charts.merchants\",\n      \"charts.flows\",\n      \"charts.trends\",\n    ]);\n\n    if (monthRequired.has(tool)) {\n      if (!body.month || body.month !== month) {\n        body = { ...body, month }; // snap to current MonthContext\n        const newText = JSON.stringify(body, null, 2);\n        setPayloadText(newText);\n  setPayloads((p: Record<string, string>) => ({ ...p, [tool]: newText }));\n      }\n    }\n\n    // single-flight\n    const ctrl = new AbortController();\n    runningRef.current = ctrl;\n    setState({ loading: true, error: null, data: null });\n\n    try {\n      let data: unknown;\n      switch (tool) {\n        case \"transactions.search\":       data = await agentTools.searchTransactions(body, ctrl.signal); break;\n        case \"transactions.categorize\":   data = await agentTools.categorizeTransactions(body, ctrl.signal); break;\n        case \"transactions.get_by_ids\":   data = await agentTools.getTransactionsByIds(body, ctrl.signal); break;\n        case \"budget.summary\":            data = await agentTools.budgetSummary(body, ctrl.signal); break;\n        case \"budget.check\":              data = await agentTools.budgetCheck(body, ctrl.signal); break;\n        case \"insights.expanded\":         data = await agentTools.insightsExpanded(body, ctrl.signal); break;\n        case \"charts.summary\":            data = await agentTools.chartsSummary(body, ctrl.signal); break;\n        case \"charts.merchants\":          data = await agentTools.chartsMerchants(body, ctrl.signal); break;\n        case \"charts.flows\":              data = await agentTools.chartsFlows(body, ctrl.signal); break;\n        case \"charts.trends\":             data = await agentTools.chartsSpendingTrends(body, ctrl.signal); break;\n        case \"rules.test\":                data = await agentTools.rulesTest(body, ctrl.signal); break;\n        case \"rules.apply\":               data = await agentTools.rulesApply(body, ctrl.signal); break;\n        case \"rules.apply_all\":           data = await agentTools.rulesApplyAll(body, ctrl.signal); break;\n        default: throw new Error(\"Unknown tool\");\n      }\n      setState({ loading: false, error: null, data });\n\n      // 2) Force LLM rephrase to show the thinking bubble in chat\n      try {\n        setBusy(true);\n        const pretty = (function prettyFormat(toolKey: ToolKey, payload: any): string {\n          try {\n            if (toolKey === 'charts.summary' && payload) {\n              const m = payload?.month ? ` - ${payload.month}` : '';\n              const income = payload?.income ?? payload?.total_income ?? 0;\n              const spend = payload?.spend ?? payload?.total_spend ?? 0;\n              const net = payload?.net ?? (income - Math.abs(spend));\n              return `Month summary${m}\\n\\n- Income: $${Number(income).toFixed(0)}\\n- Spend: $${Math.abs(Number(spend)).toFixed(0)}\\n- Net: $${Number(net).toFixed(0)}\\n\\nOne recommendation:`;\n            }\n            if (toolKey === 'charts.merchants' && Array.isArray(payload?.merchants)) {\n              const m = payload?.month ? ` - ${payload.month}` : '';\n              const lines = payload.merchants.slice(0, 5).map((it: any) => `- ${it.merchant}: $${Math.abs(Number(it.amount||0)).toFixed(0)}`);\n              return `Top merchants${m}\\n\\n${lines.join('\\n')}\\n\\nSummarize and suggest one action.`;\n            }\n            if (toolKey === 'charts.trends' && Array.isArray(payload?.series)) {\n              const lines = payload.series.slice(-6).map((it: any) => `- ${it.month}: income $${Number(it.income||0).toFixed(0)}, spend $${Math.abs(Number(it.spend||it.spending||0)).toFixed(0)}, net $${Number(it.net||0).toFixed(0)}`);\n              return `Spending trends\\n\\n${lines.join('\\n')}\\n\\nSummarize the trend in 3 bullets and one next step.`;\n            }\n            if (toolKey === 'insights.expanded' && payload) {\n              const m = payload?.month ? ` - ${payload.month}` : '';\n              const inc = payload?.summary?.income ?? 0;\n              const spd = payload?.summary?.spend ?? 0;\n              const unk = payload?.unknown_spend?.amount ? Math.abs(Number(payload.unknown_spend.amount)).toFixed(0) : null;\n              const bullets = [\n                `Income: $${Number(inc).toFixed(0)}`,\n                `Spend: $${Math.abs(Number(spd)).toFixed(0)}`,\n              ];\n              if (unk) bullets.push(`Unknown spend: $${unk}`);\n              return `Expanded insights${m}\\n\\n- ${bullets.join('\\n- ')}\\n\\nRephrase clearly with MoM highlights if present, then one actionable tip.`;\n            }\n          } catch {}\n          // Generic fallback: pretty JSON\n          return `Rephrase this result for the user, concise and clear.\\n\\n${JSON.stringify(payload, null, 2)}`;\n        })(tool, data);\n        const llm = await agentRephrase(pretty);\n        appendAssistant(llm.reply, { model: llm.model });\n      } finally {\n        setBusy(false);\n      }\n    } catch (e: any) {\n      if (e?.name !== \"AbortError\") {\n        setState({ loading: false, error: e?.message ?? \"Request failed\", data: null });\n      }\n    } finally {\n      runningRef.current = null;\n    }\n  }, [tool, payloadText, month]);\n\n  // Lightweight tool palette -> uses unified /agent/chat\n  // keep legacy helper name for response objects (internal use)\n  const handleAgentResponse = React.useCallback((resp: AgentChatResponse) => {\n    setChatResp(resp);\n  if (resp?.reply) appendAssistant(resp.reply, { citations: resp.citations, ctxMonth: resp.used_context?.month, trace: resp.tool_trace, model: resp.model, fallback: (resp as any).fallback });\n  }, [appendAssistant]);\n\n  const appendAssistantFromText = React.useCallback((text: string, opts?: { meta?: any }) => {\n    appendAssistant(text, opts?.meta);\n  }, [appendAssistant]);\n\n  React.useEffect(() => {\n    // Register handlers so external callers (e.g., Explain buttons) can append into ChatDock\n  chat.setAppendAssistant(appendAssistantFromText);\n  chat.setAppendUser((text: string) => { appendUser(text); });\n  }, [chat, appendAssistantFromText]);\n\n  // Always include context; hold Alt while clicking to omit it.\n  const getContext = (ev?: { altKey?: boolean }) => {\n    if (ev?.altKey) return null;\n    try { return (window as any).__FA_CONTEXT ?? null; } catch { return null; }\n  };\n\n  // Composer send (optimistic append + context-aware) REPLACED to support AGUI SSE\n  function aguiLog(evt: string, data: any) { try { console.debug(`[agui] ${evt}`, data); } catch {} }\n  const handleSend = React.useCallback(async (ev?: React.MouseEvent | React.KeyboardEvent) => {\n    if (busy) return;\n    const text = input.trim();\n    if (!text) return;\n    if (ENABLE_AGUI) {\n      // Unified AGUI streaming via wireAguiStream\n      appendUser(text);\n      setInput(\"\");\n      setComposerPlaceholderUI(DEFAULT_PLACEHOLDER);\n      focusComposer();\n      setBusy(true);\n      setAguiTools([]);\n      setAguiRunActive(true);\n      let aggregated = '';\n      aguiLog('agui.run', { from: 'text', month, q: text });\n      wireAguiStream({ q: text, month }, {\n        onStart(meta) { appendAssistant('...', { thinking: true }); if (meta?.intent) setIntentBadge(meta.intent); },\n        onIntent(intent) { setIntentBadge(intent); },\n        onToolStart(name) {\n          aguiLog('agui.tool', { name, status: 'start' });\n          setAguiTools(cur => {\n            const exists = cur.find(t => t.name === name);\n            if (exists) return cur.map(t => t.name === name ? { ...t, status: 'active', startedAt: t.startedAt || Date.now() } : t);\n            return [...cur, { name, status: 'active', startedAt: Date.now() }];\n          });\n        },\n        onToolEnd(name, ok) {\n          aguiLog('agui.tool', { name, status: 'end', ok });\n          setAguiTools(cur => cur.map(t => t.name === name ? { ...t, status: ok ? 'done' : 'error', endedAt: Date.now() } : t));\n        },\n        onChunk(chunk) { aggregated += chunk; },\n        onSuggestions(chips) {\n          const tagged = chips.map(c => ({ ...c, source: 'gateway' }));\n            aguiLog('agui.suggestions', { count: tagged.length, source: 'gateway' });\n          setUiMessages(cur => cur.map((m,i)=> {\n            const thinking = (m as any).thinking || (m as any).meta?.thinking;\n            return (i===cur.length-1 && m.role==='assistant' && thinking)\n              ? { ...m, meta: { ...(m.meta||{}), suggestions: tagged, thinking: true } }\n              : m;\n          }));\n        },\n        onMeta(meta) {\n          if (meta && meta.fallback) {\n            setUiMessages(cur => cur.map((m,i) => {\n              const thinking = (m as any).thinking || (m as any).meta?.thinking;\n              return (i===cur.length-1 && m.role==='assistant' && thinking)\n                ? { ...m, meta: { ...(m.meta||{}), fallback: String(meta.fallback), thinking: true } }\n                : m;\n            }));\n          }\n        },\n        onFinish() {\n          const snapshot = aguiToolsRef.current || aguiTools;\n          const errors = snapshot.filter(t => t.status === 'error').map(t => t.name);\n          if (errors.length) {\n            const pretty = errors.map(stripToolNamespaces);\n            aggregated += `\\n\\n⚠️ Skipped: ${pretty.join(', ')} (unavailable). I used everything else.`;\n          }\n          setBusy(false); setAguiRunActive(false); appendAssistant(aggregated || '(no content)');\n        },\n        onError() {\n          setBusy(false); setAguiRunActive(false); appendAssistant('(stream error – fallback)');\n        }\n      });\n      return;\n    }\n    setInput(\"\");\n    setComposerPlaceholderUI(DEFAULT_PLACEHOLDER);\n    focusComposer();\n    appendUser(text);\n    setBusy(true);\n    try {\n      const req: AgentChatRequest = {\n        messages: [{ role: 'user', content: text }],\n        intent: 'general',\n        context: getContext(ev as any),\n        ...(selectedModel ? { model: selectedModel } : {})\n      };\n      const resp = await agentChat(req);\n      handleAgentResponse(resp);\n      syncFromStoreDebounced(120);\n    } catch (e: any) {\n      appendAssistant(`Send failed: ${e?.message ?? String(e)}`);\n    } finally {\n      setBusy(false);\n    }\n  }, [busy, input, selectedModel, handleAgentResponse, month, appendUser, appendAssistant]);\n\n  const onComposerKeyDown = React.useCallback((e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n    if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) { e.preventDefault(); handleSend(e); return; }\n    if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleSend(e); }\n  }, [handleSend]);\n\n  // --- ONE-CLICK TOOL RUNNERS (top bar) ---\n  const runMonthSummary = React.useCallback(async (_ev?: React.MouseEvent) => {\n    if (busy) return;\n  if (startAguiRun('overview', AGUI_ACTIONS['overview'].prompt, month)) return;\n    setBusy(true);\n    try {\n      appendUser('Summarize my spending this month in 4 bullets and one action.');\n      await runToolWithRephrase(\n  'charts.month_summary',\n        () => agentTools.chartsSummary({ month: month || '', include_daily: false } as any),\n        (raw: any) => {\n          const norm = {\n            income_total: raw?.total_inflows ?? 0,\n            spend_total: raw?.total_outflows ?? 0,\n            net: raw?.net ?? (raw?.total_inflows ?? 0) - Math.abs(raw?.total_outflows ?? 0),\n            categories: [],\n          };\n          return fmtMonthSummary(month || '', norm);\n        },\n  (msg, meta) => appendAssistant(msg, { ...meta, ctxMonth: month }),\n  (on) => setBusy(on),\n  () => ({ context: getContext(), ...(selectedModel ? { model: selectedModel } : {}) })\n      );\n      syncFromStoreDebounced(120);\n    } finally { setBusy(false); }\n  }, [busy, month, appendAssistant]);\n\n  const runFindSubscriptions = React.useCallback(async (_ev?: React.MouseEvent) => {\n    if (busy) return;\n  if (startAguiRun('subscriptions', AGUI_ACTIONS['subscriptions'].prompt, month)) return;\n    setBusy(true);\n    try {\n      appendUser('Identify recurring subscriptions this month and suggest which I could cancel.');\n      await runToolWithRephrase(\n        'analytics.subscriptions',\n        () => analytics.subscriptions(month),\n        (raw: any) => `Identify likely subscriptions for ${month} and which to cancel, with reasons:\\n\\n${JSON.stringify(raw)}`,\n        (msg, meta) => appendAssistant(msg, { ...meta, ctxMonth: month }),\n        (on) => setBusy(on),\n        () => ({ context: getContext(), ...(selectedModel ? { model: selectedModel } : {}) })\n      );\n      syncFromStoreDebounced(120);\n    } finally {\n      setBusy(false);\n    }\n  }, [busy, month, appendAssistant, selectedModel]);\n\n  // Additional one-click runners shown in the tools tray\n  const runTopMerchants = React.useCallback(async (_ev?: React.MouseEvent) => {\n    if (busy) return;\n  if (startAguiRun('merchants', AGUI_ACTIONS['merchants'].prompt, month)) return;\n    setBusy(true);\n    try {\n      appendUser('Show top merchants for the current month.');\n      await runToolWithRephrase(\n        'charts.month_merchants',\n  // Use Agent Tools POST to ensure auth + month-aware behavior\n  () => agentTools.chartsMerchants({ month: month || '', limit: 10 }),\n        (raw: any) => fmtTopMerchants(month || '', raw?.merchants || raw || []),\n  (msg, meta) => appendAssistant(msg, { ...meta, ctxMonth: month }),\n  (on) => setBusy(on),\n  () => ({ context: getContext(), ...(selectedModel ? { model: selectedModel } : {}) })\n      );\n      syncFromStoreDebounced(120);\n    } finally { setBusy(false); }\n  }, [busy, month, appendAssistant]);\n\n  const runCashflow = React.useCallback(async (_ev?: React.MouseEvent) => {\n    if (busy) return;\n  if (startAguiRun('cashflow', AGUI_ACTIONS['cashflow'].prompt, month)) return;\n    setBusy(true);\n    try {\n      appendUser('Show my cashflow (inflows vs outflows).');\n      await runToolWithRephrase(\n        'charts.month_flows',\n  // Use Agent Tools POST to avoid GET auth issues\n  () => agentTools.chartsFlows({ month: month || '' }),\n        (raw) => fmtCashflow(month || '', raw as any),\n  (msg, meta) => appendAssistant(msg, { ...meta, ctxMonth: month }),\n  (on) => setBusy(on),\n  () => ({ context: getContext(), ...(selectedModel ? { model: selectedModel } : {}) })\n      );\n      syncFromStoreDebounced(120);\n    } finally { setBusy(false); }\n  }, [busy, month, appendAssistant]);\n\n  const runTrends = React.useCallback(async (_ev?: React.MouseEvent) => {\n    if (busy) return;\n  if (startAguiRun('overview', AGUI_ACTIONS['trends'].prompt, month)) return;\n    setBusy(true);\n    try {\n      appendUser('Show my spending trends.');\n      await runToolWithRephrase(\n        'charts.spending_trends',\n  // Prefer Agent Tools POST with selected month and months_back window\n  () => agentTools.chartsSpendingTrends({ month: month || '', months_back: 6 }) as any,\n  (raw: any) => fmtTrends(raw?.trends || raw?.series || raw || []),\n  (msg, meta) => appendAssistant(msg, { ...meta, ctxMonth: month }),\n  (on) => setBusy(on),\n  () => ({ context: getContext(), ...(selectedModel ? { model: selectedModel } : {}) })\n      );\n      syncFromStoreDebounced(120);\n    } finally { setBusy(false); }\n  }, [busy, month, appendAssistant]);\n\n  // Debug: confirm onClick bindings are in place for the current month\n  useEffect(() => {\n    console.debug('[bind] Month summary handler attached', month);\n    console.debug('[bind] Top merchants handler attached', month);\n    console.debug('[bind] Cashflow handler attached', month);\n    console.debug('[bind] Trends handler attached', month);\n    console.debug('[bind] Insights (summary/expanded) handlers attached', month);\n    console.debug('[bind] Budget check handler attached', month);\n  }, [month]);\n\n  const runInsightsSummary = React.useCallback(async (_ev?: React.MouseEvent) => {\n    if (busy) return;\n  if (startAguiRun('overview', AGUI_ACTIONS['insights-summary'].prompt, month)) return;\n    setBusy(true);\n    try {\n      appendUser('Summarize key insights for this month.');\n      await runToolWithRephrase(\n        'insights.expanded',\n        () => agentTools.insightsExpanded({ month }),\n        (raw) => `Turn these insights for ${month} into a friendly paragraph with one recommendation: ${JSON.stringify(raw)}`,\n  (msg, meta) => appendAssistant(msg, { ...meta, ctxMonth: month }),\n  (on) => setBusy(on),\n  () => ({ context: getContext(), ...(selectedModel ? { model: selectedModel } : {}) })\n      );\n      syncFromStore();\n    } finally { setBusy(false); }\n  }, [busy, month, appendAssistant]);\n\n  const runInsightsExpanded = React.useCallback(async (_ev?: React.MouseEvent) => {\n    if (busy) return;\n  if (startAguiRun('overview', AGUI_ACTIONS['insights-expanded'].prompt, month)) return;\n    setBusy(true);\n    try {\n      appendUser('Expand insights (month-over-month + anomalies).');\n      await runToolWithRephrase(\n        'insights.expanded',\n        () => agentTools.insightsExpanded({ month }),\n        (raw) => `Expand insights for ${month} with MoM and anomalies: ${JSON.stringify(raw)}`,\n  (msg, meta) => appendAssistant(msg, { ...meta, ctxMonth: month }),\n  (on) => setBusy(on),\n  () => ({ context: getContext(), ...(selectedModel ? { model: selectedModel } : {}) })\n      );\n      syncFromStore();\n    } finally { setBusy(false); }\n  }, [busy, month, appendAssistant]);\n\n  const runBudgetCheck = React.useCallback(async (_ev?: React.MouseEvent) => {\n    if (busy) return;\n  if (startAguiRun('budget', AGUI_ACTIONS['budget'].prompt, month)) return;\n    setBusy(true);\n    try {\n      appendUser('Check my budget status for this month.');\n      await runToolWithRephrase(\n        'budget.check',\n  // Use Agent Tools POST variant with month\n  () => agentTools.budgetCheck({ month: month || '' }),\n        (raw) => `Summarize this budget status for ${month}: ${JSON.stringify(raw)}`,\n  (msg, meta) => appendAssistant(msg, { ...meta, ctxMonth: month }),\n  (on) => setBusy(on),\n  () => ({ context: getContext(), ...(selectedModel ? { model: selectedModel } : {}) })\n      );\n      syncFromStore();\n    } finally { setBusy(false); }\n  }, [busy, month, appendAssistant]);\n\n  // ---------- Analytics quick buttons ----------\n  const runAnalyticsKpis = React.useCallback(async (_ev?: React.MouseEvent) => {\n    if (busy) return;\n  if (startAguiRun('kpis', AGUI_ACTIONS['kpis'].prompt, month)) return;\n    setBusy(true);\n    try {\n      appendUser('Show KPIs for this month.');\n      await runToolWithRephrase(\n        'analytics.kpis',\n        () => analytics.kpis(month),\n        (raw: any) => `Summarize these KPIs for ${month} in 3 bullets and one suggestion:\\n\\n${JSON.stringify(raw)}`,\n        (msg, meta) => appendAssistant(msg, { ...meta, ctxMonth: month }),\n        (on) => setBusy(on),\n        () => ({ context: getContext(), ...(selectedModel ? { model: selectedModel } : {}) })\n      );\n      syncFromStoreDebounced(120);\n    } finally { setBusy(false); }\n  }, [busy, month, appendAssistant, selectedModel]);\n\n  const runAnalyticsForecast = React.useCallback(async (_ev?: React.MouseEvent) => {\n    if (busy) return;\n  // forecast not a dedicated branch yet; legacy path\n    setBusy(true);\n    try {\n      appendUser('Forecast my next 3 months cashflow.');\n      await runToolWithRephrase(\n        'analytics.forecast',\n  () => analytics.forecast(month, 3, { model: \"auto\", ciLevel: 0.8 }),\n        (raw: any) => `Explain this cashflow forecast for ${month} and what it means:\\n\\n${JSON.stringify(raw)}`,\n        (msg, meta) => appendAssistant(msg, { ...meta, ctxMonth: month }),\n        (on) => setBusy(on),\n        () => ({ context: getContext(), ...(selectedModel ? { model: selectedModel } : {}) })\n      );\n      syncFromStoreDebounced(120);\n    } finally { setBusy(false); }\n  }, [busy, month, appendAssistant, selectedModel]);\n\n  const runAnalyticsAnomalies = React.useCallback(async (_ev?: React.MouseEvent) => {\n    if (busy) return;\n  // anomalies not a dedicated branch yet; legacy path\n    setBusy(true);\n    try {\n      appendUser('Find anomalies this month.');\n      await runToolWithRephrase(\n        'analytics.anomalies',\n        () => analytics.anomalies(month),\n        (raw: any) => `List any spending anomalies for ${month} and suggest actions:\\n\\n${JSON.stringify(raw)}`,\n        (msg, meta) => appendAssistant(msg, { ...meta, ctxMonth: month }),\n        (on) => setBusy(on),\n        () => ({ context: getContext(), ...(selectedModel ? { model: selectedModel } : {}) })\n      );\n      syncFromStoreDebounced(120);\n    } finally { setBusy(false); }\n  }, [busy, month, appendAssistant, selectedModel]);\n\n  const runAnalyticsRecurring = React.useCallback(async (_ev?: React.MouseEvent) => {\n    if (busy) return;\n  if (startAguiRun('subscriptions', AGUI_ACTIONS['recurring'].prompt, month)) return;\n    setBusy(true);\n    try {\n      appendUser('Detect recurring charges.');\n      await runToolWithRephrase(\n        'analytics.recurring',\n        () => analytics.recurring(month),\n        (raw: any) => `Summarize recurring charges for ${month}, with likely subscriptions highlighted:\\n\\n${JSON.stringify(raw)}`,\n        (msg, meta) => appendAssistant(msg, { ...meta, ctxMonth: month }),\n        (on) => setBusy(on),\n        () => ({ context: getContext(), ...(selectedModel ? { model: selectedModel } : {}) })\n      );\n      syncFromStoreDebounced(120);\n    } finally { setBusy(false); }\n  }, [busy, month, appendAssistant, selectedModel]);\n\n  const runAnalyticsBudgetSuggest = React.useCallback(async (_ev?: React.MouseEvent) => {\n    if (busy) return;\n  if (startAguiRun('budget', AGUI_ACTIONS['budget-suggest'].prompt, month)) return;\n    setBusy(true);\n    try {\n      appendUser('Suggest budget targets.');\n      await runToolWithRephrase(\n        'analytics.budget_suggest',\n        () => analytics.budgetSuggest(month),\n        (raw: any) => `Propose budget targets for ${month} from these stats, in a short list:\\n\\n${JSON.stringify(raw)}`,\n        (msg, meta) => appendAssistant(msg, { ...meta, ctxMonth: month }),\n        (on) => setBusy(on),\n        () => ({ context: getContext(), ...(selectedModel ? { model: selectedModel } : {}) })\n      );\n      syncFromStoreDebounced(120);\n    } finally { setBusy(false); }\n  }, [busy, month, appendAssistant, selectedModel]);\n\n  const callTransactionsNl = React.useCallback(async (payload?: Record<string, any>) => {\n    if (busy) return null;\n\n    const data = payload ?? {};\n    const query = typeof data.query === 'string' ? data.query.trim() : '';\n    const filters = data.filters;\n\n    if (query) {\n      appendUser(query);\n    }\n\n    setComposer('');\n    setComposerPlaceholderUI(DEFAULT_PLACEHOLDER);\n    focusComposer();\n\n    try {\n      setBusy(true);\n      const response = await transactionsNl(data);\n      const meta = (response as any)?.meta ?? {};\n      const suggestions = Array.isArray(meta.suggestions) ? meta.suggestions : undefined;\n      const metaPayload: Record<string, any> = { ...meta, rephrased: response.rephrased };\n      if (suggestions !== undefined) metaPayload.suggestions = suggestions;\n      appendAssistant(response.reply, metaPayload);\n\n      const filtersForLast: any = meta.filters ?? filters ?? null;\n      if (filtersForLast) {\n        lastNlqRef.current = {\n          q: query || (typeof meta.query === 'string' ? meta.query : query),\n          filters: filtersForLast,\n          flow: filtersForLast?.flow,\n          intent: (meta.result && (meta.result as any)?.intent) || meta.intent || undefined,\n        };\n      } else if (query) {\n        lastNlqRef.current = {\n          q: query,\n          filters: {},\n          intent: (meta.result && (meta.result as any)?.intent) || meta.intent || undefined,\n        };\n      }\n\n      return response;\n    } catch (err: any) {\n      const message = err?.message ? String(err.message) : String(err ?? 'Unknown error');\n      appendAssistant(`**transactions.nl failed:** ${message}`);\n      throw err;\n    } finally {\n      setBusy(false);\n      syncFromStoreDebounced(120);\n    }\n  }, [appendAssistant, appendUser, busy, focusComposer, setBusy, setComposer, setComposerPlaceholderUI, syncFromStoreDebounced, transactionsNl]);\n\n  // Insert AGUI feature flag and streaming helper near top-level utility section\n  // (legacy runAguiStream removed in favor of wireAguiStream)\n\n  // Central mapping of AGUI actions to prompts + forced gateway mode\n  const AGUI_ACTIONS: Record<string, { prompt: string; mode: string }> = {\n    'overview':         { prompt: 'Give me this month’s overview summary.', mode: 'overview' },\n    'subscriptions':    { prompt: 'Identify recurring subscriptions this month and suggest which I could cancel.', mode: 'subscriptions' },\n    'merchants':        { prompt: 'Show top merchants for the current month.', mode: 'merchants' },\n    'cashflow':         { prompt: 'Show my cashflow breakdown for this month.', mode: 'cashflow' },\n    'trends':           { prompt: 'Show spending trends for this month versus prior month.', mode: 'overview' },\n    'insights-summary': { prompt: 'Summarize key insights for this month.', mode: 'overview' },\n    'insights-expanded':{ prompt: 'Give me expanded insights for this month (last 60 days if needed).', mode: 'overview' },\n    'budget':           { prompt: 'Check my budget status for this month.', mode: 'budget' },\n    'kpis':             { prompt: 'Show KPIs for this month.', mode: 'kpis' },\n    'forecast':         { prompt: 'Forecast next month’s spending.', mode: 'forecast' },\n    'anomalies':        { prompt: 'Show anomalies or unusual transactions for this month.', mode: 'anomalies' },\n    'recurring':        { prompt: 'List recurring charges this month.', mode: 'subscriptions' },\n    'budget-suggest':   { prompt: 'Suggest budget targets for this month.', mode: 'budget' },\n    'what-if':          { prompt: 'What if I reduce dining by 20% next month?', mode: 'what-if' },\n    'alerts':           { prompt: 'Show my alerts for this month.', mode: 'alerts' },\n    'search-txns':      { prompt: 'Search transactions matching my last query.', mode: 'txns' },\n  };\n\n  // Intent label mapping for badge display\n  const INTENT_LABELS: Record<string,string> = {\n    overview:'Overview', merchants:'Merchants', kpis:'KPIs', subscriptions:'Subscriptions',\n    alerts:'Alerts', anomalies:'Anomalies', budget:'Budget', cashflow:'Cashflow',\n    forecast:'Forecast', 'what-if':'What-if', txns:'Transactions', chat:'Chat'\n  };\n\n  // Minimal badge injection: attach to last assistant thinking bubble meta\n  function setIntentBadge(intent?: string) {\n    if (!intent) return;\n    const label = INTENT_LABELS[intent] || intent;\n    setUiMessages(cur => cur.map((m, i) => {\n      const thinking = (m as any).thinking || (m as any).meta?.thinking;\n      if (i === cur.length - 1 && m.role === 'assistant' && thinking) {\n        return { ...m, meta: { ...(m.meta||{}), intent_label: label, intent, thinking: true }, thinking: (m as any).thinking };\n      }\n      return m;\n    }));\n  }\n\n  // Start an AGUI streaming run forcing a branch via mode; returns true if started\n  function startAguiRun(mode: string, prompt: string, monthCtx?: string | null) {\n    if (!ENABLE_AGUI) return false;\n    appendUser(prompt);\n    setBusy(true);\n    setAguiTools([]);\n    setAguiRunActive(true);\n    let aggregated = '';\n  if (mode === 'what-if') { lastWhatIfScenarioRef.current = prompt; hadWhatIfRunRef.current = true; }\n    aguiLog('agui.run', { from: 'button', mode, month: monthCtx, q: prompt });\n    wireAguiStream({ q: prompt, month: monthCtx || undefined, mode }, {\n      onStart(meta) { appendAssistant('...', { thinking: true }); if (meta?.intent) setIntentBadge(meta.intent); },\n      onIntent(intent) { setIntentBadge(intent); },\n      onToolStart(name) {\n        aguiLog('agui.tool', { name, status: 'start' });\n        setAguiTools(cur => {\n          const exists = cur.find(t => t.name === name);\n          if (exists) return cur.map(t => t.name === name ? { ...t, status: 'active', startedAt: t.startedAt || Date.now() } : t);\n          return [...cur, { name, status: 'active', startedAt: Date.now() }];\n        });\n      },\n      onToolEnd(name, ok) {\n        aguiLog('agui.tool', { name, status: 'end', ok });\n        setAguiTools(cur => cur.map(t => t.name === name ? { ...t, status: ok ? 'done' : 'error', endedAt: Date.now() } : t));\n      },\n      onChunk(txt) { aggregated += txt; },\n      onSuggestions(chips) {\n        const tagged = chips.map(c => ({ ...c, source: 'gateway' }));\n        aguiLog('agui.suggestions', { count: tagged.length, source: 'gateway' });\n        setUiMessages(cur => cur.map((m,i)=> {\n          const thinking = (m as any).thinking || (m as any).meta?.thinking;\n          return (i===cur.length-1 && m.role==='assistant' && thinking)\n            ? { ...m, meta: { ...(m.meta||{}), suggestions: tagged, thinking: true } }\n            : m;\n        }));\n      },\n      onFinish() {\n        const snapshot = aguiToolsRef.current || aguiTools;\n        const errors = snapshot.filter(t => t.status === 'error').map(t => t.name);\n        if (errors.length) {\n          const pretty = errors.map(stripToolNamespaces);\n            aggregated += `\\n\\n⚠️ Skipped: ${pretty.join(', ')} (unavailable). I used everything else.`;\n        }\n        // Emit additional gateway suggestions based on last run context (KPI & Merchants heuristics)\n        try {\n          const extra: any[] = [];\n          // If a forecast was run, suggest budgeting and saving rule directly\n          if (/forecast/i.test(aggregated)) {\n            extra.push({ label: 'Apply this forecast budget', action: 'apply_budget' });\n            extra.push({ label: 'Save as rule', action: 'save_rule' });\n          }\n          // If merchants mentioned (simple keyword scan), suggest merchant spend insights\n          if (/merchant|store|shop/i.test(aggregated)) {\n            extra.push({ label: 'Show top merchants', action: 'top_merchants' });\n            extra.push({ label: 'Merchant spend trend', action: 'merchant_trend' });\n          }\n          if (extra.length) {\n            setUiMessages(cur => cur.map((m,i)=> {\n              const isLast = i===cur.length-1;\n              if (!isLast || m.role !== 'assistant') return m;\n              const meta = (m as any).meta || {};\n              const existing = Array.isArray(meta.suggestions) ? meta.suggestions : [];\n              // de-dupe by action+label\n              const seen = new Set(existing.map((c:any)=> (c.action||'')+'::'+c.label));\n              const merged = [...existing];\n              for (const e of extra) {\n                const key = (e.action||'')+'::'+e.label;\n                if (seen.has(key)) continue;\n                seen.add(key);\n                merged.push({ ...e, source: 'gateway' });\n              }\n              return { ...m, meta: { ...meta, suggestions: merged } };\n            }));\n          }\n        } catch (err) { /* non-fatal */ }\n        setBusy(false); setAguiRunActive(false); appendAssistant(aggregated || '(no content)');\n      },\n  onError() { setBusy(false); setAguiRunActive(false); appendAssistant('(stream error – fallback)'); }\n    });\n    return true;\n  }\n\n  useEffect(() => {\n    return registerChatHandlers({\n      pushAssistant: ({ reply, rephrased, suggestions, meta }) => {\n        const metaPayload: Record<string, any> = { ...(meta ?? {}) };\n        if (typeof rephrased !== 'undefined') metaPayload.rephrased = rephrased;\n        if (Array.isArray(suggestions)) metaPayload.suggestionsLLM = suggestions.map(s => ({ ...(typeof s==='object'?s:{ label: s }), source: 'model', label: (s as any)?.label || (s as any)?.query || (typeof s==='string'? s : '') }));\n        appendAssistant(reply, metaPayload);\n      },\n      pushUser: appendUser,\n      callTool: async (tool, payload) => {\n        if (tool === 'transactions.nl') {\n          return callTransactionsNl(payload);\n        }\n        throw new Error(`Unsupported chat tool: ${tool}`);\n      },\n    });\n  }, [appendAssistant, appendUser, callTransactionsNl]);\n\n  // Legacy inline submit removed; new SaveRuleModal handles validation + save\n  function handleSuggestionChip(chip: { label: string; action: string; source?: string }) {\n    const normLabel = chip.label.trim().toLowerCase();\n    if (/^save\\s+as\\s+rule$/.test(normLabel) || /save\\s+rule/.test(normLabel)) {\n      setSaveRuleScenario(lastWhatIfScenarioRef.current || chip.label || '');\n      setShowSaveRuleModal(true);\n      return;\n    }\n    const currentMonth = month;\n    switch (chip.action) {\n      case 'budget_from_forecast':\n        startAguiRun('budget', 'Suggest a budget using the forecast', currentMonth);\n        break;\n      case 'compare_prev':\n        startAguiRun('overview', 'Compare this month’s forecast with last month', currentMonth);\n        break;\n      case 'apply_budget':\n        startAguiRun('budget', 'Apply this what-if scenario to my budget', currentMonth);\n        break;\n      case 'save_rule':\n        setSaveRuleScenario(lastWhatIfScenarioRef.current || chip.label || '');\n        setShowSaveRuleModal(true);\n        break;\n      default:\n        // Fallback: just re-run with the chip label as a query\n        startAguiRun('overview', chip.label, currentMonth);\n    }\n  }\n\n  const runAnalyticsWhatIf = React.useCallback(async () => {\n    if (busy) return;\n    const cat = window.prompt('Category to cut? e.g., \"Dining out\"', 'Dining out');\n    if (!cat) return;\n    const pctStr = window.prompt('Cut percent (0-100)', '20');\n    const pct = Math.max(0, Math.min(100, Number(pctStr || 0)));\n  // what-if not a dedicated branch; legacy path (could map to overview)\n    setBusy(true);\n    try {\n      appendUser(`What if I cut ${cat} by ${pct}%?`);\n      await runToolWithRephrase(\n        'analytics.whatif',\n        () => analytics.whatif({ month, cuts: [{ category: cat, pct }]}),\n        (raw: any) => `Explain this what-if simulation for ${month} (cut ${cat} by ${pct}%):\\n\\n${JSON.stringify(raw)}`,\n        (msg, meta) => appendAssistant(msg, { ...meta, ctxMonth: month }),\n        (on) => setBusy(on),\n        () => ({ context: getContext(), ...(selectedModel ? { model: selectedModel } : {}) })\n      );\n      syncFromStoreDebounced(120);\n    } finally { setBusy(false); }\n  }, [busy, month, appendAssistant, selectedModel]);\n\n  const runAlerts = React.useCallback(async (ev?: React.MouseEvent) => {\n    if (busy) return;\n  if (startAguiRun('alerts', AGUI_ACTIONS['alerts'].prompt, month)) return;\n    setBusy(true);\n    try {\n      appendUser('Show my alerts.');\n      const req: AgentChatRequest = {\n        messages: [{ role: 'user', content: 'List my alerts for the selected month.' }],\n        intent: 'general',\n        context: getContext(ev),\n        ...(selectedModel ? { model: selectedModel } : {})\n      };\n  console.debug('[chat] alerts -> /agent/chat', { preview: req.messages[0]?.content?.slice(0, 80) });\n  const resp = await agentChat(req);\n  console.debug('[chat] alerts ← ok', { model: resp?.model });\n      handleAgentResponse(resp);\n    } finally { setBusy(false); }\n  }, [busy, selectedModel, handleAgentResponse]);\n\n  // Removed legacy non-NL search tool in favor of NL query\n\n  // (inline quick tool buttons removed; using top-bar runners instead)\n\n  // Auto-run on month change with debouncing and in-flight protection\n  useEffect(() => {\n    // Skip legacy auto-run when legacy form is disabled\n    if (!ENABLE_LEGACY_TOOL_FORM) return;\n    if (!month || !monthReady) return;\n\n    // Debounce 300ms to avoid double-run from rapid state updates\n    if (debounceTimer.current) {\n      window.clearTimeout(debounceTimer.current);\n    }\n    \n    debounceTimer.current = window.setTimeout(async () => {\n      if (isAutoRunning.current) return;\n      if (runningRef.current) return; // Already running from manual click\n      if (lastRunForTool[tool] === month) return; // Already ran for this month/tool combo\n      \n      try {\n        isAutoRunning.current = true;\n        insertContext(); // Update payload with current month\n        await run(); // Run the tool\n  setLastRunForTool((prev: Record<string, string | undefined>) => ({ ...prev, [tool]: month }));\n      } catch (e) {\n        console.error(\"Auto insertContext/run failed:\", e);\n      } finally {\n        isAutoRunning.current = false;\n      }\n    }, 300);\n\n    return () => {\n      if (debounceTimer.current) {\n        window.clearTimeout(debounceTimer.current);\n      }\n    };\n  }, [month, monthReady, tool, insertContext, run, lastRunForTool]); // runs every time month changes\n\n  // Unified right/bottom anchored drag (used by bubble and panel header)\n  const startDragRB = React.useCallback((e: React.PointerEvent, w: number, h: number, onClick?: () => void) => {\n    const startX = e.clientX;\n    const startY = e.clientY;\n    const start = { ...rb };\n    let moved = false;\n    const el = e.currentTarget as HTMLElement;\n    el.setPointerCapture?.(e.pointerId);\n    const onMove = (ev: PointerEvent) => {\n      const dx = ev.clientX - startX;\n      const dy = ev.clientY - startY;\n      if (Math.abs(dx) + Math.abs(dy) > 3) moved = true;\n      const next = { right: start.right - dx, bottom: start.bottom - dy };\n      setRb(clampRB(next, w, h));\n    };\n    const onUp = (_ev: PointerEvent) => {\n      el.releasePointerCapture?.(e.pointerId);\n      window.removeEventListener(\"pointermove\", onMove);\n      window.removeEventListener(\"pointerup\", onUp);\n      if (!moved && onClick) onClick();\n    };\n    window.addEventListener(\"pointermove\", onMove);\n    window.addEventListener(\"pointerup\", onUp);\n  }, [rb]);\n\n  const bubbleEl = (\n    <button\n      type=\"button\"\n      className=\"fixed z-[80] rounded-full shadow-lg bg-black text-white w-12 h-12 flex items-center justify-center hover:opacity-90 select-none\"\n      style={{ right: rb.right, bottom: rb.bottom, cursor: \"grab\", position: 'fixed' as const }}\n      data-chatdock-root\n      data-chatdock-bubble\n      onPointerDown={(e) => startDragRB(e, BUBBLE, BUBBLE)}\n      onClick={() => setOpen(true)}\n      title=\"Open Agent Tools (Ctrl+Shift+K)\"\n    >\n      <span className=\"text-base\" aria-hidden>💬</span>\n      <span className=\"sr-only\">Open agent chat</span>\n    </button>\n  );\n\n  const panelEl = open && (\n    <div\n      ref={panelRef}\n  className=\"fixed z-[70] w-[min(760px,calc(100vw-2rem))] max-h-[80vh] rounded-2xl border border-neutral-700 shadow-xl bg-neutral-900/95 backdrop-blur p-4 flex flex-col min-h-[320px]\"\n  style={{ right: rb.right, bottom: rb.bottom, position: 'fixed' as const }}\n  data-chatdock-root\n    >\n  <style>{`.intent-badge{display:inline-flex;align-items:center;gap:.35rem;padding:.15rem .45rem;border-radius:9999px;border:1px solid rgba(120,120,120,.35);font-size:.6rem;letter-spacing:.5px;text-transform:uppercase;background:rgba(255,255,255,0.06);} .chip{display:inline-flex;align-items:center;padding:.25rem .6rem;border-radius:9999px;border:1px solid rgba(120,120,120,.35);font-size:.7rem;line-height:1;font-weight:500;cursor:pointer;user-select:none} .chip-suggest{background:rgba(59,130,246,.10);} .chip-suggest-gw{background:rgba(16,185,129,.12);} .chip:focus{outline:2px solid currentColor;outline-offset:1px}`}</style>\n      <div\n        className=\"flex items-center justify-between mb-2 select-none border-b border-border pb-1\"\n        style={{ cursor: \"grab\" }}\n        onPointerDown={(e) => {\n          const rect = panelRef.current?.getBoundingClientRect();\n          const w = rect?.width ?? PANEL_W_GUESS;\n          const h = rect?.height ?? PANEL_H_GUESS;\n          startDragRB(e, w, h);\n        }}\n      >\n        <div className=\"flex items-center gap-2\">\n          <div className=\"text-sm text-neutral-300\">Agent Tools</div>\n          {restoredVisible && <RestoredBadge />}\n        </div>\n  <div className=\"flex items-center gap-2\">\n          {/* Export */}\n          <button\n            type=\"button\"\n            onPointerDown={(e) => e.stopPropagation()}\n            onClick={(e) => { e.stopPropagation();\n              const normalized = (uiMessages || []).map(m => ({ role: m.role, content: m.text, createdAt: m.ts }));\n              const firstUser = (uiMessages || []).find(m => m.role === 'user');\n              const trimmed = (firstUser?.text || '').split('\\n')[0].slice(0, 40).trim();\n              const title = trimmed ? `finance-agent-chat-${trimmed.replace(/\\s+/g, '_')}` : 'finance-agent-chat';\n              exportThreadAsJSON(title, normalized);\n            }}\n            className=\"text-xs px-2 py-1 border rounded-md hover:bg-muted\"\n            title=\"Download chat as JSON\"\n          >\n            Export JSON\n          </button>\n          <button\n            type=\"button\"\n            onPointerDown={(e) => e.stopPropagation()}\n            onClick={(e) => { e.stopPropagation();\n              const normalized = (uiMessages || []).map(m => ({ role: m.role, content: m.text, createdAt: m.ts }));\n              const firstUser = (uiMessages || []).find(m => m.role === 'user');\n              const trimmed = (firstUser?.text || '').split('\\n')[0].slice(0, 40).trim();\n              const title = trimmed ? `finance-agent-chat-${trimmed.replace(/\\s+/g, '_')}` : 'finance-agent-chat';\n              exportThreadAsMarkdown(title, normalized);\n            }}\n            className=\"text-xs px-2 py-1 border rounded-md hover:bg-muted\"\n            title=\"Download chat as Markdown\"\n          >\n            Export Markdown\n          </button>\n          {/* Hide any legacy top-bar tool buttons */}\n          {ENABLE_TOPBAR_TOOL_BUTTONS && (\n            <div className=\"hidden\" />\n          )}\n          <button\n            type=\"button\"\n            onPointerDown={(e) => e.stopPropagation()}\n            onClick={(e) => { e.stopPropagation(); setHistoryOpen(v => !v); }}\n            className=\"text-xs px-2 py-1 border rounded-md hover:bg-muted\"\n            title=\"Show recent messages\"\n          >\n            {historyOpen ? 'Hide history' : 'History'}\n          </button>\n          <button\n            type=\"button\"\n            onPointerDown={(e) => e.stopPropagation()}\n            onClick={(e) => { e.stopPropagation(); setRb({ right: MARGIN, bottom: MARGIN }); }}\n            className=\"text-xs px-2 py-1 border rounded-md hover:bg-muted\"\n            title=\"Reset to bottom-right\"\n          >\n            Reset\n          </button>\n          <button\n            type=\"button\"\n            onPointerDown={(e) => e.stopPropagation()}\n            onClick={(e) => { e.stopPropagation(); handleClearHistory(); }}\n            className=\"text-xs px-2 py-1 border rounded-md hover:bg-muted\"\n            title=\"Clear chat history (all tabs)\"\n          >\n            Clear\n          </button>\n          <button\n            type=\"button\"\n            onPointerDown={(e) => e.stopPropagation()}\n            onClick={(e) => { e.stopPropagation(); setShowTools(v => !v); }}\n            aria-expanded={showTools}\n            aria-controls=\"agent-tools-panel\"\n            className=\"text-xs px-2 py-1 border rounded-md hover:bg-muted inline-flex items-center gap-1\"\n            title={showTools ? \"Hide tools\" : \"Show tools\"}\n          >\n            {showTools ? <ChevronUp size={14}/> : <Wrench size={14}/>}\n            {showTools ? 'Hide tools' : 'Agent Tools'}\n          </button>\n      {modelsInfo ? (\n            <button\n              onPointerDown={(e) => e.stopPropagation()}\n              onClick={(e) => { e.stopPropagation(); setShowAdvanced((v: boolean)=>!v); }}\n              className=\"px-2 py-1 rounded-lg bg-neutral-800 text-neutral-200 border border-neutral-700 hover:bg-neutral-700\"\n        title=\"Models\"\n            >\n        {showAdvanced ? 'Hide models' : 'Models'}\n            </button>\n          ) : null}\n          <button\n            onPointerDown={(e) => e.stopPropagation()}\n            onClick={(e) => { e.stopPropagation(); setOpen(false); }}\n            className=\"px-2 py-1 rounded-lg bg-neutral-800 text-neutral-200 border border-neutral-700 hover:bg-neutral-700\"\n            title=\"Collapse (Esc)\"\n          >\n            Collapse\n          </button>\n        </div>\n      </div>\n\n      {showAdvanced && modelsInfo && (\n        <div className=\"mb-2 p-2 rounded-lg border border-neutral-800 bg-neutral-800/40\">\n          <div className=\"flex items-center gap-2\">\n            <select\n              className=\"px-2 py-1 text-sm rounded-md bg-neutral-800 border border-neutral-700 text-neutral-100\"\n              value={selectedModel}\n              onChange={(e) => setSelectedModel(e.target.value)}\n            >\n              <option value=\"\">{`Default - ${modelsInfo.provider}: ${modelsInfo.default}`}</option>\n              {modelsInfo.models?.map((m: any) => (\n                <option key={m.id} value={m.id}>{m.id}</option>\n              ))}\n            </select>\n          </div>\n          <div className=\"text-[11px] mt-1 opacity-60\">\n            Leave blank to use the server default. This selection applies only in this tab.\n          </div>\n        </div>\n      )}\n\n      {/* Agent tools tray (all tools live here; one-click) */}\n      {showTools && (\n        <div id=\"agent-tools-panel\" className=\"px-3 py-2 border-b bg-muted/10\">\n          {/* Tabs */}\n          <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 mb-2\">\n            <button type=\"button\" onClick={(e) => runMonthSummary(e as any)} disabled={busy} className=\"text-xs px-2 py-1 rounded-md border border-neutral-700 bg-neutral-800 hover:bg-neutral-700 disabled:opacity-50\">Month summary</button>\n            <button type=\"button\" onClick={(e) => runFindSubscriptions(e as any)} disabled={busy} className=\"text-xs px-2 py-1 rounded-md border border-neutral-700 bg-neutral-800 hover:bg-neutral-700 disabled:opacity-50\">Find subscriptions</button>\n            <button type=\"button\" onClick={(e) => runTopMerchants(e as any)} disabled={busy} className=\"text-xs px-2 py-1 rounded-md border border-neutral-700 bg-neutral-800 hover:bg-neutral-700 disabled:opacity-50\">Top merchants</button>\n            <button type=\"button\" onClick={(e) => runCashflow(e as any)} disabled={busy} className=\"text-xs px-2 py-1 rounded-md border border-neutral-700 bg-neutral-800 hover:bg-neutral-700 disabled:opacity-50\">Cashflow</button>\n            <button type=\"button\" onClick={(e) => runTrends(e as any)} disabled={busy} className=\"text-xs px-2 py-1 rounded-md border border-neutral-700 bg-neutral-800 hover:bg-neutral-700 disabled:opacity-50\">Trends</button>\n            <button type=\"button\" onClick={(e) => runInsightsSummary(e as any)} disabled={busy} className=\"text-xs px-2 py-1 rounded-md border border-neutral-700 bg-neutral-800 hover:bg-neutral-700 disabled:opacity-50\">Insights: Summary</button>\n            <button type=\"button\" onClick={(e) => runInsightsExpanded(e as any)} disabled={busy} className=\"text-xs px-2 py-1 rounded-md border border-neutral-700 bg-neutral-800 hover:bg-neutral-700 disabled:opacity-50\">Insights: Expanded</button>\n            <button type=\"button\" onClick={(e) => runBudgetCheck(e as any)} disabled={busy} className=\"text-xs px-2 py-1 rounded-md border border-neutral-700 bg-neutral-800 hover:bg-neutral-700 disabled:opacity-50\">Budget check</button>\n            <button type=\"button\" onClick={(e) => runAlerts(e as any)} disabled={busy} className=\"text-xs px-2 py-1 rounded-md border border-neutral-700 bg-neutral-800 hover:bg-neutral-700 disabled:opacity-50\">Alerts</button>\n            {/* Analytics quick buttons */}\n            <button type=\"button\" onClick={(e) => runAnalyticsKpis(e as any)} disabled={busy} className=\"text-xs px-2 py-1 rounded-md border border-neutral-700 bg-neutral-800 hover:bg-neutral-700 disabled:opacity-50\">KPIs</button>\n            <button type=\"button\" onClick={(e) => { if(!busy){ startAguiRun('forecast', 'Forecast next month’s spending.', month); } }} disabled={busy} className=\"text-xs px-2 py-1 rounded-md border border-neutral-700 bg-neutral-800 hover:bg-neutral-700 disabled:opacity-50\">Forecast</button>\n            <button type=\"button\" onClick={(e) => runAnalyticsAnomalies(e as any)} disabled={busy} className=\"text-xs px-2 py-1 rounded-md border border-neutral-700 bg-neutral-800 hover:bg-neutral-700 disabled:opacity-50\">Anomalies</button>\n            <button type=\"button\" onClick={(e) => runAnalyticsRecurring(e as any)} disabled={busy} className=\"text-xs px-2 py-1 rounded-md border border-neutral-700 bg-neutral-800 hover:bg-neutral-700 disabled:opacity-50\">Recurring</button>\n            <button type=\"button\" onClick={(e) => runAnalyticsBudgetSuggest(e as any)} disabled={busy} className=\"text-xs px-2 py-1 rounded-md border border-neutral-700 bg-neutral-800 hover:bg-neutral-700 disabled:opacity-50\">Budget suggest</button>\n            <button type=\"button\" onClick={() => runAnalyticsWhatIf()} disabled={busy} className=\"text-xs px-2 py-1 rounded-md border border-neutral-700 bg-neutral-800 hover:bg-neutral-700 disabled:opacity-50\">What if...</button>\n            {/* Legacy non-NL search removed */}\n            <button\n              type=\"button\"\n              onClick={() => { void handleTransactionsNL(); }}\n              disabled={busy}\n              className=\"text-xs px-2 py-1 rounded-md border border-neutral-700 bg-neutral-800 hover:bg-neutral-700 disabled:opacity-50\"\n              title=\"Search transactions (NL) — Try: “Starbucks this month”, “Delta in Aug 2025”, “transactions > $50 last 90 days”. Pro tips: MTD, YTD, last N days/weeks/months, since YYYY-MM-DD.\"\n            >\n              Search transactions (NL)\n            </button>\n            <button\n              type=\"button\"\n              onClick={async () => {\n                if (busy) return;\n                try {\n                  setBusy(true);\n                  const last = lastNlqRef.current;\n                  if (!last) {\n                    window.alert(\"No previous NL query found. Run a query first.\");\n                    return;\n                  }\n                  const { q, flow, filters } = last;\n                  const { blob, filename } = await txnsQueryCsv(q, {\n                    start: filters?.start,\n                    end: filters?.end,\n                    page_size: Math.max(100, Math.min(1000, filters?.page_size || filters?.limit || 200)),\n                    ...(flow ? { flow } as any : {})\n                  });\n                  saveAs(blob, filename || \"txns_query.csv\");\n                 \n                  appendAssistant(`Exported CSV for last NL query: ${q}`);\n                } catch (err: any) {\n                  appendAssistant(`**CSV export failed:** ${err?.message || String(err)}`);\n                } finally {\n                  setBusy(false);\n                }\n              }}\n              disabled={busy}\n              className=\"text-xs px-2 py-1 rounded-md border border-neutral-700 bg-neutral-800 hover:bg-neutral-700 disabled:opacity-50\"\n              title=\"Download CSV of the last NL transactions query\"\n            >\n              Export CSV (last NL query)\n            </button>\n            {/* Prev/Next paging for last NL list results */}\n            <button\n              type=\"button\"\n              onClick={async () => {\n                if (busy) return;\n                const last = lastNlqRef.current;\n                if (!last) { window.alert(\"No previous NL query found.\"); return; }\n                if ((last.intent || '').toLowerCase() !== 'list') { window.alert(\"Paging applies to list results only.\"); return; }\n                const page = Math.max(1, Number(last.filters?.page || 1) - 1);\n                const page_size = Number(last.filters?.page_size || 50);\n                await runToolWithRephrase(\n                  'transactions.nl_page_prev',\n                  async () => {\n                    const res = await txnsQuery(last.q, {\n                      start: last.filters?.start,\n                      end: last.filters?.end,\n                      page, page_size,\n                      ...(last.flow ? { flow: last.flow as any } : {}),\n                    });\n                    lastNlqRef.current = {\n                      q: last.q,\n                      flow: last.flow,\n                      filters: (res as any)?.filters ?? { ...(last.filters || {}), page, page_size },\n                      intent: (res as any)?.intent,\n                    };\n                    return res as any;\n                  },\n                  (res: any) => formatTxnQueryResult(last.q, res),\n                  (msg, meta) => appendAssistant(msg, { ...meta, ctxMonth: month }),\n                  (on) => setBusy(on)\n                );\n              }}\n              disabled={busy || !lastNlqRef.current || (lastNlqRef.current?.intent || '').toLowerCase() !== 'list' || Number((lastNlqRef.current?.filters || {}).page || 1) <= 1}\n              className=\"text-xs px-2 py-1 rounded-md border border-neutral-700 bg-neutral-800 hover:bg-neutral-700 disabled:opacity-50\"\n              title=\"Previous page of last NL list\"\n            >\n              ◀ Prev page (NL)\n            </button>\n            <button\n              type=\"button\"\n              onClick={async () => {\n                if (busy) return;\n                const last = lastNlqRef.current;\n                if (!last) { window.alert(\"No previous NL query found.\"); return; }\n                if ((last.intent || '').toLowerCase() !== 'list') { window.alert(\"Paging applies to list results only.\"); return; }\n                const page = Math.max(1, Number(last.filters?.page || 1) + 1);\n                const page_size = Number(last.filters?.page_size || 50);\n                await runToolWithRephrase(\n                  'transactions.nl_page_next',\n                  async () => {\n                    const res = await txnsQuery(last.q, {\n                      start: last.filters?.start,\n                      end: last.filters?.end,\n                      page, page_size,\n                      ...(last.flow ? { flow: last.flow as any } : {}),\n                    });\n                    lastNlqRef.current = {\n                      q: last.q,\n                      flow: last.flow,\n                      filters: (res as any)?.filters ?? { ...(last.filters || {}), page, page_size },\n                      intent: (res as any)?.intent,\n                    };\n                    return res as any;\n                  },\n                  (res: any) => formatTxnQueryResult(last.q, res),\n                  (msg, meta) => appendAssistant(msg, { ...meta, ctxMonth: month }),\n                  (on) => setBusy(on)\n                );\n              }}\n              disabled={busy || !lastNlqRef.current || (lastNlqRef.current?.intent || '').toLowerCase() !== 'list'}\n              className=\"text-xs px-2 py-1 rounded-md border border-neutral-700 bg-neutral-800 hover:bg-neutral-700 disabled:opacity-50\"\n              title=\"Next page of last NL list\"\n            >\n              Next page (NL) ▶\n            </button>\n            {/* Selftest button removed */}\n          </div>\n          <div className=\"text-[11px] opacity-60\">Tip: Hold Alt to run without context.</div>\n\n\n          {ENABLE_LEGACY_TOOL_FORM ? (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n              {/* ... existing payload/result form retained behind flag ... */}\n            </div>\n          ) : null}\n        </div>\n      )}\n\n      {/* Collapsible History panel */}\n      {historyOpen && (\n        <div className=\"px-3 py-2 border-b bg-muted/5\">\n          <div className=\"flex items-center justify-between mb-2\">\n            <div className=\"text-xs opacity-70\">This tab's recent messages</div>\n            <button\n              className=\"text-xs px-2 py-1 border rounded-md hover:bg-muted\"\n              onClick={handleClearHistory}\n              title=\"Clear chat history (all tabs)\"\n            >\n              Clear\n            </button>\n          </div>\n          <div className=\"max-h-48 overflow-auto space-y-2 text-sm\">\n            {uiMessages.length === 0 ? (\n              <div className=\"opacity-60 text-xs\">No messages yet.</div>\n            ) : uiMessages.slice(-50).map((m, i) => (\n              <div key={i} className=\"p-2 rounded-md border\">\n                <div className=\"text-[11px] opacity-60 mb-1\">\n                  {m.role.toUpperCase()} · {new Date(m.ts).toLocaleTimeString()}\n                  {m.meta?.model ? ` · ${m.meta.model}` : ''}\n                  {m.meta?.ctxMonth ? ` · month ${m.meta.ctxMonth}` : ''}\n                </div>\n                <div className=\"prose prose-invert max-w-none text-sm\">\n                  {m.text}\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Messages list (scrollable) with day dividers & timestamps */}\n      {aguiRunActive || aguiTools.length ? (\n        <div className={[\"px-3\", aguiRunActive ? \"\" : \"agui-ribbon-fade\"].join(\" \")}> \n          <div className=\"agui-ribbon\">\n            {aguiTools.map(t => {\n              const baseClass = t.status === 'active' ? 'agui-chip-active' : t.status === 'done' ? 'agui-chip-done' : t.status === 'error' ? 'agui-chip-error' : 'agui-chip-pending';\n              return (\n                <span key={t.name} className={baseClass} title={t.status}>\n                  {t.status === 'active' && <span className=\"agui-dot agui-dot-pulse\" />}\n                  {t.status !== 'active' && <span className=\"agui-dot\" />}\n                  {t.name.replace('charts.', 'charts/').replace('analytics.', 'analytics/').replace('agent.', 'agent/')}\n                </span>\n              );\n            })}\n          </div>\n        </div>\n      ) : null}\n      <div className=\"flex-1 overflow-auto chat-scroll\" ref={listRef}>\n        {renderedMessages}\n        {busy && (\n          <div className=\"px-3 py-2\">\n            <RobotThinking size={64} />\n          </div>\n        )}\n        {/* Fallback chip lane when no assistant messages yet */}\n  {IS_TEST && canSaveRule && !uiMessages.some(m => m.role === 'assistant') && (\n          <div className=\"flex flex-wrap gap-2 mt-2 px-3\">\n            <button\n              type=\"button\"\n              aria-label=\"Save Rule…\"\n              className=\"chip ml-auto\"\n              onClick={() => { setSaveRuleScenario(lastWhatIfScenarioRef.current || ''); setShowSaveRuleModal(true); }}\n            >\n              Save Rule…\n            </button>\n          </div>\n        )}\n        <div id=\"chatdock-scroll-anchor\" ref={bottomRef} />\n      </div>\n\n  {/* Undo Snackbar (fixed) stays as-is */}\n      {undoVisible && (\n        <div\n          className={[\n            \"fixed bottom-4 right-4 z-50\",\n            \"card bg-card border border-border rounded-2xl shadow-lg\",\n            \"px-3 py-2 text-sm flex items-center gap-3\",\n            undoClosing ? \"animate-fade-slide-up\" : \"\"\n          ].join(\" \")}\n          role=\"status\"\n          aria-live=\"polite\"\n        >\n          <span className=\"opacity-85\">{undoMsg}</span>\n          <button\n            className=\"px-2 py-1 text-xs rounded-lg border border-border hover:opacity-90\"\n            onClick={() => {\n              if (undoActionRef.current) {\n                undoActionRef.current();\n              } else {\n                // graceful dismiss if no action wired\n                setUndoClosing(true);\n                window.setTimeout(() => setUndoVisible(false), 800);\n              }\n            }}\n          >\n            Undo\n          </button>\n        </div>\n      )}\n\n      <SaveRuleModal\n        open={showSaveRuleModal}\n        onOpenChange={setShowSaveRuleModal}\n        month={month}\n        scenario={saveRuleScenario}\n        defaultCategory={(() => {\n          // Heuristic: attempt to extract category in quotes from scenario text e.g. \"Dining out\"\n          const src = saveRuleScenario || '';\n            const q = src.match(/\\\"([^\\\"]{2,40})\\\"/);\n            if (q) return q[1];\n            // fallback: look for single word after 'cut' or 'reduce'\n            const m = src.match(/(?:cut|reduce)\\s+([A-Za-z][A-Za-z\\s]{2,30})/i);\n            if (m) return m[1].trim();\n            return '';\n        })()}\n      />\n\n\n      {/* Composer - textarea with Enter to send, Shift+Enter newline */}\n      <div className=\"p-3 border-t bg-background sticky bottom-0 z-10 flex items-end gap-2\">\n        <textarea\n          id=\"chat-composer\"\n          ref={composerRef}\n          rows={1}\n          placeholder={composerPlaceholder}\n          className=\"flex-1 resize-none px-3 py-2 rounded-md border bg-background text-sm\"\n          value={input}\n          onChange={(e) => {\n            if (composerPlaceholder !== DEFAULT_PLACEHOLDER) {\n              setComposerPlaceholderUI(DEFAULT_PLACEHOLDER);\n            }\n            setInput(e.target.value);\n          }}\n          onKeyDown={onComposerKeyDown}\n          disabled={busy}\n        />\n        <button\n          className=\"btn hover:bg-muted disabled:opacity-50\"\n          disabled={!input.trim() || busy}\n          onClick={(e) => handleSend(e)}\n          title=\"Send (Enter). Shift+Enter = newline. Hold Alt to omit context.\"\n        >\n          {busy ? '...' : 'Send'}\n        </button>\n      </div>\n    </div>\n  );\n\n  // Render via portal; show bubble when closed, panel when open\n  // Render only the primary instance\n  if (!isPrimary) return null;\n  return createPortal(<>{open ? panelEl : bubbleEl}</>, document.body);\n}\n\n// Helper: format NL transaction query result for chat rendering\n// --- helper to inject a compact table (markdown + inline HTML for buttons)\nfunction tableForListWithExplain(rows: any[]): string {\n  if (!rows?.length) return \"_No matches - try a narrower range or a specific merchant (e.g., `Starbucks last month`)._\";\n  const head = `| Date | Merchant | Category | Amount | Action |\\n|---|---|---|---:|---|`;\n  const body = rows.map((r: any) => {\n    const amt = `$${Math.abs(Number(r.amount || 0)).toFixed(2)}`;\n    const btn = `<button data-explain-id=\"${r.id}\" class=\"px-2 py-1 rounded-md border border-border\">Explain</button>`;\n    return `| ${r.date ?? \"\"} | ${r.merchant ?? \"\"} | ${r.category ?? \"\"} | ${amt} | ${btn} |`;\n  }).join(\"\\n\");\n  return `${head}\\n${body}`;\n}\n\nfunction hintsBlock(hints?: string[]): string {\n  if (!hints?.length) return \"\";\n  const items = hints.map((h) => `- \\`${h}\\``).join(\"\\n\");\n  return `> **Try:**\\n${items}\\n`;\n}\n\nfunction formatTxnQueryResult(q: string, res: TxnQueryResult & { meta?: any }): string {\n  const meta = (res as any)?.meta || {};\n  const f: any = (res as any).filters || {};\n  const windowStr = f.start && f.end ? `\\n- Range: ${f.start} -> ${f.end}` : \"\";\n  const hintStr = hintsBlock(meta?.hints);\n  const metaMessage = typeof meta?.message === 'string' && meta.message.trim().length ? `${meta.message.trim()}\\n\\n` : '';\n  if (res.intent === \"sum\") {\n    return `${metaMessage}**NL Query:** ${q}${windowStr}\\n**Total (abs):** $${res.result.total_abs.toFixed(2)}\\n${hintStr}`;\n  }\n  if (res.intent === \"count\") {\n    return `${metaMessage}**NL Query:** ${q}${windowStr}\\n**Count:** ${res.result.count}\\n${hintStr}`;\n  }\n  if (res.intent === \"top_merchants\") {\n    const lines = res.result.map((r, i) => `${i + 1}. ${r.merchant ?? \"(Unknown)\"} - $${r.spend.toFixed(2)}`).join(\"\\n\");\n    return `${metaMessage}**NL Query:** ${q}${windowStr}\\n**Top merchants:**\\n${lines}\\n${hintStr}`;\n  }\n  if (res.intent === \"top_categories\") {\n    const lines = res.result.map((r, i) => `${i + 1}. ${r.category ?? \"(Uncategorized)\"} - $${r.spend.toFixed(2)}`).join(\"\\n\");\n    return `${metaMessage}**NL Query:** ${q}${windowStr}\\n**Top categories:**\\n${lines}\\n${hintStr}`;\n  }\n  if (res.intent === \"average\") {\n    return `${metaMessage}**NL Query:** ${q}${windowStr}\\n**Average (abs):** $${res.result.average_abs.toFixed(2)}\\n${hintStr}`;\n  }\n  if (res.intent === \"by_day\" || res.intent === \"by_week\" || res.intent === \"by_month\") {\n    const label = res.intent.replace(\"by_\", \"By \");\n    const lines = (res.result as any[]).map((p: any) => `- ${p.bucket}: $${Number(p.spend || 0).toFixed(2)}`).join(\"\\n\");\n    return `${metaMessage}**NL Query:** ${q}${windowStr}\\n**${label}:**\\n${lines}\\n${hintStr}`;\n  }\n  const items = Array.isArray((res as any).result) ? (res as any).result : [];\n  const table = tableForListWithExplain(items);\n  return `${metaMessage}**NL Query:** ${q}${windowStr}\\n${table}\\n\\n_Use \"Export CSV (NL Result)\" in tools to download rows._\\n${hintStr}`;\n}\n\n// Small UI chip to show grounded mode/args (e.g., Forecast horizon)\nexport function ModeChip({ mode, args }: { mode?: string; args?: any }) {\n  if (!mode) return null;\n  const norm = String(mode);\n  const pretty = (() => {\n    if (norm === \"analytics.forecast\") {\n      const h = Math.max(1, Math.min(12, Number(args?.horizon || 3)));\n      return `Analytics | Forecast (${h}m)`;\n    }\n    if (norm === \"analytics.kpis\") return \"Analytics | KPIs\";\n    if (norm === \"analytics.anomalies\") return \"Analytics | Anomalies\";\n    if (norm === \"analytics.recurring\") return \"Analytics | Recurring\";\n    if (norm === \"analytics.subscriptions\") return \"Analytics | Subscriptions\";\n    if (norm === \"analytics.budget_suggest\") return \"Analytics | Budget suggest\";\n    if (norm === \"analytics.whatif\") return \"Analytics | What-if\";\n    if (norm === \"charts.summary\") return \"Charts | Summary\";\n    if (norm === \"charts.flows\") return \"Charts | Flows\";\n    if (norm === \"charts.merchants\") return \"Charts | Merchants\";\n    if (norm === \"charts.categories\") return \"Charts | Categories\";\n    if (norm === \"charts.category\") return \"Charts | Category\";\n    if (norm === \"nl_txns\") return \"Transactions | NL\";\n    if (norm === \"budgets.recommendations\") return \"Budgets | Recommendations\";\n    if (norm === \"budgets.temp\") return \"Budgets | Temp\";\n    if (norm === \"report.link\") return \"Report | Link\";\n    if (norm === \"insights.anomalies\") return \"Insights | Anomalies\";\n    if (norm === \"insights.anomalies.ignore\") return \"Insights | Ignore anomalies\";\n    return norm\n      .replace(\"analytics.\", \"Analytics | \")\n      .replace(\"charts.\", \"Charts | \")\n      .replace(\"insights.\", \"Insights | \")\n      .replace(\"budgets.\", \"Budgets | \")\n      .replace(\"report.\", \"Report | \")\n      .replace(\"_\", \" \");\n  })();\n  return (\n    <span className=\"ml-2 text-xs px-2 py-0.5 rounded bg-neutral-800/70 text-foreground/80 border border-neutral-700\">\n      {pretty}\n    </span>\n  );\n}\n\nexport function ForecastFollowUps({ month, append, setThinking }: { month?: string; append: (msg: string, meta?: any) => void; setThinking: (b: boolean) => void; }) {\n  if (!month) return null;\n  return (\n    <div className=\"mt-2 flex flex-wrap gap-2\">\n      <button\n        className=\"text-xs px-2 py-1 rounded border border-neutral-700 hover:bg-neutral-800\"\n        onClick={() => runAndRephrase(\n          \"analytics.forecast\",\n          async () => analytics.forecast(month, 6, { model: \"auto\", ciLevel: 0.8 }),\n          () => \"Extend forecast to 6 months.\",\n          (msg, meta) => append(msg, meta),\n          setThinking,\n          () => ({})\n        )}\n      >Extend to 6 months</button>\n      <button\n        className=\"text-xs px-2 py-1 rounded border border-neutral-700 hover:bg-neutral-800\"\n        onClick={() => runAndRephrase(\n          \"analytics.anomalies\",\n          async () => analytics.anomalies(month, 6),\n          () => \"Check anomalies for this month.\",\n          (msg, meta) => append(msg, meta),\n          setThinking,\n          () => ({})\n        )}\n      >Check anomalies</button>\n      <button\n        className=\"text-xs px-2 py-1 rounded border border-neutral-700 hover:bg-neutral-800\"\n        onClick={() => runAndRephrase(\n          \"analytics.budget_suggest\",\n          async () => analytics.budgetSuggest(month, 6),\n          () => \"Draft budget suggestions (p75).\",\n          (msg, meta) => append(msg, meta),\n          setThinking,\n          () => ({})\n        )}\n      >Draft budget (p75)</button>\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\DateRangePicker.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\DbRevBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\DevMenuItem.tsx","messages":[{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":15,"column":81,"nodeType":"BlockStatement","messageId":"unexpected","endLine":15,"endColumn":83,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[682,682],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":18,"column":84,"nodeType":"BlockStatement","messageId":"unexpected","endLine":18,"endColumn":86,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[813,813],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useDevUI, isDevUIEnabled, setDevUIEnabled, setDevUIEnabledSoft, useDevUISoftStatus } from \"@/state/useDevUI\";\r\nimport { emitToastSuccess } from \"@/lib/toast-helpers\";\r\nimport { DropdownMenuItem } from \"@/components/ui/dropdown-menu\";\r\nimport { Check, Wrench } from \"lucide-react\";\r\nimport * as React from \"react\";\r\n\r\nexport default function DevMenuItem() {\r\n  const dev = useDevUI();\r\n  const { soft } = useDevUISoftStatus();\r\n\r\n  const onToggle = React.useCallback((e: React.MouseEvent) => {\r\n    const next = !isDevUIEnabled();\r\n    if (e.altKey) {      \r\n      setDevUIEnabledSoft(next);\r\n      try { emitToastSuccess?.(`Dev UI (soft) ${next ? 'on' : 'off'}`); } catch {}\r\n    } else {\r\n      setDevUIEnabled(next);\r\n      try { emitToastSuccess?.(`Dev UI ${next ? 'enabled' : 'disabled'}`); } catch {}\r\n    }\r\n  }, []);\r\n\r\n  return (\r\n    <DropdownMenuItem\r\n      onClick={onToggle}\r\n      className=\"cursor-pointer flex items-center gap-2\"\r\n      data-testid=\"menu-dev-toggle\"\r\n      title=\"Toggle Dev UI (Alt+Click for soft session-only toggle)\"\r\n    >\r\n      <Wrench className=\"h-4 w-4 opacity-70\" />\r\n  <span className=\"flex-1\">{dev ? (soft ? \"Disable Dev UI (soft)\" : \"Disable Dev UI\") : \"Enable Dev UI\"}</span>\r\n      {dev && <Check className=\"h-4 w-4 opacity-80\" aria-hidden=\"true\" />}\r\n    </DropdownMenuItem>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\DevModeSwitch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\EmptyState.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\EnvAvatar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\ErrorBoundary.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[105,108],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[105,108],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[170,173],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[170,173],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[200,203],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[200,203],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[300,303],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[300,303],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":90,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":93,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[474,477],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[474,477],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\n\nexport default class ErrorBoundary extends React.Component<{\n  fallback: (e: any) => React.ReactNode;\n  children?: React.ReactNode;\n}, { err: any }> {\n  constructor(props: any) {\n    super(props);\n    this.state = { err: null };\n  }\n  static getDerivedStateFromError(err: any) {\n    return { err };\n  }\n  componentDidCatch() {\n    // no-op\n  }\n  render() {\n    return this.state.err ? this.props.fallback(this.state.err) : this.props.children as any;\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\ExplainButton.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport { createPortal } from \"react-dom\";\nimport { useExplain } from \"@/hooks/useExplain\";\nimport { Button, pillIconClass } from \"@/components/ui/button\";\n\nexport default function ExplainButton({\n  k, month, withContext = true, className = \"ml-2\",\n}: { k: string; month?: string; withContext?: boolean; className?: string }) {\n  const btnRef = React.useRef<HTMLButtonElement | null>(null);\n  const { open, setOpen, loading, text, explain } = useExplain();\n  const [pos, setPos] = React.useState<{ top: number; left: number }>({ top: 0, left: 0 });\n\n  async function openHelp() {\n    const rect = btnRef.current?.getBoundingClientRect();\n    const width = 340;\n    const padding = 8;\n    setPos({\n      top: ((rect?.bottom ?? 0) + 8),\n      left: Math.max(padding, Math.min((rect?.left ?? 0), (window.innerWidth - width - padding))),\n    });\n    await explain(k, { month, withContext });\n  }\n\n  const popover = open ? createPortal(\n    <div\n      id=\"ui-help-popover\"\n      className=\"fixed z-[9999] w-[340px] rounded-xl border bg-background p-3 shadow-xl animate-in fade-in-0 zoom-in-95\"\n      style={{ top: pos.top, left: pos.left }}\n      role=\"dialog\"\n      aria-label=\"What am I looking at?\"\n    >\n      <div className=\"flex items-center justify-between\">\n        <div className=\"font-medium\">What am I looking at?</div>\n        <button className=\"text-sm text-muted-foreground\" onClick={() => setOpen(false)}>Close</button>\n      </div>\n      <div className=\"mt-2 text-sm whitespace-pre-wrap max-h-[50vh] overflow-auto\">\n        {loading ? \"Loading…\" : text}\n      </div>\n    </div>,\n    document.body\n  ) : null;\n\n  React.useEffect(() => {\n    if (!open) return;\n    const onKey = (e: KeyboardEvent) => { if (e.key === \"Escape\") setOpen(false); };\n    const onClick = (e: MouseEvent) => {\n      const target = e.target as HTMLElement;\n      const pop = document.getElementById(\"ui-help-popover\");\n      if (pop && !pop.contains(target) && btnRef.current && !btnRef.current.contains(target)) {\n        setOpen(false);\n      }\n    };\n    const onReposition = () => {\n      const rect = btnRef.current?.getBoundingClientRect();\n      const width = 340;\n      const padding = 8;\n      setPos({\n        top: ((rect?.bottom ?? 0) + 8),\n        left: Math.max(padding, Math.min((rect?.left ?? 0), (window.innerWidth - width - padding))),\n      });\n    };\n    window.addEventListener(\"keydown\", onKey);\n    window.addEventListener(\"click\", onClick, true);\n    window.addEventListener(\"resize\", onReposition);\n    window.addEventListener(\"scroll\", onReposition, true);\n    return () => {\n      window.removeEventListener(\"keydown\", onKey);\n      window.removeEventListener(\"click\", onClick, true);\n      window.removeEventListener(\"resize\", onReposition);\n      window.removeEventListener(\"scroll\", onReposition, true);\n    };\n  }, [open, setOpen]);\n\n  return (\n    <>\n      <button\n        ref={btnRef}\n        aria-label=\"Explain this\"\n        className={`${pillIconClass} h-5 w-5 text-[11px] ${className}`}\n        onClick={openHelp}\n      >?\n      </button>\n      {popover}\n    </>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\ExplainSignalDrawer.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'GroundedBadge' is defined but never used. Allowed unused vars must match /^_/u.","line":10,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[812,815],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[812,815],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1260,1263],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1260,1263],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from 'react'\nimport { getExplain, type ExplainResponse } from '@/api'\nimport Chip from '@/components/ui/chip'\nimport { Skeleton } from '@/components/ui/skeleton'\nimport { selectTopMerchantCat } from '@/selectors/explain'\nimport * as ReactDOM from 'react-dom'\nimport { buildDeterministicExplain } from '@/lib/explainFallback'\nimport Pill from '@/components/ui/pill'\n\nfunction GroundedBadge() {\n  return (\n    <span className=\"inline-flex items-center gap-1 text-[10px] px-2 py-0.5 rounded-full border border-border bg-accent/10\">\n      <span className=\"w-2 h-2 rounded-full border border-current\" /> grounded\n    </span>\n  )\n}\n\n\nexport default function ExplainSignalDrawer({ txnId, open, onOpenChange, txn }: {\n  txnId: number | null\n  open: boolean\n  onOpenChange: (v: boolean) => void\n  txn?: any\n}) {\n  const [loading, setLoading] = React.useState(false)\n  const [error, setError] = React.useState<string | null>(null)\n  const [data, setData] = React.useState<ExplainResponse | null>(null)\n\n  React.useEffect(() => {\n    if (!open || !txnId) return\n    let ignore = false\n    setLoading(true)\n    setError(null)\n    ;(async () => {\n      try {\n        const res = await getExplain(txnId)\n        if (!ignore) setData(res)\n      } catch (e: any) {\n        if (!ignore) setError(e?.message ?? String(e))\n      } finally {\n        if (!ignore) setLoading(false)\n      }\n    })()\n    return () => { ignore = true }\n  }, [open, txnId])\n\n  const rationale = data?.llm_rationale || data?.rationale || ''\n  const mode = data?.mode || (data?.llm_rationale ? 'llm' : 'deterministic')\n  const top = React.useMemo(() => selectTopMerchantCat(data), [data])\n\n  if (!open) return null;\n  const fallbackHtml = buildDeterministicExplain(txn, data?.evidence, rationale);\n  return ReactDOM.createPortal(\n    <div className=\"fixed inset-0 z-[9900]\" aria-modal role=\"dialog\" data-testid=\"explain-drawer\">\n      <div className=\"absolute inset-0 bg-black/70 backdrop-blur-[2px]\" onClick={() => onOpenChange(false)} />\n      <aside className=\"absolute right-0 top-0 h-full w-full max-w-[460px] bg-[rgb(var(--panel))] text-zinc-100 ring-1 ring-white/10 shadow-2xl border-l border-white/5 z-[1] overflow-y-auto\">\n        <header className=\"sticky top-0 bg-[rgb(var(--panel))]/95 backdrop-blur px-4 py-3 border-b border-white/5\">\n          <div className=\"flex items-center justify-between\">\n            <h2 className=\"text-base font-semibold\">Why this category?</h2>\n            <button data-testid=\"drawer-close\" className=\"text-sm opacity-80 hover:opacity-100\" onClick={() => onOpenChange(false)}>Close</button>\n          </div>\n          <div className=\"mt-2 flex flex-wrap gap-2\">\n            <Pill tone=\"muted\">grounded</Pill>\n            <Pill>{mode === 'llm' ? 'LLM rephrase' : 'Deterministic'}</Pill>\n            {fallbackHtml && <Pill tone=\"muted\">fallback</Pill>}\n          </div>\n        </header>\n        <main className=\"px-4 py-4 prose-invert prose-sm space-y-4\">\n          {loading && (\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center gap-2\">\n                <Skeleton className=\"h-5 w-16 rounded-full\" />\n                <Skeleton className=\"h-5 w-28 rounded-full\" />\n              </div>\n              <Skeleton className=\"h-4 w-[85%]\" />\n              <Skeleton className=\"h-4 w-[70%]\" />\n              <div className=\"border-t border-white/10 pt-3\">\n                <div className=\"space-y-2\">\n                  <Skeleton className=\"h-4 w-24\" />\n                  <div className=\"flex flex-wrap gap-2\">\n                    <Skeleton className=\"h-6 w-40 rounded-2xl\" />\n                    <Skeleton className=\"h-6 w-48 rounded-2xl\" />\n                    <Skeleton className=\"h-6 w-36 rounded-2xl\" />\n                  </div>\n                </div>\n              </div>\n            </div>\n          )}\n          {error && (\n            <div className=\"text-sm text-amber-300/90 bg-amber-500/10 border border-amber-500/30 rounded-xl p-3\">\n              Failed to load: <code>{error}</code>\n            </div>\n          )}\n          {data && !fallbackHtml && (\n            <div className=\"text-sm leading-6 whitespace-pre-wrap\">{rationale}</div>\n          )}\n          {fallbackHtml && (\n            <div className=\"text-sm leading-6\" dangerouslySetInnerHTML={{ __html: fallbackHtml }} />\n          )}\n          {data && (\n            <div className=\"mt-2\">\n              <div className=\"text-xs uppercase tracking-wide mb-1 opacity-70\">Evidence</div>\n              <div className=\"flex flex-wrap gap-1.5\">\n                {data.evidence?.rule_match?.category && (\n                  <Chip tone=\"good\" title={`Rule #${data.evidence.rule_match.id}`}>Rule → {data.evidence.rule_match.category}</Chip>\n                )}\n                {top && (\n                  <Chip tone=\"muted\" title=\"Top historical category\">History → {top.cat || 'Unknown'} • {top.count}</Chip>\n                )}\n                {(() => {\n                  const fb = data.evidence?.feedback?.merchant_feedback?.[0]\n                  if (!fb) return null\n                  const pos = fb.positives || 0\n                  const neg = fb.negatives || 0\n                  return <Chip tone={pos >= neg ? 'good' : 'warn'} title=\"Feedback aggregate\">Feedback {fb.category} • +{pos}/-{neg}</Chip>\n                })()}\n                {data.evidence?.merchant_norm && (\n                  <Chip tone=\"muted\" title=\"Canonical merchant\">Merchant • {data.evidence.merchant_norm}</Chip>\n                )}\n              </div>\n            </div>\n          )}\n        </main>\n      </aside>\n    </div>,\n    document.body\n  )\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\ExportMenu.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1296,1299],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1296,1299],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1369,1372],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1369,1372],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1692,1695],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1692,1695],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1763,1766],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1763,1766],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from \"react\";\nimport { downloadReportExcel, downloadReportPdf } from \"@/lib/api\";\nimport { saveAs } from \"@/utils/download\";\nimport { Download, Check } from \"lucide-react\";\nimport { DropdownMenu, DropdownMenuTrigger, DropdownMenuContent, DropdownMenuItem, DropdownMenuSeparator, DropdownMenuCheckboxItem } from \"@/components/ui/dropdown-menu\";\nimport { Button } from \"@/components/ui/button\";\n// Optional toast helper (if you have one). Otherwise we fallback to alert().\n// import { toastError } from \"@/src/lib/toast-helpers\";\nimport DateRangePicker from \"@/components/DateRangePicker\";\n\ntype Props = { month?: string };\n\nexport default function ExportMenu({ month }: Props) {\n  const [busy, setBusy] = useState<\"excel\" | \"pdf\" | null>(null);\n  const [includeTxns, setIncludeTxns] = useState(true);\n  const [splitAlpha, setSplitAlpha] = useState(false);\n  const [range, setRange] = useState<{ start?: string; end?: string }>({});\n  const rangeActive = !!(range.start && range.end);\n  const rangeLabel = rangeActive ? `${range.start} → ${range.end}` : null;\n\n  async function doExcel() {\n    try {\n      setBusy(\"excel\");\n      const { blob, filename } = await downloadReportExcel(month, includeTxns, { ...range, splitAlpha });\n      saveAs(blob, filename);\n    } catch (err: any) {\n      console.error(\"Excel export failed\", err);\n      (window as any)?.toastError?.(\"Excel export failed\") ?? alert(\"Excel export failed. Check console/logs.\");\n    } finally {\n      setBusy(null);\n    }\n  }\n\n  async function doPdf() {\n    try {\n      setBusy(\"pdf\");\n      const { blob, filename } = await downloadReportPdf(month, range);\n      saveAs(blob, filename);\n    } catch (err: any) {\n      console.error(\"PDF export failed\", err);\n      (window as any)?.toastError?.(\"PDF export failed\") ?? alert(\"PDF export failed. Check console/logs.\");\n    } finally {\n      setBusy(null);\n    }\n  }\n\n\n  return (\n    <div className=\"flex items-center gap-2\">\n      {/* Export dropdown */}\n      <DropdownMenu>\n        <DropdownMenuTrigger asChild>\n          <Button\n            variant=\"pill\"\n            size=\"sm\"\n            disabled={!!busy}\n            className=\"gap-2 px-3.5 h-9\"\n            aria-label={rangeActive ? `Export (range ${rangeLabel})` : \"Export\"}\n          >\n            <Download className=\"h-4 w-4\" />\n            <span>Export</span>\n          </Button>\n        </DropdownMenuTrigger>\n        <DropdownMenuContent align=\"end\" className=\"min-w-[240px]\">\n        <DropdownMenuCheckboxItem\n          checked={includeTxns}\n          onCheckedChange={(v: boolean | \"indeterminate\") => setIncludeTxns(v === true)}\n        >\n          Include transactions\n        </DropdownMenuCheckboxItem>\n        <DropdownMenuCheckboxItem\n          checked={splitAlpha}\n          onCheckedChange={(v: boolean | \"indeterminate\") => setSplitAlpha(v === true)}\n        >\n          Split transactions A–M / N–Z\n        </DropdownMenuCheckboxItem>\n        <DropdownMenuSeparator />\n        <DropdownMenuItem onClick={doExcel} disabled={busy === \"excel\"}>\n          {busy === \"excel\" ? <Check className=\"mr-2 h-4 w-4\" /> : <Download className=\"mr-2 h-4 w-4\" />}\n          Excel (.xlsx)\n        </DropdownMenuItem>\n        <DropdownMenuItem onClick={doPdf} disabled={busy === \"pdf\"}>\n          {busy === \"pdf\" ? <Check className=\"mr-2 h-4 w-4\" /> : <Download className=\"mr-2 h-4 w-4\" />}\n          PDF (.pdf)\n        </DropdownMenuItem>\n        </DropdownMenuContent>\n      </DropdownMenu>\n\n      {/* Range picker popover lives OUTSIDE the dropdown */}\n      <DateRangePicker value={range} onChange={setRange} />\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\FallbackBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\ForecastCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[520,523],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[520,523],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","message":"Definition for rule 'react-hooks/exhaustive-deps' was not found.","line":44,"column":5,"endLine":44,"endColumn":60,"severity":2,"nodeType":null}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { analytics } from \"@/lib/api\";\nimport { useMonth } from \"@/context/MonthContext\";\nimport ForecastChart from \"@/components/ForecastChart\";\nimport ExplainButton from \"@/components/ExplainButton\";\n\ntype ModelOpt = \"auto\" | \"ema\" | \"sarimax\";\ntype CiOpt = 0 | 0.8 | 0.9 | 0.95;\n\nexport default function ForecastCard({ className = \"\" }: { className?: string }) {\n  const { month } = useMonth();\n  const [data, setData] = React.useState<any>(null);\n  const [busy, setBusy] = React.useState(false);\n  const lastAutoRunMonth = React.useRef<string | null>(null);\n\n  // Controls\n  const [model, setModel] = React.useState<ModelOpt>(\"auto\");\n  const [ci, setCi] = React.useState<CiOpt>(0.8);\n  const [horizon, setHorizon] = React.useState(3);\n\n  async function run(overrides?: { model?: ModelOpt; ci?: CiOpt; horizon?: number }) {\n    setBusy(true);\n    try {\n      const m = overrides?.model ?? model;\n      const c = overrides?.ci ?? ci;\n      const h = overrides?.horizon ?? horizon;\n      const res = await analytics.forecast(month, h, {\n        model: m,\n        ciLevel: c,\n      });\n      setData(res);\n    } finally {\n      setBusy(false);\n    }\n  }\n\n  // Auto-run once when a valid month is available and no data yet\n  React.useEffect(() => {\n    if (!month || data || busy) return;\n    if (lastAutoRunMonth.current === month) return;\n    lastAutoRunMonth.current = month;\n    void run();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [month]);\n\n  return (\n    <section\n      data-help-id={month}\n      data-help-key=\"card.forecast\"\n      className={[\n        \"help-spot\",\n        \"rounded-2xl border bg-card/50 shadow-sm p-4 md:p-5\",\n        \"overflow-visible\",\n        className,\n      ].join(\" \")}\n    >\n      {/* Header */}\n      <div className=\"flex items-center justify-between gap-2\">\n        <div className=\"flex items-center gap-2\">\n          <h3 className=\"text-sm font-semibold\">Forecast</h3>\n          {data?.model && (\n            <span className=\"text-[10px] px-2 py-0.5 rounded-full border text-muted-foreground\">\n              Model: {String(data.model).toUpperCase()}\n              {data?.ci_alpha != null ? ` • CI ${((1 - data.ci_alpha) * 100) | 0}%` : \"\"}\n            </span>\n          )}\n        </div>\n        {/* Help for this card */}\n        <ExplainButton k=\"charts.spending_trends\" month={month} />\n      </div>\n\n      {/* Controls */}\n      <div className=\"mt-3 grid grid-cols-2 md:grid-cols-[auto_auto_auto_auto_1fr] items-end gap-2\">\n        <label className=\"text-xs text-muted-foreground grid\">\n          <span className=\"mb-1\">Model</span>\n          <select\n            className=\"border rounded-md px-2 py-1 bg-background\"\n            value={model}\n            onChange={(e) => setModel(e.target.value as ModelOpt)}\n          >\n            <option value=\"auto\">Auto</option>\n            <option value=\"sarimax\">SARIMAX</option>\n            <option value=\"ema\">EMA</option>\n          </select>\n        </label>\n\n        <label className=\"text-xs text-muted-foreground grid\">\n          <span className=\"mb-1\">CI</span>\n          <select\n            className=\"border rounded-md px-2 py-1 bg-background\"\n            value={ci}\n            onChange={(e) => setCi(Number(e.target.value) as CiOpt)}\n          >\n            <option value={0}>Off</option>\n            <option value={0.8}>80%</option>\n            <option value={0.9}>90%</option>\n            <option value={0.95}>95%</option>\n          </select>\n        </label>\n\n        <label className=\"text-xs text-muted-foreground grid\">\n          <span className=\"mb-1\">Horizon</span>\n          <input\n            className=\"border rounded-md px-2 py-1 bg-background w-20\"\n            type=\"number\"\n            min={1}\n            max={12}\n            value={horizon}\n            onChange={(e) => setHorizon(Math.max(1, Math.min(12, Number(e.target.value) || 1)))}\n          />\n        </label>\n\n        <div className=\"self-end\">\n          <Button variant=\"pill-primary\" className=\"h-9 px-4 ml-2\" onClick={() => run()} disabled={busy} aria-busy={busy}>\n            {busy ? \"Running…\" : \"Run\"}\n          </Button>\n          <Button\n            type=\"button\"\n            variant=\"pill-outline\"\n            className=\"ml-2 align-middle text-xs\"\n            onClick={() => {\n              setModel(\"auto\");\n              setCi(0.8);\n              setHorizon(3);\n              setData(null);\n              void run({ model: \"auto\", ci: 0.8, horizon: 3 });\n            }}\n            aria-label=\"Reset forecast options\"\n          >\n            Reset\n          </Button>\n        </div>\n\n        {/* subtle hint only when empty */}\n        {!data && (\n          <div className=\"hidden md:block text-xs text-muted-foreground pl-2 self-center\">\n            Run a forecast for <span className=\"font-medium\">{month}</span>.\n          </div>\n        )}\n      </div>\n\n      {/* Chart / states */}\n      <div className=\"mt-4\">\n        {busy && (\n          <div className=\"h-64 grid place-items-center rounded-lg border bg-muted/20\">\n            <div className=\"text-sm text-muted-foreground\">Calculating forecast…</div>\n          </div>\n        )}\n\n        {!busy && !data && (\n          <div className=\"h-64 grid place-items-center rounded-lg border bg-muted/10\">\n            <div className=\"text-sm text-muted-foreground\">No forecast yet. Choose options and click Run.</div>\n          </div>\n        )}\n\n        {!busy && data && data.ok === false && (\n          <div className=\"h-64 grid place-items-center rounded-lg border bg-muted/10\">\n            <div className=\"text-sm\">\n              {data.reason === \"not_enough_history\"\n                ? \"Not enough history to forecast yet.\"\n                : \"Forecast unavailable.\"}\n            </div>\n          </div>\n        )}\n\n        {!busy && data && data.ok !== false && (\n          <div className=\"rounded-lg border p-2\">\n            <ForecastChart data={data} />\n          </div>\n        )}\n      </div>\n    </section>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\ForecastChart.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":51,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1265,1268],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1265,1268],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1309,1312],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1309,1312],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":84,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2754,2757],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2754,2757],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport {\n  ResponsiveContainer,\n  ComposedChart,\n  Area,\n  Line,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  Legend,\n} from \"recharts\";\n\ntype ForecastItem = {\n  t: number;\n  inflows: number;\n  outflows: number;\n  net: number;\n  net_ci?: [number, number];\n};\n\ntype Props = {\n  data: { forecast?: ForecastItem[]; model?: string; ci_alpha?: number } | null;\n};\n\nfunction fmtUSD(n?: number) {\n  if (n == null || Number.isNaN(n)) return \"—\";\n  return n.toLocaleString(undefined, { style: \"currency\", currency: \"USD\", maximumFractionDigits: 0 });\n}\n\nexport default function ForecastChart({ data }: Props) {\n  const items = data?.forecast ?? [];\n\n  // Palette (match existing charts)\n  const NET = \"#60a5fa\";      // blue-400\n  const INFLOWS = \"#22c55e\";  // green-500\n  const OUTFLOWS = \"#ef4444\"; // red-500\n  const CI_FILL = \"rgba(96,165,250,0.22)\"; // NET with ~22% opacity\n\n  const points = items.map((d) => {\n    const ciLow = d.net_ci ? d.net_ci[0] : null;\n    const ciHigh = d.net_ci ? d.net_ci[1] : null;\n    const ciSpan = d.net_ci ? Math.max(0, (ciHigh ?? 0) - (ciLow ?? 0)) : null;\n    return {\n      x: `M+${d.t}`,\n      inflows: d.inflows,\n      outflows: d.outflows,\n      net: d.net,\n      ciLow,\n      ciSpan,\n    } as any;\n  });\n\n  const hasCI = points.some((p: any) => p.ciLow != null && p.ciSpan != null);\n  const ciLabel = data?.ci_alpha != null ? `Net CI (${Math.round((1 - data.ci_alpha) * 100)}%)` : \"Net CI\";\n\n  const LegendMini: React.FC = () => (\n    <div className=\"text-xs flex items-center gap-4\" style={{ color: \"var(--text-muted)\" }}>\n      <span className=\"flex items-center gap-1\">\n        <span style={{ display: 'inline-block', width: 16, height: 2, background: NET, marginTop: 3 }} /> Net\n      </span>\n      <span className=\"flex items-center gap-1\">\n        <span style={{ display: 'inline-block', width: 16, height: 2, background: INFLOWS, marginTop: 3 }} /> Inflows\n      </span>\n      <span className=\"flex items-center gap-1\">\n        <span style={{ display: 'inline-block', width: 16, height: 2, background: OUTFLOWS, marginTop: 3 }} /> Outflows\n      </span>\n      {hasCI && (\n        <span className=\"flex items-center gap-1\">\n          <span style={{ display: 'inline-block', width: 14, height: 10, background: CI_FILL, border: `1px solid ${NET}55`, borderRadius: 2 }} />\n          {ciLabel}\n        </span>\n      )}\n    </div>\n  );\n\n  return (\n    <div className=\"w-full h-64\">\n      <ResponsiveContainer>\n        <ComposedChart data={points} margin={{ top: 8, right: 16, left: 8, bottom: 8 }}>\n          <CartesianGrid strokeDasharray=\"3 3\" />\n          <XAxis dataKey=\"x\" />\n          <YAxis tickFormatter={(v) => fmtUSD(v)} width={72} />\n          <Tooltip formatter={(val: any, name: string) => [fmtUSD(Number(val)), name]} labelFormatter={(l) => `Horizon ${l}`} />\n          <Legend content={<LegendMini />} />\n\n          {hasCI && (\n            <>\n              <Area dataKey=\"ciLow\" stackId=\"ci\" stroke=\"none\" fill=\"transparent\" isAnimationActive={false} name=\"\" />\n              <Area\n                dataKey=\"ciSpan\"\n                stackId=\"ci\"\n                stroke=\"none\"\n                fill={CI_FILL}\n                isAnimationActive={false}\n                name={ciLabel}\n              />\n            </>\n          )}\n\n          <Line type=\"monotone\" dataKey=\"net\" stroke={NET} strokeWidth={2} dot={{ r: 2 }} name=\"Net\" />\n          <Line type=\"monotone\" dataKey=\"inflows\" stroke={INFLOWS} strokeDasharray=\"4 2\" dot={false} name=\"Inflows\" />\n          <Line type=\"monotone\" dataKey=\"outflows\" stroke={OUTFLOWS} strokeDasharray=\"4 2\" dot={false} name=\"Outflows\" />\n        </ComposedChart>\n      </ResponsiveContainer>\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\HelpBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\HelpExplainListener.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\HelpMode.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'explainApi' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":8,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[681,684],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[681,684],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[826,829],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[826,829],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport { createPortal } from \"react-dom\";\nimport { useExplain } from \"@/hooks/useExplain\";\nimport HelpLayer from \"@/features/help/HelpLayer\";\n\nexport default function HelpMode() {\n  const [on, setOn] = React.useState(false);\n  const explainApi = useExplain();\n  const dialogRef = React.useRef<HTMLDivElement | null>(null);\n  const prevFocusRef = React.useRef<HTMLElement | null>(null);\n\n  React.useEffect(() => {\n    const keyHandler = (e: KeyboardEvent) => { if (e.key === \"?\") setOn(v => !v); };\n    const toggle = () => setOn(v => !v);\n    window.addEventListener(\"keydown\", keyHandler);\n    window.addEventListener(\"help-mode:toggle\", toggle as any);\n    return () => {\n      window.removeEventListener(\"keydown\", keyHandler);\n      window.removeEventListener(\"help-mode:toggle\", toggle as any);\n    };\n  }, []);\n\n  React.useEffect(() => {\n    if (on) {\n      // remember current focus and move focus into the dialog once mounted\n      prevFocusRef.current = (document.activeElement as HTMLElement) || null;\n    } else {\n      // restore focus on close\n      prevFocusRef.current?.focus?.();\n    }\n  }, [on]);\n\n  // Click handling is now provided by AppHelpMode/useHelpMode.\n\n  React.useEffect(() => {\n    if (on) {\n      // move focus inside the help overlay\n      setTimeout(() => dialogRef.current?.focus?.(), 0);\n    }\n  }, [on]);\n\n  if (!on) return null;\n\n  return createPortal(\n    <div className=\"fixed inset-0 z-[60] pointer-events-none\" aria-hidden={false}>\n      <HelpLayer active={on} />\n      <div\n        ref={dialogRef}\n        className=\"pointer-events-auto fixed bottom-4 right-4 rounded-xl border bg-background p-3 shadow-xl z-[9600]\"\n        role=\"dialog\"\n        aria-modal=\"true\"\n        tabIndex={-1}\n      >\n        <div className=\"font-medium mb-1\">Help mode</div>\n        <div className=\"text-sm text-muted-foreground\">Click any highlighted card to see its explanation.</div>\n        <div className=\"mt-2 text-xs\">Press <kbd>?</kbd> to exit.</div>\n      </div>\n    </div>,\n    document.body\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\InfoDot.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\InitialsBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\InsightsAnomaliesCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[967,970],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[967,970],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport Card from \"./Card\";\nimport { getAnomalies, type Anomaly } from \"@/lib/api\";\nimport { useMonth } from \"@/context/MonthContext\";\nimport CardHelpTooltip from \"./CardHelpTooltip\";\nimport { getHelpBaseText } from '@/lib/helpBaseText';\n\nexport default function InsightsAnomaliesCard() {\n  const [loading, setLoading] = React.useState(false);\n  const [data, setData] = React.useState<Anomaly[]>([]);\n  const [month, setMonth] = React.useState<string | null>(null);\n  const [err, setErr] = React.useState<string | null>(null);\n  const { month: selectedMonth } = useMonth();\n\n  React.useEffect(() => {\n    let cancelled = false;\n    (async () => {\n      setLoading(true); setErr(null);\n      try {\n        const res = await getAnomalies({ months: 6, min: 50, threshold: 0.4, max: 6, month: selectedMonth || undefined });\n        if (cancelled) return;\n        setMonth(res.month);\n        setData(res.anomalies ?? []);\n      } catch (e: any) {\n        if (cancelled) return;\n        setErr(e?.message ?? \"Failed to load anomalies\");\n      } finally {\n        if (!cancelled) setLoading(false);\n      }\n    })();\n    return () => { cancelled = true };\n  }, [selectedMonth]);\n\n  return (\n    <div\n      className=\"panel-no-border p-3 md:p-4 help-spot\"\n      data-explain-key=\"cards.insights\"\n      data-help-key=\"anomalies.month\"\n      data-month={month || undefined}\n      data-help-id={month || undefined}\n    >\n      <Card className=\"border-0 bg-transparent shadow-none p-0\">\n      <div className=\"flex items-center justify-between mb-2\">\n  <h3 className=\"text-lg font-semibold flex items-center\">⚠ Unusual this month <CardHelpTooltip cardId=\"cards.insights\" month={month || undefined} ctx={{ data }} baseText={getHelpBaseText('cards.insights', { month: month || undefined })} className=\"ml-2\" /></h3>\n        {month && <span className=\"text-xs opacity-70\">{month}</span>}\n      </div>\n\n      {loading && <div className=\"text-sm opacity-70\">Scanning…</div>}\n      {err && <div className=\"text-sm text-red-500\">{err}</div>}\n\n      {!loading && !err && (\n        data.length ? (\n          <ul className=\"space-y-1\">\n            {data.map((a) => {\n              const pct = Math.round(a.pct_from_median * 100);\n              const badge = a.direction === \"high\" ? \"bg-yellow-500/20\" : \"bg-cyan-500/20\";\n              return (\n                <li key={a.category} className=\"flex items-center justify-between border-t border-border/50 py-2 first:border-t-0\">\n                  <div className=\"flex items-center gap-2\">\n                    <span className={`text-xs px-1.5 py-0.5 rounded ${badge}`}>\n                      {a.direction === \"high\" ? \"High\" : \"Low\"}\n                    </span>\n                    <span className=\"font-medium\">{a.category}</span>\n                  </div>\n                  <div className=\"text-sm opacity-80\">\n                    ${a.current.toFixed(2)} <span className=\"opacity-60\">vs</span> ${a.median.toFixed(2)}\n                    <span className=\"ml-2\">{pct > 0 ? `+${pct}%` : `${pct}%`}</span>\n                  </div>\n                </li>\n              );\n            })}\n          </ul>\n        ) : (\n          <div className=\"text-sm opacity-70\">No unusual categories this month.</div>\n        )\n      )}\n      </Card>\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\InsightsCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[147,150],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[147,150],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[445,448],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[445,448],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react'\nimport Card from './Card'\nimport { t } from '@/lib/i18n'\n\nexport default function InsightsCard({ insights }: { insights: any }) {\n  if (!insights) return null\n  const items = Array.isArray(insights) ? insights : insights.items || []\n  return (\n  <Card title={t('ui.insights.title')} className=\"help-spot\" data-help-key=\"cards.insights_list\" data-help-id=\"list\">\n      <ul className=\"space-y-2\">\n        {items.map((it: any, i: number) => (\n          <li key={i} className=\"p-3 rounded-lg bg-neutral-900 border border-neutral-800\">\n            <div className=\"text-sm opacity-80\">{it.title ?? it.type ?? t('ui.insights.item_fallback')}</div>\n            <div className=\"text-base\">{it.text ?? it.detail ?? JSON.stringify(it)}</div>\n          </li>\n        ))}\n      </ul>\n    </Card>\n  )\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\LearnedBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\LoginForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1018,1021],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1018,1021],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":65,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2289,2292],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2289,2292],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2555,2558],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2555,2558],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from \"react\";\nimport { useAuth } from \"@/state/auth\";\nimport { Button } from \"@/components/ui/button\";\n\nconst LoginForm: React.FC = () => {\n  const { user, login, register, logout } = useAuth();\n  const [email, setEmail] = useState(\"admin@local\");\n  const [password, setPassword] = useState(\"admin\");\n  const [mode, setMode] = useState<\"login\" | \"register\">(\"login\");\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  if (user) {\n    return (\n      <div className=\"flex items-center gap-2 text-sm\">\n        <span className=\"opacity-80\">{user.email}</span>\n  <Button variant=\"pill-outline\" onClick={logout}>Logout</Button>\n      </div>\n    );\n  }\n\n  const submit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(null);\n    setLoading(true);\n    try {\n      const trimmed = email.trim();\n      if (mode === \"login\") await login(trimmed, password);\n      else await register(trimmed, password);\n    } catch (e: any) {\n      // show friendly message for auth failures\n      setError(\"Invalid email or password\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <form onSubmit={submit} className=\"flex items-center gap-2\">\n      <input\n        type=\"email\"\n        className=\"input input-bordered input-xs\"\n        placeholder=\"email\"\n        value={email}\n        onChange={(e) => setEmail(e.target.value)}\n      />\n      <input\n        type=\"password\"\n        className=\"input input-bordered input-xs\"\n        placeholder=\"password\"\n        value={password}\n        onChange={(e) => setPassword(e.target.value)}\n      />\n      <Button variant=\"pill-primary\" type=\"submit\" disabled={loading}>\n        {loading ? (mode === \"login\" ? \"…\" : \"…\") : mode === \"login\" ? \"Login\" : \"Register\"}\n      </Button>\n      <Button type=\"button\" variant=\"pill-outline\" onClick={() => setMode(mode === \"login\" ? \"register\" : \"login\")}>\n        {mode === \"login\" ? \"Register\" : \"Login\"}\n      </Button>\n      {error && <span className=\"text-red-500 text-xs ml-2\">{error}</span>}\n      {/* OAuth buttons */}\n      <div className=\"flex items-center gap-1 ml-2\">\n        <Button type=\"button\" variant=\"pill-outline\"\n          onClick={() => {\n            const base = (import.meta as any)?.env?.VITE_API_BASE || \"\";\n            window.location.href = `${base}/auth/github/start`;\n          }}>\n          GitHub\n        </Button>\n        <Button type=\"button\" variant=\"pill-outline\"\n          onClick={() => {\n            const base = (import.meta as any)?.env?.VITE_API_BASE || \"\";\n            window.location.href = `${base}/auth/google/start`;\n          }}>\n          Google\n        </Button>\n      </div>\n    </form>\n  );\n};\n\nexport default LoginForm;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\MLStatusCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[461,464],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[461,464],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'intervalRef' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":25,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1443,1446],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1443,1446],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":52,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1903,1906],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1903,1906],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":89,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3321,3324],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3321,3324],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from 'react';\nimport { getMlStatus, mlSelftest } from '../lib/api';\nimport { emitToastSuccess, emitToastError } from '@/lib/toast-helpers';\nimport { useCoalescedRefresh } from '@/utils/refreshBus';\nimport CardHelpTooltip from './CardHelpTooltip';\nimport { getHelpBaseText } from '@/lib/helpBaseText';\nimport { t } from '@/lib/i18n';\n\ntype MlStatus = {\n  classes?: string[];\n  feedback_count?: number;\n  updated_at?: string | null;\n  details?: any;\n};\n\nexport default function MLStatusCard() {\n  const ok = emitToastSuccess; const err = emitToastError;\n  const [status, setStatus] = React.useState<MlStatus | null>(null);\n  const [loading, setLoading] = React.useState(true);\n  const [running, setRunning] = React.useState(false);\n  const [lastRunNote, setLastRunNote] = React.useState<string | null>(null);\n\n  // Guards to prevent overlaps and interval duplication\n  const busyRef = React.useRef(false);\n  const intervalRef = React.useRef<number | ReturnType<typeof setInterval> | null>(null);\n  const errorShownRef = React.useRef(false); // don't spam toasts\n\n  async function load(opts?: { skipIfBusy?: boolean }) {\n    if (opts?.skipIfBusy && (busyRef.current || document.hidden)) return;\n    if (busyRef.current) return;\n    busyRef.current = true;\n    try {\n      setLoading(true);\n      const s = await getMlStatus();\n      setStatus(s || null);\n      errorShownRef.current = false; // reset on success\n    } catch (e: any) {\n    if (!errorShownRef.current) {\n  err(t('ui.toast.ml_refresh_failed', { error: e?.message ?? String(e) }));\n        errorShownRef.current = true;\n      }\n    } finally {\n      setLoading(false);\n      busyRef.current = false;\n    }\n  }\n\n  // Coalesced refresh (shared key prevents burst reloads)\n  const scheduleMlStatusRefresh = useCoalescedRefresh('ml-status-refresh', () => load({ skipIfBusy: false }), 500);\n\n  React.useEffect(() => {\n    let id: any = null;\n    const tick = () => load({ skipIfBusy: true });\n    const start = () => { if (id) return; id = setInterval(tick, 6000); tick(); };\n    const stop = () => { if (id) clearInterval(id); id = null; };\n    const onVis = () => (document.hidden ? stop() : start());\n    document.addEventListener('visibilitychange', onVis);\n    onVis(); // start if visible immediately\n    return () => { document.removeEventListener('visibilitychange', onVis); stop(); };\n  }, []);\n\n  async function runSelftest() {\n    try {\n      setRunning(true);\n      setLastRunNote(null);\n      const t0 = performance.now();\n      const res = await mlSelftest();\n      const t1 = performance.now();\n      const ms = Math.round(t1 - t0);\n\n      const bumped = !!res?.mtime_bumped;\n      const label = res?.label_used ?? '—';\n      const txn = res?.used_txn_id ?? '—';\n      const classes = (res?.classes_after ?? res?.classes_before ?? []).join(', ') || '—';\n\n      const msg = bumped\n        ? t('ui.toast.ml_selftest_ok', { ms, label, txn, classes })\n        : t('ui.toast.ml_selftest_no_bump');\n\n      setLastRunNote(\n        bumped\n          ? `mtime: ${res?.mtime_before ?? '∅'} → ${res?.mtime_after ?? '∅'}`\n          : `no mtime bump; reason: ${res?.reason ?? 'unknown'}`\n      );\n  bumped ? ok(msg) : err(msg);\n\n  // Coalesced status refresh to avoid back-to-back polling and selftest\n  scheduleMlStatusRefresh();\n    } catch (e: any) {\n      err(t('ui.toast.ml_selftest_failed', { error: e?.message ?? String(e) }));\n      setLastRunNote('request failed');\n    } finally {\n      setRunning(false);\n      // auto-clear inline note\n      setTimeout(() => setLastRunNote(null), 4500);\n    }\n  }\n\n  const classesText =\n    status?.classes && status.classes.length > 0 ? status.classes.join(', ') : '—';\n\n  return (\n  <div\n    className=\"panel-tight md:p-5 lg:p-6 help-spot\"\n    data-explain-key=\"cards.ml_status\"\n  data-help-key=\"cards.ml_status\"\n  data-help-id=\"ml\"\n  >\n      <div className=\"flex items-center justify-between border-b border-border pb-1\">\n  <h3 className=\"text-sm font-medium flex items-center\">{t('ui.ml.title')} <CardHelpTooltip cardId=\"cards.ml_status\" ctx={{ status }} baseText={getHelpBaseText('cards.ml_status')} className=\"ml-2\" /></h3>\n        <button\n          className=\"text-xs opacity-80 hover:opacity-100\"\n          onClick={scheduleMlStatusRefresh}\n          disabled={loading}\n          title={t('ui.ml.refresh')}\n        >\n          {loading ? t('ui.ml.refreshing') : t('ui.ml.refresh')}\n        </button>\n      </div>\n\n      <div className=\"mt-2 text-sm space-y-1\">\n        <div>\n          <span className=\"opacity-70\">{t('ui.ml.classes')}</span> <span>{classesText}</span>\n        </div>\n        <div>\n          <span className=\"opacity-70\">{t('ui.ml.feedback_count')}</span>{' '}\n          <span>{status?.feedback_count ?? '—'}</span>\n        </div>\n        <div>\n          <span className=\"opacity-70\">{t('ui.ml.updated')}</span>{' '}\n          <span>{status?.updated_at ?? '—'}</span>\n        </div>\n      </div>\n\n      <div className=\"mt-3 flex items-center justify-between\">\n        <button\n          onClick={runSelftest}\n          disabled={running}\n          className=\"px-3 py-2 text-sm rounded-xl border border-border hover:opacity-90 disabled:opacity-50\"\n          title={t('ui.ml.selftest_run_title')}\n        >\n          {running ? t('ui.ml.selftest_running') : t('ui.ml.selftest_run')}\n        </button>\n        {lastRunNote && (\n          <span className=\"text-xs text-muted-foreground\">{lastRunNote}</span>\n        )}\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\Markdown.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\MergeDialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1316,1319],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1316,1319],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1427,1430],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1427,1430],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\r\nimport { mergeTxns, getTxn } from \"@/lib/api\";\r\nimport { Button } from \"@/components/ui/button\";\r\n\r\nexport default function MergeDialog({ open, onOpenChange, ids, onDone }:{ open:boolean; onOpenChange:(v:boolean)=>void; ids:number[]; onDone:(mergedId?:number)=>void }){\r\n  const [note, setNote] = React.useState<string>(\"\");\r\n  const [saving, setSaving] = React.useState(false);\r\n  const [error, setError] = React.useState<string | null>(null);\r\n  const [signOk, setSignOk] = React.useState<boolean>(true);\r\n\r\n  React.useEffect(() => {\r\n    if (!open) return;\r\n    let alive = true;\r\n    (async () => {\r\n      try {\r\n        const amounts: number[] = [];\r\n        for (const id of ids) {\r\n          const t = await getTxn(id);\r\n          amounts.push(Number(t?.amount || 0));\r\n        }\r\n        if (!alive) return;\r\n        const signs = amounts.map(a => (a === 0 ? 0 : (a > 0 ? 1 : -1)));\r\n        const allSame = signs.every(s => s === signs[0]);\r\n        setSignOk(allSame);\r\n      } catch {\r\n        setSignOk(true); // fallback to allow\r\n      }\r\n    })();\r\n    return () => { alive = false; };\r\n  }, [open, ids]);\r\n\r\n  async function onMerge() {\r\n    setSaving(true); setError(null);\r\n    try {\r\n      const res = await mergeTxns(ids, note || undefined);\r\n      const id = (res as any)?.id;\r\n      onDone(typeof id === 'number' ? id : undefined);\r\n      onOpenChange(false);\r\n    } catch (e: any) {\r\n      setError(e?.message || String(e));\r\n    } finally { setSaving(false); }\r\n  }\r\n\r\n  if (!open) return null;\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex\">\r\n      <div className=\"absolute inset-0 bg-black/50\" onClick={()=>onOpenChange(false)} />\r\n      <div className=\"relative z-10 bg-background border border-border rounded-xl m-auto p-4 w-[460px]\">\r\n        <div className=\"text-base font-semibold mb-2\">Merge {ids.length} transactions</div>\r\n        {error && <div className=\"text-sm text-amber-300/90 bg-amber-500/10 border border-amber-500/30 rounded p-2 mb-2\">{error}</div>}\r\n        <label className=\"block text-sm\">\r\n          <span className=\"block opacity-70 mb-1\">Merged note (optional)</span>\r\n          <input className=\"w-full bg-neutral-900 border border-neutral-800 rounded px-2 py-1\" value={note} onChange={(e)=>setNote(e.target.value)} />\r\n        </label>\r\n        <div className=\"mt-3 flex gap-2 justify-end\">\r\n          <Button variant=\"pill-outline\" onClick={()=>onOpenChange(false)} disabled={saving}>Cancel</Button>\r\n          <Button variant=\"pill-primary\" className=\"h-9 px-4\" onClick={onMerge} disabled={saving || ids.length<2 || !signOk}>Merge</Button>\r\n        </div>\r\n        {!signOk && <div className=\"mt-2 text-xs text-amber-300/90\">Select transactions with the same sign (don’t merge income with expense).</div>}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\NetActivityBlip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\Providers.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\QuickChips.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[185,188],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[185,188],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\nimport { Button } from \"@/components/ui/button\";\n\nexport type ChipAction =\n  | { type: \"nl_search\"; query: string }\n  | { type: \"nl_search_filters\"; filters: any }\n  | { type: \"toggle\"; key: \"insightsExpanded\" }\n  | { type: \"nav\"; href: string };\n\nexport type QuickChipItem = { label: string; action: ChipAction };\n\nexport function QuickChips({ items }: { items: QuickChipItem[] }) {\n  if (!items?.length) return null;\n\n  const handleClick = React.useCallback((action: ChipAction) => {\n    const ev = new CustomEvent(\"chip-action\", { detail: action });\n    window.dispatchEvent(ev);\n  }, []);\n\n  return (\n    <div className=\"mt-2 flex flex-wrap gap-2\">\n      {items.map((it) => (\n        <Button\n          key={it.label}\n          type=\"button\"\n          onClick={() => handleClick(it.action)}\n          variant=\"pill-outline\"\n        >\n          {it.label}\n        </Button>\n      ))}\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\ReportRangePanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\RestoredBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\RuleSuggestionsPersistentPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Card' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":51,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1998,2001],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1998,2001],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":120,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4555,4558],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4555,4558],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":130,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4916,4919],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4916,4919],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":162,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":162,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6247,6250],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6247,6250],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":178,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":178,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6921,6924],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6921,6924],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\nimport Card from \"./Card\";\nimport SuggestionIgnoresPanel from \"./SuggestionIgnoresPanel\";\nimport { emitToastSuccess, emitToastError } from \"@/lib/toast-helpers\";\nimport {\n  listPersistedSuggestions,\n  acceptSuggestion,\n  dismissSuggestion,\n  listRuleSuggestionsPersistent,\n  applyRuleSuggestion,\n  ignoreRuleSuggestion,\n} from \"@/lib/api\";\nimport type { RuleSuggestion } from \"@/types/rules\";\nimport CardHelpTooltip from \"./CardHelpTooltip\";\nimport { getHelpBaseText } from '@/lib/helpBaseText';\nimport { Button } from \"@/components/ui/button\";\nimport { t } from '@/lib/i18n';\n\ntype RowModel =\n  | ({ kind: \"persisted\"; id: number; status: \"new\" | \"accepted\" | \"dismissed\" } & Pick<RuleSuggestion, \"merchant\" | \"category\" | \"count\" | \"window_days\">)\n  | ({ kind: \"mined\" } & RuleSuggestion);\n\nexport default function RuleSuggestionsPersistentPanel() {\n  const [loading, setLoading] = React.useState(false);\n  const [rows, setRows] = React.useState<RowModel[]>([]);\n  const [error, setError] = React.useState<string | null>(null);\n  const [showIgnores, setShowIgnores] = React.useState(false);\n\n  const load = React.useCallback(async () => {\n    setLoading(true); setError(null);\n    try {\n      const persisted = await listPersistedSuggestions();\n      if (Array.isArray(persisted) && persisted.length) {\n        const mapped: RowModel[] = persisted\n          .filter(s => s.status === \"new\")\n          .map(s => ({\n            kind: \"persisted\",\n            id: s.id,\n            status: s.status,\n            merchant: s.merchant,\n            category: s.category,\n            count: s.count ?? 0,\n            window_days: s.window_days ?? 60,\n          }));\n        setRows(mapped);\n      } else {\n        const mined = await listRuleSuggestionsPersistent({ windowDays: 60, minCount: 3, maxResults: 25 });\n        const arr = Array.isArray(mined?.suggestions) ? mined.suggestions : [];\n        setRows(arr.map(s => ({ kind: \"mined\", ...s })));\n      }\n    } catch (e: any) {\n  setError(e?.message ?? \"Failed to load suggestions\");\n      setRows([]);\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  React.useEffect(() => { load(); }, [load]);\n\n  return (\n    <section className=\"panel p-4 md:p-5\" data-explain-key=\"cards.rule_suggestions\">\n    <div>\n      <header className=\"flex items-center gap-3 pb-1 mb-3 border-b border-border\">\n        <h3 className=\"text-base font-semibold flex items-center\">\n          {t('ui.rule_suggestions.title')}\n          <CardHelpTooltip cardId=\"cards.rule_suggestions\" ctx={{ rows }} baseText={getHelpBaseText('cards.rule_suggestions')} className=\"ml-2\" />\n        </h3>\n        <div className=\"ml-auto flex items-end gap-2\">\n          <Button\n            variant=\"pill-outline\"\n            size=\"sm\"\n            onClick={() => setShowIgnores(v => !v)}\n            title={t('ui.rule_suggestions.show_ignores')}\n          >\n            {showIgnores ? t('ui.rule_suggestions.hide_ignores') : t('ui.rule_suggestions.show_ignores')}\n          </Button>\n          <Button variant=\"pill-outline\" size=\"sm\" onClick={load} disabled={loading}>\n            {loading ? t('ui.rule_suggestions.refreshing') : t('ui.rule_suggestions.refresh')}\n          </Button>\n        </div>\n      </header>\n\n  {loading && <div className=\"text-sm opacity-70\">{t('ui.rule_suggestions.loading')}</div>}\n      {error && <div className=\"text-sm text-red-500\">{error}</div>}\n\n      {!loading && !error && rows.length === 0 && (\n        <div className=\"px-3 py-6 text-center opacity-70\">{t('ui.rule_suggestions.none')}</div>\n      )}\n\n      <div className=\"space-y-2\">\n        {rows.map((s, i) => (\n          <SuggestionRow key={`${s.kind}-${s.merchant}-${s.category}-${i}`} s={s} onChanged={load} />\n        ))}\n      </div>\n\n      {showIgnores && (\n        <div className=\"mt-6\">\n          <SuggestionIgnoresPanel />\n        </div>\n      )}\n  </div>\n  </section>\n  );\n}\n\nfunction SuggestionRow({ s, onChanged }: { s: RowModel; onChanged: () => void }) {\n  const [busy, setBusy] = React.useState<null | \"apply\" | \"ignore\" | \"accept\" | \"dismiss\">(null);\n\n  const merchant = s.merchant ?? \"—\";\n  const category = s.category ?? \"—\";\n  const meta = <div className=\"text-xs opacity-70\">{t('ui.rule_suggestions.seen_meta', { count: s.count ?? 0, days: s.window_days ?? 60 })}</div>;\n\n  async function doAccept() {\n    if (s.kind !== \"persisted\") return;\n    setBusy(\"accept\");\n    try {\n      await acceptSuggestion(s.id);\n         emitToastSuccess(t('ui.toast.rule_accepted', { merchant, category }));\n    } catch (e:any) {\n  emitToastError(e?.message ?? t('ui.toast.rule_accept_failed'));\n    } finally { setBusy(null); onChanged(); }\n  }\n  async function doDismiss() {\n    if (s.kind !== \"persisted\") return;\n    setBusy(\"dismiss\");\n    try {\n      await dismissSuggestion(s.id);\n         emitToastSuccess(t('ui.toast.rule_dismissed', { merchant, category }));\n    } catch (e:any) {\n  emitToastError(e?.message ?? t('ui.toast.rule_dismiss_failed'));\n    } finally { setBusy(null); onChanged(); }\n  }\n\n  return (\n    <div className=\"flex items-center justify-between border border-border rounded-lg px-3 py-2\">\n      <div>\n        <div className=\"font-medium\">{merchant} → {category}</div>\n        {meta}\n      </div>\n\n      {s.kind === \"persisted\" ? (\n        <div className=\"flex items-center gap-2\">\n          <Button variant=\"pill-success\" size=\"sm\" disabled={busy === \"accept\"} onClick={doAccept}>\n            {busy === \"accept\" ? t('ui.rule_suggestions.accepting') : t('ui.rule_suggestions.accept')}\n          </Button>\n          <Button variant=\"pill-danger\" size=\"sm\" disabled={busy === \"dismiss\"} onClick={doDismiss}>\n            {busy === \"dismiss\" ? t('ui.rule_suggestions.dismissing') : t('ui.rule_suggestions.dismiss')}\n          </Button>\n        </div>\n      ) : (\n        <div className=\"flex items-center gap-2\">\n          <Button\n            variant=\"pill-primary\"\n            size=\"sm\"\n            disabled={busy === \"apply\"}\n            onClick={async () => {\n              setBusy(\"apply\");\n              try {\n                await applyRuleSuggestion({ merchant, category });\n                emitToastSuccess(t('ui.toast.rule_added', { merchant, category }));\n              } catch (e:any) {\n                emitToastError(e?.message ?? t('ui.toast.rule_apply_failed'));\n              } finally { setBusy(null); onChanged(); }\n            }}\n          >\n            {busy === \"apply\" ? t('ui.rule_suggestions.applying') : t('ui.rule_suggestions.apply')}\n          </Button>\n          <Button\n            variant=\"pill-outline\"\n            size=\"sm\"\n            disabled={busy === \"ignore\"}\n            onClick={async () => {\n              setBusy(\"ignore\");\n              try {\n                await ignoreRuleSuggestion({ merchant, category });\n                  emitToastSuccess(t('ui.toast.rule_ignored', { merchant, category }));\n              } catch (e:any) {\n                  emitToastError(e?.message ?? t('ui.toast.rule_ignore_failed'));\n              } finally { setBusy(null); onChanged(); }\n            }}\n          >\n            {busy === \"ignore\" ? t('ui.rule_suggestions.ignoring') : t('ui.rule_suggestions.ignore')}\n          </Button>\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\RuleTesterPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ToastAction' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'InfoDot' is defined but never used. Allowed unused vars must match /^_/u.","line":13,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[871,874],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[871,874],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[909,912],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[909,912],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'result' is assigned a value but never used. Allowed unused elements of array destructuring patterns must match /^_/u.","line":38,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":16},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":97,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":100,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1788,1791],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1788,1791],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'like' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":41,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":41,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'category' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":41,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":41,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'derivedName' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":41,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":41,"endColumn":38},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":62,"column":110,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":113,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2743,2746],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2743,2746],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":71,"column":74,"nodeType":"BlockStatement","messageId":"unexpected","endLine":71,"endColumn":76,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[3107,3107],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":87,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3599,3602],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3599,3602],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":87,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3626,3629],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3626,3629],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":98,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4010,4013],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4010,4013],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":98,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4038,4041],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4038,4041],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":116,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4709,4712],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4709,4712],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":119,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4834,4837],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4834,4837],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":139,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5609,5612],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5609,5612],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":139,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5637,5640],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5637,5640],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":139,"column":83,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":86,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5657,5660],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5657,5660],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":139,"column":105,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":108,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5679,5682],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5679,5682],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":156,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":156,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6456,6459],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6456,6459],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":156,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":156,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6484,6487],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6484,6487],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":158,"column":15,"nodeType":"BlockStatement","messageId":"unexpected","endLine":158,"endColumn":17,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[6613,6613],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":159,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":159,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6631,6634],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6631,6634],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":173,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":173,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7192,7195],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7192,7195],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":174,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":174,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7266,7269],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7266,7269],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":176,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":176,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7377,7380],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7377,7380],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":179,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":179,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7595,7598],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7595,7598],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":181,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7663,7666],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7663,7666],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":183,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":183,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7840,7843],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7840,7843],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":183,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":183,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7868,7871],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7868,7871],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":183,"column":101,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":183,"endColumn":104,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7896,7899],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7896,7899],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":183,"column":134,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":183,"endColumn":137,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7929,7932],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7929,7932],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":183,"column":160,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":183,"endColumn":163,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7955,7958],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7955,7958],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":185,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":185,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8030,8033],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8030,8033],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":189,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":189,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8375,8378],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8375,8378],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":192,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":192,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8613,8616],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8613,8616],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":197,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":197,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9008,9011],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9008,9011],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":290,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":290,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12935,12938],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12935,12938],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":333,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":333,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14748,14751],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14748,14751],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":334,"column":100,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":334,"endColumn":103,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14892,14895],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14892,14895],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":343,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":343,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15253,15256],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15253,15256],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":344,"column":100,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":344,"endColumn":103,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15395,15398],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15395,15398],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":42,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo, useState, useEffect } from 'react';\nimport * as ReactDOM from 'react-dom';\nimport { usePersistentFlag } from '@/lib/usePersistentFlag';\nimport type { SeedDraft } from '@/lib/rulesSeed';\nimport { testRule, saveTrainReclassify, saveRule, type RuleInput } from '@/api';\nimport { ThresholdsSchema } from '@/lib/schemas';\nimport { emitToastSuccess, emitToastError } from '@/lib/toast-helpers';\nimport { t } from '@/lib/i18n';\nimport { consumeRuleDraft, onOpenRuleTester } from '@/state/rulesDraft';\nimport { getGlobalMonth, onGlobalMonthChange } from '@/state/month';\nimport { Tooltip, TooltipContent, TooltipTrigger } from \"@/components/ui/tooltip\";\nimport { ToastAction } from \"@/components/ui/toast\";\nimport { InfoDot } from './InfoDot';\nimport { scrollToId } from \"@/lib/scroll\";\n\ndeclare global {\n  interface Window {\n    __openRuleTester?: (d?: any) => void;\n    __pendingRuleSeed?: any | null;\n  }\n}\n\nexport default function RuleTesterPanel({ onChanged }: { onChanged?: () => void }) {\n  // Legacy useToast removed in favor of unified emit helpers\n  const [form, setForm] = useState<RuleInput>({\n    name: '',\n    enabled: true,\n    when: { description_like: '' },\n    then: { category: '' },\n  });\n  const [open, setOpen] = useState<boolean>(false);\n  const [month, setMonth] = useState<string>(getGlobalMonth() || ''); // \"YYYY-MM\"\n  const [useCurrentMonth, setUseCurrentMonth] = useState<boolean>(true);\n  const [seededMonth, setSeededMonth] = useState<string | undefined>(undefined);\n  const [testing, setTesting] = useState(false);\n  const [saving, setSaving] = useState(false);\n  const [retrainMode, setRetrainMode] = usePersistentFlag('retrainMode', false);\n  const [result, setResult] = useState<null | { matched_count?: number; count?: number; sample: any[] }>(null);\n\n  // Derived values for UX and payloads\n  const { like, category, derivedName, canTest, canSave } = useMemo(() => {\n    const _like = String(form.when?.description_like || '').trim();\n    const _category = String(form.then?.category || '').trim();\n    const _derivedName = (form.name || '').trim() || `${_like || 'Any'} → ${_category || 'Uncategorized'}`;\n    return {\n      like: _like,\n      category: _category,\n      derivedName: _derivedName,\n      canTest: _like.length > 0,\n      canSave: _like.length > 0 && _category.length > 0,\n    };\n  }, [form]);\n\n  // Smooth scroll helper for CTA buttons (charts / unknowns)\n  useEffect(() => {\n    // Establish global open function\n    window.__openRuleTester = (d?: SeedDraft) => {\n      if (d) {\n        setForm(f => ({\n          name: d.name ?? f.name,\n          enabled: true,\n          when: { ...(f.when || {}), description_like: d.when?.merchant || d.when?.description || (d.when as any)?.description_like || '' },\n          then: { ...(f.then || {}), category: d.then?.category || '' },\n        }));\n        if (d.month) setSeededMonth(d.month);\n      }\n      setOpen(true);\n    };\n    // Consume any queued seed that arrived pre-mount\n    if (window.__pendingRuleSeed) {\n      try { window.__openRuleTester?.(window.__pendingRuleSeed); } catch {}\n      window.__pendingRuleSeed = null;\n    }\n    return () => { delete window.__openRuleTester; };\n  }, []);\n\n  useEffect(() => {\n    // Draft system integration (existing logic preserved)\n    const d = consumeRuleDraft();\n    if (d) {\n      setForm(f => ({\n        name: d.name ?? f.name,\n        enabled: d.enabled ?? f.enabled,\n        when: { ...(f.when || {}), ...(d.when || {}) },\n        then: { ...(f.then || {}), ...(d.then || {}) },\n      }));\n      if (!useCurrentMonth && (d as any).month) setMonth((d as any).month);\n    }\n    const offDraft = onOpenRuleTester(() => {\n      const nd = consumeRuleDraft();\n      if (!nd) return;\n      setForm(f => ({\n        name: nd.name ?? f.name,\n        enabled: nd.enabled ?? f.enabled,\n        when: { ...(f.when || {}), ...(nd.when || {}) },\n        then: { ...(f.then || {}), ...(nd.then || {}) },\n      }));\n      if (!useCurrentMonth && (nd as any).month) setMonth((nd as any).month);\n    });\n    const offMonth = onGlobalMonthChange((m) => { if (useCurrentMonth) setMonth(m || ''); });\n    const onSeed = (e: Event) => {\n      const ce = e as CustomEvent<SeedDraft>;\n      const sd = ce?.detail;\n      if (!sd) return;\n      window.__openRuleTester?.(sd);\n    };\n    window.addEventListener('ruleTester:seed', onSeed as EventListener);\n    return () => { offDraft(); offMonth(); window.removeEventListener('ruleTester:seed', onSeed as EventListener); };\n  }, [useCurrentMonth]);\n\n  async function onTest(e: React.FormEvent) {\n    e.preventDefault();\n    setTesting(true);\n    setResult(null);\n    try {\n      const descLike = String((form as any)?.when?.description_like || '').trim();\n      const safeRule = {\n        ...form,\n        when: { ...(form.when || {} as any), description_like: descLike },\n        then: { category: form.then?.category?.trim() || 'Uncategorized' },\n      } as RuleInput;\n      console.debug('TEST payload', {\n        rule: {\n          name: form.name,\n          when: { description_like: descLike },\n          then: { category: form.then?.category || '' },\n        },\n        month: (useCurrentMonth ? getGlobalMonth() : month) || undefined,\n      });\n      const r = await testRule({\n        rule: safeRule,\n        month: (useCurrentMonth ? getGlobalMonth() : month) || undefined,\n      });\n      setResult(r);\n      // Infer match count for UX feedback\n      let matchCount = 0;\n      if (Array.isArray(r)) matchCount = r.length;\n      else if (r && typeof r === 'object') {\n        matchCount = Number((r as any).matched_count ?? (r as any).count ?? (r as any).matches ?? (r as any).total) || 0;\n      }\n      const category = form.then?.category || '—';\n      emitToastSuccess(t('ui.toast.rule_tested_title'), {\n        description: matchCount > 0\n          ? t('ui.toast.rule_tested_matches_description', { count: matchCount, category })\n          : t('ui.toast.rule_tested_no_matches_description', { category }),\n        action: {\n          label: 'View charts',\n          onClick: () => scrollToId('charts-panel')\n        }\n      });\n      // Cache last test result summary in localStorage for quick badges elsewhere\n      try {\n        const key = 'ruleTestCache';\n        const cache = JSON.parse(localStorage.getItem(key) || '{}');\n  const ruleKey = (form.name?.trim()) || JSON.stringify(form.when || {});\n  cache[ruleKey] = { matched_count: (r as any).matched_count ?? (r as any).count ?? 0, tested_at: new Date().toISOString() };\n        localStorage.setItem(key, JSON.stringify(cache));\n      } catch {}\n    } catch (e: any) {\n  emitToastError(t('ui.toast.rule_test_failed_title'), { description: e?.message ?? 'Could not validate the rule. Please check the inputs.' });\n    } finally {\n      setTesting(false);\n    }\n  }\n\n  async function onUnifiedSave() {\n    if (!canSave || saving) return;\n    setSaving(true);\n    try {\n      const like = String(form.when?.description_like || '').trim();\n      const categoryVal = (form.then?.category || '').trim() || 'Uncategorized';\n      const name = (form.name || '').trim() || `${like || 'Any'} → ${categoryVal}`;\n      let thresholds: any = undefined;\n      try { thresholds = ThresholdsSchema.parse((form as any)?.when?.thresholds || {}); } catch { thresholds = undefined; }\n      if (retrainMode) {\n        const res: any = await saveTrainReclassify({\n          rule: { name, when: { description_like: like }, then: { category: categoryVal } },\n          month: seededMonth ?? (useCurrentMonth ? getGlobalMonth() : month),\n        } as any);\n        let reclassCount = 0;\n        const reclass = (res as any)?.reclass;\n        if (Array.isArray(reclass)) reclassCount = reclass.length; else if (reclass && typeof reclass === 'object') {\n          reclassCount = Number((reclass as any).updated ?? (reclass as any).applied ?? (reclass as any).reclassified ?? (reclass as any).count ?? (reclass as any).total) || 0;\n        } else {\n          reclassCount = Number((res as any)?.reclassified ?? 0) || 0;\n        }\n  emitToastSuccess(t('ui.toast.rule_saved_retrained_title'), { description: reclassCount > 0 ? t('ui.toast.rule_saved_retrained_description', { count: reclassCount, category: categoryVal }) : t('ui.toast.rule_saved_retrained_no_changes_description') });\n      } else {\n        const when: Record<string, any> = { description_like: like };\n        if (thresholds && Object.keys(thresholds).length) when.thresholds = thresholds;\n  const selectedMonth = (seededMonth ?? ((useCurrentMonth ? getGlobalMonth() : month) || undefined));\n  const res: any = await saveRule({ rule: { name, when, then: { category: categoryVal } }, month: selectedMonth }, { idempotencyKey: crypto.randomUUID() });\n  emitToastSuccess(t('ui.toast.rule_saved_title'), { description: t('ui.toast.rule_saved_description', { name: res?.display_name || name }) });\n      }\n      window.dispatchEvent(new CustomEvent('rules:refresh'));\n      onChanged?.();\n    } catch (e: any) {\n  emitToastError(t('ui.toast.rule_save_failed_title'), { description: e?.message || 'Unable to save rule' });\n    } finally {\n      setSaving(false);\n    }\n  }\n\n  function clearForm() {\n    setForm({ name: '', enabled: true, when: { description_like: '' }, then: { category: '' } });\n    setUseCurrentMonth(true);\n    setMonth(getGlobalMonth() || '');\n    setResult(null);\n  }\n\n  if (!open) return null;\n  const panel = (\n    <div className=\"fixed inset-0 z-[9999]\" id=\"rule-tester-anchor\">\n      <div className=\"absolute inset-0 bg-black/50\" onClick={() => setOpen(false)} />\n      <div className=\"absolute right-0 top-0 h-full w-full max-w-3xl bg-card border-l border-border shadow-2xl p-4 md:p-5 lg:p-6 overflow-auto\">\n      <div className=\"flex items-center justify-between mb-3\">\n        {/* left: title + tooltip (baseline aligned) */}\n        <div className=\"flex items-baseline gap-2\">\n           <h2 className=\"text-lg font-semibold\">Rule Tester</h2>\n           <Tooltip>\n             <TooltipTrigger asChild>\n               <span className=\"inline-block cursor-help\">ⓘ</span>\n             </TooltipTrigger>\n             <TooltipContent>\n               Prototype a rule, test it for a month, then save/retrain/reclassify.\n             </TooltipContent>\n           </Tooltip>\n         </div>\n        {/* right: tight Month + toggle (one line on md+) */}\n        <div className=\"hidden md:flex items-center gap-2\">\n          <input\n            className={`h-8 px-3 rounded-xl border bg-background text-sm w-24 ${\n              useCurrentMonth ? 'opacity-60 cursor-not-allowed' : ''\n            }`}\n            placeholder=\"YYYY-MM\"\n            value={month}\n            onChange={(e) => setMonth(e.target.value)}\n            title={useCurrentMonth ? 'Following current month — uncheck to edit' : 'Type a month like 2025-08'}\n            disabled={useCurrentMonth}\n          />\n          <label className=\"btn-toggle whitespace-nowrap\">\n             <input\n               type=\"checkbox\"\n               checked={useCurrentMonth}\n               onChange={(e) => {\n                 const next = e.target.checked;\n                 setUseCurrentMonth(next);\n                 if (next) setMonth(getGlobalMonth() || '');\n               }}\n             />\n             Use current month\n           </label>\n         </div>\n       </div>\n\n    {/* Row 1: name / match / category (match made wider).\n          On mobile, month controls appear below as a separate row. */}\n      <form onSubmit={onTest} className=\"form-grid grid-cols-1 md:grid-cols-12\">\n        <div className=\"field col-span-12 md:col-span-3\">\n          <div className=\"field-label\">\n            <span>Rule name</span>\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <span className=\"inline-block cursor-help\">ⓘ</span>\n              </TooltipTrigger>\n              <TooltipContent>Optional label—helps you identify the rule later.</TooltipContent>\n            </Tooltip>\n          </div>\n          <input\n            className=\"field-input\"\n            placeholder=\"e.g., Netflix subs\"\n            value={form.name}\n            onChange={(e) => setForm(f => ({ ...f, name: e.target.value }))}\n            title=\"A label for this rule (optional for testing)\"\n          />\n        </div>\n        <div className=\"field col-span-12 md:col-span-6\">\n          <div className=\"field-label\">\n            <span title=\"Match — description contains\">Match contains</span>\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <span className=\"inline-block cursor-help\">ⓘ</span>\n              </TooltipTrigger>\n              <TooltipContent>Substring match (case-insensitive) against the transaction description.</TooltipContent>\n            </Tooltip>\n          </div>\n          <input\n            className=\"field-input\"\n            placeholder='e.g., \"NETFLIX\" (case-insensitive)'\n            value={(form.when as any).description_like ?? ''}\n            onChange={(e) => setForm(f => ({ ...f, when: { ...(f.when || {}), description_like: e.target.value } }))}\n            title='Substring match against description (SQL ILIKE \"%text%\")'\n          />\n        </div>\n        <div className=\"field col-span-12 md:col-span-3\">\n          <div className=\"field-label\">\n            <span title=\"Then — set category\">Set category</span>\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <span className=\"inline-block cursor-help\">ⓘ</span>\n              </TooltipTrigger>\n              <TooltipContent>Category to assign to all matches.</TooltipContent>\n            </Tooltip>\n          </div>\n          <input\n            className=\"field-input\"\n            placeholder=\"e.g., Subscriptions\"\n            value={form.then?.category ?? ''}\n            onChange={(e) => setForm(f => ({ ...f, then: { ...(f.then || {}), category: e.target.value } }))}\n            title=\"What category to assign to matches\"\n          />\n        </div>\n\n        {/* Thresholds advanced inputs */}\n        <div className=\"field col-span-12 md:col-span-3\">\n          <div className=\"field-label flex items-center gap-2\">\n            <span>Thresholds</span>\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <span className=\"inline-block cursor-help\">ⓘ</span>\n              </TooltipTrigger>\n              <TooltipContent>Optional advanced match thresholds (leave blank to ignore).</TooltipContent>\n            </Tooltip>\n          </div>\n          <div className=\"flex gap-2\">\n            <input\n              className=\"field-input\"\n              placeholder=\"minConfidence\"\n              type=\"number\"\n              step=\"0.01\"\n              min={0}\n              max={1}\n              value={(form as any)?.when?.thresholds?.minConfidence ?? ''}\n              onChange={e => setForm(f => ({ ...f, when: { ...(f.when||{}), thresholds: { ...(f as any).when?.thresholds, minConfidence: e.target.value ? Number(e.target.value) : undefined } } }))}\n              title=\"Minimum confidence (0-1)\"\n            />\n            <input\n              className=\"field-input\"\n              placeholder=\"maxFalsePos\"\n              type=\"number\"\n              step=\"1\"\n              min={0}\n              value={(form as any)?.when?.thresholds?.maxFalsePos ?? ''}\n              onChange={e => setForm(f => ({ ...f, when: { ...(f.when||{}), thresholds: { ...(f as any).when?.thresholds, maxFalsePos: e.target.value ? Number(e.target.value) : undefined } } }))}\n              title=\"Max false positives\"\n            />\n          </div>\n          <div className=\"text-[10px] opacity-60 mt-1\">Leave blank to skip thresholds.</div>\n        </div>\n\n        {/* Row 2 (mobile-only): month + toggle (since top-right is hidden on mobile) */}\n        <div className=\"col-span-12 grid grid-cols-12 gap-3 items-center md:hidden\">\n          <div className=\"field col-span-7 min-w-0\">\n            <div className=\"field-label\"><span>Month</span></div>\n            <input\n              className={`field-input h-8 ${useCurrentMonth ? 'opacity-60 cursor-not-allowed' : ''}`}\n              placeholder=\"YYYY-MM\"\n              value={month}\n              onChange={(e) => setMonth(e.target.value)}\n              disabled={useCurrentMonth}\n            />\n          </div>\n          <label className=\"btn-toggle col-span-5 justify-center\">\n            <input\n              type=\"checkbox\"\n              checked={useCurrentMonth}\n              onChange={(e) => {\n                const next = e.target.checked;\n                setUseCurrentMonth(next);\n                if (next) setMonth(getGlobalMonth() || '');\n              }}\n            />\n            Use current month\n          </label>\n        </div>\n\n    {/* Row 3: Actions (all on one row on md+) */}\n        <div className=\"col-span-12 flex items-center justify-end gap-3 flex-wrap md:flex-nowrap\">\n          <label className=\"flex items-center gap-2 text-xs px-3 py-2 rounded-lg border border-border cursor-pointer select-none bg-card\">\n            <input type=\"checkbox\" className=\"scale-110\" checked={retrainMode} onChange={e=>setRetrainMode(e.target.checked)} />\n            <span className=\"whitespace-nowrap\">Retrain + reclassify</span>\n          </label>\n          <button\n            type=\"submit\"\n            className={`btn hover:bg-accent w-full sm:w-auto shrink-0 ${!canTest ? 'opacity-60 cursor-not-allowed' : ''}`}\n            disabled={testing || !canTest}\n          >\n            {testing ? 'Testing…' : 'Test rule'}\n          </button>\n          <button\n            type=\"button\"\n            onClick={clearForm}\n            className=\"btn hover:bg-muted w-full sm:w-auto shrink-0\"\n            title=\"Clear all fields and reset to current month\"\n          >\n            Clear\n          </button>\n          <button\n            onClick={onUnifiedSave}\n            type=\"button\"\n            className={`btn hover:bg-accent w-full sm:w-auto shrink-0 font-semibold ${!canSave ? 'opacity-60 cursor-not-allowed' : ''}`}\n            disabled={saving || !canSave}\n            title={retrainMode ? 'Save rule, retrain model, and reclassify transactions' : 'Save rule only'}\n          >\n            {saving ? (retrainMode ? 'Saving + Retraining…' : 'Saving…') : (retrainMode ? 'Save + Retrain' : 'Save')}\n          </button>\n        </div>\n      </form>\n\n      <div className=\"text-xs opacity-70 mt-1 space-y-0.5\">\n        <div><strong>Test rule</strong> to preview matches for the selected month.</div>\n        <div><strong>Save</strong> stores the rule. Enable <em>Retrain + reclassify</em> to also retrain the model and reclassify existing transactions.</div>\n      </div>\n      </div>\n    </div>\n  );\n  return ReactDOM.createPortal(panel, document.body);\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\RulesPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ToastAction' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'scrollToId' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'InfoDot' is defined but never used. Allowed unused vars must match /^_/u.","line":10,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Card' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'month' is defined but never used. Allowed unused args must match /^_/u.","line":17,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'like' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":38,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'category' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":38,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'derivedName' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":38,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":38},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1780,1783],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1780,1783],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1862,1865],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1862,1865],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":53,"column":47,"nodeType":"BlockStatement","messageId":"unexpected","endLine":53,"endColumn":49,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[2516,2516],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":107,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":110,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2727,2730],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2727,2730],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2770,2773],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2770,2773],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2792,2795],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2792,2795],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2840,2843],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2840,2843],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":62,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2875,2878],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2875,2878],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":88,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3804,3807],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3804,3807],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":91,"column":114,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":117,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4122,4125],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4122,4125],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":94,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4224,4227],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4224,4227],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":101,"column":124,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":127,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4617,4620],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4617,4620],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":102,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4667,4670],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4667,4670],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getBadgeFor' is defined but never used. Allowed unused vars must match /^_/u.","line":124,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":124,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":151,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6239,6242],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6239,6242],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":166,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":166,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6737,6740],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6737,6740],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":171,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6885,6888],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6885,6888],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":267,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":267,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10993,10996],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10993,10996],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":300,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":300,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12350,12353],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12350,12353],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":301,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":301,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12454,12457],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12454,12457],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":302,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":302,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12542,12545],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12542,12545],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":302,"column":88,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":302,"endColumn":91,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12578,12581],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12578,12581],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":302,"column":138,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":302,"endColumn":141,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12628,12631],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12628,12631],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":303,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":303,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12677,12680],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12677,12680],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":303,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":303,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12692,12695],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12692,12695],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":322,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":322,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14130,14133],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14130,14133],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":323,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":323,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14190,14193],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14190,14193],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":34,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useMemo, useState, useCallback, useRef } from 'react';\nimport { getRules, deleteRule, type Rule, type RuleInput, type RuleListItem, fetchRuleSuggestConfig, type RuleSuggestConfig } from '@/api';\nimport { addRule } from '@/state/rules';\nimport { emitToastSuccess, emitToastError } from '@/lib/toast-helpers';\nimport { t } from '@/lib/i18n';\nimport { ToastAction } from '@/components/ui/toast';\nimport { scrollToId } from '@/lib/scroll';\nimport { setRuleDraft } from '@/state/rulesDraft';\nimport { Tooltip, TooltipContent, TooltipTrigger } from \"@/components/ui/tooltip\";\nimport { InfoDot } from './InfoDot';\nimport Card from './Card';\nimport { setBudget, deleteBudget } from '@/lib/api';\nimport { Button } from '@/components/ui/button';\n\ntype Props = { month?: string; refreshKey?: number };\n\nfunction RulesPanelImpl({ month, refreshKey }: Props) {\n  const ok = emitToastSuccess; const err = emitToastError;\n  // Removed useToast in favor of unified emit helpers\n  const [rules, setRules] = useState<RuleListItem[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [creating, setCreating] = useState(false);\n  const [q, setQ] = useState('');\n  const [page, setPage] = useState(0);\n  const [total, setTotal] = useState(0);\n  const limit = 20;\n  const [cfg, setCfg] = useState<RuleSuggestConfig | null>(null);\n  const [form, setForm] = useState<RuleInput>({\n    name: '',\n    enabled: true,\n    when: { description_like: '' },\n    then: { category: '' },\n  });\n  const [editingId, setEditingId] = useState<string | number | null>(null);\n  const [editAmount, setEditAmount] = useState<string>('');\n\n  // Derived values for UX and validation\n  const { like, category, derivedName, canCreate } = useMemo(() => {\n    const _like = String((form as any)?.when?.description_like || '').trim();\n    const _category = String((form as any)?.then?.category || '').trim();\n    const _derivedName = (form?.name || '').trim() || `${_like || 'Any'} → ${_category || 'Uncategorized'}`;\n    return { like: _like, category: _category, derivedName: _derivedName, canCreate: _like.length > 0 && _category.length > 0 };\n  }, [form]);\n\n  const abortRef = useRef<AbortController | null>(null);\n  const lastReqRef = useRef(0);\n  const COALESCE_MS = 400;\n  const load = useCallback(async () => {\n    const now = Date.now();\n    if (now - lastReqRef.current < COALESCE_MS) return; // coalesce bursts\n    lastReqRef.current = now;\n    if (abortRef.current) {\n      try { abortRef.current.abort(); } catch {}\n    }\n    const ac = new AbortController();\n    abortRef.current = ac;\n    setLoading(true);\n    try {\n      const res = await getRules({ q: q || undefined, limit, offset: page * limit, signal: ac.signal } as any);\n      setRules(Array.isArray((res as any).items) ? (res as any).items : []);\n      setTotal(Number((res as any).total || 0));\n    } catch (e: any) {\n      if (ac.signal.aborted) return; // ignore aborted\n  err(t('ui.toast.rules_list_load_failed'), { description: 'Load failed' });\n    } finally {\n      if (abortRef.current === ac) abortRef.current = null;\n      setLoading(false);\n    }\n  }, [q, page, err]);\n\n  useEffect(() => { load(); }, [load]);\n  useEffect(() => { fetchRuleSuggestConfig().then(setCfg).catch(() => {}); }, []);\n  useEffect(() => {\n    if (typeof refreshKey !== 'undefined') load();\n  }, [refreshKey, load]);\n\n  // Listen for external refresh events (e.g., RuleTesterPanel simple save)\n  useEffect(() => {\n    const onRefresh = () => queueMicrotask(() => load());\n    window.addEventListener('rules:refresh', onRefresh);\n    return () => window.removeEventListener('rules:refresh', onRefresh);\n  }, [load]);\n\n  async function onCreate(e: React.FormEvent) {\n    e.preventDefault();\n    setCreating(true);\n    try {\n      const like = String((form as any)?.when?.description_like || '').trim();\n      const category = (form?.then?.category || '').trim() || 'Uncategorized';\n      const name = (form?.name || '').trim() || `${like || 'Any'} → ${category}`;\n      const res = await addRule({ name, enabled: true, when: { description_like: like }, then: { category } } as any);\n      // Seed Rule Tester with what you just created\n      setRuleDraft({\n        name: (res as any)?.display_name || name,\n        when: { description_like: like },\n        then: { category },\n      });\n      setForm({ name: '', enabled: true, when: { description_like: '' }, then: { category: '' } });\n      load();\n      // Use raw toast so we can attach actions\n  emitToastSuccess(t('ui.toast.rule_created_title'), { description: t('ui.toast.rule_created_description', { name: (res as any)?.display_name || name }) });\n    } catch (e: any) {\n      const message = e?.message || 'Failed to create rule';\n  err(message, { description: 'Create failed' });\n    } finally {\n      setCreating(false);\n    }\n  }\n\n  // Removed Enable/Disable toggle per request.\n\n  async function remove(rule: Rule) {\n    const keep = confirm(`Delete rule “${rule.name}”?`);\n    if (!keep) return;\n    const prev = rules;\n    setRules(rules?.filter(r => r.id !== rule.id) ?? null);\n    try {\n      await deleteRule(rule.id);\n    } catch (e) {\n      setRules(prev ?? null);\n    }\n  }\n\n  function getBadgeFor(rule: Rule) {\n    try {\n      const cache = JSON.parse(localStorage.getItem('ruleTestCache') || '{}');\n      const idMap = JSON.parse(localStorage.getItem('ruleIdNameMap') || '{}');\n      const key = rule.name || idMap[rule.id] || JSON.stringify(rule.when || {});\n      return cache[key] as { matched_count: number; tested_at: string } | undefined;\n    } catch {\n      return undefined;\n    }\n  }\n\n  function parseAmountFromDescription(desc?: string | null) {\n    if (!desc) return undefined;\n    const m = /\\$([\\d.,]+)/.exec(desc);\n    return m ? Number(m[1].replace(/,/g, '')) : undefined;\n  }\n  async function saveBudgetInline(category: string) {\n    const amt = Number(editAmount);\n    if (!Number.isFinite(amt) || amt <= 0) {\n  err(t('ui.toast.budget_inline_invalid_amount'));\n      return;\n    }\n    try {\n      const r = await setBudget(category, amt);\n  ok(t('ui.toast.budget_inline_saved_title', { category, amount: `$${r.budget.amount.toFixed(2)}` }));\n      setEditingId(null);\n      await load();\n    } catch (e: any) {\n  err(e?.message ?? t('ui.toast.budget_inline_save_failed'));\n    }\n  }\n\n  async function removeBudget(category: string) {\n    try {\n      const r = await deleteBudget(category);\n      const { category: cat, amount } = r.deleted;\n      ok(`Deleted budget for ${cat}`);\n      // Provide a simple immediate undo without custom toast action for now\n      try {\n        await setBudget(cat, amount);\n        ok(`Restored ${cat} = $${amount.toFixed(2)}`);\n        await load();\n      } catch (e: any) {\n        err(e?.message ?? t('ui.toast.budget_inline_restore_failed'));\n      }\n      setEditingId(null);\n      await load();\n    } catch (e: any) {\n  err(e?.message ?? t('ui.toast.budget_inline_delete_failed'));\n    }\n  }\n\n  return (\n    <section className=\"panel p-4 md:p-5\">\n    <div>\n      {/* Header grid prevents overlap and keeps a tidy top-right Actions area */}\n      <header className=\"grid grid-cols-[1fr_auto] gap-3 pb-3 mb-3 border-b border-border\">\n        <div className=\"flex items-center gap-2 min-w-0\">\n          <h2 className=\"text-lg font-semibold shrink-0\">Rules</h2>\n          <Tooltip>\n            <TooltipTrigger asChild>\n              <span className=\"inline-block cursor-help\">ⓘ</span>\n            </TooltipTrigger>\n            <TooltipContent>\n              Saved rules are patterns that auto-categorize your transactions.\n              Each rule has a matcher (like “description contains Starbucks”) and a resulting category.\n            </TooltipContent>\n          </Tooltip>\n          <input\n            className=\"field-input w-[220px] sm:w-[280px] lg:w-[320px]\"\n            placeholder=\"Search rules…\"\n            value={q}\n            onChange={(e) => { setPage(0); setQ(e.target.value); }}\n          />\n        </div>\n        <div className=\"flex flex-col items-end gap-2\">\n          <div className=\"flex items-center gap-2\">\n            <Button\n              onClick={load}\n              variant=\"pill-outline\"\n              size=\"sm\"\n              disabled={loading}\n            >\n              {loading ? 'Refreshing…' : 'Refresh'}\n            </Button>\n            <Button\n              type=\"submit\"\n              form=\"rules-create-form\"\n              variant=\"pill-primary\"\n              size=\"sm\"\n              className={!canCreate ? 'opacity-60 cursor-not-allowed' : ''}\n              disabled={creating || !canCreate}\n              title=\"Create rule with the fields below\"\n            >\n              {creating ? 'Creating…' : 'Create'}\n            </Button>\n          </div>\n          {cfg && (\n            <div className=\"text-xs opacity-70\">\n              based on last {cfg.window_days ?? '∞'} days of feedback\n            </div>\n          )}\n          <div className=\"flex items-center gap-2 text-xs whitespace-nowrap\">\n            <Button variant=\"pill-outline\" size=\"sm\" disabled={page===0} onClick={() => setPage(p=>Math.max(0,p-1))}>Prev</Button>\n            <span className=\"opacity-70\">{page*limit+1}–{Math.min((page+1)*limit, total)} of {total}</span>\n            <Button variant=\"pill-outline\" size=\"sm\" disabled={(page+1)*limit>=total} onClick={() => setPage(p=>p+1)}>Next</Button>\n          </div>\n        </div>\n  </header>\n\n      {/* Give the form an id so the header button can submit it */}\n      <form id=\"rules-create-form\" onSubmit={onCreate} className=\"form-grid grid-cols-1 md:grid-cols-12\">\n        <div className=\"field col-span-3\">\n          <div className=\"field-label\">\n            <span className=\"label-nowrap\" title=\"Rule name\">Rule name</span>\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <span className=\"inline-block cursor-help flex-none\">ⓘ</span>\n              </TooltipTrigger>\n              <TooltipContent>Short, descriptive label for this rule.</TooltipContent>\n            </Tooltip>\n          </div>\n          <input\n            className=\"field-input\"\n            placeholder=\"e.g., Coffee shops\"\n            value={form.name}\n            onChange={(e) => setForm(f => ({ ...f, name: e.target.value }))}\n            title=\"Short, descriptive name for the rule\"\n          />\n        </div>\n        <div className=\"field col-span-5\">\n          <div className=\"field-label\">\n            <span title=\"Match — description contains\">Match contains</span>\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <span className=\"inline-block cursor-help flex-none\">ⓘ</span>\n              </TooltipTrigger>\n              <TooltipContent>Substring match (case-insensitive) against the transaction description.</TooltipContent>\n            </Tooltip>\n          </div>\n          <input\n            className=\"field-input\"\n            placeholder='e.g., \"STARBUCKS\" (case-insensitive)'\n            value={(form.when as any).description_like ?? ''}\n            onChange={(e) => setForm(f => ({ ...f, when: { ...(f.when || {}), description_like: e.target.value } }))}\n            title='Substring match against description (SQL ILIKE \"%text%\")'\n          />\n        </div>\n        <div className=\"field col-span-3\">\n          <div className=\"field-label\">\n            <span title=\"Then — set category\">Set category</span>\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <span className=\"inline-block cursor-help flex-none\">ⓘ</span>\n              </TooltipTrigger>\n              <TooltipContent>Category assigned to all matching transactions.</TooltipContent>\n            </Tooltip>\n          </div>\n          <input\n            className=\"field-input\"\n            placeholder=\"e.g., Coffee\"\n            value={form.then?.category ?? ''}\n            onChange={(e) => setForm(f => ({ ...f, then: { ...(f.then || {}), category: e.target.value } }))}\n            title=\"The category assigned to all matches\"\n          />\n        </div>\n  {/* Mobile actions handled in header now */}\n      </form>\n\n      {!rules?.length && (\n        <p className=\"text-sm opacity-80\">No rules yet. Create your first rule above.</p>\n      )}\n\n      {!!rules?.length && (\n  <div className=\"space-y-3\">\n          {rules.map(rule => {\n            const isBudget = ((rule as any).kind === 'budget' || String(rule.id).startsWith('budget:'));\n            const category = (rule as any).category as string | undefined;\n            const amountFromDesc = typeof (rule as any).amount === 'number' ? (rule as any).amount : parseAmountFromDescription((rule as any).description);\n            const thresholds: any = (rule as any)?.when?.thresholds;\n            const hasTh = thresholds && typeof thresholds === 'object' && Object.keys(thresholds).length > 0;\n            const thBadge = hasTh ? `min ${thresholds.minConfidence ?? '-'}${thresholds.budgetPercent != null ? \", \"+thresholds.budgetPercent+\"%\" : ''}${thresholds.limit != null ? \", ≤ \"+thresholds.limit : ''}` : null;\n            return (\n              <div key={rule.id} className=\"panel-tight md:p-5 lg:p-6 flex items-center justify-between\">\n                <div className=\"min-w-0\">\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"font-medium truncate\">{rule.display_name}</span>\n                    {isBudget && (\n                      <span className=\"text-[10px] px-1.5 py-0.5 rounded bg-amber-500/15 text-amber-400\">Budget</span>\n                    )}\n                    <span className={`text-xs px-2 py-0.5 rounded-full ${(rule.active ?? true) ? 'bg-emerald-600/10 text-emerald-600' : 'bg-zinc-600/10 text-zinc-500'}`}>\n                      {(rule.active ?? true) ? 'Enabled' : 'Disabled'}\n                    </span>\n                    {thBadge && (\n                      <span className=\"text-[10px] px-2 py-0.5 rounded-full bg-slate-800/60 border border-slate-700\">Thresholds: {thBadge}</span>\n                    )}\n                  </div>\n                  <div className=\"text-xs opacity-80 truncate\">\n                    {((rule as any).description) ? (\n                      <span>{(rule as any).description}</span>\n                    ) : (\n                      rule.category ? <span>category: {rule.category}</span> : null\n                    )}\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-2 shrink-0\">\n                  {isBudget && category ? (\n                    editingId === rule.id ? (\n                      <div className=\"flex items-center gap-2\">\n                        <input\n                          type=\"number\"\n                          min={0.01}\n                          step=\"0.01\"\n                          value={editAmount}\n                          onChange={(e) => setEditAmount(e.target.value)}\n                          className=\"w-28 rounded-md border border-border bg-card px-2 py-1 text-sm\"\n                        />\n                        <Button variant=\"pill-success\" size=\"sm\" onClick={() => saveBudgetInline(category)}>Save</Button>\n                        <Button variant=\"pill-outline\" size=\"sm\" onClick={() => setEditingId(null)}>Cancel</Button>\n                      </div>\n                    ) : (\n                      <div className=\"flex items-center gap-2\">\n                        <span className=\"text-sm opacity-80\">Cap:&nbsp;{typeof amountFromDesc === 'number' ? `$${amountFromDesc.toFixed(2)}` : '—'}</span>\n                        <Button\n                          variant=\"pill-outline\"\n                          size=\"sm\"\n                          onClick={() => {\n                            setEditingId(rule.id);\n                            setEditAmount(typeof amountFromDesc === 'number' ? String(amountFromDesc.toFixed(2)) : '');\n                          }}\n                          title=\"Edit budget cap\"\n                        >\n                          Edit\n                        </Button>\n                        <Button variant=\"pill-danger\" size=\"sm\" onClick={() => removeBudget(category)} title=\"Delete budget\">\n                          Clear\n                        </Button>\n                      </div>\n                    )\n                  ) : (\n                    <Button variant=\"pill-danger\" size=\"sm\" onClick={() => remove({ id: rule.id, name: rule.display_name, enabled: rule.active ?? true, when: {}, then: { category: rule.category } })}>\n                      Delete\n                    </Button>\n                  )}\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      )}\n  </div>\n  </section>\n  );\n}\n\nexport default React.memo<Props>(RulesPanelImpl);\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\SaveRuleModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1470,1473],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1470,1473],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2592,2595],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2592,2595],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from 'react'\r\nimport { ThresholdsSchema } from '@/lib/schemas'\r\nimport { saveRule } from '@/lib/api'\r\nimport { emitToastSuccess, emitToastError } from '@/lib/toast-helpers'\r\nimport { t } from '@/lib/i18n';\r\nimport { Button } from '@/components/ui/button'\r\nimport { Label } from '@/components/ui/label'\r\n\r\ntype Props = {\r\n  open: boolean\r\n  onOpenChange: (v: boolean) => void\r\n  month?: string\r\n  scenario?: string\r\n  defaultCategory?: string\r\n}\r\n\r\nexport default function SaveRuleModal({ open, onOpenChange, month, scenario, defaultCategory }: Props) {\r\n  const [name, setName] = React.useState('Auto: New rule')\r\n  const [category, setCategory] = React.useState('')\r\n  const [minConfidence, setMinConfidence] = React.useState<number>(0.66)\r\n  const [budgetPercent, setBudgetPercent] = React.useState<number | ''>('')\r\n  const [limit, setLimit] = React.useState<number | ''>('')\r\n  const [busy, setBusy] = React.useState(false)\r\n  const [errors, setErrors] = React.useState<{minConf?: string; budgetPct?: string; limit?: string}>({})\r\n\r\n  React.useEffect(() => {\r\n    if (!open) return;\r\n    setName(scenario ? `Auto: ${scenario}`.slice(0, 64) : 'Auto: New rule');\r\n    setCategory(defaultCategory || '');\r\n    setMinConfidence(0.66);\r\n    setBudgetPercent('');\r\n    setLimit('');\r\n  }, [open, scenario, defaultCategory]);\r\n\r\n  async function onSubmit(e: React.FormEvent) {\r\n    e.preventDefault()\r\n    try {\r\n      setBusy(true)\r\n      const nextErr: any = {}\r\n      if (minConfidence < 0 || minConfidence > 1) nextErr.minConf = 'Min confidence must be between 0 and 1'\r\n      if (budgetPercent !== '' && (Number(budgetPercent) < 0 || Number(budgetPercent) > 100)) nextErr.budgetPct = 'Budget % must be 0–100'\r\n      if (limit !== '' && Number(limit) < 0) nextErr.limit = 'Limit must be ≥ 0'\r\n      setErrors(nextErr)\r\n      if (Object.keys(nextErr).length) throw new Error('Please fix validation errors')\r\n      const thresholds = ThresholdsSchema.parse({\r\n        minConfidence,\r\n        budgetPercent: budgetPercent === '' ? undefined : Number(budgetPercent),\r\n        limit: limit === '' ? undefined : Number(limit)\r\n      })\r\n      const res = await saveRule({\r\n        rule: {\r\n          name,\r\n          when: { ...(scenario ? { scenario } : {}), thresholds, ...(category ? { category } : {}) },\r\n          then: { ...(category ? { category } : {}) }\r\n        },\r\n        month\r\n      }, { idempotencyKey: crypto.randomUUID() })\r\n  emitToastSuccess(t('ui.toast.save_rule_modal_saved_title', { name: res.display_name }))\r\n      onOpenChange(false)\r\n    } catch (err: any) {\r\n  emitToastError(err?.message ?? t('ui.toast.save_rule_modal_save_failed_title'))\r\n    } finally {\r\n      setBusy(false)\r\n    }\r\n  }\r\n\r\n  if (!open) return null\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/70\">\r\n      <div className=\"bg-neutral-900 border border-neutral-800 rounded-md p-5 w-full max-w-md shadow-xl\">\r\n        <h2 className=\"text-lg font-semibold mb-4\">Save as Rule</h2>\r\n        <form onSubmit={onSubmit} className=\"space-y-4\">\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"sr-name\">Rule Name</Label>\r\n            <input id=\"sr-name\" className=\"w-full bg-neutral-800 rounded px-2 py-1\" value={name} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setName(e.target.value)} maxLength={64} />\r\n          </div>\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"sr-category\">Category (optional)</Label>\r\n            <input id=\"sr-category\" className=\"w-full bg-neutral-800 rounded px-2 py-1\" placeholder=\"Groceries\" value={category} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setCategory(e.target.value)} />\r\n          </div>\r\n          <div className=\"grid grid-cols-3 gap-3\">\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"sr-minconf\">Min Confidence</Label>\r\n              <input id=\"sr-minconf\" className=\"w-full bg-neutral-800 rounded px-2 py-1\" type=\"number\" step=\"0.01\" min={0} max={1} value={minConfidence} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setMinConfidence(Number(e.target.value))} aria-invalid={!!errors.minConf} aria-describedby=\"sr-minconf-err\" />\r\n              {errors.minConf && <p id=\"sr-minconf-err\" className=\"text-xs text-red-400\">{errors.minConf}</p>}\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"sr-budgetpct\">Budget %</Label>\r\n              <input id=\"sr-budgetpct\" className=\"w-full bg-neutral-800 rounded px-2 py-1\" type=\"number\" step=\"1\" min={0} max={100} placeholder=\"e.g., 25\" value={budgetPercent} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setBudgetPercent(e.target.value === '' ? '' : Number(e.target.value))} aria-invalid={!!errors.budgetPct} aria-describedby=\"sr-budgetpct-err\" />\r\n              {errors.budgetPct && <p id=\"sr-budgetpct-err\" className=\"text-xs text-red-400\">{errors.budgetPct}</p>}\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"sr-limit\">Limit</Label>\r\n              <input id=\"sr-limit\" className=\"w-full bg-neutral-800 rounded px-2 py-1\" type=\"number\" step=\"0.01\" min={0} placeholder=\"e.g., 200\" value={limit} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setLimit(e.target.value === '' ? '' : Number(e.target.value))} aria-invalid={!!errors.limit} aria-describedby=\"sr-limit-err\" />\r\n              {errors.limit && <p id=\"sr-limit-err\" className=\"text-xs text-red-400\">{errors.limit}</p>}\r\n            </div>\r\n          </div>\r\n          <div className=\"flex justify-end gap-2 pt-2\">\r\n            <Button type=\"button\" variant=\"pill-outline\" onClick={() => onOpenChange(false)} disabled={busy}>Cancel</Button>\r\n            <Button type=\"submit\" disabled={busy}>{busy ? 'Saving...' : 'Save Rule'}</Button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\SplitDialog.tsx","messages":[{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":18,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":18,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[806,806],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1647,1650],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1647,1650],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\r\nimport { getTxn, splitTxn } from \"@/lib/api\";\r\nimport { Button } from \"@/components/ui/button\";\r\n\r\ntype Part = { amount: string; category?: string; note?: string };\r\n\r\nexport default function SplitDialog({ open, onOpenChange, txnId, onDone }:{ open:boolean; onOpenChange:(v:boolean)=>void; txnId:number; onDone:()=>void }){\r\n  const [orig, setOrig] = React.useState<number>(0);\r\n  const [parts, setParts] = React.useState<Part[]>([{ amount: \"\" }]);\r\n  const [error, setError] = React.useState<string | null>(null);\r\n  const [saving, setSaving] = React.useState(false);\r\n\r\n  React.useEffect(() => {\r\n    if (!open) return;\r\n    let alive = true;\r\n    (async () => {\r\n      try { const t = await getTxn(txnId); if (!alive) return; setOrig(Number(t?.amount || 0)); }\r\n      catch {}\r\n    })();\r\n    return () => { alive = false; };\r\n  }, [open, txnId]);\r\n\r\n  function addPart() { setParts((p) => [...p, { amount: \"\" }]); }\r\n  function removePart(i: number) { setParts((p) => p.filter((_, idx) => idx !== i)); }\r\n\r\n  function total(): number { return parts.reduce((s, p) => s + (parseFloat(p.amount) || 0), 0); }\r\n\r\n  async function onSave() {\r\n    setError(null);\r\n    const t = total();\r\n    if (!Number.isFinite(t)) { setError(\"Invalid amounts\"); return; }\r\n    // strict within 0.01 tolerance\r\n    if (Math.abs(t - orig) > 0.01) { setError(\"Parts must sum to the original amount\"); return; }\r\n    setSaving(true);\r\n    try {\r\n      await splitTxn(txnId, parts.map(p => ({ amount: p.amount, category: p.category || undefined, note: p.note || undefined })));\r\n      onDone();\r\n      onOpenChange(false);\r\n    } catch (e: any) {\r\n      setError(e?.message || String(e));\r\n    } finally { setSaving(false); }\r\n  }\r\n\r\n  if (!open) return null;\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex\">\r\n      <div className=\"absolute inset-0 bg-black/50\" onClick={()=>onOpenChange(false)} />\r\n      <div className=\"relative z-10 bg-background border border-border rounded-xl m-auto p-4 w-[520px]\">\r\n        <div className=\"text-base font-semibold mb-2\">Split transaction #{txnId}</div>\r\n        <div className=\"text-xs opacity-70 mb-2\">Original amount: {orig.toLocaleString(undefined, { style:'currency', currency:'USD' })}</div>\r\n        {error && <div className=\"text-sm text-amber-300/90 bg-amber-500/10 border border-amber-500/30 rounded p-2 mb-2\">{error}</div>}\r\n        <div className=\"space-y-2\">\r\n          {parts.map((p, i) => (\r\n            <div key={i} className=\"grid grid-cols-6 gap-2 items-center\">\r\n              <input placeholder=\"Amount\" className=\"col-span-2 bg-neutral-900 border border-neutral-800 rounded px-2 py-1\"\r\n                type=\"number\" step=\"0.01\" value={p.amount} onChange={(e)=>setParts(ps=>ps.map((pp,idx)=> idx===i?{...pp, amount:e.target.value}:pp))} />\r\n              <input placeholder=\"Category\" className=\"col-span-2 bg-neutral-900 border border-neutral-800 rounded px-2 py-1\"\r\n                value={p.category || ''} onChange={(e)=>setParts(ps=>ps.map((pp,idx)=> idx===i?{...pp, category:e.target.value}:pp))} />\r\n              <input placeholder=\"Note\" className=\"col-span-2 bg-neutral-900 border border-neutral-800 rounded px-2 py-1\"\r\n                value={p.note || ''} onChange={(e)=>setParts(ps=>ps.map((pp,idx)=> idx===i?{...pp, note:e.target.value}:pp))} />\r\n              <div className=\"col-span-6 text-right\">\r\n                <Button variant=\"pill-ghost\" className=\"text-xs h-7 px-2\" onClick={()=>removePart(i)} disabled={parts.length<=1}>Remove</Button>\r\n              </div>\r\n            </div>\r\n          ))}\r\n          <div className=\"flex items-center justify-between text-sm opacity-80\">\r\n            <Button variant=\"pill-outline\" className=\"h-8 px-3 text-xs\" onClick={addPart}>Add part</Button>\r\n            <div>Total: {total().toLocaleString(undefined, { style:'currency', currency:'USD' })}</div>\r\n          </div>\r\n        </div>\r\n        <div className=\"mt-3 flex gap-2 justify-end\">\r\n          <Button variant=\"pill-outline\" onClick={()=>onOpenChange(false)} disabled={saving}>Cancel</Button>\r\n          <Button variant=\"pill-primary\" className=\"h-9 px-4\" onClick={onSave} disabled={saving}>Save</Button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\SuggestionIgnoresPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[779,782],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[779,782],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2676,2679],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2676,2679],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport Card from './Card';\nimport { listSuggestionIgnores, removeSuggestionIgnore } from '@/lib/api';\nimport { emitToastSuccess, emitToastError } from '@/lib/toast-helpers';\nimport { t } from '@/lib/i18n';\nimport { Skeleton } from '@/components/ui/skeleton';\n\nexport default function SuggestionIgnoresPanel() {\n  const [rows, setRows] = React.useState<Array<{ merchant: string; category: string }>>([]);\n  const [loading, setLoading] = React.useState(false);\n  const [error, setError] = React.useState<string | null>(null);\n\n  const load = React.useCallback(async () => {\n    setLoading(true); setError(null);\n    try {\n      const res = await listSuggestionIgnores(true);\n      setRows(Array.isArray(res?.ignores) ? res.ignores : []);\n    } catch (e: any) {\n      setError(e?.message ?? 'Failed to load ignores');\n    } finally { setLoading(false); }\n  }, []);\n\n  React.useEffect(() => { load(); }, [load]);\n\n  return (\n    <Card>\n      <header className=\"flex items-center gap-3 pb-1 mb-3 border-b border-border\">\n        <h3 className=\"text-base font-semibold\">Ignored Pairs</h3>\n        <div className=\"ml-auto\">\n          <button className=\"btn btn-ghost btn-sm\" onClick={load} disabled={loading}>\n            {loading ? 'Refreshing…' : 'Refresh'}\n          </button>\n        </div>\n      </header>\n\n      {error && <div className=\"text-sm text-red-500\">{error}</div>}\n      {loading && (\n        <div className=\"space-y-2\">\n          {[0,1,2].map(i => (\n            <div key={i} className=\"flex items-center justify-between border border-border rounded-lg px-3 py-2\">\n              <Skeleton className=\"h-4 w-48\" />\n              <Skeleton className=\"h-7 w-20\" />\n            </div>\n          ))}\n        </div>\n      )}\n      {!error && rows.length === 0 && (\n        <div className=\"px-3 py-4 text-sm opacity-70\">No ignored (merchant, category) pairs.</div>\n      )}\n      <div className=\"space-y-2\">\n        {rows.map((r, i) => (\n          <div key={`${r.merchant}-${r.category}-${i}`} className=\"flex items-center justify-between border border-border rounded-lg px-3 py-2\">\n            <div className=\"font-medium truncate mr-3\">{r.merchant} → {r.category}</div>\n            <button\n              className=\"rounded-md border border-border px-2 py-1 text-xs\"\n              onClick={async () => {\n                try {\n                  const next = await removeSuggestionIgnore(r.merchant, r.category);\n                  setRows(Array.isArray(next?.ignores) ? next.ignores : []);\n                  emitToastSuccess(t('ui.toast.suggestion_ignore_removed_title', { merchant: r.merchant, category: r.category }));\n                } catch (e: any) {\n                  emitToastError(e?.message ?? t('ui.toast.suggestion_ignore_remove_failed_title'));\n                }\n              }}\n            >Remove</button>\n          </div>\n        ))}\n      </div>\n    </Card>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\SuggestionsPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Card' is defined but never used. Allowed unused vars must match /^_/u.","line":15,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":12},{"ruleId":"react-hooks/exhaustive-deps","message":"Definition for rule 'react-hooks/exhaustive-deps' was not found.","line":62,"column":5,"endLine":62,"endColumn":60,"severity":2,"nodeType":null}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport { useRef } from \"react\";\nimport {\n  fetchRuleSuggestConfig,\n  type RuleSuggestConfig,\n  listRuleSuggestionsSummary,\n  applyRuleSuggestion,\n  ignoreRuleSuggestion,\n  type MinedRuleSuggestion,\n} from \"@/api\";\nimport { useCoalescedRefresh } from \"@/utils/refreshBus\";\nimport InfoDot from \"@/components/InfoDot\";\nimport { emitToastSuccess, emitToastError } from \"@/lib/toast-helpers\";\nimport { t } from '@/lib/i18n';\nimport Card from \"./Card\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Button } from \"@/components/ui/button\";\n\ntype Suggestion = MinedRuleSuggestion;\n\nexport default function SuggestionsPanel() {\n  const [rows, setRows] = React.useState<Suggestion[]>([]);\n  const [loading, setLoading] = React.useState(false);\n  const [recentMonth, setRecentMonth] = React.useState<string | null>(null);\n  const [selected, setSelected] = React.useState<Set<string>>(new Set());\n  const [pending, setPending] = React.useState<Set<string>>(new Set());\n  const [bulkBusy, setBulkBusy] = React.useState(false);\n  const [cfg, setCfg] = React.useState<RuleSuggestConfig | null>(null);\n  const ok = emitToastSuccess; const err = emitToastError;\n  const errRef = React.useRef(err);\n  React.useEffect(() => { errRef.current = err; }, [err]);\n  const loadingRef = useRef(false);\n\n  const refresh = React.useCallback(async () => {\n    if (loadingRef.current) return; // prevent overlap\n    loadingRef.current = true;\n    setLoading(true);\n    try {\n      const data = await listRuleSuggestionsSummary({}); // { window_days, min_count, suggestions }\n      const list = (data?.suggestions ?? []) as Suggestion[];\n      setRows(list);\n      // derive the most recent month key across suggestions\n      const mk = list.find((s) => s.recent_month_key)?.recent_month_key ?? null;\n      setRecentMonth(mk ?? null);\n      setSelected(new Set());\n    } catch (e) {\n      // use ref to avoid re-creating callback and effect loops\n  errRef.current?.(\"Could not fetch suggestions.\", { description: \"Failed to load\" });\n    } finally {\n      loadingRef.current = false;\n      setLoading(false);\n    }\n  }, []);\n\n  // Coalesced refresh to batch rapid apply actions across this tab\n  const scheduleSuggestionsRefresh = useCoalescedRefresh('suggestions-refresh', () => refresh(), 450);\n\n  React.useEffect(() => {\n    // run once on mount\n    refresh();\n  fetchRuleSuggestConfig().then(setCfg).catch(() => {});\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const keyFor = (s: Suggestion) => `${s.merchant}||${s.category}`;\n  const toggle = (key: string, on: boolean) => {\n    const next = new Set(selected);\n    if (on) next.add(key);\n    else next.delete(key);\n    setSelected(next);\n  };\n  const acceptOne = async (s: Suggestion) => {\n    const key = keyFor(s);\n    const nextPending = new Set(pending); nextPending.add(key); setPending(nextPending);\n    try {\n      const res = await applyRuleSuggestion({ merchant: s.merchant, category: s.category, backfill_month: s.recent_month_key ?? undefined });\n  ok(t('ui.toast.rule_created_title') + ` (#${res.rule_id})`, { description: `${s.merchant} → ${s.category}` });\n      setRows((prev) => prev.filter((r) => keyFor(r) !== key));\n      setSelected((prev) => { const c = new Set(prev); c.delete(key); return c; });\n    } catch (e) {\n  err(\"Failed to apply suggestion.\", { description: \"Action failed\" });\n    } finally {\n      setPending((prev) => { const c = new Set(prev); c.delete(key); return c; });\n    }\n    scheduleSuggestionsRefresh();\n  };\n\n  const applySelected = async () => {\n    const keys = Array.from(selected);\n  if (keys.length === 0) return err(\"No rows selected\", { description: \"Select some suggestions first.\" });\n    setBulkBusy(true);\n    const mapByKey = new Map(rows.map((r) => [keyFor(r), r] as const));\n    const targets = keys.map((k) => mapByKey.get(k)).filter(Boolean) as Suggestion[];\n    const pend = new Set(pending); targets.forEach((t) => pend.add(keyFor(t))); setPending(pend);\n    const results = await Promise.allSettled(targets.map((s) =>\n      applyRuleSuggestion({ merchant: s.merchant, category: s.category, backfill_month: s.recent_month_key ?? undefined })\n    ));\n    const okCount = results.filter((r) => r.status === 'fulfilled').length;\n    const failCount = results.length - okCount;\n    setRows((prev) => prev.filter((r) => !keys.includes(keyFor(r))));\n    setSelected(new Set());\n    setPending(new Set());\n  if (okCount) ok(`Applied ${okCount} ${okCount === 1 ? 'item' : 'items'}`, { description: failCount ? `${failCount} failed` : 'All succeeded' });\n  if (!okCount && failCount) err('Nothing applied', { description: `${failCount} failed` });\n    setBulkBusy(false);\n    scheduleSuggestionsRefresh();\n  };\n\n  const ignoreOne = async (s: Suggestion) => {\n    const key = keyFor(s);\n    const nextPending = new Set(pending); nextPending.add(key); setPending(nextPending);\n    try {\n      await ignoreRuleSuggestion({ merchant: s.merchant, category: s.category });\n      setRows((prev) => prev.filter((r) => keyFor(r) !== key));\n  ok(\"Ignored\", { description: `${s.merchant} → ${s.category}` });\n    } catch (e) {\n  err(\"Failed to ignore\", { description: \"Action failed\" });\n    } finally {\n      setPending((prev) => { const c = new Set(prev); c.delete(key); return c; });\n    }\n    scheduleSuggestionsRefresh();\n  };\n\n  return (\n    <section className=\"panel p-4 md:p-5\">\n    <div>\n      {/* Header: title+tooltip left; actions pushed right */}\n      <header className=\"flex items-center gap-3 pb-1 mb-3 border-b border-border\">\n        <div className=\"flex items-center gap-2\">\n          <h3 className=\"text-base font-semibold\">ML Suggestions</h3>\n          <InfoDot title=\"Predicted categories with confidence. Review, select, apply or auto-apply.\" />\n          {recentMonth && <span className=\"text-sm opacity-70\">— {recentMonth}</span>}\n        </div>\n        <div className=\"ml-auto flex items-center gap-2\">\n          {cfg && (\n            <span className=\"text-xs opacity-70 mr-2\">\n              feedback window: {cfg.window_days ?? \"∞\"}d\n            </span>\n          )}\n          <Button\n            variant=\"pill-outline\"\n            size=\"sm\"\n            onClick={refresh}\n            disabled={loading}\n            aria-label=\"Refresh suggestions\"\n            title=\"Refresh suggestions\"\n          >\n            {loading ? \"Refreshing…\" : \"Refresh\"}\n          </Button>\n          <Button\n            variant=\"pill-primary\"\n            size=\"sm\"\n            onClick={() => applySelected()}\n            title=\"Apply checked suggestions\"\n            disabled={bulkBusy}\n          >\n            {bulkBusy ? 'Applying…' : `Apply selected${selected.size ? ` (${selected.size})` : ''}`}\n          </Button>\n          {/* Auto-apply by confidence removed; mined suggestions have no probability */}\n        </div>\n      </header>\n\n  {/* List */}\n      <div className=\"space-y-2\">\n        {loading && (\n          <div className=\"space-y-2\">\n            {[0,1,2,3].map(i => (\n              <div key={i} className=\"rounded-xl border border-[hsl(var(--border))] bg-card/60 px-3 py-2\">\n                <div className=\"flex items-center gap-3\">\n                  <Skeleton className=\"w-4 h-4 rounded\" />\n                  <div className=\"min-w-0 flex-1\">\n                    <Skeleton className=\"h-4 w-40\" />\n                    <div className=\"mt-1\">\n                      <Skeleton className=\"h-3 w-24\" />\n                    </div>\n                  </div>\n                  <Skeleton className=\"h-6 w-48\" />\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n        {rows.map((r, idx) => {\n          const key = keyFor(r);\n          const disabled = pending.has(key);\n          return (\n          <div\n            key={key || `${r.merchant}-${r.category}-${idx}`}\n            className=\"panel-tight\"\n          >\n            <div className=\"flex items-center gap-3\">\n              <input\n                type=\"checkbox\"\n                className=\"shrink-0 w-4 h-4 accent-[hsl(var(--primary))]\"\n                checked={selected.has(key)}\n                onChange={(e) => toggle(key, e.target.checked)}\n                aria-label={`Select ${r.merchant} → ${r.category}`}\n              />\n              <div className=\"min-w-0\">\n                <div className=\"font-medium truncate\">{r.merchant || \"—\"}</div>\n                <div className=\"text-xs opacity-70 truncate\">{recentMonth ? `Most recent: ${recentMonth}` : \" \"}</div>\n              </div>\n              <div className=\"ml-auto flex items-center gap-3\">\n                <span className=\"text-sm\">\n                  <span className=\"opacity-70\">Suggest: </span>\n                  <span className=\"font-medium\">{r.category}</span>\n                  <span className=\"opacity-70\"> · {r.count}× in {r.window_days}d</span>\n                </span>\n                <button\n                  className=\"btn btn-sm\"\n                  title=\"Accept suggestion\"\n                  onClick={() => acceptOne(r)}\n                  disabled={disabled}\n                >\n                  {disabled ? \"Applying…\" : \"Accept\"}\n                </button>\n                <button\n                  className=\"btn btn-ghost btn-sm\"\n                  title=\"Ignore this pair\"\n                  onClick={() => ignoreOne(r)}\n                  disabled={disabled}\n                >\n                  Ignore\n                </button>\n              </div>\n            </div>\n          </div>\n          );\n        })}\n  {!loading && rows.length === 0 && (\n          <div className=\"text-sm opacity-70 py-4 text-center\">No suggestions right now.</div>\n        )}\n      </div>\n  </div>\n  </section>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\Toast.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\TopEmptyBanner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\TransactionsDrawer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\TransactionsPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getTxn' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'patchTxn' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'bulkPatchTxns' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":51},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'splitTxn' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":76,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":84},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mergeTxns' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":86,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":95},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'linkTransfer' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":97,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":109},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setMonth' is assigned a value but never used. Allowed unused elements of array destructuring patterns must match /^_/u.","line":31,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":51,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2125,2128],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2125,2128],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2198,2201],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2198,2201],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":55,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2270,2273],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2270,2273],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":84,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3540,3543],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3540,3543],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":118,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4668,4671],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4668,4671],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":152,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":152,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6829,6832],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6829,6832],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":13,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\r\nimport { listTxns, getTxn, patchTxn, bulkPatchTxns, deleteTxn, restoreTxn, splitTxn, mergeTxns, linkTransfer } from \"@/lib/api\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport Card from \"@/components/Card\";\r\nimport { emitToastSuccess, emitToastError } from \"@/lib/toast-helpers\";\r\nimport { t } from '@/lib/i18n';\r\nimport TxnEditDialog from \"./TxnEditDialog\";\r\nimport SplitDialog from \"./SplitDialog\";\r\nimport MergeDialog from \"./MergeDialog\";\r\nimport TransferDialog from \"./TransferDialog\";\r\nimport BulkEditDialog from \"./bulk/BulkEditDialog\";\r\n\r\ntype Row = {\r\n  id: number;\r\n  date?: string | null;\r\n  merchant?: string | null;\r\n  merchant_canonical?: string | null;\r\n  description?: string | null;\r\n  category?: string | null;\r\n  amount: number;\r\n  deleted_at?: string | null;\r\n  split_parent_id?: number | null;\r\n  transfer_group?: string | null;\r\n};\r\n\r\nexport default function TransactionsPanel() {\r\n  const [rows, setRows] = React.useState<Row[]>([]);\r\n  const [total, setTotal] = React.useState(0);\r\n  const [sel, setSel] = React.useState<number[]>([]);\r\n  const [q, setQ] = React.useState(\"\");\r\n  const [month, setMonth] = React.useState<string | undefined>(undefined);\r\n  const [sort, setSort] = React.useState(\"-date\");\r\n  const [page, setPage] = React.useState(0);\r\n  const [loading, setLoading] = React.useState(false);\r\n  const [error, setError] = React.useState<string | null>(null);\r\n  const limit = 50;\r\n  // Removed legacy toast hook in favor of emit helpers\r\n\r\n  // Dialog state\r\n  const [editId, setEditId] = React.useState<number | null>(null);\r\n  const [bulkOpen, setBulkOpen] = React.useState<boolean>(false);\r\n  const [splitId, setSplitId] = React.useState<number | null>(null);\r\n  const [mergeOpen, setMergeOpen] = React.useState<boolean>(false);\r\n  const [transferIds, setTransferIds] = React.useState<[number, number] | null>(null);\r\n\r\n  const refresh = React.useCallback(async () => {\r\n    setLoading(true);\r\n    setError(null);\r\n    try {\r\n      const res = await listTxns({ q, month, limit, offset: page * limit, sort });\r\n      const items: Row[] = (res as any)?.items || [];\r\n      setRows(items);\r\n      setTotal(Number((res as any)?.total || items.length || 0));\r\n      setSel([]);\r\n    } catch (e: any) {\r\n      setError(e?.message || String(e));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [q, month, sort, page]);\r\n\r\n  React.useEffect(() => { refresh(); }, [refresh]);\r\n\r\n  // Keyboard shortcuts for selection actions\r\n  React.useEffect(() => {\r\n    const onKey = (e: KeyboardEvent) => {\r\n      if (e.target && (e.target as HTMLElement).tagName === 'INPUT') return; // ignore typing in inputs\r\n      const k = e.key.toLowerCase();\r\n      if (k === 'e' && sel.length === 1) { e.preventDefault(); openEdit(sel[0]); }\r\n      if (k === 'd' && sel.length >= 1) { e.preventDefault(); handleDelete(sel); }\r\n      if (k === 's' && sel.length === 1) { e.preventDefault(); openSplit(sel[0]); }\r\n      if (k === 'm' && sel.length >= 2) { e.preventDefault(); openMerge(sel); }\r\n      if (k === 't' && sel.length === 2) { e.preventDefault(); openTransfer(sel); }\r\n    };\r\n    window.addEventListener('keydown', onKey);\r\n    return () => window.removeEventListener('keydown', onKey);\r\n  }, [sel]);\r\n\r\n  async function handleDelete(ids: number[]) {\r\n    try {\r\n      await Promise.all(ids.map((id) => deleteTxn(id)));\r\n  emitToastSuccess(t('ui.toast.tx_deleted_title'), { description: `${ids.length} transaction(s) soft-deleted.` });\r\n      refresh();\r\n    } catch (e: any) {\r\n  emitToastError(t('ui.toast.tx_delete_failed_title'), { description: e?.message || String(e) });\r\n    }\r\n  }\r\n\r\n  // Dialog openers\r\n  function openEdit(idOrRow: number | Row) {\r\n    const id = typeof idOrRow === 'number' ? idOrRow : idOrRow.id;\r\n    setEditId(id);\r\n  }\r\n  function openBulkEdit(ids: number[]) {\r\n    if (!ids.length) return;\r\n    setBulkOpen(true);\r\n  }\r\n  function openSplit(idOrRow: number | Row) {\r\n    const id = typeof idOrRow === 'number' ? idOrRow : idOrRow.id;\r\n    setSplitId(id);\r\n  }\r\n  function openMerge(ids: number[]) {\r\n    if (ids.length < 2) return;\r\n    setMergeOpen(true);\r\n  }\r\n  function openTransfer(ids: number[]) {\r\n    if (ids.length !== 2) return;\r\n    setTransferIds([ids[0], ids[1]]);\r\n  }\r\n\r\n  const toggleAll = (checked: boolean) => setSel(checked ? rows.map((r) => r.id) : []);\r\n  const toggleOne = (id: number, checked: boolean) => setSel((cur) => (checked ? [...new Set([...cur, id])] : cur.filter((x) => x !== id)));\r\n\r\n  const start = page * limit + 1;\r\n  const end = Math.min(total, (page + 1) * limit);\r\n\r\n  return (\r\n    <Card className=\"p-3\" title={undefined as any}>\r\n      <div className=\"flex items-center gap-2 mb-2\">\r\n        <input className=\"bg-neutral-900 border border-neutral-800 rounded px-2 py-1 text-sm\" placeholder=\"Search…\" value={q} onChange={(e) => setQ(e.target.value)} />\r\n        <select className=\"bg-neutral-900 border border-neutral-800 rounded px-2 py-1 text-sm\" value={sort} onChange={(e) => setSort(e.target.value)}>\r\n          <option value=\"-date\">Newest</option>\r\n          <option value=\"date\">Oldest</option>\r\n          <option value=\"-amount\">Amount ↓</option>\r\n          <option value=\"amount\">Amount ↑</option>\r\n        </select>\r\n        <div className=\"ml-auto text-sm opacity-70\">{sel.length} selected</div>\r\n      </div>\r\n\r\n      {loading && <div className=\"text-sm opacity-70\">Loading…</div>}\r\n      {error && <div className=\"text-sm text-amber-300/90 bg-amber-500/10 border border-amber-500/30 rounded-xl p-2 mb-2\">{error}</div>}\r\n      {!loading && rows.length === 0 && <div className=\"text-sm opacity-70\">No transactions.</div>}\r\n\r\n      {rows.length > 0 && (\r\n        <div className=\"overflow-auto border border-border rounded-2xl\">\r\n          <table className=\"w-full text-sm\">\r\n            <thead>\r\n              <tr className=\"text-left\">\r\n                <th className=\"px-2 py-1\"><input type=\"checkbox\" aria-label=\"Select all\" checked={sel.length === rows.length && rows.length > 0} onChange={(e) => toggleAll(e.target.checked)} /></th>\r\n                <th className=\"px-2 py-1\">Date</th>\r\n                <th className=\"px-2 py-1\">Merchant</th>\r\n                <th className=\"px-2 py-1\">Category</th>\r\n                <th className=\"px-2 py-1 text-right\">Amount</th>\r\n                <th className=\"px-2 py-1\" />\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {rows.map((r) => (\r\n                <tr key={r.id} className=\"border-t border-border\">\r\n                  <td className=\"px-2 py-1\"><input type=\"checkbox\" checked={sel.includes(r.id)} onChange={(e) => toggleOne(r.id, e.target.checked)} /></td>\r\n                  <td className=\"px-2 py-1 whitespace-nowrap\">{r.date || '—'}</td>\r\n                  <td className=\"px-2 py-1\">{(r as any).merchant_canonical || r.merchant || '—'}</td>\r\n                  <td className=\"px-2 py-1\">{r.category || <span className=\"opacity-60\">—</span>}</td>\r\n                  <td className=\"px-2 py-1 text-right\">{r.amount?.toLocaleString?.(undefined, { style: 'currency', currency: 'USD' }) ?? String(r.amount)}</td>\r\n                  <td className=\"px-2 py-1 text-right\">\r\n                    <Button variant=\"pill-ghost\" onClick={() => openEdit(r)}>Edit</Button>\r\n                    <Button variant=\"pill-danger\" onClick={() => handleDelete([r.id])}>Delete</Button>\r\n                  </td>\r\n                </tr>\r\n              ))}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"mt-3 flex gap-2 items-center\">\r\n        <Button onClick={() => openBulkEdit(sel)} disabled={sel.length === 0}>Bulk Edit</Button>\r\n        <Button onClick={() => openSplit(sel[0])} disabled={sel.length !== 1}>Split</Button>\r\n        <Button onClick={() => openMerge(sel)} disabled={sel.length < 2}>Merge</Button>\r\n        <Button onClick={() => openTransfer(sel)} disabled={sel.length !== 2}>Link Transfer</Button>\r\n  <Button variant=\"pill-success\" onClick={async () => { await Promise.all(sel.map((id) => restoreTxn(id))); emitToastSuccess(t('ui.toast.tx_restored_title'), { description: `${sel.length} transaction(s) restored.` }); refresh(); }}>Restore</Button>\r\n        <div className=\"ml-auto flex items-center gap-2\">\r\n          <Button variant=\"pill-outline\" onClick={() => setPage((p) => Math.max(0, p - 1))}>Prev</Button>\r\n          <span className=\"mx-2 text-sm\">{start}–{end} / {total}</span>\r\n          <Button variant=\"pill-outline\" onClick={() => setPage((p) => p + 1)} disabled={(page + 1) * limit >= total}>Next</Button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Dialogs */}\r\n      {editId != null && (\r\n        <TxnEditDialog\r\n          open={true}\r\n          onOpenChange={(v) => { if (!v) setEditId(null); }}\r\n          txnId={editId}\r\n          onSaved={() => { emitToastSuccess(t('ui.toast.tx_updated_title'), { description: `Transaction #${editId} updated.` }); refresh(); }}\r\n        />\r\n      )}\r\n      {bulkOpen && (\r\n        <BulkEditDialog\r\n          open={true}\r\n          onOpenChange={(v) => { if (!v) setBulkOpen(false); }}\r\n          ids={sel}\r\n          onSaved={(n) => { emitToastSuccess(t('ui.toast.tx_bulk_updated_title'), { description: `${n} transaction(s) updated.` }); refresh(); }}\r\n        />\r\n      )}\r\n      {splitId != null && (\r\n        <SplitDialog\r\n          open={true}\r\n          onOpenChange={(v) => { if (!v) setSplitId(null); }}\r\n          txnId={splitId}\r\n          onDone={() => { emitToastSuccess(t('ui.toast.tx_split_created_title'), { description: `Transaction #${splitId} split.` }); refresh(); }}\r\n        />\r\n      )}\r\n      {mergeOpen && (\r\n        <MergeDialog\r\n          open={true}\r\n          onOpenChange={(v) => { if (!v) setMergeOpen(false); }}\r\n          ids={sel}\r\n          onDone={(mergedId) => { emitToastSuccess(t('ui.toast.tx_merged_into_title'), { description: mergedId ? `Merged into #${mergedId}` : `Merged ${sel.length} transactions.` }); refresh(); }}\r\n        />\r\n      )}\r\n      {transferIds && (\r\n        <TransferDialog\r\n          open={true}\r\n          onOpenChange={(v) => { if (!v) setTransferIds(null); }}\r\n          ids={transferIds}\r\n          onDone={(group) => { emitToastSuccess(t('ui.toast.tx_linked_title'), { description: `Transfer group ${group || 'created'}.` }); refresh(); }}\r\n        />\r\n      )}\r\n    </Card>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\TransferDialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[657,660],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[657,660],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[769,772],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[769,772],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\r\nimport { linkTransfer } from \"@/lib/api\";\r\nimport { Button } from \"@/components/ui/button\";\r\n\r\nexport default function TransferDialog({ open, onOpenChange, ids, onDone }:{ open:boolean; onOpenChange:(v:boolean)=>void; ids:[number,number]; onDone:(group?:string)=>void }){\r\n  const [group, setGroup] = React.useState<string>(\"\");\r\n  const [saving, setSaving] = React.useState(false);\r\n  const [error, setError] = React.useState<string | null>(null);\r\n\r\n  async function onLink() {\r\n    setSaving(true); setError(null);\r\n    try {\r\n      const res = await linkTransfer(ids[0], ids[1], group || undefined);\r\n      const g = (res as any)?.group;\r\n      onDone(typeof g === 'string' ? g : undefined);\r\n      onOpenChange(false);\r\n    } catch (e: any) {\r\n      setError(e?.message || String(e));\r\n    } finally { setSaving(false); }\r\n  }\r\n\r\n  if (!open) return null;\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex\">\r\n      <div className=\"absolute inset-0 bg-black/50\" onClick={()=>onOpenChange(false)} />\r\n      <div className=\"relative z-10 bg-background border border-border rounded-xl m-auto p-4 w-[460px]\">\r\n        <div className=\"text-base font-semibold mb-2\">Link transfer</div>\r\n        <div className=\"text-xs opacity-70 mb-2\">Select exactly two rows (outflow & inflow). Linking will group them as a transfer.</div>\r\n        {error && <div className=\"text-sm text-amber-300/90 bg-amber-500/10 border border-amber-500/30 rounded p-2 mb-2\">{error}</div>}\r\n        <label className=\"block text-sm\">\r\n          <span className=\"block opacity-70 mb-1\">Group (optional)</span>\r\n          <input className=\"w-full bg-neutral-900 border border-neutral-800 rounded px-2 py-1\" value={group} onChange={(e)=>setGroup(e.target.value)} placeholder=\"Leave blank to auto-generate\" />\r\n        </label>\r\n        <div className=\"mt-3 flex gap-2 justify-end\">\r\n          <Button variant=\"pill-outline\" onClick={()=>onOpenChange(false)} disabled={saving}>Cancel</Button>\r\n          <Button variant=\"pill-primary\" className=\"h-9 px-4\" onClick={onLink} disabled={saving || ids.length!==2}>Link</Button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\TxnEditDialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1030,1033],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1030,1033],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1306,1309],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1306,1309],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1739,1742],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1739,1742],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\r\nimport { getTxn, patchTxn } from \"@/lib/api\";\r\nimport { Button } from \"@/components/ui/button\";\r\n\r\nexport default function TxnEditDialog({ open, onOpenChange, txnId, onSaved }:{ open:boolean; onOpenChange:(v:boolean)=>void; txnId:number; onSaved:()=>void }){\r\n  const [loading, setLoading] = React.useState(false);\r\n  const [error, setError] = React.useState<string | null>(null);\r\n  const [form, setForm] = React.useState<{ date?: string; amount?: string; category?: string; note?: string; description?: string }>({});\r\n\r\n  React.useEffect(() => {\r\n    if (!open) return;\r\n    let alive = true;\r\n    (async () => {\r\n      setLoading(true); setError(null);\r\n      try {\r\n        const t = await getTxn(txnId);\r\n        if (!alive) return;\r\n        setForm({\r\n          date: t?.date || \"\",\r\n          amount: t?.amount != null ? String(t.amount) : \"\",\r\n          category: t?.category || \"\",\r\n          note: t?.note || \"\",\r\n          description: t?.description || \"\",\r\n        });\r\n      } catch (e: any) { if (alive) setError(e?.message || String(e)); }\r\n      finally { if (alive) setLoading(false); }\r\n    })();\r\n    return () => { alive = false; };\r\n  }, [open, txnId]);\r\n\r\n  async function onSave() {\r\n    setLoading(true); setError(null);\r\n    try {\r\n      const patch: any = {};\r\n      if (form.date) patch.date = form.date;\r\n      if (form.amount != null && form.amount !== \"\") patch.amount = form.amount;\r\n      if (form.category != null) patch.category = form.category;\r\n      if (form.note != null) patch.note = form.note;\r\n      if (form.description != null) patch.description = form.description;\r\n      await patchTxn(txnId, patch);\r\n      onSaved();\r\n      onOpenChange(false);\r\n    } catch (e: any) {\r\n      setError(e?.message || String(e));\r\n    } finally { setLoading(false); }\r\n  }\r\n\r\n  if (!open) return null;\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex\">\r\n      <div className=\"absolute inset-0 bg-black/50\" onClick={()=>onOpenChange(false)} />\r\n      <div className=\"relative z-10 bg-background border border-border rounded-xl m-auto p-4 w-[460px]\">\r\n        <div className=\"text-base font-semibold mb-2\">Edit transaction #{txnId}</div>\r\n        {error && <div className=\"text-sm text-amber-300/90 bg-amber-500/10 border border-amber-500/30 rounded p-2 mb-2\">{error}</div>}\r\n        <div className=\"space-y-2\">\r\n          <label className=\"block text-sm\">\r\n            <span className=\"block opacity-70 mb-1\">Date</span>\r\n            <input type=\"date\" className=\"w-full bg-neutral-900 border border-neutral-800 rounded px-2 py-1\"\r\n              value={form.date || ''}\r\n              onChange={(e)=>setForm(f=>({...f, date:e.target.value}))} />\r\n          </label>\r\n          <label className=\"block text-sm\">\r\n            <span className=\"block opacity-70 mb-1\">Amount</span>\r\n            <input type=\"number\" step=\"0.01\" className=\"w-full bg-neutral-900 border border-neutral-800 rounded px-2 py-1\"\r\n              value={form.amount ?? ''}\r\n              onChange={(e)=>setForm(f=>({...f, amount:e.target.value}))} />\r\n          </label>\r\n          <label className=\"block text-sm\">\r\n            <span className=\"block opacity-70 mb-1\">Category</span>\r\n            <input className=\"w-full bg-neutral-900 border border-neutral-800 rounded px-2 py-1\"\r\n              value={form.category ?? ''}\r\n              onChange={(e)=>setForm(f=>({...f, category:e.target.value}))} />\r\n          </label>\r\n          <label className=\"block text-sm\">\r\n            <span className=\"block opacity-70 mb-1\">Note</span>\r\n            <input className=\"w-full bg-neutral-900 border border-neutral-800 rounded px-2 py-1\"\r\n              value={form.note ?? ''}\r\n              onChange={(e)=>setForm(f=>({...f, note:e.target.value}))} />\r\n          </label>\r\n          <label className=\"block text-sm\">\r\n            <span className=\"block opacity-70 mb-1\">Description</span>\r\n            <input className=\"w-full bg-neutral-900 border border-neutral-800 rounded px-2 py-1\"\r\n              value={form.description ?? ''}\r\n              onChange={(e)=>setForm(f=>({...f, description:e.target.value}))} />\r\n          </label>\r\n        </div>\r\n        <div className=\"mt-3 flex gap-2 justify-end\">\r\n          <Button variant=\"pill-outline\" onClick={()=>onOpenChange(false)} disabled={loading}>Cancel</Button>\r\n          <Button variant=\"pill-primary\" className=\"h-9 px-4\" onClick={onSave} disabled={loading}>Save</Button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\UnknownsPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ToastAction' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'onSeedRule' is defined but never used. Allowed unused args must match /^_/u.","line":21,"column":48,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":58},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'refreshKey' is defined but never used. Allowed unused args must match /^_/u.","line":21,"column":71,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":81},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1551,1554],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1551,1554],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2214,2217],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2214,2217],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2641,2644],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2641,2644],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3130,3133],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3130,3133],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react'\nimport Card from './Card'\nimport EmptyState from './EmptyState'\nimport { categorizeTxn, mlFeedback } from '@/api'\nimport { useCoalescedRefresh } from '@/utils/refreshBus'\n// removed useOkErrToast hook (deprecated)\nimport { ToastAction } from '@/components/ui/toast'\nimport { Tooltip, TooltipTrigger, TooltipContent } from '@/components/ui/tooltip'\nimport { InfoDot } from './InfoDot'\nimport LearnedBadge from './LearnedBadge'\nimport ExplainSignalDrawer from './ExplainSignalDrawer'\nimport { useUnknowns } from '@/hooks/useUnknowns'\nimport { Skeleton } from '@/components/ui/skeleton'\nimport CardHelpTooltip from './CardHelpTooltip'\nimport { getHelpBaseText } from '@/lib/helpBaseText';\nimport { seedRuleFromTxn } from '@/lib/rulesSeed'\nimport { emitToastSuccess, emitToastError } from '@/lib/toast-helpers'\nimport { Button } from '@/components/ui/button'\nimport { t } from '@/lib/i18n'\n\nexport default function UnknownsPanel({ month, onSeedRule, onChanged, refreshKey }: {\n  month?: string\n  onSeedRule?: (seed: { id: number; merchant?: string; description?: string }) => void\n  onChanged?: () => void\n  refreshKey?: number\n}) {\n  const { items, loading, error, currentMonth, refresh } = useUnknowns(month)\n  const ok = emitToastSuccess; const err = emitToastError;\n  const [learned, setLearned] = useState<Record<number, boolean>>({})\n  const [explainOpen, setExplainOpen] = useState(false)\n  const [explainTxnId, setExplainTxnId] = useState<number | null>(null)\n  const [explainTxn, setExplainTxn] = useState<any | null>(null)\n  // One shared timer for all unknowns refresh requests across this tab\n  const scheduleUnknownsRefresh = useCoalescedRefresh('unknowns-refresh', () => refresh(), 450)\n\n  async function quickApply(id: number, category: string) {\n    await categorizeTxn(id, category)\n    // Attempt ML feedback; show transient \"learned\" badge on success\n    try {\n      await mlFeedback({ txn_id: id, category, action: 'accept' })\n      setLearned(prev => ({ ...prev, [id]: true }))\n      setTimeout(() => {\n        setLearned(prev => {\n          const next = { ...prev }\n          delete next[id]\n          return next\n        })\n      }, 4500)\n    } catch (e: any) {\n  err(t('ui.toast.ml_feedback_failed', { error: e?.message ?? String(e) }))\n    }\n  // Optimistically remove the row\n  // items comes from the hook; since we can't mutate it here, trigger a refresh\n  refresh()\n    onChanged?.()\n  ok?.(t('ui.toast.category_applied', { category }))\n  // Batch multiple quick applies into a single reload (coalesced by key)\n  scheduleUnknownsRefresh()\n  }\n\n  function seedRuleFromRow(row: any) {\n    const draft = seedRuleFromTxn({\n      merchant: row.merchant,\n      description: row.description,\n      category_guess: row.category_guess,\n    }, { month: currentMonth || month })\n    // Provide a toast with an action to forcibly open (if listener not auto-opened)\n    emitToastSuccess(t('ui.toast.seed_rule_title'), {\n      description: t('ui.toast.seed_rule_description'),\n      action: {\n        label: t('ui.toast.seed_rule_action_open'),\n        onClick: () => (window as any).__openRuleTester?.(draft),\n      },\n    })\n  }\n\n  const resolvedMonth = (currentMonth ?? month) || '(latest)'\n  return (\n  <section\n    id=\"unknowns-panel\"\n    className=\"panel p-4 md:p-5 help-spot\"\n    data-explain-key=\"cards.unknowns\"\n  data-help-key=\"cards.unknowns\"\n  data-help-id={currentMonth || month}\n  >\n  <Card title={t('ui.cards.unknowns_title', { month: resolvedMonth })} className=\"border-0 bg-transparent shadow-none p-0\">\n  {loading && (\n        <div className=\"space-y-2\">\n          {[0,1,2].map(i => (\n    <div key={i} className=\"panel-tight\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"space-y-1\">\n                  <Skeleton className=\"h-4 w-40\" />\n                  <Skeleton className=\"h-3 w-64\" />\n                </div>\n                <Skeleton className=\"h-4 w-24\" />\n              </div>\n              <div className=\"mt-2 flex items-center gap-2\">\n                <Skeleton className=\"h-7 w-20 rounded\" />\n                <Skeleton className=\"h-7 w-16 rounded\" />\n                <Skeleton className=\"h-7 w-24 rounded\" />\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n      {!loading && error && <div className=\"text-sm text-rose-300\">{error}</div>}\n      {!loading && !error && items.length === 0 && (\n        <EmptyState title={t('ui.empty.no_transactions_title')} note={t('ui.empty.unknowns_note')} />\n      )}\n      <div className=\"flex items-center justify-between mb-2 text-sm font-medium\">\n        <div className=\"flex items-center gap-2\">\n          <span className=\"flex items-center\">\n            {t('ui.unknowns.header_label')}\n            <CardHelpTooltip cardId=\"cards.unknowns\" month={currentMonth || month} ctx={{ items }} baseText={getHelpBaseText('cards.unknowns', { month: currentMonth || month })} className=\"ml-2\" />\n          </span>\n          <Tooltip>\n            <TooltipTrigger asChild>\n              <InfoDot />\n            </TooltipTrigger>\n            <TooltipContent>\n              {t('ui.unknowns.tooltip_info')}\n            </TooltipContent>\n          </Tooltip>\n        </div>\n  <div className=\"text-xs opacity-70\">{t('ui.unknowns.workflow_hint')}</div>\n      </div>\n  <ul className=\"space-y-2\">\n        {items.map(tx => (\n      <li key={tx.id} className=\"panel-tight md:p-5 lg:p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <div className=\"font-medium\">{tx.merchant ?? '—'}</div>\n        <div className=\"text-sm opacity-70 wrap\">{tx.description ?? ''}</div>\n              </div>\n              <div className=\"text-right\">\n                <div className=\"text-sm opacity-70\">{new Date(tx.date).toLocaleDateString()}</div>\n                <div className=\"font-mono\">{typeof tx.amount === 'number' ? `$${tx.amount.toFixed(2)}` : tx.amount}</div>\n              </div>\n            </div>\n            <div className=\"mt-2 flex items-center gap-2\">\n              <Tooltip>\n                <TooltipTrigger asChild>\n                  <Button\n                    type=\"button\"\n                    variant=\"pill-outline\"\n                    size=\"sm\"\n                    onClick={()=> seedRuleFromRow(tx)}\n                    aria-label={t('ui.unknowns.seed_rule_aria')}\n                  >\n                    {t('ui.unknowns.seed_rule')}\n                  </Button>\n                </TooltipTrigger>\n                <TooltipContent>\n                  {t('ui.unknowns.seed_rule_tooltip')}\n                </TooltipContent>\n              </Tooltip>\n              <Button\n                variant=\"pill-outline\"\n                size=\"sm\"\n                onClick={() => { setExplainTxnId(tx.id); setExplainTxn(tx); setExplainOpen(true); }}\n              >\n                {t('ui.unknowns.explain')}\n              </Button>\n              {([\n                { key: 'groceries', label: t('ui.categories.groceries') },\n                { key: 'dining', label: t('ui.categories.dining') },\n                { key: 'shopping', label: t('ui.categories.shopping') },\n              ] as const).map(c => (\n                <button key={c.key} className=\"px-2 py-1 rounded bg-blue-700 hover:bg-blue-600\" onClick={()=>quickApply(tx.id, c.label)}>\n                  {t('ui.unknowns.apply_category', { category: c.label })}\n                </button>\n              ))}\n              {learned[tx.id] && <LearnedBadge />}\n            </div>\n          </li>\n        ))}\n      </ul>\n  <ExplainSignalDrawer txnId={explainTxnId} txn={explainTxn} open={explainOpen} onOpenChange={(v)=>{ setExplainOpen(v); if(!v){ setExplainTxnId(null); setExplainTxn(null);} }} />\n      </Card>\n    </section>\n  )\n}\n\n// If you support bulk apply somewhere, prefer this pattern to batch network work and refresh once:\n// for (const { id, cat } of items) {\n//   await categorizeTxn(id, cat)\n//   await mlFeedback({ txn_id: id, label: cat, source: 'bulk' }).catch(() => {})\n// }\n// ok(`Applied ${items.length} changes`)\n// scheduleUnknownsRefresh()\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\UploadCsv.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'emitToastError' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":42},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ToastAction' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'scrollToId' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Card' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[615,618],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[615,618],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":120,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4388,4391],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4388,4391],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useCallback, useRef, useState } from \"react\";\nimport { uploadCsv, fetchLatestMonth, agentTools } from \"../lib/api\"; // uses your existing helpers\nimport { emitToastSuccess, emitToastError } from \"@/lib/toast-helpers\";\nimport { t } from '@/lib/i18n';\nimport { ToastAction } from \"@/components/ui/toast\";\nimport { scrollToId } from \"@/lib/scroll\";\nimport { useMonth } from \"../context/MonthContext\";\nimport Card from \"./Card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Upload } from \"lucide-react\";\n\ntype UploadResult = {\n  ok: boolean;\n  status?: number;\n  message?: string;\n  data?: any;\n};\n\ninterface UploadCsvProps {\n  /** Called after a successful upload. Useful to refresh Unknowns/Suggestions. */\n  onUploaded?: (result?: UploadResult) => void;\n  /** Default for the \"Replace existing data\" toggle. */\n  defaultReplace?: boolean;\n  /** Optional className passthrough. */\n  className?: string;\n}\n\nconst prettyBytes = (n: number) => {\n  if (!Number.isFinite(n)) return \"\";\n  const units = [\"B\", \"KB\", \"MB\", \"GB\"];\n  let u = 0;\n  while (n >= 1024 && u < units.length - 1) {\n    n /= 1024;\n    u++;\n  }\n  return `${n.toFixed(u === 0 ? 0 : 1)} ${units[u]}`;\n};\n\nconst UploadCsv: React.FC<UploadCsvProps> = ({ onUploaded, defaultReplace = true, className }) => {\n  const { month, setMonth } = useMonth();\n  const [file, setFile] = useState<File | null>(null);\n  const [replace, setReplace] = useState<boolean>(defaultReplace);\n  const [dragOver, setDragOver] = useState(false);\n  const [busy, setBusy] = useState(false);\n  const [result, setResult] = useState<UploadResult | null>(null);\n  const inputRef = useRef<HTMLInputElement | null>(null);\n  // useToast replaced with emit helpers\n\n  const onPick = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    const f = e.target.files?.[0] ?? null;\n    setFile(f);\n    setResult(null);\n  }, []);\n\n  const onDrop = useCallback((e: React.DragEvent<HTMLLabelElement>) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragOver(false);\n    const f = e.dataTransfer.files?.[0] ?? null;\n    setFile(f);\n    setResult(null);\n  }, []);\n\n  const onDrag = useCallback((e: React.DragEvent<HTMLLabelElement>) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (e.type === \"dragover\") setDragOver(true);\n    if (e.type === \"dragleave\") setDragOver(false);\n  }, []);\n\n  const reset = useCallback(() => {\n    setFile(null);\n    setResult(null);\n    if (inputRef.current) inputRef.current.value = \"\";\n  }, []);\n\n  // After a successful upload, snap to latest month and refetch key dashboards\n  const handleUploadSuccess = useCallback(async () => {\n    try {\n      const latest = await fetchLatestMonth();\n      // Only update month if we got a meaningful result that's different from current\n      // Avoid overwriting a carefully resolved month from boot unless truly necessary\n      if (latest && latest !== month && latest.length >= 7) {\n        console.debug(\"[upload] updating month from\", month, \"to\", latest);\n        setMonth(latest);\n      }\n\n      // Use the resolved month (prefer current context month over latest)\n      const resolved = month || latest;\n      if (resolved) {\n        // fire-and-forget to avoid blocking UI\n        void Promise.allSettled([\n          agentTools.chartsSummary({ month: resolved }),\n          agentTools.chartsMerchants({ month: resolved, limit: 10 }),\n          agentTools.chartsFlows({ month: resolved }),\n          agentTools.chartsSpendingTrends({ month: resolved, months_back: 6 }),\n        ]);\n      }\n    } catch {\n      // best-effort; UI will still refresh via parent onUploaded handler\n    }\n  }, [month, setMonth]);\n\n  const doUpload = useCallback(async () => {\n    if (!file) return;\n    setBusy(true);\n    setResult(null);\n    try {\n      // Uses your existing API helper; falls back to direct fetch if needed.\n      const data = await uploadCsv(file, replace); // Auto-inference enabled\n      const r: UploadResult = { ok: true, data, message: \"CSV ingested successfully.\" };\n      setResult(r);\n      onUploaded?.(r);\n  // snap month + refetch dashboards (non-blocking)\n  void handleUploadSuccess();\n      // Success toast with dual CTAs\n  emitToastSuccess(t('ui.toast.import_complete_title'), { description: t('ui.toast.import_complete_description') });\n      // optional: reset file after success\n      // reset();\n    } catch (err: any) {\n      const message =\n        err?.message ??\n        (typeof err === \"string\" ? err : \"Upload failed. Check server logs for details.\");\n      const status = err?.status ?? undefined;\n      const r: UploadResult = { ok: false, status, message };\n      setResult(r);\n    } finally {\n      setBusy(false);\n    }\n  }, [file, replace, onUploaded, handleUploadSuccess]);\n\n  const disabled = busy || !file;\n\n  return (\n    <div className={`w-full ${className ?? \"\"}`}>\n        <header className=\"flex items-center justify-between border-b border-border pb-1\">\n          <h2 className=\"text-lg font-semibold\">Upload Transactions CSV</h2>\n          <div className=\"flex items-center gap-3\">\n            <label className=\"inline-flex items-center gap-2 text-sm text-gray-300\">\n              <input\n                type=\"checkbox\"\n                className=\"h-4 w-4 rounded border-gray-600 bg-gray-800 text-indigo-500 focus:ring-indigo-500\"\n                checked={replace}\n                onChange={(e) => setReplace(e.target.checked)}\n              />\n              Replace existing data\n            </label>\n            <Button\n              onClick={reset}\n              type=\"button\"\n              variant=\"pill-outline\"\n              size=\"sm\"\n            >\n              Reset\n            </Button>\n          </div>\n        </header>\n\n        <label\n          onDragOver={onDrag}\n          onDragLeave={onDrag}\n          onDrop={onDrop}\n          className={`mt-4 block cursor-pointer rounded-xl border-2 border-dashed p-6 text-center transition\n            ${dragOver ? \"border-indigo-400 bg-indigo-500/10\" : \"border-border hover:bg-background/40\"}`}\n        >\n          <input\n            ref={inputRef}\n            type=\"file\"\n            accept=\".csv,text/csv\"\n            className=\"hidden\"\n            onChange={onPick}\n          />\n          <div className=\"space-y-2\">\n            <div className=\"text-sm font-medium\">\n              {file ? (\n                <>\n                  Selected: <span className=\"text-indigo-300\">{file.name}</span>{\" \"}\n                  <span className=\"opacity-70\">({prettyBytes(file.size)})</span>\n                </>\n              ) : dragOver ? (\n                \"Drop your CSV to upload\"\n              ) : (\n                \"Click to choose a CSV or drag & drop here\"\n              )}\n            </div>\n            {!file && (\n              <p className=\"text-xs opacity-70\">\n                Accepts <code>.csv</code> • Example: <code>transactions_sample.csv</code>\n              </p>\n            )}\n          </div>\n        </label>\n\n        <div className=\"mt-4 flex items-center justify-end\">\n          <Button\n            variant=\"pill\"\n            onClick={doUpload}\n            disabled={disabled}\n            className=\"gap-2 px-3.5 h-9\"\n          >\n            <Upload className=\"h-4 w-4\" />\n            {busy ? \"Uploading…\" : \"Upload CSV\"}\n          </Button>\n        </div>\n\n        {/* Progress / Result */}\n        {busy && (\n          <div className=\"mt-4\">\n            <div className=\"h-2 w-full overflow-hidden rounded-full bg-gray-800\">\n              <div className=\"h-2 w-2/3 animate-pulse rounded-full bg-indigo-500\"></div>\n            </div>\n            <p className=\"mt-2 text-xs text-gray-400\">Sending file to server…</p>\n          </div>\n        )}\n\n        {result && (\n          <div\n            className={`mt-4 rounded-xl border p-3 text-sm ${\n              result.ok\n                ? \"border-emerald-700 bg-emerald-900/30 text-emerald-200\"\n                : \"border-rose-700 bg-rose-900/30 text-rose-200\"\n            }`}\n          >\n            <div className=\"font-medium\">\n              {result.ok ? \"Success\" : `Error${result.status ? ` (${result.status})` : \"\"}`}\n            </div>\n            {result.message && <div className=\"mt-1 opacity-90\">{result.message}</div>}\n            {result.data && (\n              <pre className=\"mt-2 max-h-48 overflow-auto rounded-lg bg-black/30 p-2 text-xs\">\n                {JSON.stringify(result.data, null, 2)}\n              </pre>\n            )}\n          </div>\n        )}\n  {/* hint removed per request */}\n    </div>\n  );\n};\n\nexport default UploadCsv;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\__tests__\\CardHelpTooltip.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[327,330],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[327,330],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[397,400],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[397,400],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\r\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react';\r\nimport CardHelpTooltip from '@/components/CardHelpTooltip';\r\n\r\n// Mock getHelp to emulate sequential what/why responses + ETag caching markers\r\nconst calls: any[] = [];\r\nvi.mock('@/lib/helpTooltip', () => ({\r\n  getHelp: (args: any) => {\r\n    calls.push(args);\r\n    if (args.mode === 'what') {\r\n      return Promise.resolve({ mode: 'what', source: 'deterministic', text: 'What text', etag: 'etag-what' });\r\n    }\r\n    return Promise.resolve({ mode: 'why', source: 'llm', text: 'Why text', etag: 'etag-why' });\r\n  },\r\n}));\r\n\r\ndescribe('CardHelpTooltip', () => {\r\n  beforeEach(() => {\r\n    document.body.innerHTML = '';\r\n    // Reset captured calls between tests so assertions on absence/presence are accurate\r\n    calls.length = 0;\r\n  });\r\n\r\n  it('opens and fetches what help on click', async () => {\r\n    render(<CardHelpTooltip cardId=\"cards.test\" ctx={{ foo: 'bar' }} baseText=\"Base\" />);\r\n    const btn = screen.getByRole('button', { name: /card help/i });\r\n    fireEvent.click(btn);\r\n    await screen.findByText('What text');\r\n    expect(screen.getByText('What text')).toBeInTheDocument();\r\n    // Tab defaults to What\r\n    expect(screen.getByRole('button', { name: 'What' })).toHaveClass('bg-accent');\r\n  });\r\n\r\n  it('switches to why tab and fetches why help', async () => {\r\n    render(<CardHelpTooltip cardId=\"cards.test\" ctx={{ foo: 'bar' }} baseText=\"Base summary\" />);\r\n    fireEvent.click(screen.getByRole('button', { name: /card help/i }));\r\n    await screen.findByText('What text');\r\n    const whyTab = screen.getByRole('button', { name: 'Why' });\r\n    fireEvent.click(whyTab);\r\n    await screen.findByText('Why text');\r\n    expect(screen.getByText('Why text')).toBeInTheDocument();\r\n  });\r\n\r\n  it('shift+click opens and loads why only (lazy skip what)', async () => {\r\n    render(<CardHelpTooltip cardId=\"cards.test\" ctx={{}} baseText=\"Base\" />);\r\n    const btn = screen.getByRole('button', { name: /card help/i });\r\n    fireEvent.click(btn, { shiftKey: true });\r\n    await waitFor(() => {\r\n      expect(screen.getByText('Why text')).toBeInTheDocument();\r\n    });\r\n    // Active tab is Why\r\n    expect(screen.getByRole('button', { name: 'Why' })).toHaveClass('bg-accent');\r\n    // Ensure no 'what' fetch happened\r\n    expect(calls.find(c => c.mode === 'what')).toBeUndefined();\r\n    expect(calls.filter(c => c.mode === 'why').length).toBe(1);\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\__tests__\\ChatDock.agui.dedupe2.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[425,428],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[425,428],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[484,487],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[484,487],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[492,495],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[492,495],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1209,1212],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1209,1212],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1228,1231],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1228,1231],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1252,1255],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1252,1255],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { render, screen, act, waitFor } from '@testing-library/react';\r\nimport userEvent from '@testing-library/user-event';\r\nimport { vi, describe, it, expect } from 'vitest';\r\nimport { AuthContext } from '@/state/auth';\r\nimport { MonthContext } from '@/context/MonthContext';\r\nimport { ChatDockProvider } from '@/context/ChatDockContext';\r\n\r\nvi.mock('@/lib/aguiStream', () => {\r\n  let handlers: any = null;\r\n  return {\r\n    wireAguiStream: vi.fn((_opts: any, h: any) => { handlers = h; return () => {}; }),\r\n    __getHandlers: () => handlers,\r\n  };\r\n});\r\nimport ChatDock from '../ChatDock';\r\nimport { wireAguiStream } from '@/lib/aguiStream';\r\n\r\nfunction Providers({ children }: { children: React.ReactNode }) {\r\n  return (\r\n    <AuthContext.Provider value={{\r\n      user: { email: 'tester@example.com', roles: [] },\r\n      authReady: true,\r\n      login: vi.fn(), register: vi.fn(), logout: vi.fn(), refresh: vi.fn(async () => true)\r\n    }}>\r\n      <MonthContext.Provider value={{ month: '2025-08', setMonth: () => {} }}>\r\n        <ChatDockProvider>{children}</ChatDockProvider>\r\n      </MonthContext.Provider>\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n\r\nfunction latestHandlers(): any {\r\n  const fn: any = wireAguiStream as any;\r\n  const calls = fn.mock?.calls || [];\r\n  return calls.length ? calls[calls.length - 1][1] : null;\r\n}\r\n\r\ndescribe('AG-UI: duplicate gateway/model suggestions de-dupe', () => {\r\n  it('renders only one chip after duplicate suggestions', async () => {\r\n    render(<Providers><ChatDock /></Providers>);\r\n    const openBtn = await screen.findByRole('button', { name: /open agent chat/i });\r\n    await userEvent.click(openBtn);\r\n    const input = await screen.findByRole('textbox');\r\n    await userEvent.type(input, 'Forecast next month{enter}');\r\n    await waitFor(() => expect(wireAguiStream).toHaveBeenCalled());\r\n    const h = latestHandlers();\r\n    await act(async () => {\r\n      h.onStart?.({ intent: 'forecast', month: '2025-08' });\r\n      h.onIntent?.('forecast');\r\n      h.onSuggestions?.([{ label: 'Set budget from forecast', action: 'budget_from_forecast', source: 'gateway' }]);\r\n      h.onSuggestions?.([{ label: 'Set budget from forecast', action: 'budget_from_forecast', source: 'model' }]);\r\n      h.onFinish?.();\r\n    });\r\n    const chips = screen.getAllByRole('button', { name: /Set budget from forecast/i });\r\n    expect(chips.length).toBe(1);\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\__tests__\\ChatDock.agui.error.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[446,449],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[446,449],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[492,495],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[492,495],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[507,510],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[507,510],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1443,1446],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1443,1446],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1502,1505],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1502,1505],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { describe, it, expect, vi } from 'vitest';\r\nimport { render, screen, act } from '@testing-library/react';\r\nimport userEvent from '@testing-library/user-event';\r\nimport ChatDock from '../ChatDock';\r\nimport { AuthContext } from '@/state/auth';\r\nimport { MonthContext } from '@/context/MonthContext';\r\nimport { ChatDockProvider } from '@/context/ChatDockContext';\r\n\r\nvi.mock('@/lib/aguiStream', () => {\r\n  let h: any; return {\r\n    wireAguiStream: vi.fn((_o: any, handlers: any) => { h = handlers; return () => {}; }),\r\n    __getHandlers: () => h,\r\n  };\r\n});\r\n\r\nfunction Providers({ children }: { children: React.ReactNode }) {\r\n  return (\r\n    <AuthContext.Provider value={{ user: { email: 't@example.com', roles: [] }, authReady: true, login: vi.fn(), register: vi.fn(), logout: vi.fn(), refresh: vi.fn(async () => true) }}>\r\n      <MonthContext.Provider value={{ month: '2025-08', setMonth: () => {} }}>\r\n        <ChatDockProvider>{children}</ChatDockProvider>\r\n      </MonthContext.Provider>\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n\r\ndescribe('AG-UI error fallback', () => {\r\n  it('marks fallback on onError', async () => {\r\n    render(<Providers><ChatDock /></Providers>);\r\n    const open = await screen.findByRole('button', { name: /open agent chat/i });\r\n    await userEvent.click(open);\r\n    const input = await screen.findByRole('textbox');\r\n    await userEvent.type(input, 'hi{enter}');\r\n  const wag: any = (await import('@/lib/aguiStream')).wireAguiStream as any;\r\n  const calls = wag.mock.calls;\r\n  const h = calls[calls.length - 1][1];\r\n  expect(h).toBeTruthy();\r\n    await act(async () => {\r\n      h.onStart?.({ intent: 'chat', month: '2025-08' });\r\n      h.onError?.(new Error('boom'));\r\n    });\r\n    expect(await screen.findByText(/fallback/i)).toBeInTheDocument();\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\__tests__\\ChatDock.agui.mixedTools.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[316,319],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[316,319],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[365,368],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[365,368],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[380,383],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[380,383],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[527,530],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[527,530],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":122,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":125,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[633,636],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[633,636],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[923,926],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[923,926],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[942,945],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[942,945],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[966,969],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[966,969],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { render, screen, act, waitFor } from '@testing-library/react';\r\nimport userEvent from '@testing-library/user-event';\r\nimport { vi, describe, it, expect } from 'vitest';\r\n\r\n// Mock using the same alias path ChatDock uses so the real stream impl is never invoked\r\nvi.mock('@/lib/aguiStream', () => {\r\n  let h: any;\r\n  return {\r\n    wireAguiStream: vi.fn((_o: any, handlers: any) => { h = handlers; return () => {}; }),\r\n    __getHandlers: () => h,\r\n  };\r\n});\r\n\r\n// Avoid any accidental real network fetch\r\n(globalThis as any).fetch = vi.fn(() => Promise.resolve(new Response(JSON.stringify({ ok: true }), { status: 200 }))) as any;\r\n\r\nimport ChatDock from '../ChatDock';\r\nimport { AuthContext } from '@/state/auth';\r\nimport { MonthContext } from '@/context/MonthContext';\r\nimport { ChatDockProvider } from '@/context/ChatDockContext';\r\nimport { wireAguiStream } from '@/lib/aguiStream';\r\n\r\nfunction latestHandlers(): any {\r\n  const fn: any = wireAguiStream as any;\r\n  const calls = fn.mock?.calls || [];\r\n  return calls.length ? calls[calls.length - 1][1] : null;\r\n}\r\n\r\nfunction Providers({ children }: { children: React.ReactNode }) {\r\n  return (\r\n    <AuthContext.Provider value={{\r\n      user: { email: 'tester@example.com', roles: [] },\r\n      authReady: true,\r\n      login: vi.fn(), register: vi.fn(), logout: vi.fn(), refresh: vi.fn(async () => true)\r\n    }}>\r\n      <MonthContext.Provider value={{ month: '2025-08', setMonth: () => {} }}>\r\n        <ChatDockProvider>{children}</ChatDockProvider>\r\n      </MonthContext.Provider>\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n\r\ndescribe('AG-UI: mixed tool success/failure', () => {\r\n  it('renders Skipped line with prettified analytics.* name', async () => {\r\n    render(<Providers><ChatDock /></Providers>);\r\n\r\n    // Open floating bubble first\r\n    const openBtn = await screen.findByRole('button', { name: /open agent chat/i });\r\n    await userEvent.click(openBtn);\r\n\r\n    const input = await screen.findByRole('textbox');\r\n    await userEvent.type(input, 'Overview{enter}', { delay: 1 });\r\n\r\n    await waitFor(() => expect(wireAguiStream).toHaveBeenCalledTimes(1));\r\n    const h = latestHandlers();\r\n    expect(h).toBeTruthy();\r\n\r\n    await act(async () => {\r\n      h.onStart?.({ intent: 'overview', month: '2025-08' });\r\n      h.onIntent?.('overview');\r\n      h.onToolStart?.('analytics.forecast.cashflow');\r\n      h.onToolEnd?.('analytics.forecast.cashflow', true);\r\n      h.onToolStart?.('analytics.kpis');\r\n      h.onToolEnd?.('analytics.kpis', false, 'service unavailable');\r\n      h.onChunk?.('Here is your overview…');\r\n    });\r\n    // Allow React effect updating aguiToolsRef to run before finish snapshot\r\n    await new Promise(r => setTimeout(r, 0));\r\n    await act(async () => { h.onFinish?.(); });\r\n\r\n  // Intent badge/message content (select specific badge to avoid multiple matches)\r\n  const badge = await waitFor(() => document.querySelector('.intent-badge')) as HTMLElement | null;\r\n  expect(badge).toBeTruthy();\r\n  expect(badge?.textContent).toMatch(/Overview/i);\r\n    // Skipped summary + prettified tool name (KPI)\r\n    const skipped = await screen.findByText(/Skipped:/i);\r\n    expect(skipped).toBeInTheDocument();\r\n    // prettyToolName only strips prefixes; analytics.kpis -> kpis\r\n    expect(skipped.textContent).toMatch(/kpis/i);\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\__tests__\\ChatDock.agui.noSuggestions.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[486,489],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[486,489],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[545,548],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[545,548],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[553,556],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[553,556],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1270,1273],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1270,1273],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1289,1292],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1289,1292],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1313,1316],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1313,1316],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { render, screen, act, waitFor } from '@testing-library/react';\r\nimport { expectBodyText } from '../../__tests__/utils/dom';\r\nimport userEvent from '@testing-library/user-event';\r\nimport { vi, describe, it, expect } from 'vitest';\r\nimport { AuthContext } from '@/state/auth';\r\nimport { MonthContext } from '@/context/MonthContext';\r\nimport { ChatDockProvider } from '@/context/ChatDockContext';\r\n\r\nvi.mock('@/lib/aguiStream', () => {\r\n  let handlers: any = null;\r\n  return {\r\n    wireAguiStream: vi.fn((_opts: any, h: any) => { handlers = h; return () => {}; }),\r\n    __getHandlers: () => handlers,\r\n  };\r\n});\r\nimport ChatDock from '../ChatDock';\r\nimport { wireAguiStream } from '@/lib/aguiStream';\r\n\r\nfunction Providers({ children }: { children: React.ReactNode }) {\r\n  return (\r\n    <AuthContext.Provider value={{\r\n      user: { email: 'tester@example.com', roles: [] },\r\n      authReady: true,\r\n      login: vi.fn(), register: vi.fn(), logout: vi.fn(), refresh: vi.fn(async () => true)\r\n    }}>\r\n      <MonthContext.Provider value={{ month: '2025-08', setMonth: () => {} }}>\r\n        <ChatDockProvider>{children}</ChatDockProvider>\r\n      </MonthContext.Provider>\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n\r\nfunction latestHandlers(): any {\r\n  const fn: any = wireAguiStream as any;\r\n  const calls = fn.mock?.calls || [];\r\n  return calls.length ? calls[calls.length - 1][1] : null;\r\n}\r\n\r\ndescribe('AG-UI: chat only (no tools, no suggestions)', () => {\r\n  it('shows Chat intent badge and no suggestion chips', async () => {\r\n    render(<Providers><ChatDock /></Providers>);\r\n    const openBtn = await screen.findByRole('button', { name: /open agent chat/i });\r\n    await userEvent.click(openBtn);\r\n    const input = await screen.findByRole('textbox');\r\n    await userEvent.type(input, 'hi{enter}');\r\n    await waitFor(() => expect(wireAguiStream).toHaveBeenCalled());\r\n    const h = latestHandlers();\r\n    await act(async () => {\r\n      h.onStart?.({ intent: 'chat', month: '2025-08' });\r\n      h.onIntent?.('chat');\r\n      h.onChunk?.('Hey! How can I help?');\r\n      h.onFinish?.();\r\n    });\r\n    const badge = await waitFor(() => document.querySelector('.intent-badge')) as HTMLElement | null;\r\n    expect(badge?.textContent).toMatch(/Chat/i);\r\n  await expectBodyText(/How can I help/i);\r\n    // Ensure no suggestion chip appears\r\n    expect(screen.queryByRole('button', { name: /Set budget from forecast/i })).toBeNull();\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\__tests__\\ChatDock.agui.suggestionsDedupe.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[442,445],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[442,445],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":83,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":86,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[482,485],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[482,485],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":97,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":100,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[496,499],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[496,499],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1467,1470],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1467,1470],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1526,1529],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1526,1529],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { describe, it, expect, vi } from 'vitest';\r\nimport { render, screen, act } from '@testing-library/react';\r\nimport userEvent from '@testing-library/user-event';\r\nimport ChatDock from '../ChatDock';\r\nimport { AuthContext } from '@/state/auth';\r\nimport { MonthContext } from '@/context/MonthContext';\r\nimport { ChatDockProvider } from '@/context/ChatDockContext';\r\n\r\nvi.mock('@/lib/aguiStream', () => { let h:any; return { wireAguiStream: vi.fn((_o:any, handlers:any)=>{ h=handlers; return ()=>{}; }), __getHandlers:()=>h }; });\r\n\r\nfunction Providers({ children }: { children: React.ReactNode }) {\r\n  return (\r\n    <AuthContext.Provider value={{ user: { email: 't@example.com', roles: [] }, authReady: true, login: vi.fn(), register: vi.fn(), logout: vi.fn(), refresh: vi.fn(async () => true) }}>\r\n      <MonthContext.Provider value={{ month: '2025-08', setMonth: () => {} }}>\r\n        <ChatDockProvider>{children}</ChatDockProvider>\r\n      </MonthContext.Provider>\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n\r\ndescribe('AG-UI suggestions de-dupe', () => {\r\n  it('renders one chip for duplicate model+gateway suggestion', async () => {\r\n    render(<Providers><ChatDock /></Providers>);\r\n    const open = await screen.findByRole('button', { name: /open agent chat/i });\r\n    await userEvent.click(open);\r\n    const input = await screen.findByRole('textbox');\r\n    await userEvent.type(input, 'Forecast next month{enter}');\r\n    const wag: any = (await import('@/lib/aguiStream')).wireAguiStream as any;\r\n    const h = wag.mock.calls.slice(-1)[0][1];\r\n    await act(async () => {\r\n      h.onStart?.({ intent: 'forecast', month: '2025-08' });\r\n      // gateway suggestions\r\n      h.onSuggestions?.([{ label: 'Set budget from forecast', action: 'budget_from_forecast', source: 'gateway' }]);\r\n      // Simulate model suggestions merging via pushAssistant (reuse gateway path by mutating store)\r\n      // We directly set a model suggestion through the chatResp meta adaptation path by appending assistant with suggestionsLLM semantics is complex; instead\r\n      // emulate duplicate insertion then rely on de-dupe logic (second onSuggestions with same chip)\r\n      h.onSuggestions?.([{ label: 'Set budget from forecast', action: 'budget_from_forecast', source: 'model' }]);\r\n      h.onFinish?.();\r\n    });\r\n    const chips = screen.getAllByText(/Set budget from forecast/i);\r\n    expect(chips.length).toBe(1);\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\__tests__\\ChatDock.agui.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[550,553],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[550,553],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[609,612],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[609,612],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[624,627],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[624,627],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[863,866],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[863,866],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":122,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":125,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[969,972],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[969,972],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1652,1655],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1652,1655],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1671,1674],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1671,1674],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1695,1698],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1695,1698],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":92,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3783,3786],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3783,3786],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":99,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4196,4199],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4196,4199],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { describe, it, expect, vi } from 'vitest';\r\nimport { render, screen, act, waitFor } from '@testing-library/react';\r\nimport { expectBodyText } from '../../__tests__/utils/dom';\r\nimport userEvent from '@testing-library/user-event';\r\nimport { AuthContext } from '@/state/auth';\r\nimport { MonthContext } from '@/context/MonthContext';\r\nimport { ChatDockProvider } from '@/context/ChatDockContext';\r\n\r\n// 1) Mock the stream helper (alias path used by ChatDock)\r\nvi.mock('@/lib/aguiStream', () => {\r\n  let lastHandlers: any = null;\r\n  return {\r\n    wireAguiStream: vi.fn((_opts: any, handlers: any) => { lastHandlers = handlers; return () => {}; }),\r\n    __getHandlers: () => lastHandlers,\r\n  };\r\n});\r\n\r\n// 2) Mock global fetch (avoid network); minimal Response poly if needed\r\n// Use globalThis for TS compatibility\r\n(globalThis as any).fetch = vi.fn(() => Promise.resolve(new Response(JSON.stringify({ ok: true }), { status: 200 }))) as any;\r\n\r\n// 3) Import after mocks so mocked module is used\r\nimport ChatDock from '../ChatDock';\r\nimport { wireAguiStream } from '@/lib/aguiStream';\r\n\r\nfunction Providers({ children }: { children: React.ReactNode }) {\r\n  return (\r\n    <AuthContext.Provider value={{\r\n      user: { email: 'tester@example.com', roles: [] },\r\n      authReady: true,\r\n      login: vi.fn(), register: vi.fn(), logout: vi.fn(), refresh: vi.fn(async () => true)\r\n    }}>\r\n      <MonthContext.Provider value={{ month: '2025-08', setMonth: () => {} }}>\r\n        <ChatDockProvider>{children}</ChatDockProvider>\r\n      </MonthContext.Provider>\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n\r\nfunction latestHandlers(): any {\r\n  const fn: any = wireAguiStream as any;\r\n  const calls = fn.mock?.calls || [];\r\n  if (!calls.length) return null;\r\n  return calls[calls.length - 1][1];\r\n}\r\n\r\ndescribe('ChatDock AG-UI (streaming via wireAguiStream mock)', () => {\r\n  it('renders intent badge + suggestions from mocked stream', async () => {\r\n    render(<Providers><ChatDock /></Providers>);\r\n\r\n    // Open the dock (floating bubble)\r\n    const openBtn = await screen.findByRole('button', { name: /open agent chat/i });\r\n    await userEvent.click(openBtn);\r\n\r\n    const input = await screen.findByRole('textbox');\r\n    await userEvent.type(input, 'Forecast next month{enter}', { delay: 1 });\r\n\r\n    await waitFor(() => expect(wireAguiStream).toHaveBeenCalledTimes(1));\r\n    const h = latestHandlers();\r\n    expect(h).toBeTruthy();\r\n\r\n    await act(async () => {\r\n      h.onStart?.({ intent: 'forecast', month: '2025-08' });\r\n      h.onIntent?.('forecast');\r\n    });\r\n    // Wait for intent badge before proceeding (ensures meta applied before final assistant append)\r\n    const badge = await waitFor(() => document.querySelector('.intent-badge')) as HTMLElement | null;\r\n    expect(badge).toBeTruthy();\r\n    expect(badge?.textContent).toMatch(/Forecast/i);\r\n\r\n    await act(async () => {\r\n      h.onToolStart?.('analytics.forecast.cashflow');\r\n      h.onToolEnd?.('analytics.forecast.cashflow', true);\r\n      h.onChunk?.('Projected spend ~$2,140.');\r\n      h.onSuggestions?.([\r\n        { label: 'Set budget from forecast', action: 'budget_from_forecast', source: 'gateway' },\r\n        { label: 'Compare vs last month', action: 'compare_prev', source: 'gateway' }\r\n      ]);\r\n      h.onFinish?.();\r\n    });\r\n\r\n  // Aggregated assistant message (streamed fragments tolerant)\r\n  await expectBodyText(/Projected spend/i);\r\n  await expectBodyText(/2[, ]?140/);\r\n    // Suggestion chips\r\n    expect(await screen.findByText(/Set budget from forecast/i)).toBeInTheDocument();\r\n    expect(await screen.findByText(/Compare vs last month/i)).toBeInTheDocument();\r\n  });\r\n\r\n  it('button path uses wireAguiStream with mode=forecast', async () => {\r\n    (wireAguiStream as any).mockClear();\r\n    render(<Providers><ChatDock /></Providers>);\r\n    const openBtn = await screen.findByRole('button', { name: /open agent chat/i });\r\n    await userEvent.click(openBtn);\r\n    const btn = await screen.findByRole('button', { name: /^forecast$/i });\r\n    await userEvent.click(btn);\r\n    await waitFor(() => expect(wireAguiStream).toHaveBeenCalledTimes(1));\r\n    const call = (wireAguiStream as any).mock.calls.slice(-1)[0];\r\n    expect(call[0]).toEqual(expect.objectContaining({ mode: 'forecast' }));\r\n    const h2 = latestHandlers();\r\n  await act(async () => { h2.onStart?.({ intent: 'forecast', month: '2025-08' }); h2.onIntent?.('forecast'); });\r\n  const badge2 = await waitFor(() => document.querySelector('.intent-badge')) as HTMLElement | null;\r\n  expect(badge2?.textContent).toMatch(/Forecast/i);\r\n  await act(async () => { h2.onFinish?.(); });\r\n  });\r\n});\r\n\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\__tests__\\ChatDock.agui.toolErrors.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[442,445],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[442,445],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":83,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":86,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[482,485],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[482,485],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":97,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":100,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[496,499],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[496,499],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[638,641],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[638,641],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":96,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":99,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[718,721],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[718,721],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1599,1602],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1599,1602],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1658,1661],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1658,1661],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { describe, it, expect, vi } from 'vitest';\r\nimport { render, screen, act } from '@testing-library/react';\r\nimport userEvent from '@testing-library/user-event';\r\nimport ChatDock from '../ChatDock';\r\nimport { AuthContext } from '@/state/auth';\r\nimport { MonthContext } from '@/context/MonthContext';\r\nimport { ChatDockProvider } from '@/context/ChatDockContext';\r\n\r\nvi.mock('@/lib/aguiStream', () => { let h:any; return { wireAguiStream: vi.fn((_o:any, handlers:any)=>{ h=handlers; return ()=>{}; }), __getHandlers:()=>h }; });\r\n\r\n// Ensure fetch is mocked to avoid real network attempts\r\n(globalThis as any).fetch = vi.fn(() => Promise.resolve(new Response('{}',{ status:200 }))) as any;\r\n\r\nfunction Providers({ children }: { children: React.ReactNode }) {\r\n  return (\r\n    <AuthContext.Provider value={{ user: { email: 't@example.com', roles: [] }, authReady: true, login: vi.fn(), register: vi.fn(), logout: vi.fn(), refresh: vi.fn(async () => true) }}>\r\n      <MonthContext.Provider value={{ month: '2025-08', setMonth: () => {} }}>\r\n        <ChatDockProvider>{children}</ChatDockProvider>\r\n      </MonthContext.Provider>\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n\r\ndescribe('AG-UI tool error summary', () => {\r\n  it('appends Skipped line for failed tools', async () => {\r\n    render(<Providers><ChatDock /></Providers>);\r\n    const open = await screen.findByRole('button', { name: /open agent chat/i });\r\n    await userEvent.click(open);\r\n    const input = await screen.findByRole('textbox');\r\n    await userEvent.type(input, 'Show KPIs{enter}');\r\n    const wag: any = (await import('@/lib/aguiStream')).wireAguiStream as any;\r\n    const h = wag.mock.calls.slice(-1)[0][1];\r\n    await act(async () => { h.onStart?.({ intent: 'kpis', month: '2025-08' }); });\r\n    await act(async () => {\r\n      h.onToolStart?.('analytics.kpis');\r\n      h.onToolEnd?.('analytics.kpis', false, 'service unavailable');\r\n      h.onChunk?.('Partial data…');\r\n    });\r\n    // allow state update for aguiTools before finish\r\n    await new Promise(r=>setTimeout(r,0));\r\n    await act(async () => { h.onFinish?.(); });\r\n    const skipped = await screen.findByText(/Skipped:/i);\r\n    expect(skipped.textContent).toMatch(/kpis/i);\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\__tests__\\ChatDock.rephrase.tools.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\__tests__\\DevMenuItem.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[365,368],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[365,368],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from 'vitest';\r\nimport { render, fireEvent } from '@testing-library/react';\r\nimport DevMenuItem from '@/components/DevMenuItem';\r\nimport * as useDev from '@/state/useDevUI';\r\n\r\n// Minimal mock for dropdown menu item wrapper expectations\r\nvi.mock('@/components/ui/dropdown-menu', () => ({\r\n  DropdownMenuItem: (props: any) => <div role=\"menuitem\" {...props} />\r\n}));\r\n\r\ndescribe('DevMenuItem', () => {\r\n  beforeEach(() => {\r\n    localStorage.clear();\r\n    vi.restoreAllMocks();\r\n  });\r\n\r\n  it('toggles persistently without alt key', () => {\r\n    const spy = vi.spyOn(useDev, 'setDevUIEnabled');\r\n    const { getByRole } = render(<DevMenuItem />);\r\n    const item = getByRole('menuitem');\r\n    fireEvent.click(item); // persistent toggle\r\n    expect(spy).toHaveBeenCalledTimes(1);\r\n  });\r\n\r\n  it('performs soft toggle with alt+click (no persistence)', () => {\r\n    const persistentSpy = vi.spyOn(useDev, 'setDevUIEnabled');\r\n    const softSpy = vi.spyOn(useDev, 'setDevUIEnabledSoft');\r\n    const { getByRole } = render(<DevMenuItem />);\r\n    const item = getByRole('menuitem');\r\n    fireEvent.click(item, { altKey: true });\r\n    expect(softSpy).toHaveBeenCalledTimes(1);\r\n    expect(persistentSpy).not.toHaveBeenCalled();\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\__tests__\\ExplainSignalDrawer.error.test.tsx","messages":[{"ruleId":"no-extra-semi","severity":2,"message":"Unnecessary semicolon.","line":20,"column":5,"nodeType":"EmptyStatement","messageId":"unexpected","endLine":20,"endColumn":6,"fix":{"range":[626,634],"text":"{\n    ("}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[648,651],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[648,651],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import React from 'react'\nimport { describe, it, expect, vi, beforeEach } from 'vitest'\nimport { render, screen, waitFor, cleanup } from '@testing-library/react'\n\nvi.mock('@/api', async (importOriginal) => {\n  const mod = await importOriginal() as typeof import('@/api')\n  return { ...mod, getExplain: vi.fn() }\n})\n\nimport ExplainSignalDrawer from '@/components/ExplainSignalDrawer'\nimport { getExplain } from '@/api'\n\ndescribe('ExplainSignalDrawer – error state', () => {\n  beforeEach(() => {\n    cleanup()\n    vi.clearAllMocks()\n  })\n\n  it('shows skeletons, then replaces them with an error message on failure', async () => {\n    ;(getExplain as any).mockRejectedValue(new Error('load failed'))\n\n    render(<ExplainSignalDrawer txnId={555} open={true} onOpenChange={() => {}} />)\n\n    // while fetching, skeletons should be present\n    expect(screen.getAllByTestId('skeleton').length).toBeGreaterThan(0)\n\n    // then an error message should appear and skeletons disappear\n    await waitFor(() => {\n      expect(screen.getByText(/load failed/i)).toBeTruthy()\n    })\n    expect(screen.queryByTestId('skeleton')).toBeNull()\n  })\n})\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\__tests__\\ExplainSignalDrawer.fallback.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1182,1185],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1182,1185],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1216,1219],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1216,1219],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1410,1413],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1410,1413],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":52,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2121,2124],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2121,2124],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2155,2158],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2155,2158],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2353,2356],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2353,2356],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react'\r\nimport { describe, it, expect, vi, beforeEach } from 'vitest'\r\nimport { render, screen, waitFor, cleanup } from '@testing-library/react'\r\n\r\nvi.mock('@/api', async (importOriginal) => {\r\n  const mod = await importOriginal() as typeof import('@/api')\r\n  return { ...mod, getExplain: vi.fn() }\r\n})\r\n\r\nimport ExplainSignalDrawer from '@/components/ExplainSignalDrawer'\r\nimport { getExplain, type ExplainResponse } from '@/api'\r\n\r\nconst baseTxn = { id: 777, date: '2025-09-01', merchant: 'Target', amount: -25.15, category: 'Groceries' }\r\nconst evidence = { merchant_norm: 'target', rule_match: { id: 12, category: 'Groceries' }, similar: { total: 1, by_category: [{ category: 'Groceries', count: 1 }] }, feedback: { merchant_feedback: [] } }\r\n\r\nfunction renderDrawer() {\r\n  return render(<ExplainSignalDrawer txnId={777} open={true} onOpenChange={() => {}} txn={baseTxn} />)\r\n}\r\n\r\ndescribe('ExplainSignalDrawer – deterministic fallback rendering', () => {\r\n  beforeEach(() => {\r\n    cleanup()\r\n    vi.clearAllMocks()\r\n  })\r\n\r\n  it('renders fallback HTML when rationale is short', async () => {\r\n    const mockShort: ExplainResponse = {\r\n      txn: baseTxn as any,\r\n      evidence: evidence as any,\r\n      candidates: [{ source: 'rule', category: 'Groceries', confidence: 1 }],\r\n      rationale: 'ok',\r\n      llm_rationale: null,\r\n      mode: 'deterministic',\r\n    }\r\n    ;(getExplain as any).mockResolvedValue(mockShort)\r\n\r\n    renderDrawer()\r\n    await waitFor(() => expect(screen.getByTestId('explain-drawer')).toBeTruthy())\r\n\r\n    // Fallback badge appears\r\n    await screen.findByText(/fallback/i)\r\n\r\n    // Fallback explanatory paragraph text snippet\r\n    expect(screen.getByText(/deterministic signals/i)).toBeTruthy()\r\n    // Evidence list item from rule\r\n    expect(screen.getByText(/Matched rule:/i)).toBeTruthy()\r\n  })\r\n\r\n  it('renders original rationale when content is sufficiently long', async () => {\r\n    const longText = 'This transaction was categorized as Groceries based on prior labeling and explicit rule match.'\r\n    const mockLong: ExplainResponse = {\r\n      txn: baseTxn as any,\r\n      evidence: evidence as any,\r\n      candidates: [{ source: 'rule', category: 'Groceries', confidence: 1 }],\r\n      rationale: longText,\r\n      llm_rationale: null,\r\n      mode: 'deterministic',\r\n    }\r\n    ;(getExplain as any).mockResolvedValue(mockLong)\r\n\r\n    renderDrawer()\r\n    await waitFor(() => expect(screen.getByTestId('explain-drawer')).toBeTruthy())\r\n\r\n    // Should not show fallback chip\r\n    expect(screen.queryByText(/fallback/i)).toBeNull()\r\n\r\n    // Should show the long rationale verbatim\r\n    expect(screen.getByText(longText.slice(0, 40), { exact: false })).toBeTruthy()\r\n\r\n    // Should not render the deterministic signals paragraph\r\n    expect(screen.queryByText(/deterministic signals/i)).toBeNull()\r\n  })\r\n})\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\__tests__\\ExplainSignalDrawer.integration.test.tsx","messages":[{"ruleId":"no-extra-semi","severity":2,"message":"Unnecessary semicolon.","line":39,"column":5,"nodeType":"EmptyStatement","messageId":"unexpected","endLine":39,"endColumn":6,"fix":{"range":[1385,1393],"text":"{\n    ("}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1407,1410],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1407,1410],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-extra-semi","severity":2,"message":"Unnecessary semicolon.","line":57,"column":5,"nodeType":"EmptyStatement","messageId":"unexpected","endLine":57,"endColumn":6,"fix":{"range":[2190,2198],"text":"{\n    ("}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2212,2215],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2212,2215],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":2,"fixableWarningCount":0,"source":"import React from 'react'\nimport { describe, it, expect, vi, beforeEach } from 'vitest'\nimport { render, screen, waitFor, cleanup } from '@testing-library/react'\nimport userEvent from '@testing-library/user-event'\n\n// Mock API\nvi.mock('@/api', async (importOriginal) => {\n  const mod = await importOriginal() as typeof import('@/api')\n  return {\n    ...mod,\n    getExplain: vi.fn(),\n  }\n})\n\nimport ExplainSignalDrawer from '@/components/ExplainSignalDrawer'\nimport { getExplain, type ExplainResponse } from '@/api'\n\nconst mockExplain: ExplainResponse = {\n  txn: { id: 999, date: '2025-08-01', merchant: 'Starbucks', amount: -4.5, category: 'Coffee' },\n  evidence: {\n    merchant_norm: 'starbucks',\n    similar: { total: 12, by_category: [{ category: 'Coffee', count: 12 }], recent_samples: [{ id: 1, amount: -4.5, date: '2025-08-01', category: 'Coffee' }] },\n    feedback: { merchant_feedback: [{ category: 'Coffee', positives: 12, negatives: 0 }] },\n    rule_match: null,\n  },\n  candidates: [{ source: 'history', category: 'Coffee', confidence: 0.9 }],\n  rationale: 'We\\u2019ve seen starbucks labeled as Coffee 12 time(s).',\n  llm_rationale: null,\n  mode: 'deterministic',\n}\n\ndescribe('ExplainSignalDrawer – integration (open/close)', () => {\n  beforeEach(() => {\n    cleanup()\n    vi.clearAllMocks()\n  })\n\n  it('mounts closed, renders when opened, unmounts when closed', async () => {\n    ;(getExplain as any).mockResolvedValue(mockExplain)\n    const onOpenChange = vi.fn()\n\n    const { rerender } = render(<ExplainSignalDrawer txnId={999} open={false} onOpenChange={onOpenChange} />)\n    expect(screen.queryByTestId('explain-drawer')).toBeNull()\n\n    rerender(<ExplainSignalDrawer txnId={999} open={true} onOpenChange={onOpenChange} />)\n\n    await waitFor(() => expect(screen.getByTestId('explain-drawer')).toBeTruthy())\n    // deterministic chip should render\n    await screen.findByText(/Deterministic/i)\n\n    // Close via prop\n    rerender(<ExplainSignalDrawer txnId={999} open={false} onOpenChange={onOpenChange} />)\n    await waitFor(() => expect(screen.queryByTestId('explain-drawer')).toBeNull())\n  })\n\n  it('calls onOpenChange(false) when clicking the Close button', async () => {\n    ;(getExplain as any).mockResolvedValue(mockExplain)\n\n    const user = userEvent.setup()\n    const onOpenChange = vi.fn()\n\n    render(<ExplainSignalDrawer txnId={999} open={true} onOpenChange={onOpenChange} />)\n\n    await waitFor(() => expect(screen.getByTestId('explain-drawer')).toBeTruthy())\n\n    await user.click(screen.getByTestId('drawer-close'))\n    expect(onOpenChange).toHaveBeenCalled()\n    expect(onOpenChange).toHaveBeenCalledWith(false)\n  })\n})\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\__tests__\\ExplainSignalDrawer.llm-close.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1407,1410],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1407,1410],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react'\nimport { describe, it, expect, vi, beforeEach } from 'vitest'\nimport { render, screen, waitFor, cleanup } from '@testing-library/react'\nimport userEvent from '@testing-library/user-event'\n\nvi.mock('@/api', async (importOriginal) => {\n  const mod = await importOriginal() as typeof import('@/api')\n  return { ...mod, getExplain: vi.fn() }\n})\n\nimport ExplainSignalDrawer from '@/components/ExplainSignalDrawer'\nimport { getExplain, type ExplainResponse } from '@/api'\n\ndescribe('ExplainSignalDrawer – LLM mode close behavior', () => {\n  beforeEach(() => {\n    cleanup()\n    vi.clearAllMocks()\n  })\n\n  it('renders LLM badge/lead and calls onOpenChange(false) when Close is clicked', async () => {\n    const mock: ExplainResponse = {\n      txn: { id: 4242, date: '2025-08-03', merchant: 'Starbucks', amount: -3.21, category: 'Coffee' },\n      evidence: {\n        merchant_norm: 'starbucks',\n        similar: { total: 12, by_category: [{ category: 'Coffee', count: 12 }] },\n        feedback: { merchant_feedback: [{ category: 'Coffee', positives: 7, negatives: 0 }] },\n        rule_match: null,\n      },\n      candidates: [{ source: 'history', category: 'Coffee', confidence: 0.95 }],\n      rationale: 'Base deterministic',\n      llm_rationale: 'This was classified as Coffee because you consistently mark Starbucks as Coffee (12 prior).',\n      mode: 'llm',\n    }\n\n    ;(getExplain as any).mockResolvedValue(mock)\n\n    const onOpenChange = vi.fn()\n    const user = userEvent.setup()\n\n    render(<ExplainSignalDrawer txnId={4242} open={true} onOpenChange={onOpenChange} />)\n\n    await waitFor(() => {\n      expect(screen.getByTestId('explain-drawer')).toBeTruthy()\n      expect(screen.getByText(/LLM rephrase/i)).toBeTruthy()\n    })\n\n    // lead should come from llm_rationale\n    expect(\n      screen.getByText(/This was classified as Coffee because you consistently mark Starbucks/i)\n    ).toBeTruthy()\n\n    // Close behavior\n    await user.click(screen.getByTestId('drawer-close'))\n    expect(onOpenChange).toHaveBeenCalledTimes(1)\n    expect(onOpenChange).toHaveBeenCalledWith(false)\n  })\n})\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\__tests__\\ExplainSignalDrawer.llm.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\__tests__\\ForecastCard.reset.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":84,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":87,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[827,830],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[827,830],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1459,1462],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1459,1462],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { describe, it, expect, vi } from 'vitest';\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react';\n\nimport ForecastCard from '@/components/ForecastCard';\nimport { MonthContext } from '@/context/MonthContext';\nimport { analytics } from '@/lib/api';\n\n// Keep the test focused: stub heavy subcomponents\nvi.mock('@/components/ExplainButton', () => ({\n  default: () => <div data-testid=\"explain-btn\" />,\n}));\nvi.mock('@/components/ForecastChart', () => ({\n  default: () => <div data-testid=\"forecast-chart\" />,\n}));\n\ndescribe('ForecastCard Reset auto-run', () => {\n  it('calls analytics.forecast with defaults after Reset', async () => {\n    const spy = vi\n      .spyOn(analytics, 'forecast')\n      .mockResolvedValue({ ok: true, model: 'auto', ci_alpha: 0.2, points: [] } as any);\n\n    render(\n      <MonthContext.Provider value={{ month: '2025-08', setMonth: () => {} }}>\n        <ForecastCard />\n      </MonthContext.Provider>\n    );\n\n    // Initial auto-run once on mount\n    await waitFor(() => expect(spy).toHaveBeenCalledTimes(1));\n\n    // Click Reset and expect another call with default params\n    const resetBtn = screen.getByRole('button', { name: /reset/i });\n    fireEvent.click(resetBtn);\n\n    await waitFor(() => expect(spy).toHaveBeenCalledTimes(2));\n\n  const last = spy.mock.calls[spy.mock.calls.length - 1]!;\n  const [calledMonth, calledHorizon, opts] = last as unknown as [string, number, any];\n    expect(calledMonth).toBe('2025-08');\n    expect(calledHorizon).toBe(3);\n    expect(opts).toEqual(expect.objectContaining({ model: 'auto', ciLevel: 0.8 }));\n  });\n});\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\__tests__\\ForecastCard.ui-chip.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[538,541],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[538,541],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":94,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":97,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[914,917],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[914,917],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { describe, it, expect, vi } from 'vitest';\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react';\n\nimport ForecastCard from '@/components/ForecastCard';\nimport { MonthContext } from '@/context/MonthContext';\nimport { analytics } from '@/lib/api';\n\nvi.mock('@/components/ExplainButton', () => ({\n  default: () => <div data-testid=\"explain-btn\" />,\n}));\n\n// Render a simple stub for ForecastChart we can assert on\nvi.mock('@/components/ForecastChart', () => ({\n  default: ({ data }: any) => <div data-testid=\"forecast-chart\">points:{Array.isArray(data?.points) ? data.points.length : 0}</div>,\n}));\n\ndescribe('ForecastCard UI', () => {\n  it('shows CI chip and renders chart after Reset auto-run', async () => {\n    const spy = vi\n      .spyOn(analytics, 'forecast')\n      .mockResolvedValue({ ok: true, model: 'auto', ci_alpha: 0.2, points: [{}, {}, {}] } as any);\n\n    render(\n      <MonthContext.Provider value={{ month: '2025-08', setMonth: () => {} }}>\n        <ForecastCard />\n      </MonthContext.Provider>\n    );\n\n    // Wait for initial auto-run render\n    await waitFor(() => expect(spy).toHaveBeenCalledTimes(1));\n\n    // Click Reset to ensure UI flows from a user action\n    const resetBtn = screen.getByRole('button', { name: /reset/i });\n    fireEvent.click(resetBtn);\n\n    await waitFor(() => expect(spy).toHaveBeenCalledTimes(2));\n\n    // Chip should reflect AUTO and CI 80%\n    expect(screen.getByText(/model:\\s*auto/i)).toBeTruthy();\n    expect(screen.getByText(/ci\\s*80%/i)).toBeTruthy();\n\n    // Chart stub should be present\n    expect(screen.getByTestId('forecast-chart')).toBeTruthy();\n  });\n});\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\__tests__\\HelpBadge.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[782,785],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[782,785],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { describe, it, expect, vi } from 'vitest';\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react';\nimport HelpBadge from '@/components/HelpBadge';\n\n// Mock useExplain to capture calls\nvi.mock('@/hooks/useExplain', () => {\n  const explain = vi.fn();\n  return {\n    useExplain: () => ({ open: false, setOpen: vi.fn(), loading: false, text: '', explain }),\n  };\n});\n\ndescribe('HelpBadge', () => {\n  it('calls explain on click', async () => {\n    render(<HelpBadge k=\"cards.month_summary\" month=\"2025-08\" />);\n    const btn = screen.getByRole('button', { name: /explain this/i });\n    fireEvent.click(btn);\n\n    const { useExplain } = await import('@/hooks/useExplain');\n    const hook = useExplain();\n    expect((hook.explain as any)).toHaveBeenCalledWith('cards.month_summary', { month: '2025-08', withContext: true });\n  });\n\n  it('dispatches toggle event on shift+click', async () => {\n    const dispatchSpy = vi.spyOn(window, 'dispatchEvent');\n    render(<HelpBadge k=\"cards.month_summary\" />);\n    const btn = screen.getAllByRole('button', { name: /explain this/i })[0];\n    fireEvent.click(btn, { shiftKey: true });\n    await waitFor(() => {\n      expect(dispatchSpy).toHaveBeenCalled();\n      const evt = (dispatchSpy.mock.calls[0]?.[0]) as Event;\n      expect(evt?.type).toBe('help-mode:toggle');\n    });\n  });\n});\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\__tests__\\HelpExplainListener.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\__tests__\\HelpMode.overlay.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\__tests__\\QuickChips.spec.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\__tests__\\TransactionsPanel.smoke.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[221,224],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[221,224],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from 'vitest'\r\nimport { render, screen } from '@testing-library/react'\r\nimport React from 'react'\r\n\r\nvi.mock('@/lib/api', async () => {\r\n  const mod = await vi.importActual<any>('@/lib/api')\r\n  return {\r\n    ...mod,\r\n    listTxns: vi.fn(async () => ({ items: [], total: 0, limit: 50, offset: 0 })),\r\n  }\r\n})\r\n\r\nimport TransactionsPanel from '../TransactionsPanel'\r\n\r\ndescribe('TransactionsPanel (smoke)', () => {\r\n  beforeEach(() => {\r\n    vi.clearAllMocks()\r\n  })\r\n  it('renders empty state without crashing', async () => {\r\n    render(<TransactionsPanel />)\r\n    const empty = await screen.findByText(/No transactions\\./i)\r\n    expect(empty).toBeTruthy()\r\n  const bulkBtn = await screen.findByRole('button', { name: /Bulk Edit/i })\r\n  expect((bulkBtn as HTMLButtonElement).disabled).toBe(true)\r\n  })\r\n})\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\__tests__\\_isolate_auth_import.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\agent-tools\\runAndRephrase.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[375,378],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[375,378],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[470,473],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[470,473],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { runToolWithRephrase } from \"@/lib/tools-runner\";\n\n/**\n * Thin wrapper for deterministic tool run + LLM rephrase into chat.\n * Keeps a simpler name for callers while delegating to the shared runner.\n */\nexport async function runAndRephrase<T>(\n  tool: string,\n  fetcher: () => Promise<T>,\n  promptBuilder: (data: T) => string,\n  appendAssistant: (msg: string, meta?: any) => void,\n  setThinking: (on: boolean) => void,\n  buildRephraseMeta?: () => Record<string, any>\n) {\n  return runToolWithRephrase(tool, fetcher, promptBuilder, appendAssistant, setThinking, buildRephraseMeta);\n}\n\nexport default runAndRephrase;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\bulk\\BulkEditDialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[634,637],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[634,637],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[832,835],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[832,835],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[926,929],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[926,929],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\r\nimport { bulkPatchTxns } from \"@/lib/api\";\r\nimport { Button } from \"@/components/ui/button\";\r\n\r\nexport default function BulkEditDialog({ open, onOpenChange, ids, onSaved }:{ open:boolean; onOpenChange:(v:boolean)=>void; ids:number[]; onSaved:(updated:number)=>void }){\r\n  const [form, setForm] = React.useState<{ category?: string; note?: string }>(() => ({ category: \"\", note: \"\" }));\r\n  const [saving, setSaving] = React.useState(false);\r\n  const [error, setError] = React.useState<string | null>(null);\r\n\r\n  async function onSave() {\r\n    setSaving(true); setError(null);\r\n    try {\r\n      const patch: any = {};\r\n      if (form.category) patch.category = form.category;\r\n      if (form.note) patch.note = form.note;\r\n      const res = await bulkPatchTxns(ids, patch);\r\n      const n = Number((res as any)?.updated ?? ids.length);\r\n      onSaved(n);\r\n      onOpenChange(false);\r\n    } catch (e: any) {\r\n      setError(e?.message || String(e));\r\n    } finally { setSaving(false); }\r\n  }\r\n\r\n  if (!open) return null;\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex\">\r\n      <div className=\"absolute inset-0 bg-black/50\" onClick={()=>onOpenChange(false)} />\r\n      <div className=\"relative z-10 bg-background border border-border rounded-xl m-auto p-4 w-[460px]\">\r\n        <div className=\"text-base font-semibold mb-2\">Bulk edit ({ids.length})</div>\r\n        {error && <div className=\"text-sm text-amber-300/90 bg-amber-500/10 border border-amber-500/30 rounded p-2 mb-2\">{error}</div>}\r\n        <div className=\"space-y-2\">\r\n          <label className=\"block text-sm\">\r\n            <span className=\"block opacity-70 mb-1\">Category</span>\r\n            <input className=\"w-full bg-neutral-900 border border-neutral-800 rounded px-2 py-1\" value={form.category ?? ''} onChange={(e)=>setForm(f=>({...f, category:e.target.value}))} placeholder=\"Leave blank to keep\" />\r\n          </label>\r\n          <label className=\"block text-sm\">\r\n            <span className=\"block opacity-70 mb-1\">Note</span>\r\n            <input className=\"w-full bg-neutral-900 border border-neutral-800 rounded px-2 py-1\" value={form.note ?? ''} onChange={(e)=>setForm(f=>({...f, note:e.target.value}))} placeholder=\"Leave blank to keep\" />\r\n          </label>\r\n        </div>\r\n        <div className=\"mt-3 flex gap-2 justify-end\">\r\n          <Button variant=\"pill-outline\" onClick={()=>onOpenChange(false)} disabled={saving}>Cancel</Button>\r\n          <Button variant=\"pill-primary\" className=\"h-9 px-4\" onClick={onSave} disabled={saving || ids.length===0}>Save</Button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\dev\\DevBadge.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":79,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2218,2221],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2218,2221],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":79,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2249,2252],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2249,2252],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":96,"column":104,"nodeType":"BlockStatement","messageId":"unexpected","endLine":96,"endColumn":106,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[3058,3058],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from \"react\"\nimport { useDevUISoftStatus } from \"@/state/useDevUI\";\nimport { GitBranch, Check, Rocket, ShieldCheck, Settings2, Wrench, Info } from \"lucide-react\"\nimport { Button } from \"@/components/ui/button\"\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\"\nimport { getHealthz, type Healthz } from \"@/lib/api\"\nimport Pill from \"@/components/ui/pill\"\n\ntype Flags = {\n  dev: boolean\n  ruleTester: boolean\n  mlSelftest: boolean\n  planner: boolean\n  helpRephrase: boolean\n}\n\nfunction read(key: string, fallback = \"0\") {\n  return (localStorage.getItem(key) ?? fallback) === \"1\"\n}\nfunction write(key: string, on: boolean) {\n  localStorage.setItem(key, on ? \"1\" : \"0\")\n}\n\ntype Props = {\n  branch?: string;\n  commit?: string;\n  openDevDock?: boolean;\n  onToggleDevDock?: () => void;\n}\n\nexport default function DevBadge({ branch, commit, openDevDock, onToggleDevDock }: Props) {\n  const [flags, setFlags] = useState<Flags>({ dev: true, ruleTester: true, mlSelftest: true, planner: true, helpRephrase: true })\n  const [open, setOpen] = useState(false)\n  const [health, setHealth] = useState<Healthz | null>(null)\n\n  useEffect(() => {\n    setFlags({\n      dev: read(\"DEV_UI\", \"1\"),\n      ruleTester: read(\"FEATURE_RULE_TESTER\", \"1\"),\n      mlSelftest: read(\"FEATURE_ML_SELFTEST\", \"1\"),\n      planner: read(\"FEATURE_PLANNER\", \"1\"),\n      helpRephrase: read(\"HELP_REPHRASE\", (import.meta.env.VITE_HELP_REPHRASE_DEFAULT ?? '1')),\n    })\n  }, [])\n\n  const toggle = (key: keyof Flags, storageKey: string) => (v: boolean) => {\n    setFlags(s => ({ ...s, [key]: v }))\n    write(storageKey, v)\n  }\n\n  const reload = () => window.location.reload()\n\n  const softStatus = useDevUISoftStatus();\n\n  // Fetch health when menu opens\n  useEffect(() => {\n    let alive = true\n    if (!open) return\n    ;(async () => {\n      try {\n        const h = await getHealthz()\n        if (!alive) return\n        setHealth(h)\n      } catch {\n        if (!alive) return\n        setHealth(null)\n      }\n    })()\n    return () => { alive = false }\n  }, [open])\n\n  const inSyncRaw = (health as any)?.alembic_ok ?? (health as any)?.alembic?.in_sync ?? null\n  const inSync: boolean | null = inSyncRaw === true ? true : inSyncRaw === false ? false : null\n\n  return (\n    <DropdownMenu open={open} onOpenChange={setOpen}>\n      <DropdownMenuTrigger asChild>\n        <Button\n          variant=\"pill-outline\"\n          className=\"h-7 gap-1 rounded-full border-white/15 bg-white/5 px-2 py-0 text-xs\"\n          title={branch ? `branch: ${branch}${commit ? ` @ ${commit.slice(0,7)}` : ''}` : undefined}\n        >\n          <GitBranch className=\"h-3.5 w-3.5\" />\n          <span>{softStatus.soft ? 'DEV (soft)' : 'DEV'}</span>\n        </Button>\n      </DropdownMenuTrigger>\n\n      <DropdownMenuContent align=\"end\" className=\"min-w-[220px]\">\n        <DropdownMenuItem onClick={() => { try { window.dispatchEvent(new Event('about:open')) } catch {} }}>\n          <Info className=\"mr-2 h-4 w-4\" />\n          <span className=\"flex-1\">About (Health)</span>\n          <Pill\n            tone={inSync === true ? 'accent' : inSync === false ? 'default' : 'muted'}\n            size=\"xs\"\n            className={inSync === false ? 'bg-amber-500/10 border-amber-500/30 text-amber-300' : ''}\n          >\n            {inSync === true ? 'DB ok' : inSync === false ? 'DB out' : 'Unknown'}\n          </Pill>\n        </DropdownMenuItem>\n        <DropdownMenuSeparator />\n\n        {onToggleDevDock && (\n          <DropdownMenuItem onClick={onToggleDevDock}>\n            <Wrench className=\"mr-2 h-4 w-4\" />\n            Toggle Dev Dock {openDevDock ? <Check className=\"ml-auto h-4 w-4 opacity-70\" /> : null}\n          </DropdownMenuItem>\n        )}\n        {onToggleDevDock && <DropdownMenuSeparator />}\n        <DropdownMenuItem onClick={() => { write(\"DEV_UI\", !flags.dev); reload() }}>\n          <Settings2 className=\"mr-2 h-4 w-4\" />\n          Toggle Dev UI {flags.dev && <Check className=\"ml-auto h-4 w-4 opacity-70\" />}\n        </DropdownMenuItem>\n        <DropdownMenuSeparator />\n        <DropdownMenuCheckboxItem\n          checked={flags.ruleTester}\n          onCheckedChange={(v) => { toggle(\"ruleTester\", \"FEATURE_RULE_TESTER\")(!!v); reload() }}\n        >\n          Rule Tester\n        </DropdownMenuCheckboxItem>\n        <DropdownMenuCheckboxItem\n          checked={flags.mlSelftest}\n          onCheckedChange={(v) => { toggle(\"mlSelftest\", \"FEATURE_ML_SELFTEST\")(!!v); reload() }}\n        >\n          ML Selftest\n        </DropdownMenuCheckboxItem>\n        <DropdownMenuCheckboxItem\n          checked={flags.planner}\n          onCheckedChange={(v) => { toggle(\"planner\", \"FEATURE_PLANNER\")(!!v); reload() }}\n        >\n          Planner DevTool\n        </DropdownMenuCheckboxItem>\n        <DropdownMenuCheckboxItem\n          checked={flags.helpRephrase}\n          onCheckedChange={(v) => { toggle(\"helpRephrase\", \"HELP_REPHRASE\")(!!v); /* no reload needed */ setFlags(s=>({...s, helpRephrase: !!v})); }}\n        >\n          Help Rephrase\n        </DropdownMenuCheckboxItem>\n        <DropdownMenuSeparator />\n        <DropdownMenuItem onClick={() => window.open(\"/docs\", \"_blank\")}>\n          <ShieldCheck className=\"mr-2 h-4 w-4\" />\n          OpenAPI /docs\n        </DropdownMenuItem>\n        <DropdownMenuItem onClick={() => window.open(\"/\", \"_blank\")}>\n          <Rocket className=\"mr-2 h-4 w-4\" />\n          Go to app\n        </DropdownMenuItem>\n      </DropdownMenuContent>\n    </DropdownMenu>\n  )\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\dev\\DevDock.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\dev\\DevFab.tsx","messages":[{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":12,"column":82,"nodeType":"BlockStatement","messageId":"unexpected","endLine":12,"endColumn":84,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[550,550],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useCallback, useState, useEffect } from \"react\";\nimport { flags } from \"@/lib/flags\";\nimport { isDevUIEnabled, setDevUIEnabled } from \"@/state/useDevUI\";\nimport { emitToastSuccess } from \"@/lib/toast-helpers\";\n\nexport default function DevFab() {\n  const [dev, setDev] = useState(isDevUIEnabled());\n  useEffect(() => { setDev(isDevUIEnabled()); }, []);\n  const toggle = useCallback(() => {\n    const next = !isDevUIEnabled();\n    setDevUIEnabled(next);\n    try { emitToastSuccess?.(`Dev UI ${next ? 'enabled' : 'disabled'}`); } catch {}\n    // also persist dock visibility consistent with legacy usage\n    if (!next) localStorage.setItem('DEV_DOCK', '0');\n    location.reload();\n  }, []);\n  if (!flags.dev && !dev) return null;\n  return (\n    <button\n      onClick={toggle}\n      title={dev ? \"Disable Dev UI\" : \"Enable Dev UI\"}\n      className=\"\n        fixed bottom-6 right-6 z-[60]\n        h-11 w-11 rounded-full\n        border border-white/10 bg-neutral-900/80\n        backdrop-blur hover:bg-neutral-900\n        shadow-lg\n        inline-flex items-center justify-center\n      \"\n    >\n      <span className=\"sr-only\">Dev UI Toggle</span>\n      <div className={`h-2.5 w-2.5 rounded-full ${dev ? 'bg-emerald-400' : 'bg-gray-500'}`} />\n    </button>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\dev\\DevMenu.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[578,581],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[578,581],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Button } from \"@/components/ui/button\";\r\nimport {\r\n  DropdownMenu, DropdownMenuTrigger, DropdownMenuContent,\r\n  DropdownMenuItem, DropdownMenuSeparator, DropdownMenuCheckboxItem\r\n} from \"@/components/ui/dropdown-menu\";\r\nimport { Wrench, FileText, Bug, Link2, RefreshCw } from \"lucide-react\";\r\nimport { agentPlanStatus } from \"@/lib/api\";\r\nimport DevMenuItem from \"../DevMenuItem\";\r\nimport React from \"react\";\r\n\r\nexport default function DevMenu() {\r\n  const isDev = import.meta.env.MODE !== \"production\";\r\n  if (!isDev) return null;\r\n\r\n  const apiBase = (import.meta as any).env?.VITE_API_BASE || \"\";\r\n  const [throttle, setThrottle] = React.useState<{ rate_per_min: number; capacity: number; tokens: number } | null>(null);\r\n  const [open, setOpen] = React.useState(false);\r\n  const [bypass, setBypass] = React.useState<boolean>(() => localStorage.getItem(\"planner:bypass\") === \"1\");\r\n\r\n  const loadStatus = React.useCallback(async () => {\r\n    try {\r\n      const r = await agentPlanStatus();\r\n      setThrottle(r.throttle);\r\n    } catch {\r\n      setThrottle(null);\r\n    }\r\n  }, []);\r\n\r\n  React.useEffect(() => {\r\n    if (open) loadStatus();\r\n  }, [open, loadStatus]);\r\n\r\n  const onToggleBypass = (v: boolean) => {\r\n    setBypass(v);\r\n    localStorage.setItem(\"planner:bypass\", v ? \"1\" : \"0\");\r\n  };\r\n\r\n  return (\r\n  <DropdownMenu open={open} onOpenChange={setOpen}>\r\n      <DropdownMenuTrigger asChild>\r\n  <Button variant=\"pill\" size=\"sm\" className=\"gap-1 px-3\">\r\n          <Wrench className=\"h-4 w-4\" /> Dev\r\n        </Button>\r\n      </DropdownMenuTrigger>\r\n      <DropdownMenuContent align=\"end\" className=\"w-56\">\r\n        <DropdownMenuItem onClick={() => (window.location.hash = \"#dev-plan\") }>\r\n          <FileText className=\"h-4 w-4 mr-2\" /> Planner DevTool\r\n        </DropdownMenuItem>\r\n        <DropdownMenuItem onClick={() => (window.location.hash = \"#dev-plan-apply\") }>\r\n          <FileText className=\"h-4 w-4 mr-2\" /> Planner Apply Panel\r\n        </DropdownMenuItem>\r\n\r\n        <DropdownMenuSeparator />\r\n        <DevMenuItem />\r\n\r\n        <DropdownMenuSeparator />\r\n\r\n        <DropdownMenuItem onClick={() => window.open(`${apiBase}/agent/plan/debug?q=top%20merchants%20for%20July`, \"_blank\") }>\r\n          <Bug className=\"h-4 w-4 mr-2\" /> Plan Debug (GET)\r\n        </DropdownMenuItem>\r\n        <DropdownMenuItem onClick={() => window.open(`${apiBase}/docs`, \"_blank\") }>\r\n          <Link2 className=\"h-4 w-4 mr-2\" /> Open Backend /docs\r\n        </DropdownMenuItem>\r\n\r\n        <DropdownMenuSeparator />\r\n\r\n        <div className=\"px-2 py-1.5 text-xs opacity-70\">\r\n          Planner LLM throttle:\r\n          <div className=\"mt-1\">\r\n            {throttle\r\n              ? `${Math.floor(throttle.tokens)}/${throttle.capacity} tokens • ${throttle.rate_per_min}/min`\r\n              : \"—\"}\r\n          </div>\r\n        </div>\r\n        <DropdownMenuItem onClick={loadStatus}>\r\n          <RefreshCw className=\"h-4 w-4 mr-2\" /> Refresh status\r\n        </DropdownMenuItem>\r\n\r\n        <DropdownMenuCheckboxItem\r\n          checked={bypass}\r\n          onCheckedChange={(v: boolean) => onToggleBypass(Boolean(v))}\r\n        >\r\n          Bypass planner throttle\r\n        </DropdownMenuCheckboxItem>\r\n      </DropdownMenuContent>\r\n    </DropdownMenu>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\dev\\PlannerApplyPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[462,465],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[462,465],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[800,803],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[800,803],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1062,1065],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1062,1065],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1128,1131],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1128,1131],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1375,1378],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1375,1378],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1566,1569],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1566,1569],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1598,1601],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1598,1601],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2085,2088],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2085,2088],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":75,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2728,2731],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2728,2731],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":83,"column":108,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":111,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3376,3379],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3376,3379],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":97,"column":8,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":11,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3664,3667],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3664,3667],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":103,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3892,3895],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3892,3895],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useCallback, useState } from \"react\";\nimport { agentPlanPreview, agentPlanApply, downloadReportExcel, type PlannerPlanItem } from \"@/lib/api\";\nimport { Button } from \"@/components/ui/button\";\nimport { emitToastSuccess, emitToastError } from \"@/lib/toast-helpers\";\n\nexport default function PlannerApplyPanel() {\n  const [loading, setLoading] = useState(false);\n  const [applying, setApplying] = useState(false);\n  const [plan, setPlan] = useState<any | null>(null);\n  const [selected, setSelected] = useState<Record<number, boolean>>({});\n  const ok = emitToastSuccess; const err = emitToastError;\n\n  const preview = useCallback(async () => {\n    setLoading(true);\n    try {\n  const p = await agentPlanPreview({ month: null });\n      setPlan(p);\n      setSelected({});\n    } catch (e: any) {\n  err(e?.message || \"Preview failed\");\n    } finally {\n      setLoading(false);\n    }\n  }, [err]);\n\n  const apply = useCallback(async () => {\n    if (!plan || applying) return;\n    const picked: PlannerPlanItem[] = [];\n    (plan.items || []).forEach((it: any, idx: number) => {\n      if (selected[idx]) picked.push(it as any);\n    });\n    const wantsExport = picked.some((a) => a.kind === \"export_report\");\n    const actions: PlannerPlanItem[] = picked; // backend no-ops export_report, safe to send\n    setLoading(true);\n    setApplying(true);\n    try {\n  const res: any = await agentPlanApply({ month: plan?.month ?? null, actions });\n  ok(\"Applied.\");\n      if (wantsExport) {\n        await handleApplyLocal({ res, month: plan?.month, selected: actions as any });\n      }\n    } catch (e: any) {\n  err(e?.message || \"Apply failed\");\n    } finally {\n      setLoading(false);\n      setApplying(false);\n    }\n  }, [plan, selected, applying, ok, err]);\n\n  const download = useCallback(async (m?: string) => {\n    try {\n      const { blob, filename } = await downloadReportExcel(m, true);\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement(\"a\");\n      a.href = url; a.download = filename; a.click();\n      URL.revokeObjectURL(url);\n    } catch (e: any) {\n  err(e?.message || \"Download failed\");\n    }\n  }, [err]);\n\n  return (\n    <div className=\"rounded-lg border p-3 space-y-3\">\n      <div className=\"flex items-center gap-2\">\n        <Button onClick={preview} disabled={loading}>{loading ? \"Loading…\" : \"Preview Plan\"}</Button>\n  <Button onClick={apply} variant=\"pill-primary\" disabled={!plan || loading || applying}>\n          {applying ? \"Applying…\" : \"Apply Selected\"}\n        </Button>\n      </div>\n      {plan && (\n        <div className=\"text-sm opacity-80\">Month: <b>{plan.month}</b></div>\n      )}\n      {plan && (\n        <ul className=\"space-y-2\">\n          {plan.items.map((it: any, idx: number) => (\n            <li key={idx} className=\"flex items-start gap-2\">\n              <input type=\"checkbox\" id={`plan-${idx}`} checked={!!selected[idx]} onChange={(e) => setSelected(s => ({ ...s, [idx]: e.target.checked }))} />\n              <label htmlFor={`plan-${idx}`} className=\"cursor-pointer ml-2\">\n                <div className=\"font-medium\">{it.title}</div>\n                <div className=\"text-xs opacity-70\">{it.kind}</div>\n                {it.kind === \"export_report\" && (\n                  <div className=\"pt-1\">\n                    <Button variant=\"pill-ghost\" className=\"px-0 underline\" onClick={() => download((it as any).month)}>Download Excel</Button>\n                  </div>\n                )}\n              </label>\n            </li>\n          ))}\n        </ul>\n      )}\n    </div>\n  );\n}\n\n// Local, file-scoped helper to avoid HMR export-shape changes\nasync function handleApplyLocal(args: {\n  res: any;\n  month?: string;\n  selected: PlannerPlanItem[];\n}) {\n  const { res, month, selected } = args;\n  const wantsExport = (selected || []).some((a) => a.kind === \"export_report\");\n  const reportUrl: string | undefined = (res as any)?.report_url;\n  if (!wantsExport) return res;\n  if (reportUrl) {\n    window.location.href = reportUrl;\n  } else if (month) {\n    await downloadReportExcel(month, true, { splitAlpha: true });\n  } else {\n    console.warn(\"[PlannerApplyPanel] export_report requested but no month resolved and no report_url from backend.\");\n  }\n  return res;\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\dev\\PlannerDevPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Card' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardHeader' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardTitle' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardContent' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":50},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardFooter' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":52,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":62},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[723,726],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[723,726],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'previewing' is assigned a value but never used. Allowed unused elements of array destructuring patterns must match /^_/u.","line":12,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1853,1856],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1853,1856],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":92,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":95,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1931,1934],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1931,1934],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":78,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3176,3179],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3176,3179],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":127,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5732,5735],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5732,5735],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":127,"column":87,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":90,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5753,5756],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5753,5756],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":127,"column":114,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":117,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5780,5783],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5780,5783],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":128,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5857,5860],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5857,5860],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":157,"column":8,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":157,"endColumn":11,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6874,6877],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6874,6877],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":15,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useCallback, useEffect, useState } from \"react\";\nimport { agentPlanPreview, agentPlanApply, agentPlanStatus, type PlannerPlanItem, downloadReportExcel } from \"@/lib/api\";\nimport { Card, CardHeader, CardTitle, CardContent, CardFooter } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { cn } from \"@/lib/utils\";\n\nexport default function PlannerDevPanel({ className }: { className?: string }) {\n  const [prompt, setPrompt] = useState<string>(() => localStorage.getItem(\"planner:q\") || \"Give me my top merchants for July and generate a PDF\");\n  const [plan, setPlan] = useState<any>(null);\n  const [previewing, setPreviewing] = useState(false);\n  const [applying, setApplying] = useState(false);\n  const [bypassThrottle, setBypassThrottle] = useState<boolean>(() => {\n    const urlBypass = new URLSearchParams(location.search).get(\"bypass\") === \"1\";\n    const saved = localStorage.getItem(\"planner:bypass\") === \"1\";\n    return urlBypass || saved;\n  });\n  const [throttle, setThrottle] = useState<{ rate_per_min: number; capacity: number; tokens: number } | null>(null);\n  const [selected, setSelected] = useState<PlannerPlanItem[]>([]);\n\n  useEffect(() => {\n    localStorage.setItem(\"planner:q\", prompt);\n  }, [prompt]);\n\n  const onPreview = useCallback(async () => {\n    setPreviewing(true);\n    try {\n  const res = await agentPlanPreview({ month: null, prompt });\n      setPlan(res);\n      setSelected(res.items ?? []);\n    } catch (e) {\n      // Show minimal inline error via console; dev panel\n      console.error(e);\n    } finally {\n      setPreviewing(false);\n    }\n  }, []);\n\n  const onApply = useCallback(async () => {\n    if (!plan || applying) return;\n    setApplying(true);\n    try {\n  const res: any = await agentPlanApply({ month: plan?.month ?? null, actions: selected as any });\n      const ack = res?.ack ?? \"Planner applied.\";\n      const msg = typeof ack === \"string\" ? ack : ack?.deterministic ?? \"Planner applied.\";\n      // Keep dev-panel minimal: log ack; main toasts are elsewhere\n      console.log(msg);\n      await handleApply({ res, month: plan?.month, selected });\n    } catch (e) {\n      console.error(e);\n    } finally {\n      setApplying(false);\n    }\n  }, [plan, selected, applying]);\n\n  const loadStatus = useCallback(async () => {\n    try {\n      const r = await agentPlanStatus();\n      setThrottle(r.throttle);\n    } catch {\n      // ignore\n    }\n  }, []);\n  useEffect(() => { loadStatus(); }, [loadStatus]);\n  useEffect(() => { localStorage.setItem(\"planner:bypass\", bypassThrottle ? \"1\" : \"0\"); }, [bypassThrottle]);\n\n  const copyJson = useCallback(async () => {\n    const data = plan ? JSON.stringify(plan, null, 2) : JSON.stringify({ prompt, bypassThrottle }, null, 2);\n    await navigator.clipboard.writeText(data);\n  }, [plan, prompt, bypassThrottle]);\n\n  // Derived UI aliases (no logic change)\n  const planItems: PlannerPlanItem[] = (plan?.items as PlannerPlanItem[] | undefined) ?? [];\n  const onPlanAndRun = onApply;\n  const onCopyJson = copyJson;\n  const status = {\n    mode: (plan as any)?.mode,\n    steps: planItems.length,\n    throttle: throttle ? `${throttle.rate_per_min}/min · cap ${throttle.capacity} · tokens ${throttle.tokens}` : undefined,\n  } as { mode?: string; steps?: number; throttle?: string };\n\n  return (\n  <section id=\"planner-dev\" className={cn(\"panel-tight md:p-5 lg:p-6\", className)}>\n      <div className=\"flex items-center gap-2 mb-3\">\n        <h2 className=\"text-lg font-semibold\">Planner DevTool</h2>\n        <span className=\"pill\">dev-only</span>\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-2\">\n        {/* LEFT: Prompt */}\n        <div>\n          <div className=\"text-sm opacity-80 mb-2\">Natural-language planner prompt</div>\n          <textarea\n            value={prompt}\n            onChange={(e) => setPrompt(e.target.value)}\n            className=\"input-muted w-full min-h-[120px] text-sm placeholder:text-white/40\"\n            placeholder='e.g., \"Give me my top merchants for July and generate a PDF\"'\n          />\n          <div className=\"mt-3 flex items-center gap-2\">\n            <Switch id=\"bypass\" checked={bypassThrottle} onCheckedChange={setBypassThrottle} />\n            <Label htmlFor=\"bypass\" className=\"text-sm select-none\">Bypass planner throttle</Label>\n          </div>\n        </div>\n\n        {/* RIGHT: Status */}\n        <div>\n          <div className=\"text-sm opacity-80 mb-2 flex items-center justify-between\">\n            <span>Planner status</span>\n            {/* keep your little refresh/search icon button if you had one */}\n          </div>\n\n          <div className=\"rounded-xl border border-white/10 bg-white/5 p-3 text-sm\">\n            <div className=\"grid grid-cols-3 gap-2\">\n              <div className=\"opacity-70\">Mode:</div><div className=\"col-span-2\">{status?.mode ?? \"—\"}</div>\n              <div className=\"opacity-70\">Steps:</div><div className=\"col-span-2\">{status?.steps ?? 0}</div>\n              <div className=\"opacity-70\">Throttle:</div><div className=\"col-span-2\">{status?.throttle ?? \"—\"}</div>\n            </div>\n\n            <div className=\"mt-3 border-t border-white/10 pt-3\">\n              <div className=\"mb-2 text-sm opacity-80\">Plan items</div>\n              {planItems?.length ? (\n                <ul className=\"space-y-1\">\n                  {planItems.map((it, i) => (\n                    <li key={i} className=\"grid grid-cols-[auto_1fr_auto] items-center gap-2 rounded-lg bg-white/5 px-2 py-1\">\n                      <span className=\"text-xs opacity-70\">{it.kind}</span>\n                      <span className=\"text-xs truncate\">{(it as any).title ?? (it as any).description ?? (it as any).path ?? \"\"}</span>\n                      <span className=\"pill\">{(it as any).status ?? \"pending\"}</span>\n                    </li>\n                  ))}\n                </ul>\n              ) : (\n                <div className=\"text-xs opacity-70\">No plan yet. Click <span className=\"font-medium\">Preview Plan</span>.</div>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"flex flex-wrap items-center gap-2 justify-between mt-4\">\n        <div className=\"flex items-center gap-2\">\n          <Button onClick={onPreview} className=\"px-3 py-1.5 text-sm\">Preview Plan</Button>\n          <Button variant=\"pill-primary\" onClick={onPlanAndRun} className=\"gap-2 h-9 px-4\">Plan &amp; Run</Button>\n          <Button variant=\"pill-outline\" onClick={onCopyJson}>Copy JSON</Button>\n        </div>\n      </div>\n    </section>\n  );\n}\n\n/**\n * Handle post-apply behaviors (export, etc.).\n * Prefer backend `report_url` if present; otherwise fall back to client Excel builder.\n * Designed to be unit-tested.\n */\nasync function handleApply(args: {\n  res: any;                 // response from agentPlanApply(...)\n  month?: string;           // month string like \"2025-08\"\n  selected: PlannerPlanItem[];\n}) {\n  const { res, month, selected } = args;\n\n  const wantsExport = (selected || []).some((a) => a.kind === \"export_report\");\n  const reportUrl: string | undefined = res?.report_url;\n\n  if (wantsExport) {\n    if (reportUrl) {\n      // single source of truth when backend provides URL\n      window.location.href = reportUrl;\n    } else if (month) {\n      // client-side fallback\n      await downloadReportExcel(month, true, { splitAlpha: true });\n    } else {\n      // Explicit breadcrumb to help debug empty-month states\n      console.warn(\n        \"[Planner] export_report requested but no month resolved and no report_url from backend.\"\n      );\n    }\n  }\n  return res;\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\dropdown-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\header\\MonthPicker.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\header\\TransactionsButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\ui\\AvatarCircle.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\ui\\RobotThinking.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":122,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":125,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1762,1765],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1762,1765],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\n\ntype Props = { size?: number; label?: string; className?: string };\n\nexport default function RobotThinking({ size = 64, label = \"Thinking…\", className = \"\" }: Props) {\n  const s = size, r = s / 2;\n  const eyeY = s * 0.42, eyeX = s * 0.18, eyeR = Math.max(2, s * 0.06);\n  const mouthW = s * 0.34, mouthH = s * 0.18, mouthX = r - mouthW / 2, mouthY = s * 0.60;\n\n  return (\n    <div className={`flex items-center justify-center ${className}`} role=\"status\" aria-live=\"polite\" aria-label={label} title={label}>\n      <svg width={s} height={s} viewBox={`0 0 ${s} ${s}`} className=\"robot-animate-float\">\n        <defs>\n          <radialGradient id=\"rg\" cx=\"50%\" cy=\"45%\" r=\"60%\">\n            <stop offset=\"0%\" stopColor=\"#7dd3fc\" />\n            <stop offset=\"60%\" stopColor=\"#60a5fa\" />\n            <stop offset=\"100%\" stopColor=\"#334155\" />\n          </radialGradient>\n          <filter id=\"glow\"><feGaussianBlur stdDeviation=\"3.5\" result=\"b\"/><feMerge><feMergeNode in=\"b\"/><feMergeNode in=\"SourceGraphic\"/></feMerge></filter>\n        </defs>\n\n        {/* head */}\n        <rect x={s*0.12} y={s*0.14} width={s*0.76} height={s*0.70} rx={s*0.16} fill=\"url(#rg)\"\n              stroke=\"rgba(255,255,255,.12)\" strokeWidth={1} />\n\n        {/* antenna */}\n        <line x1={r} y1={s*0.06} x2={r} y2={s*0.14} stroke=\"rgba(255,255,255,.6)\" strokeWidth={2}/>\n        <circle cx={r} cy={s*0.06} r={s*0.035} className=\"robot-animate-glow\" fill=\"#93c5fd\" filter=\"url(#glow)\"/>\n\n        {/* eyes */}\n        <g fill=\"#0ea5e9\" filter=\"url(#glow)\">\n          <circle cx={r - eyeX} cy={eyeY} r={eyeR} className=\"robot-animate-blink\"/>\n          <circle cx={r + eyeX} cy={eyeY} r={eyeR} className=\"robot-animate-blink\" style={{ animationDelay: \"0.05s\" } as any}/>\n        </g>\n\n        {/* mouth equalizer */}\n        <g transform={`translate(${mouthX}, ${mouthY})`}>\n          <rect width={mouthW} height={mouthH} rx={mouthH*0.35} fill=\"rgba(15,23,42,.5)\" />\n          <g transform={`translate(${mouthW*0.10}, ${mouthH*0.15})`}>\n            <rect width={mouthW*0.18} height={mouthH*0.7} className=\"robot-animate-mouth\"  fill=\"#a78bfa\"/>\n            <rect x={mouthW*0.26} width={mouthW*0.18} height={mouthH*0.7} className=\"robot-animate-mouth2\" fill=\"#60a5fa\"/>\n            <rect x={mouthW*0.52} width={mouthW*0.18} height={mouthH*0.7} className=\"robot-animate-mouth3\" fill=\"#34d399\"/>\n          </g>\n        </g>\n\n        {/* shadow */}\n        <ellipse cx={r} cy={s*0.88} rx={s*0.28} ry={s*0.06} fill=\"rgba(0,0,0,.35)\"/>\n      </svg>\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\ui\\SideDrawer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\ui\\avatars.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\ui\\badge.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":36,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":36,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\ui\\button.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":6,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":6,"endColumn":28},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":86,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":86,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport { Slot } from \"@radix-ui/react-slot\";\nimport { cva, type VariantProps } from \"class-variance-authority\";\nimport { cn } from \"@/lib/utils\";\n\nexport const buttonVariants = cva(\n  \"inline-flex items-center justify-center whitespace-nowrap select-none transition-transform transform-gpu\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground hover:bg-primary/90\",\n\n        // ---- PILL FAMILY ----\n        pill: [\n          \"rounded-full h-8 px-3 text-sm\",\n          \"bg-gradient-to-b from-zinc-800 to-zinc-900\",\n          \"text-zinc-100/90 border border-white/10\",\n          \"shadow-[inset_0_1px_0_0_rgba(255,255,255,.06),0_6px_16px_-8px_rgba(0,0,0,.6)]\",\n          \"hover:from-zinc-750 hover:to-zinc-900/95 hover:text-white\",\n          \"focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-400/60\",\n          \"data-[state=open]:from-emerald-700 data-[state=open]:to-emerald-800 data-[state=open]:text-emerald-50\",\n          \"active:translate-y-[0.5px]\",\n        ].join(\" \"),\n        \"pill-outline\": [\n          \"rounded-full h-8 px-3 text-sm\",\n          \"bg-transparent text-zinc-200\",\n          \"border border-white/15 hover:bg-white/[.04]\",\n          \"focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-400/50\",\n        ].join(\" \"),\n        \"pill-primary\": [\n          \"rounded-full h-9 px-4 text-sm\",\n          \"bg-emerald-600 text-white hover:bg-emerald-500\",\n          \"border border-emerald-400/20 shadow\",\n          \"focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400/70\",\n        ].join(\" \"),\n        \"pill-success\": [\n          \"rounded-full h-8 px-3 text-sm\",\n          \"bg-emerald-700/80 text-emerald-50 hover:bg-emerald-700\",\n          \"border border-emerald-400/30\",\n        ].join(\" \"),\n        \"pill-danger\": [\n          \"rounded-full h-8 px-3 text-sm\",\n          \"bg-rose-700/85 text-rose-50 hover:bg-rose-700\",\n          \"border border-rose-400/30\",\n        ].join(\" \"),\n        \"pill-ghost\": [\n          \"rounded-full h-8 px-3 text-sm\",\n          \"bg-transparent text-zinc-300 hover:bg-white/[.04]\",\n        ].join(\" \"),\n      },\n      size: {\n        sm: \"h-8 px-3 text-xs\",\n        md: \"h-9 px-4 text-sm\",\n        lg: \"h-10 px-5 text-sm\",\n        icon: \"h-8 w-8 p-0\",\n      },\n    },\n    defaultVariants: { variant: \"pill\", size: \"sm\" },\n  }\n);\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean;\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\";\n    return (\n      <Comp\n        ref={ref}\n        className={cn(buttonVariants({ variant, size }), className)}\n        {...props}\n      />\n    );\n  }\n);\nButton.displayName = \"Button\";\n\nexport { Button };\n\n/** Handy class for icon-only pills (non-Button elements) */\nexport const pillIconClass =\n  \"inline-flex items-center justify-center rounded-full h-8 w-8 bg-gradient-to-b from-zinc-800 to-zinc-900 text-zinc-100/90 border border-white/10 hover:from-zinc-750 hover:to-zinc-900/95 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-400/60\";\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\ui\\card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\ui\\checkbox.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'className' is defined but never used. Allowed unused args must match /^_/u.","line":7,"column":6,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\";\n\nexport const Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <label className=\"inline-flex items-center gap-2\">\n    <CheckboxPrimitive.Root\n      ref={ref}\n      className={\n        \"h-4 w-4 rounded border border-white/20 bg-neutral-800 \" +\n        \"data-[state=checked]:bg-emerald-600\"\n      }\n      {...props}\n    >\n      <CheckboxPrimitive.Indicator>\n        <svg viewBox=\"0 0 20 20\" className=\"h-4 w-4 fill-white\">\n          <path d=\"M7.629 13.233 3.9 9.504l1.314-1.314 2.415 2.415L14.786 3.45l1.314 1.314z\" />\n        </svg>\n      </CheckboxPrimitive.Indicator>\n    </CheckboxPrimitive.Root>\n    {children}\n  </label>\n));\nCheckbox.displayName = \"Checkbox\";\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\ui\\chip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\ui\\drawer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\ui\\dropdown-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\ui\\label.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\ui\\pill.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\ui\\popover.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\ui\\scroll-area.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\ui\\skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\ui\\switch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\ui\\toast.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'LISTENER_KEY' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":102,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":102,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'COUNT_KEY' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":103,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":103,"endColumn":16},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":128,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":131,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5246,5249],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5246,5249],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":108,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5343,5346],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5343,5346],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":127,"column":113,"nodeType":"BlockStatement","messageId":"unexpected","endLine":127,"endColumn":115,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[6501,6501],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from 'react'\nimport * as ToastPrimitives from '@radix-ui/react-toast'\nimport { cva, type VariantProps } from 'class-variance-authority'\nimport { X } from 'lucide-react'\nimport { cn } from '@/lib/utils'\n// helperToast removed from listener usage to avoid recursive dispatch loop\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    data-sonner-toaster\n    className={cn(\n      'fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[480px]',\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  'group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full data-[state=closed]:animate-fade-slide-up',\n  {\n    variants: {\n      variant: {\n        default: 'border bg-background text-foreground',\n        destructive: 'destructive group border-destructive bg-destructive text-destructive-foreground',\n      },\n    },\n    defaultVariants: { variant: 'default' },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> & VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => (\n  <ToastPrimitives.Root ref={ref} data-sonner-toast className={cn(toastVariants({ variant }), className)} {...props} />\n))\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      'inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive',\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      'absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600',\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className='h-4 w-4' />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title ref={ref} className={cn('text-sm font-semibold', className)} {...props} />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description ref={ref} className={cn('text-sm opacity-90', className)} {...props} />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport { ToastProvider, ToastViewport, Toast, ToastTitle, ToastDescription, ToastClose, ToastAction, type ToastProps, type ToastActionElement }\n\n// Enhanced singleton event listener supporting unified payload {title, description, action, variant}\nconst LISTENER_KEY = '__APP_TOASTER_LISTENER__'\nconst COUNT_KEY = '__APP_TOASTER_MOUNT_COUNT__'\nexport function Toaster() {\n  const [items, setItems] = React.useState<Array<{ id: string; title: string; description?: string; variant?: string; action?: any }>>([])\n  React.useEffect(() => {\n    const onAppToast = (e: Event) => {\n      const detail: any = (e as CustomEvent).detail || {}\n      const title = detail.title || detail.message\n      if (!title) return\n      const variant = detail.variant || (detail.type === 'error' ? 'destructive' : undefined)\n      const id = Math.random().toString(36).slice(2)\n      setItems(list => [...list, { id, title, description: detail.description || detail.options?.description, variant, action: detail.action }])\n    }\n    window.addEventListener('app:toast', onAppToast as EventListener)\n    return () => window.removeEventListener('app:toast', onAppToast as EventListener)\n  }, [])\n  return (\n    <ToastProvider>\n      {items.map(item => (\n        <Toast key={item.id} variant={item.variant === 'destructive' ? 'destructive' : 'default'}>\n          <div className='flex flex-col gap-1'>\n            <ToastTitle>{item.title}</ToastTitle>\n            {item.description && <ToastDescription>{item.description}</ToastDescription>}\n            {item.action && typeof item.action === 'object' && item.action.label && (\n              <div className='mt-2'>\n                <ToastAction altText={item.action.label} onClick={() => { try { item.action.onClick?.() } catch {} }}> {item.action.label} </ToastAction>\n              </div>\n            )}\n          </div>\n          <ToastClose />\n        </Toast>\n      ))}\n      <ToastViewport className='sm:max-w-[480px]' />\n    </ToastProvider>\n  )\n}\n\nexport default Toaster\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\ui\\toaster.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\components\\ui\\tooltip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\context\\ChatDockContext.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3,"column":103,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3,"endColumn":106,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[169,172],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[169,172],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":37,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":37,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useRef } from 'react';\n\ntype Meta = { citations?: { type: string; id?: string; count?: number }[]; ctxMonth?: string; trace?: any[]; model?: string };\n\ntype ChatDockContextValue = {\n  // External callers use these to append to ChatDock\n  appendUser: (text: string) => void;\n  appendAssistant: (text: string, opts?: { meta?: Meta }) => void;\n  // ChatDock registers its handlers here\n  setAppendUser: (fn: (text: string) => void) => void;\n  setAppendAssistant: (fn: (text: string, opts?: { meta?: Meta }) => void) => void;\n};\n\nconst noop = () => {};\n\nconst ChatDockContext = createContext<ChatDockContextValue>({\n  appendUser: noop,\n  appendAssistant: noop,\n  setAppendUser: noop,\n  setAppendAssistant: noop,\n});\n\nexport function ChatDockProvider({ children }: { children: React.ReactNode }) {\n  const appendUserRef = useRef<(text: string) => void>(() => {});\n  const appendAssistantRef = useRef<(text: string, opts?: { meta?: Meta }) => void>(() => {});\n\n  const value: ChatDockContextValue = {\n    appendUser: (text) => appendUserRef.current?.(text),\n    appendAssistant: (text, opts) => appendAssistantRef.current?.(text, opts),\n    setAppendUser: (fn) => { appendUserRef.current = fn; },\n    setAppendAssistant: (fn) => { appendAssistantRef.current = fn; },\n  };\n\n  return <ChatDockContext.Provider value={value}>{children}</ChatDockContext.Provider>;\n}\n\nexport function useChatDock() {\n  return useContext(ChatDockContext);\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\context\\MonthContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\features\\help\\HelpLayer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\features\\help\\HelpPanel.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":11,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":11,"endColumn":30},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":12,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":12,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'vh' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":20,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\n\r\ntype Props = {\r\n  title: string;\r\n  html: string;\r\n  anchorRect: DOMRect;\r\n};\r\n\r\nlet setStateRef: React.Dispatch<React.SetStateAction<Props | null>> | null = null;\r\nexport function openHelpPanel(p: Props) { setStateRef?.(p); }\r\nexport function closeHelpPanel() { setStateRef?.(null); }\r\n\r\nexport function HelpPanelHost() {\r\n  const [p, setP] = useState<Props | null>(null);\r\n  useEffect(() => { setStateRef = setP; return () => { setStateRef = null; }; }, []);\r\n  if (!p) return null;\r\n\r\n  const margin = 10;\r\n  const vw = window.innerWidth, vh = window.innerHeight;\r\n  let x = p.anchorRect.left + p.anchorRect.width / 2;\r\n  let y = p.anchorRect.top - margin;\r\n  let placeAbove = true;\r\n\r\n  const estHeight = 180;\r\n  if (y - estHeight < 0) { y = p.anchorRect.bottom + margin; placeAbove = false; }\r\n  x = Math.min(vw - 20, Math.max(20, x));\r\n\r\n  const node = (\r\n    <div\r\n      className=\"fixed z-[9900] pointer-events-auto\"\r\n      style={{ left: x, top: y, transform: \"translate(-50%, -100%)\" }}\r\n    >\r\n      <div className=\"max-w-[360px] w-[min(90vw,360px)] rounded-xl border border-white/10 bg-[rgb(26,28,33)] text-zinc-100 shadow-2xl ring-1 ring-white/10\">\r\n        <div className=\"px-3 py-2 border-b border-white/10 flex items-center justify-between\">\r\n          <div className=\"text-sm font-semibold\">{p.title}</div>\r\n          <button onClick={closeHelpPanel} className=\"text-xs opacity-80 hover:opacity-100\">Close</button>\r\n        </div>\r\n        <div className=\"px-3 py-3 prose-invert prose-sm\" dangerouslySetInnerHTML={{ __html: p.html }} />\r\n      </div>\r\n      <div\r\n        className=\"fixed z-[-1] h-3 w-3 rotate-45 bg-[rgb(26,28,33)] border border-white/10\"\r\n        style={{\r\n          left: x,\r\n          top: placeAbove ? (p.anchorRect.top - 2) : (p.anchorRect.bottom + 2),\r\n          transform: \"translate(-50%, -50%)\",\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n  return ReactDOM.createPortal(node, document.body);\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\features\\help\\useHelpClicks.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[253,256],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[253,256],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[264,267],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[264,267],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[794,797],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[794,797],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'title' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":58,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":58,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect } from \"react\";\r\nimport { openHelpPanel } from \"@/features/help/HelpPanel\";\r\nimport { uiHelp } from \"@/lib/api\";\r\n\r\nfunction textToHtml(t: string) {\r\n  return `<p>${t.replace(/\\n/g, \"<br/>\")}</p>`;\r\n}\r\n\r\nfunction formatFallback(base: any, ctx?: any) {\r\n  if (!base) return \"This widget shows a chart or card in the current view.\";\r\n  const bullets = [\r\n    `• ${base.what || base.title || \"Overview\"}`,\r\n    ...((base.how_to_read || []).slice(0, 3).map((x: string) => `• ${x}`)),\r\n    ...(base.tips ? [`• Tip: ${base.tips[0]}`] : []),\r\n    ...(ctx?.data ? [\r\n      `• Example: data available for the selected month.`\r\n    ] : []),\r\n  ];\r\n  return bullets.join(\"\\n\");\r\n}\r\n\r\nasync function fetchDescribe(opts: { target: string; id?: string | null }) {\r\n  try {\r\n    const res: any = await uiHelp.describe(opts.target, opts.id || undefined, true);\r\n    const base = res?.help || {};\r\n    const ctx = res?.context || null;\r\n    const text = formatFallback(base, ctx);\r\n    return { html: \"\", text };\r\n  } catch (e) {\r\n    return { html: \"\", text: \"No details returned.\" };\r\n  }\r\n}\r\n\r\nfunction getHelpElFromEvent(e: MouseEvent) {\r\n  const path = (e.composedPath?.() ?? []) as Array<EventTarget>;\r\n  for (const n of path) {\r\n    if (n instanceof HTMLElement && n.hasAttribute(\"data-help-target\")) return n;\r\n  }\r\n  return (e.target as HTMLElement)?.closest?.<HTMLElement>(\"[data-help-target]\") ?? null;\r\n}\r\n\r\nexport function useHelpClicks(active: boolean) {\r\n  useEffect(() => {\r\n    if (!active) return;\r\n    const onClick = async (e: MouseEvent) => {\r\n      const el = getHelpElFromEvent(e);\r\n      if (!el) return;\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n\r\n      document\r\n        .querySelectorAll<HTMLElement>(\"[data-help-active='true']\")\r\n        .forEach((x) => x.removeAttribute(\"data-help-active\"));\r\n      el.setAttribute(\"data-help-active\", \"true\");\r\n\r\n      const target = el.getAttribute(\"data-help-target\")!;\r\n      const id = el.getAttribute(\"data-help-id\") || undefined;\r\n      const title = el.getAttribute(\"data-help-title\") || el.querySelector(\"h3,h4\")?.textContent || \"This card\";\r\n\r\n      try {\r\n        const { html, text } = await fetchDescribe({ target, id: id || null });\r\n        const body = (html && html.trim()) || (text && textToHtml(text)) || \"<p>No details returned.</p>\";\r\n        const r = el.getBoundingClientRect();\r\n        openHelpPanel({ title: \"What am I looking at?\", html: body, anchorRect: r });\r\n      } catch (err) {\r\n        openHelpPanel({\r\n          title: \"What am I looking at?\",\r\n          html: `<p>Sorry—couldn’t load the explanation.</p><pre class=\"mt-2 text-xs opacity-70\">${String(err)}</pre>`,\r\n          anchorRect: el.getBoundingClientRect(),\r\n        });\r\n      }\r\n    };\r\n    document.addEventListener(\"click\", onClick, true);\r\n    return () => document.removeEventListener(\"click\", onClick, true);\r\n  }, [active]);\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\help\\HelpPopover.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'describe' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":51,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":59},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[325,328],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[325,328],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[346,349],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[346,349],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[504,507],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[504,507],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":108,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":111,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[684,687],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[684,687],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { render, screen, waitFor } from '@testing-library/react';\r\nimport HelpPopover from './HelpPopover';\r\nimport { describe as describeFn } from '@/lib/api';\r\nimport { vi, test, expect, beforeEach, afterEach, describe } from 'vitest';\r\n\r\nvi.mock('@/lib/api', async (orig) => {\r\n  const actual: any = await (orig as any)();\r\n  return {\r\n    ...actual,\r\n    describe: vi.fn(),\r\n    telemetry: { helpOpen: vi.fn().mockResolvedValue(undefined) }\r\n  };\r\n});\r\n\r\nconst baseEntry: any = { title: 'Top Merchants', body: 'Original deterministic text.' };\r\nconst rect: DOMRect = { x:0,y:0,top:120,left:40,bottom:0,right:0,height:0,width:0,toJSON(){return{};} } as any;\r\n\r\nconst mockedDescribe = describeFn as unknown as ReturnType<typeof vi.fn>;\r\n\r\nbeforeEach(() => {\r\n  sessionStorage.clear();\r\n  mockedDescribe.mockReset();\r\n});\r\n\r\nafterEach(() => {\r\n  vi.useRealTimers();\r\n});\r\n\r\nfunction mount() {\r\n  render(<HelpPopover rect={rect} entry={baseEntry} onClose={()=>{}} />);\r\n}\r\n\r\ntest('shows loading then deterministic fallback on error', async () => {\r\n  mockedDescribe.mockRejectedValueOnce(new Error('boom'));\r\n  mount();\r\n  expect(screen.getByText(/Loading/i)).toBeInTheDocument();\r\n  await waitFor(() => expect(screen.queryByText(/Loading/i)).not.toBeInTheDocument());\r\n  expect(screen.getByText('Original deterministic text.')).toBeInTheDocument();\r\n});\r\n\r\ntest('renders AI‑polished badge when rephrased true', async () => {\r\n  mockedDescribe.mockResolvedValueOnce({ text: 'Polished text', grounded: true, rephrased: true, llm_called: true, provider: 'primary', panel_id: 'top_merchants', mode: 'explain', reasons: [] });\r\n  mount();\r\n  await screen.findByText('Polished text');\r\n  expect(screen.getByText('AI‑polished')).toBeInTheDocument();\r\n});\r\n\r\ntest('renders AI checked badge when identical_output reason present (baseline)', async () => {\r\n  mockedDescribe.mockResolvedValueOnce({ text: 'Original deterministic text.', grounded: true, rephrased: false, llm_called: true, provider: 'primary', panel_id: 'top_merchants', mode: 'explain', reasons: ['identical_output'], fallback_reason: 'identical_output', effective_unavailable: false });\r\n  mount();\r\n  await screen.findByText('Original deterministic text.');\r\n  expect(screen.getByText('AI checked')).toBeInTheDocument();\r\n});\r\n\r\ntest('renders AI checked note when identical_output reason present', async () => {\r\n  mockedDescribe.mockResolvedValueOnce({ text: 'Original deterministic text.', grounded: true, rephrased: false, llm_called: true, provider: 'primary', panel_id: 'top_merchants', mode: 'explain', reasons: ['identical_output'], fallback_reason: 'identical_output', effective_unavailable: false });\r\n  mount();\r\n  await screen.findByText('Original deterministic text.');\r\n  expect(screen.getByText('AI checked')).toBeInTheDocument();\r\n  expect(screen.getByText(/original wording was already clear/i)).toBeInTheDocument();\r\n});\r\n\r\ntest('shows unavailability message only when effective_unavailable', async () => {\r\n  mockedDescribe.mockResolvedValueOnce({ text: 'The language model is temporarily unavailable.', grounded: true, rephrased: false, llm_called: true, provider: 'primary', panel_id: 'top_merchants', mode: 'explain', reasons: [], fallback_reason: 'model_unavailable', effective_unavailable: true });\r\n  mount();\r\n  await screen.findByText(/temporarily unavailable/i);\r\n  expect(screen.getByText(/deterministic description/i)).toBeInTheDocument();\r\n});\r\n\r\ntest('renders Policy blocked badge when reason present', async () => {\r\n  mockedDescribe.mockResolvedValueOnce({ text: 'Filtered text', grounded: true, rephrased: false, llm_called: true, provider: 'primary', panel_id: 'top_merchants', mode: 'explain', reasons: ['policy_blocked'] });\r\n  mount();\r\n  await screen.findByText('Filtered text');\r\n  expect(screen.getByText('Policy blocked')).toBeInTheDocument();\r\n});\r\n\r\ntest('renders No data badge when reason present', async () => {\r\n  mockedDescribe.mockResolvedValueOnce({ text: 'No data for selection', grounded: true, rephrased: false, llm_called: false, provider: 'primary', panel_id: 'top_merchants', mode: 'learn', reasons: ['no_data'] });\r\n  mount();\r\n  await screen.findByText('No data for selection');\r\n  expect(screen.getByText('No data')).toBeInTheDocument();\r\n});\r\n\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\help\\HelpPopover.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[321,324],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[321,324],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1563,1566],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1563,1566],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":117,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":120,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1660,1663],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1660,1663],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1744,1747],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1744,1747],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1855,1858],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1855,1858],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2631,2634],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2631,2634],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3183,3186],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3183,3186],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3269,3272],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3269,3272],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\r\nimport type { HelpEntry, HelpKey } from \"./helpRegistry\";\r\nimport { telemetry, describe, DescribeResponse } from \"@/lib/api\";\r\nimport { track } from \"@/lib/analytics\";\r\nimport { hashFilters } from \"@/lib/hashFilters\"; // if absent, fallback inside effect\r\n\r\nfunction chartPreviewSlice(series: any, max = 6) {\r\n  if (!series) return null;\r\n  if (Array.isArray(series)) return series.slice(0, max);\r\n  return null;\r\n}\r\n\r\nexport default function HelpPopover(props: { rect: DOMRect; entry: HelpEntry; onClose: () => void; entryKey?: HelpKey }) {\r\n  const { rect, entry, onClose, entryKey } = props;\r\n  const top = Math.max(16, rect.top - 12 - 120);\r\n  const left = Math.min(window.innerWidth - 380, Math.max(16, rect.left));\r\n  const closeRef = React.useRef<HTMLButtonElement>(null);\r\n\r\n  React.useEffect(() => {\r\n    closeRef.current?.focus();\r\n    // Telemetry: log help open (route + key)\r\n    telemetry.helpOpen({ key: String(entryKey ?? entry.title), path: location.pathname, ts: Date.now() }).catch(() => {});\r\n  }, []);\r\n\r\n  const [desc, setDesc] = React.useState<DescribeResponse | null>(null);\r\n  const [loading, setLoading] = React.useState(true);\r\n  const abortRef = React.useRef<AbortController | null>(null);\r\n\r\n  React.useEffect(() => {\r\n    abortRef.current?.abort();\r\n    const c = new AbortController();\r\n    abortRef.current = c;\r\n    setLoading(true);\r\n    const t0 = performance.now();\r\n    let fired = false;\r\n    const panelId = String(entryKey || entry.title).replace(/\\s+/g, '_').toLowerCase();\r\n    const payload: any = { month: undefined, filters: undefined, meta: undefined, data: chartPreviewSlice((entry as any).data) };\r\n    const filtersHash = (() => {\r\n      try { return (hashFilters as any)?.(payload.filters) || 'none'; } catch { return 'none'; }\r\n    })();\r\n  const envDefault = (import.meta as any).env?.VITE_HELP_REPHRASE_DEFAULT === '0' ? false : true;\r\n  const stored = sessionStorage.getItem('HELP_REPHRASE');\r\n  const allowRephrase = stored ? stored === '1' : envDefault;\r\n  describe(panelId, payload, { rephrase: allowRephrase, mode: allowRephrase ? 'explain' : 'learn', signal: c.signal })\r\n      .then(r => {\r\n        setDesc(r);\r\n        if (!fired) {\r\n          fired = true;\r\n          const ttfb = Math.round(performance.now() - t0);\r\n            track(\"help_shown\", {\r\n              panel: panelId,\r\n              month: payload.month,\r\n              filtersHash,\r\n              grounded: !!r?.grounded,\r\n              rephrased: !!r?.rephrased,\r\n              provider: r?.provider || 'none',\r\n              ttfb_ms: ttfb,\r\n              sampleHint: (r as any)?.sample_hint ?? null,\r\n            });\r\n        }\r\n      })\r\n      .catch(() => {\r\n        setDesc({ text: entry.body, grounded: true, rephrased: false, provider: 'none', panel_id: panelId, llm_called: false, mode: allowRephrase ? 'explain' : 'learn', reasons: [] });\r\n        track(\"help_shown\", { panel: panelId, error: true });\r\n      })\r\n      .finally(() => setLoading(false));\r\n    return () => c.abort();\r\n  }, [entryKey, entry]);\r\n\r\n  const badges: string[] = [];\r\n  const reasons = desc?.reasons || [];\r\n  const fallbackReason = (desc as any)?.fallback_reason as string | undefined;\r\n  const effectiveUnavailable = (desc as any)?.effective_unavailable === true;\r\n  const aiCheckedNoChange = !!desc?.llm_called && !desc?.rephrased && (reasons.includes('identical_output') || fallbackReason === 'identical_output');\r\n  if (desc?.grounded) badges.push('Grounded');\r\n  if (desc?.rephrased) badges.push('AI‑polished');\r\n  if (aiCheckedNoChange) badges.push('AI checked');\r\n  if (!desc?.rephrased && reasons.includes('policy_blocked')) badges.push('Policy blocked');\r\n  if (!desc?.rephrased && reasons.includes('no_data')) badges.push('No data');\r\n\r\n  return (\r\n    <div\r\n      className=\"help-popover rounded-2xl shadow-lg p-4 bg-zinc-900/95 border border-zinc-700 fixed z-[70] max-w-[380px]\"\r\n      style={{ top, left }}\r\n      role=\"dialog\"\r\n      aria-modal=\"true\"\r\n      aria-label={entry.title}\r\n    >\r\n      <div className=\"flex items-start justify-between gap-2\">\r\n        <div className=\"font-semibold mb-1 pr-2 leading-snug flex items-center gap-2\">\r\n          {entry.title}\r\n          {reasons.includes('identical_output') && (\r\n            <span\r\n              title=\"Model output matched deterministic summary.\"\r\n              className=\"inline-flex items-center justify-center w-4 h-4 text-[10px] rounded-full bg-zinc-800 text-zinc-300 border border-zinc-600 cursor-help\"\r\n            >i</span>\r\n          )}\r\n        </div>\r\n        <div className=\"flex flex-wrap gap-1\">\r\n          {badges.map(b => {\r\n            let extra = '';\r\n            if (b === 'Policy blocked') extra = 'bg-amber-800/40 text-amber-300 border-amber-600';\r\n            else if (b === 'No data') extra = 'bg-zinc-800 text-zinc-400 border-zinc-600';\r\n            else if (b === 'AI checked') extra = 'bg-zinc-800 text-zinc-200 border-zinc-600';\r\n            else extra = 'bg-zinc-800 text-zinc-300 border-zinc-600';\r\n            return (\r\n              <span\r\n                key={b}\r\n                title={b === 'AI checked' ? 'AI reviewed but kept original wording.' : undefined}\r\n                className={`rounded px-2 py-[2px] text-[10px] uppercase tracking-wide border ${extra}`}\r\n              >\r\n                {b}\r\n              </span>\r\n            );\r\n          })}\r\n        </div>\r\n      </div>\r\n      <div className=\"text-sm opacity-90 whitespace-pre-line min-h-[48px]\">\r\n        {loading ? (\r\n          <span className=\"opacity-60\">Loading…</span>\r\n        ) : effectiveUnavailable ? (\r\n          <span>The language model is temporarily unavailable. Showing deterministic description.</span>\r\n        ) : (\r\n          <>\r\n            {desc?.text || entry.body}\r\n            {aiCheckedNoChange && !effectiveUnavailable && (\r\n              <div className=\"mt-2 text-[11px] opacity-60\">AI reviewed the description; original wording was already clear.</div>\r\n            )}\r\n          </>\r\n        )}\r\n      </div>\r\n      <div className=\"mt-3 flex items-center justify-between\">\r\n        <button ref={closeRef} className=\"text-xs opacity-80 hover:opacity-100 underline\" onClick={onClose}>Close</button>\r\n        <div className=\"text-[10px] opacity-50\">\r\n          Based on latest data · cached 5m\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\help\\devChecks.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[108,111],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[108,111],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { helpRegistry } from \"./helpRegistry\";\r\n\r\nexport function verifyHelpKeys() {\r\n  if ((import.meta as any).env?.PROD) return;\r\n  const keys = Object.keys(helpRegistry);\r\n  const set = new Set(keys);\r\n  if (set.size !== keys.length) {\r\n    const dupes = keys.filter((k, i) => keys.indexOf(k) !== i);\r\n    // eslint-disable-next-line no-console\r\n    console.warn(\"[Help] Duplicate keys detected:\", Array.from(new Set(dupes)));\r\n  }\r\n  const missing = Array.from(document.querySelectorAll<HTMLElement>(\"[data-help-key]\"))\r\n    .map((el) => el.dataset.helpKey!)\r\n    .filter((k) => !(k in helpRegistry));\r\n  if (missing.length) {\r\n    // eslint-disable-next-line no-console\r\n    console.warn(\"[Help] Missing registry entries:\", Array.from(new Set(missing)));\r\n  }\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\help\\helpRegistry.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\help\\useHelpMode.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\help\\useHelpMode.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\hooks\\use-toast.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\hooks\\useExplain.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[277,280],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[277,280],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[288,291],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[288,291],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1291,1294],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1291,1294],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":52,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1863,1866],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1863,1866],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2478,2481],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2478,2481],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from \"react\";\nimport { uiHelp } from \"@/lib/api\";\nimport { agentChat } from \"@/lib/api\";\n\n// simple in-memory cache per tab\nconst cache = new Map<string, { t: number; text: string }>();\nconst TTL = 5 * 60 * 1000; // 5 minutes\n\nfunction formatFallback(base: any, ctx?: any) {\n  if (!base) return \"This widget shows a chart or card in the current view.\";\n  const bullets = [\n    `• ${base.what || base.title || \"Overview\"}`,\n    ...((base.how_to_read || []).slice(0, 3).map((x: string) => `• ${x}`)),\n    ...(base.tips ? [`• Tip: ${base.tips[0]}`] : []),\n    ...(ctx?.data ? [\n      `• Example: data available for the selected month.`\n    ] : []),\n  ];\n  return bullets.join(\"\\n\");\n}\n\nexport function useExplain() {\n  const [open, setOpen] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [text, setText] = useState<string>(\"\");\n\n  async function explain(key: string, opts?: { month?: string; withContext?: boolean }) {\n    const t0 = performance.now?.() ?? Date.now();\n    const ck = `${key}:${opts?.month || \"\"}:${!!opts?.withContext}`;\n    const hit = cache.get(ck);\n    if (hit && (Date.now() - hit.t) < TTL) {\n      setOpen(true);\n      setText(hit.text);\n      return;\n    }\n\n    setOpen(true); setLoading(true);\n    try {\n      const res: any = await uiHelp.describe(key, opts?.month, !!opts?.withContext);\n      const base = res?.help || {};\n      const ctx = res?.context || null;\n\n      const prompt = [\n        \"Explain the following UI widget to a new user in 4–6 short bullets.\",\n        \"Be clear and non-technical. Include how to read it.\",\n        ctx ? \"Use the provided context to cite one concrete example.\" : \"\",\n        `HELP_SPEC: ${JSON.stringify(base)}`,\n        ctx ? `CONTEXT: ${JSON.stringify(ctx).slice(0, 6000)}` : \"\",\n      ].filter(Boolean).join(\"\\n\");\n\n      try {\n        const reply: any = await agentChat([{ role: \"user\", content: prompt }]);\n        const raw = (reply?.reply || \"\").trim();\n        const tooShort = !raw || raw.length < 20 || /^ok\\.?$/i.test(raw);\n        const txt = tooShort ? formatFallback(base, ctx) : raw;\n        setText(txt);\n        cache.set(ck, { t: Date.now(), text: txt });\n      } catch {\n        const txt = formatFallback(base, ctx);\n        setText(txt);\n        cache.set(ck, { t: Date.now(), text: txt });\n      }\n    } finally {\n      setLoading(false);\n      const t1 = performance.now?.() ?? Date.now();\n      // dev-only telemetry\n      if ((import.meta as any)?.env?.DEV && typeof console !== 'undefined') {\n        console.debug?.(\"[ui-help] explain\", {\n          help_key: key,\n          with_context: !!opts?.withContext,\n          month: opts?.month,\n          ms: Math.round(Math.max(0, t1 - t0)),\n        });\n      }\n    }\n  }\n\n  return { open, setOpen, loading, text, explain };\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\hooks\\useRuleSuggestions.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1081,1084],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1081,1084],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useCallback, useEffect, useState } from \"react\";\nimport { acceptRuleSuggestion, dismissRuleSuggestion, listRuleSuggestions, type PersistedRuleSuggestion } from \"@/lib/api\";\n\ntype Query = {\n  merchant_norm?: string;\n  category?: string;\n  limit?: number;\n  offset?: number;\n};\n\nexport function useRuleSuggestions(initial: Query = {}) {\n  const [items, setItems] = useState<PersistedRuleSuggestion[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [query, setQuery] = useState<Query>({ limit: 50, offset: 0, ...initial });\n  const [refreshNonce, setRefreshNonce] = useState(0);\n\n  const refresh = useCallback(() => setRefreshNonce((n) => n + 1), []);\n  const setFilter = useCallback((q: Query) => setQuery((prev) => ({ ...prev, ...q, offset: 0 })), []);\n\n  useEffect(() => {\n    let cancelled = false;\n    async function run() {\n      setLoading(true);\n      setError(null);\n      try {\n        const data = await listRuleSuggestions(query);\n        if (!cancelled) setItems(data);\n      } catch (e: any) {\n        if (!cancelled) setError(e.message || \"Failed to load suggestions\");\n      } finally {\n        if (!cancelled) setLoading(false);\n      }\n    }\n    run();\n    return () => { cancelled = true; };\n  }, [query.merchant_norm, query.category, query.limit, query.offset, refreshNonce]);\n\n  const accept = useCallback(async (id: number) => {\n    const res = await acceptRuleSuggestion(id);\n    refresh();\n    return res; // { ok, rule_id }\n  }, [refresh]);\n\n  const dismiss = useCallback(async (id: number) => {\n    const res = await dismissRuleSuggestion(id);\n    refresh();\n    return res; // { ok }\n  }, [refresh]);\n\n  return { items, loading, error, query, setFilter, setQuery, refresh, accept, dismiss };\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\hooks\\useRulesQuery.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[692,695],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[692,695],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from \"react\";\nimport { getRules, type RuleListItem } from \"@/api\";\n\nexport function useRulesQuery(params: { q?: string; active?: boolean; limit?: number; offset?: number }) {\n  const [items, setItems] = useState<RuleListItem[]>([]);\n  const [total, setTotal] = useState(0);\n  const [loading, setLoading] = useState(false);\n  const [err, setErr] = useState<string | null>(null);\n\n  useEffect(() => {\n    let cancelled = false;\n    (async () => {\n      setLoading(true);\n      setErr(null);\n      try {\n        const res = await getRules(params);\n        if (!cancelled) {\n          setItems(res.items);\n          setTotal(res.total);\n        }\n      } catch (e: any) {\n        if (!cancelled) setErr(e?.message || \"Failed to load rules\");\n      } finally {\n        if (!cancelled) setLoading(false);\n      }\n    })();\n    return () => { cancelled = true; };\n  }, [params.q, params.active, params.limit, params.offset]);\n\n  return { items, total, loading, err };\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\hooks\\useUnknowns.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1119,1122],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1119,1122],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1208,1211],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1208,1211],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1307,1310],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1307,1310],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from \"react\";\nimport { getUnknowns } from \"@/api\";\n\nexport type UnknownTxn = {\n  id: number;\n  date: string;\n  merchant?: string | null;\n  description?: string | null;\n  amount: number;\n  category?: string | null;\n};\n\nexport function useUnknowns(month?: string, limit = 25) {\n  const [items, setItems] = useState<UnknownTxn[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [currentMonth, setCurrentMonth] = useState<string | null>(null);\n  const [nonce, setNonce] = useState(0);\n\n  useEffect(() => {\n    if (!month) {\n      // Guard: don’t fetch until we know the month\n      setItems([]);\n      setLoading(false);\n      setError(null);\n      return;\n    }\n    const ac = new AbortController();\n    setLoading(true);\n    setError(null);\n\n    (async () => {\n      try {\n        // Backend route: /txns/unknowns with optional month; limit not used server-side currently\n        const data = await getUnknowns(month);\n        if (ac.signal.aborted) return;\n        const rows = Array.isArray(data) ? data : (data as any)?.unknowns ?? [];\n        setItems(rows as UnknownTxn[]);\n        const m = (data as any)?.month;\n        setCurrentMonth(typeof m === \"string\" ? m : month ?? null);\n      } catch (e: any) {\n        if (!ac.signal.aborted) setError(e?.message ?? \"Failed to load unknowns\");\n      } finally {\n        if (!ac.signal.aborted) setLoading(false);\n      }\n    })();\n\n    return () => ac.abort();\n  }, [month, limit, nonce]);\n\n  return { items, loading, error, currentMonth, refresh: () => setNonce((n) => n + 1) };\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\lib\\__tests__\\aguiStream.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[177,180],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[177,180],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[196,199],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[196,199],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[217,220],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[217,220],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":100,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":103,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[847,850],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[847,850],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi } from 'vitest';\r\nimport { wireAguiStream } from '../aguiStream';\r\n\r\n// Helper to fetch latest mock EventSource instance\r\nfunction latestES(): any {\r\n  const ES: any = (globalThis as any).EventSource;\r\n  if (ES.instances && ES.instances.length) return ES.instances[ES.instances.length - 1];\r\n  return ES.mockLast || ES;\r\n}\r\n\r\ndescribe('wireAguiStream', () => {\r\n  it('parses RUN_STARTED, TOOL_CALL_*, TEXT_MESSAGE_CONTENT, SUGGESTIONS, RUN_FINISHED', async () => {\r\n    const handlers = {\r\n      onStart: vi.fn(),\r\n      onIntent: vi.fn(),\r\n      onToolStart: vi.fn(),\r\n      onToolEnd: vi.fn(),\r\n      onChunk: vi.fn(),\r\n      onFinish: vi.fn(),\r\n      onSuggestions: vi.fn(),\r\n      onError: vi.fn(),\r\n    };\r\n\r\n    const dispose = wireAguiStream({ q: 'Show KPIs', month: '2025-08', mode: 'kpis' }, handlers as any);\r\n    const inst = latestES();\r\n\r\n    inst._emit('RUN_STARTED', { intent: 'kpis', month: '2025-08' });\r\n    inst._emit('TOOL_CALL_START', { name: 'analytics.kpis' });\r\n    inst._emit('TOOL_CALL_END', { name: 'analytics.kpis', ok: true });\r\n    inst._emit('TEXT_MESSAGE_CONTENT', { text: 'KPI summary...' });\r\n    inst._emit('SUGGESTIONS', { chips: [{ label: 'Compare vs last month', action: 'compare_prev' }] });\r\n    inst._emit('RUN_FINISHED', { ts: Date.now() });\r\n\r\n    expect(handlers.onStart).toHaveBeenCalledWith(expect.objectContaining({ intent: 'kpis' }));\r\n  // onIntent passes (intent, meta)\r\n  expect(handlers.onIntent).toHaveBeenCalledWith('kpis', expect.objectContaining({ intent: 'kpis' }));\r\n    expect(handlers.onToolStart).toHaveBeenCalledWith('analytics.kpis');\r\n    expect(handlers.onToolEnd).toHaveBeenCalledWith('analytics.kpis', true, undefined);\r\n    expect(handlers.onChunk).toHaveBeenCalledWith('KPI summary...');\r\n    expect(handlers.onSuggestions).toHaveBeenCalledWith([\r\n      { label: 'Compare vs last month', action: 'compare_prev' }\r\n    ]);\r\n    expect(handlers.onFinish).toHaveBeenCalled();\r\n\r\n    dispose();\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\lib\\__tests__\\name.micro.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\lib\\aguiStream.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[139,142],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[139,142],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[302,305],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[302,305],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[353,356],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[353,356],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/ban-types","severity":2,"message":"Don't use `Function` as a type. The `Function` type accepts any function-like value.\nIt provides no type safety when calling the function, which can be a common source of bugs.\nIt also accepts things like class declarations, which will throw at runtime as they will not be called with `new`.\nIf you are expecting the function to accept certain arguments, you should explicitly define the function shape.","line":25,"column":22,"nodeType":"Identifier","messageId":"bannedTypeMessage","endLine":25,"endColumn":30},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[910,913],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[910,913],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export type AguiHandlers = {\r\n  onStart?(meta: { intent?: string; month?: string; ts?: number }): void;\r\n  onIntent?(intent: string, meta: any): void;\r\n  onToolStart?(name: string): void;\r\n  onToolEnd?(name: string, ok: boolean, error?: string): void;\r\n  onChunk?(text: string): void;\r\n  onMeta?(meta: any): void;\r\n  onFinish?(): void;\r\n  onError?(err: any): void;\r\n  onSuggestions?(chips: Array<{ label: string; action: string }>): void;\r\n};\r\n\r\nexport function wireAguiStream(\r\n  params: { q: string; month?: string; mode?: string },\r\n  h: AguiHandlers\r\n) {\r\n  const { q, month, mode } = params;\r\n  const url = new URL('/agui/chat', window.location.origin);\r\n  url.searchParams.set('q', q);\r\n  if (month) url.searchParams.set('month', month);\r\n  if (mode)  url.searchParams.set('mode', mode);\r\n\r\n  const es = new EventSource(url.toString(), { withCredentials: true });\r\n\r\n  const safe = (fn?: Function, ...a: any[]) => { try { fn && fn(...a); } catch { /* swallow */ } };\r\n\r\n  es.addEventListener('INTENT_DETECTED', (e: MessageEvent) => {\r\n    const meta = JSON.parse(e.data || '{}');\r\n    safe(h.onIntent, meta.intent, meta);\r\n  });\r\n  es.addEventListener('RUN_STARTED', (e: MessageEvent) => {\r\n    const meta = JSON.parse(e.data || '{}');\r\n    safe(h.onStart, meta);\r\n    if (meta.intent) safe(h.onIntent, meta.intent, meta);\r\n  });\r\n  es.addEventListener('TOOL_CALL_START', (e: MessageEvent) => {\r\n    const name = JSON.parse(e.data || '{}')?.name;\r\n    if (name) safe(h.onToolStart, name);\r\n  });\r\n  es.addEventListener('TOOL_CALL_END', (e: MessageEvent) => {\r\n    const d = JSON.parse(e.data || '{}');\r\n    safe(h.onToolEnd, d?.name, !!d?.ok, d?.error);\r\n  });\r\n  es.addEventListener('TEXT_MESSAGE_CONTENT', (e: MessageEvent) => {\r\n    const text = JSON.parse(e.data || '{}')?.text ?? '';\r\n    if (text) safe(h.onChunk, text);\r\n  });\r\n  es.addEventListener('RUN_FINISHED', () => {\r\n    safe(h.onFinish);\r\n    es.close();\r\n  });\r\n  es.addEventListener('META', (e: MessageEvent) => {\r\n    try {\r\n      const d = JSON.parse(e.data || '{}');\r\n      safe(h.onMeta, d);\r\n    } catch { /* ignore */ }\r\n  });\r\n  es.addEventListener('SUGGESTIONS', (e: MessageEvent) => {\r\n    try {\r\n      const d = JSON.parse(e.data || '{}');\r\n      if (Array.isArray(d.chips) && d.chips.length) safe(h.onSuggestions, d.chips);\r\n    } catch { /* ignore */ }\r\n  });\r\n  es.onerror = (err) => { safe(h.onError, err); es.close(); };\r\n\r\n  return () => es.close();\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\lib\\analytics.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[173,176],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[173,176],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Lightweight analytics helper wrapping existing api telemetry.track\r\nimport { telemetry } from \"@/lib/api\";\r\n\r\nexport function track(event: string, props?: Record<string, any>) {\r\n  try {\r\n    telemetry.track(event, props);\r\n  } catch (e) {\r\n    // swallow\r\n  }\r\n}\r\n\r\nexport default { track };","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\lib\\api.ts","messages":[{"ruleId":"@typescript-eslint/consistent-type-imports","severity":1,"message":"Imports \"MinedRuleSuggestionStrict\" are only used as type.","line":1,"column":1,"nodeType":"ImportDeclaration","messageId":"someImportsAreOnlyTypes","endLine":1,"endColumn":100,"fix":{"range":[0,53],"text":"import type { RuleSuggestion as MinedRuleSuggestionStrict} from \"@/types/rules\";\nimport {"}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'fetchAuth' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'dashSlug' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":40},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[278,281],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[278,281],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[761,764],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[761,764],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2223,2226],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2223,2226],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":68,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2441,2444],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2441,2444],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":89,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":89,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[3411,3411],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":114,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4113,4116],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4113,4116],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CACHE_TTL_MS' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":115,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":115,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'responseCache' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":116,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":116,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'inflight' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":117,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":117,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":117,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4275,4278],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4275,4278],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'runOrQueue' is defined but never used. Allowed unused vars must match /^_/u.","line":123,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":123,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'done' is defined but never used. Allowed unused vars must match /^_/u.","line":131,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":131,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'keyFromInit' is defined but never used. Allowed unused vars must match /^_/u.","line":140,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":140,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":146,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":146,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4956,4959],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4956,4959],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":157,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":157,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5292,5295],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5292,5295],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":160,"column":101,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":160,"endColumn":104,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5505,5508],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5505,5508],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":166,"column":88,"nodeType":"BlockStatement","messageId":"unexpected","endLine":166,"endColumn":90,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[5787,5787],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":175,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":175,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6144,6147],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6144,6147],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":179,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":179,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6213,6216],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6213,6216],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":181,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6297,6300],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6297,6300],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":181,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6323,6326],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6323,6326],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":183,"column":101,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":183,"endColumn":104,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6516,6519],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6516,6519],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":191,"column":97,"nodeType":"BlockStatement","messageId":"unexpected","endLine":191,"endColumn":99,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[6808,6808],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":205,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":205,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7317,7320],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7317,7320],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":209,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":209,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7433,7436],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7433,7436],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":212,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":212,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7613,7616],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7613,7616],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":212,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":212,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7651,7654],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7651,7654],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":213,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":213,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7711,7714],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7711,7714],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":213,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":213,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7743,7746],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7743,7746],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mapKeys' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":274,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":274,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":274,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":274,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9188,9191],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9188,9191],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":275,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":275,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9240,9243],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9240,9243],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'qs' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":295,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":295,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'qs' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":300,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":300,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'qs' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":305,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":305,"endColumn":11},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":322,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":322,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11208,11211],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11208,11211],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":335,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":335,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12010,12013],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12010,12013],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":342,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":342,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12297,12300],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12297,12300],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":366,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":366,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12926,12929],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12926,12929],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":390,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":390,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[13961,13961],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'qs' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":404,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":404,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'qs' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":408,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":408,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'qs' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":414,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":414,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'qs' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":419,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":419,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'source' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":453,"column":66,"nodeType":null,"messageId":"unusedVar","endLine":453,"endColumn":72},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'notes' is defined but never used. Allowed unused args must match /^_/u.","line":453,"column":98,"nodeType":null,"messageId":"unusedVar","endLine":453,"endColumn":103},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":493,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":493,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17313,17316],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17313,17316],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":501,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":501,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17650,17653],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17650,17653],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":510,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":510,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17907,17910],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17907,17910],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":510,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":510,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17929,17932],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17929,17932],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":510,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":510,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17959,17962],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17959,17962],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":510,"column":108,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":510,"endColumn":111,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17981,17984],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17981,17984],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":511,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":511,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18047,18050],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18047,18050],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":511,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":511,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18070,18073],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18070,18073],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":512,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":512,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18114,18117],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18114,18117],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":546,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":546,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19674,19677],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19674,19677],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":555,"column":15,"nodeType":"BlockStatement","messageId":"unexpected","endLine":555,"endColumn":17,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[19965,19965],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":576,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":576,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20640,20643],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20640,20643],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":648,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":648,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24058,24061],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24058,24061],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":665,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":665,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24656,24659],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24656,24659],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":665,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":665,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24685,24688],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24685,24688],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":666,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":666,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24722,24725],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24722,24725],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":700,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":700,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25834,25837],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25834,25837],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":727,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":727,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26799,26802],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26799,26802],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":739,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":739,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27080,27083],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27080,27083],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":742,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":742,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27197,27200],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27197,27200],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":767,"column":8,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":767,"endColumn":11,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27978,27981],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27978,27981],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":817,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":817,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30115,30118],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30115,30118],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":823,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":823,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30227,30230],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30227,30230],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":837,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":837,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30596,30599],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30596,30599],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":837,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":837,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30639,30642],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30639,30642],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":838,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":838,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30677,30680],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30677,30680],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":838,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":838,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30716,30719],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30716,30719],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":839,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":839,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30762,30765],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30762,30765],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":839,"column":100,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":839,"endColumn":103,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30821,30824],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30821,30824],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":840,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":840,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30868,30871],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30868,30871],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":840,"column":101,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":840,"endColumn":104,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30927,30930],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30927,30930],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":841,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":841,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30967,30970],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30967,30970],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":841,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":841,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31012,31015],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31012,31015],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":842,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":842,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31051,31054],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31051,31054],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":842,"column":91,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":842,"endColumn":94,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31108,31111],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31108,31111],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":843,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":843,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31148,31151],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31148,31151],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":843,"column":92,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":843,"endColumn":95,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31205,31208],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31205,31208],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":844,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":844,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31246,31249],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31246,31249],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":844,"column":93,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":844,"endColumn":96,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31303,31306],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31303,31306],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":845,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":845,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31340,31343],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31340,31343],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":845,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":845,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31353,31356],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31353,31356],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":845,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":845,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31367,31370],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31367,31370],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-shadow","severity":1,"message":"'q' is already declared in the upper scope on line 146 column 10.","line":848,"column":3,"nodeType":"Identifier","messageId":"noShadow","endLine":848,"endColumn":12},{"ruleId":"no-shadow","severity":1,"message":"'q' is already declared in the upper scope on line 146 column 10.","line":860,"column":3,"nodeType":"Identifier","messageId":"noShadow","endLine":860,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":929,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":929,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[34302,34305],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[34302,34305],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":936,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":936,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[34515,34518],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[34515,34518],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":940,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":940,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[34662,34665],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[34662,34665],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1024,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1024,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[37975,37978],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[37975,37978],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1032,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1032,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[38225,38228],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[38225,38228],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1060,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1060,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[38848,38851],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[38848,38851],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1073,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1073,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[39403,39406],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[39403,39406],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1113,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1113,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[40944,40947],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[40944,40947],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1114,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1114,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[41142,41145],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[41142,41145],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1115,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1115,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[41338,41341],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[41338,41341],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1116,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1116,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[41539,41542],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[41539,41542],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1118,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1118,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[41760,41763],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[41760,41763],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1120,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1120,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[41982,41985],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[41982,41985],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1121,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1121,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[42192,42195],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[42192,42195],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1122,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1122,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[42404,42407],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[42404,42407],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1124,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1124,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[42621,42624],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[42621,42624],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1125,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1125,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[42815,42818],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[42815,42818],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1127,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1127,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[43016,43019],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[43016,43019],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1128,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1128,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[43205,43208],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[43205,43208],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1129,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1129,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[43398,43401],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[43398,43401],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1138,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1138,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[43817,43820],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[43817,43820],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1143,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1143,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[43918,43921],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[43918,43921],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1154,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1154,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[44437,44440],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[44437,44440],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1163,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1163,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[44795,44798],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[44795,44798],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1180,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1180,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[45593,45596],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[45593,45596],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1185,"column":94,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1185,"endColumn":97,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[45872,45875],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[45872,45875],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1191,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1191,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[46189,46192],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[46189,46192],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":115,"fixableErrorCount":0,"fixableWarningCount":1,"source":"import { RuleSuggestion as MinedRuleSuggestionStrict, isRuleSuggestionArray } from \"@/types/rules\";\nimport { fetchJSON, fetchAuth, dashSlug } from '@/lib/http';\n\n// Resolve API base from env, with a dev fallback when running Vite on port 5173\nconst rawApiBase = (import.meta as any).env?.VITE_API_BASE;\nexport const API_BASE = ((rawApiBase ?? '/api') as string).replace(/\\/+$/, '') || '/api';\n\nexport function apiUrl(path: string): string {\n  return `${API_BASE}${path.startsWith('/') ? path : `/${path}`}`;\n}\n\nfunction cookieGet(name: string): string | null {\n  try {\n    const m = document.cookie.match(new RegExp(\"(^| )\" + name + \"=([^;]+)\"));\n    return m ? decodeURIComponent(m[2]) : null;\n  } catch {\n    return null;\n  }\n}\n\nexport async function api<T = any>(path: string, options: RequestInit = {}): Promise<T> {\n  const url = apiUrl(path);\n  const method = (options.method || \"GET\").toString().toUpperCase();\n  const headers = new Headers(options.headers || {});\n  if (!headers.has(\"Content-Type\") && ![\"GET\", \"HEAD\"].includes(method)) {\n    headers.set(\"Content-Type\", \"application/json\");\n  }\n  if (![\"GET\", \"HEAD\", \"OPTIONS\"].includes(method)) {\n    const csrf = cookieGet(\"csrf_token\");\n    if (csrf && !headers.has(\"X-CSRF-Token\")) headers.set(\"X-CSRF-Token\", csrf);\n  }\n  const res = await fetch(url, { credentials: \"include\", ...options, headers });\n  if (res.status === 204) return null as T;\n  const text = await res.text();\n  if (!res.ok) throw new Error(`HTTP ${res.status} ${res.statusText} :: ${text || \"<empty>\"}`);\n  try {\n    return text ? (JSON.parse(text) as T) : (null as T);\n  } catch {\n    return text as unknown as T;\n  }\n}\n\n// Central chart slug normalizer: backend expects dash-separated slugs.\n// (Instruction: convert any underscore slugs to dashes before calling)\nfunction chartPath(slug: string) {\n  const norm = slug.replace(/_/g, '-');\n  return `/charts/${norm}`;\n}\n\nexport const charts = {\n  monthSummary: () => api(chartPath('month_summary')), // becomes /charts/month-summary\n};\n\n// prefer GET-only month resolution to avoid 422s on some branches\nexport async function resolveMonthFromCharts(): Promise<string> {\n  try {\n    const r = await charts.monthSummary();\n    return (r as any)?.month ?? \"\";\n  } catch {\n    return \"\";\n  }\n}\n\n// GET-only: older backend compatibility\nexport async function resolveMonth(): Promise<string> {\n  try {\n    const r = await charts.monthSummary();\n    return (r as any)?.month ?? \"\";\n  } catch {\n    return \"\";\n  }\n}\n\n// Optional bearer fallback: keep a transient token if needed (e.g., dev/testing)\nlet accessToken: string | null = null;\nexport const setAccessToken = (t: string | null) => { accessToken = t; };\n\nfunction withCreds(init: RequestInit = {}): RequestInit {\n  // Preserve headers and include cookies in all requests\n  const headers = new Headers(init.headers || {});\n  if (accessToken) headers.set(\"Authorization\", `Bearer ${accessToken}`);\n  // CSRF: include header for unsafe methods if cookie is present\n  const method = (init.method || 'GET').toString().toUpperCase();\n  if ([\"POST\", \"PUT\", \"PATCH\", \"DELETE\"].includes(method)) {\n    try {\n      const m = typeof document !== 'undefined' ? document.cookie.match(/(?:^|;\\s*)csrf_token=([^;]+)/) : null;\n      const csrf = m && m[1] ? decodeURIComponent(m[1]) : undefined;\n      if (csrf && !headers.has(\"X-CSRF-Token\")) headers.set(\"X-CSRF-Token\", csrf);\n    } catch {}\n  }\n  return { ...init, headers, credentials: \"include\" };\n}\n\nfunction withAuthHeaders(headers?: HeadersInit): HeadersInit {\n  const at = accessToken;\n  if (!at) return headers || {};\n  const base: Record<string, string> = {};\n  if (headers) {\n    if (headers instanceof Headers) {\n      headers.forEach((v, k) => (base[k] = v));\n    } else if (Array.isArray(headers)) {\n      for (const [k, v] of headers) base[k] = String(v);\n    } else {\n      Object.assign(base, headers as Record<string, string>);\n    }\n  }\n  base[\"Authorization\"] = `Bearer ${at}`;\n  return base;\n}\n\n// ---------------------------\n// Global fetch guards\n// ---------------------------\ntype CacheEntry = { t: number; p: Promise<any> };\nconst CACHE_TTL_MS = 5000; // 5s shared cache across panels\nconst responseCache = new Map<string, CacheEntry>();\nconst inflight = new Map<string, Promise<any>>();\n\n// Simple request limiter (queue) to prevent stampedes\nconst MAX_CONCURRENCY = 4;\nlet active = 0;\nconst reqQueue: Array<() => void> = [];\nfunction runOrQueue(fn: () => void) {\n  if (active < MAX_CONCURRENCY) {\n    active++;\n    fn();\n  } else {\n    reqQueue.push(fn);\n  }\n}\nfunction done() {\n  active = Math.max(0, active - 1);\n  const next = reqQueue.shift();\n  if (next) {\n    active++;\n    next();\n  }\n}\n\nfunction keyFromInit(url: string, init?: RequestInit) {\n  const method = (init?.method || \"GET\").toUpperCase();\n  const body = typeof init?.body === \"string\" ? (init!.body as string) : \"\";\n  return `${method} ${url} ${body}`;\n}\n\nfunction q(params: Record<string, any>) {\n  const usp = new URLSearchParams()\n  Object.entries(params).forEach(([k, v]) => {\n    if (v === undefined || v === null || v === '') return\n    usp.set(k, String(v))\n  })\n  const s = usp.toString()\n  return s ? `?${s}` : ''\n}\n\n// Core HTTP: do not loop on 401. One shot; caller handles auth state.\nexport async function http<T=any>(path: string, init?: RequestInit): Promise<T> {\n  const url = apiUrl(path);\n  const doFetch = async () => {\n  const headers = withAuthHeaders({ 'Content-Type': 'application/json', ...(init?.headers || {}) as any });\n  return fetch(url, withCreds({ ...init, headers }));\n  };\n  let res = await doFetch();\n  if (res.status === 401) {\n    // Attempt cookie-based refresh once, then retry original request\n    try { await fetch(apiUrl('/auth/refresh'), withCreds({ method: 'POST' })); } catch {}\n    res = await doFetch();\n  }\n  if (!res.ok) {\n    const txt = await res.text().catch(() => \"\");\n    const snippet = txt ? ` — ${txt.slice(0, 200)}` : \"\";\n    throw new Error(`${res.status} ${res.statusText}${snippet}`);\n  }\n  const ct = res.headers.get('content-type') || '';\n  return ct.includes('application/json') ? res.json() : (await res.text() as any);\n}\n\n// Convenience GET wrapper\nexport const apiGet = async <T = any>(path: string): Promise<T> => http<T>(path);\n\nexport async function apiPost<T = any>(path: string, body?: any, init?: RequestInit): Promise<T> {\n  const url = API_BASE ? `${API_BASE}${path}` : path;\n  const headers = withAuthHeaders({ 'Content-Type': 'application/json', ...(init?.headers || {}) as any });\n  let res = await fetch(url, withCreds({\n    ...init,\n    method: 'POST',\n    headers,\n    body: body === undefined ? undefined : JSON.stringify(body),\n  }));\n  if (res.status === 401) {\n    try { await fetch(`${API_BASE || ''}/auth/refresh`, withCreds({ method: 'POST' })); } catch {}\n    res = await fetch(url, withCreds({\n      ...init,\n      method: 'POST',\n      headers,\n      body: body === undefined ? undefined : JSON.stringify(body),\n    }));\n  }\n  if (!res.ok) {\n    const text = await res.text().catch(() => '');\n    // Provide helpful message in dev (includes backend detail)\n    throw new Error(`${res.status} ${res.statusText} ${text}`.trim());\n  }\n  const ct = res.headers.get('content-type') || '';\n  return ct.includes('application/json') ? res.json() : (await res.text() as any);\n}\n\n// ---- Suggestions normalizer (array-shape resilience) ----\nexport function normalizeSuggestions(payload: any): MinedRuleSuggestionStrict[] {\n  if (isRuleSuggestionArray(payload)) return payload;\n  if (payload && typeof payload === \"object\") {\n    if (isRuleSuggestionArray((payload as any).suggestions)) return (payload as any).suggestions;\n    if (isRuleSuggestionArray((payload as any).items)) return (payload as any).items;\n    const vals = Object.values(payload);\n    if (isRuleSuggestionArray(vals)) return vals;\n  }\n  return [];\n}\n\n// ---------- Health ----------\nexport type Healthz = {\n  status: 'ok' | 'degraded';\n  db_engine?: string;\n  models_ok?: boolean;\n  alembic?: {\n    db_revision?: string | null;\n    code_head?: string | null;\n    in_sync?: boolean;\n  };\n  alembic_ok?: boolean;\n  db_revision?: string | null;\n};\n\nexport async function getHealthz(): Promise<Healthz> {\n  return http<Healthz>('/healthz');\n}\n\nexport type MetaInfo = {\n  ok: boolean;\n  engine: string;\n  alembic: {\n    db_revision: string | null;\n    code_head: string | null;\n    code_heads: string[];\n    in_sync: boolean;\n    recent_migrations: Array<{\n      revision: string;\n      down_revision: string | null | string[];\n      is_head: boolean;\n      branch_labels: string[];\n      message: string;\n  filename?: string | null;\n    }>;\n  code_error?: string | null;\n  };\n};\n\nexport async function getMetaInfo(): Promise<MetaInfo> {\n  return http<MetaInfo>('/meta/info');\n}\n\n// LLM health\nexport type LlmHealth = {\n  ok: boolean;\n  status: { ollama: string; openai: string };\n  openai_key?: { present: boolean; source: 'env'|'file'|'absent' };\n};\n\nexport async function getLlmHealth(): Promise<LlmHealth> {\n  return http<LlmHealth>('/llm/health');\n}\n\n// mapper: rename keys (camelCase -> snake_case) and allow snake_case passthrough\nconst mapKeys = <T extends object>(src: any, pairs: Record<string, string>) => {\n  const o: any = {};\n  for (const [from, to] of Object.entries(pairs)) {\n    if (src && src[from] !== undefined) o[to] = src[from];\n    if (src && src[to]   !== undefined) o[to] = src[to]; // allow snake too\n  }\n  return o as T;\n};\n\n// ---------- Insights / Alerts ----------\n// Use robust fetchJson; keep optional month for backward-compat callers\nexport const getInsights = (month?: string) =>\n  fetchJSON(`insights`, { query: month ? { month } : undefined })\nexport const getAlerts = (month?: string) =>\n  fetchJSON(`alerts`, { query: month ? { month } : undefined })\nexport const downloadReportCsv = (month: string) => window.open(`${apiUrl('/report_csv')}${q({ month })}`,'_blank')\n\n// ---------- Charts ----------\n// (Removed legacy fetchJson wrapper; use fetchJSON from http.ts directly)\n\nexport async function getMonthSummary(month?: string) {\n  const qs = month ? `?month=${encodeURIComponent(month)}` : \"\";\n  return fetchJSON(`${chartPath('month_summary').slice(1)}`, { query: month ? { month } : undefined });\n}\n\nexport async function getMonthMerchants(month?: string) {\n  const qs = month ? `?month=${encodeURIComponent(month)}` : \"\";\n  return fetchJSON(`${chartPath('month_merchants').slice(1)}`, { query: month ? { month } : undefined });\n}\n\nexport async function getMonthFlows(month?: string) {\n  const qs = month ? `?month=${encodeURIComponent(month)}` : \"\";\n  return fetchJSON(`${chartPath('month_flows').slice(1)}`, { query: month ? { month } : undefined });\n}\n\nexport async function getSpendingTrends(months = 6) {\n  return fetchJSON(`${chartPath('spending_trends').slice(1)}`, { query: { months } });\n}\n\n// ---------- Analytics (agent tools) ----------\nexport const analytics = {\n  kpis: (month?: string, lookback_months = 6) =>\n    apiPost(`/agent/tools/analytics/kpis`, { month, lookback_months }),\n  forecast: (\n    month?: string,\n    horizon = 3,\n    opts?: { model?: \"auto\" | \"ema\" | \"sarimax\"; ciLevel?: 0 | 0.8 | 0.9 | 0.95 }\n  ) => {\n    const body: any = { month, horizon };\n    if (opts?.model) body.model = opts.model;\n    if (opts?.ciLevel && opts.ciLevel > 0) body.alpha = 1 - opts.ciLevel; // 0.8 -> alpha 0.2\n    return apiPost(`/agent/tools/analytics/forecast/cashflow`, body);\n  },\n  anomalies: (month?: string, lookback_months = 6) =>\n    apiPost(`/agent/tools/analytics/anomalies`, { month, lookback_months }),\n  recurring: (month?: string, lookback_months = 6) =>\n    apiPost(`/agent/tools/analytics/recurring`, { month, lookback_months }),\n  subscriptions: (month?: string, lookback_months = 6) =>\n    apiPost(`/agent/tools/analytics/subscriptions`, { month, lookback_months }),\n  budgetSuggest: (month?: string, lookback_months = 6) =>\n    apiPost(`/agent/tools/analytics/budget/suggest`, { month, lookback_months }),\n  whatif: (payload: any) => apiPost(`/agent/tools/analytics/whatif`, payload),\n};\n\n// ---------- Telemetry ----------\nexport const telemetry = {\n  helpOpen: (payload: { key: string; path: string; ts: number }) =>\n    apiPost(`/analytics/help_open`, payload),\n  track: (event: string, props?: Record<string, any>) =>\n    apiPost(`/analytics/track`, { event, props, ts: Date.now() }).catch(() => {}),\n};\n\n// ---------- UI Help ----------\nexport const uiHelp = {\n  describe: (key: string, month?: string, withContext = false) =>\n    apiPost(`/agent/tools/help/ui/describe`, { key, month, with_context: withContext }),\n};\n\n// Unified describe (new panel help) endpoint\nexport type DescribeResponse = {\n  text: string;\n  grounded: boolean;\n  rephrased: boolean;\n  llm_called?: boolean;\n  provider: string;\n  panel_id: string;\n  mode?: 'learn' | 'explain';\n  reasons?: string[];\n};\n\nexport async function describe(\n  panelId: string,\n  body: any,\n  opts?: { mode?: 'learn' | 'explain'; rephrase?: boolean; signal?: AbortSignal }\n): Promise<DescribeResponse> {\n  const basePayload = body && typeof body === 'object' ? body : {};\n  const payload: Record<string, unknown> = { ...(basePayload as Record<string, unknown>) };\n  if (opts?.mode) payload.mode = opts.mode;\n  if (opts?.rephrase !== undefined) payload.rephrase = opts.rephrase;\n  const panelPath = `/agent/describe/${encodeURIComponent(panelId)}`;\n  const apiPrefix = API_BASE ? (API_BASE.endsWith('/api') ? API_BASE : `${API_BASE}/api`) : '/api';\n  const url = `${apiPrefix}${panelPath}`;\n  const headers = withAuthHeaders({ 'Content-Type': 'application/json' });\n  const bodyJson = JSON.stringify(payload);\n  const doFetch = () =>\n    fetch(url, withCreds({\n      method: 'POST',\n      headers,\n      body: bodyJson,\n      signal: opts?.signal,\n    }));\n\n  let res = await doFetch();\n  if (res.status === 401) {\n    try {\n      await fetch(`${API_BASE || ''}/auth/refresh`, withCreds({ method: 'POST' }));\n    } catch {}\n    res = await doFetch();\n  }\n\n  if (!res.ok) {\n    const msg = res.status === 405 ? 'Use POST /api/agent/describe/{panel_id}' : 'Help service temporarily unavailable';\n    throw new Error(msg);\n  }\n\n  return res.json() as Promise<DescribeResponse>;\n}\n\n// ---------- Budgets ----------\nexport const budgetCheck = (month?: string) => {\n  const qs = month ? `?month=${encodeURIComponent(month)}` : \"\";\n  return fetchJSON('budget/check', { query: month ? { month } : undefined });\n}\nexport const getBudgetCheck = (month?: string) => {\n  const qs = month ? `?month=${encodeURIComponent(month)}` : \"\";\n  return fetchJSON('budget/check', { query: month ? { month } : undefined });\n}\n\n// ---------- Unknowns / Suggestions ----------\nexport async function getUnknowns(month?: string) {\n  const qs = month ? `?month=${encodeURIComponent(month)}` : \"\";\n  return fetchJSON('txns/unknowns', { query: month ? { month } : undefined });\n}\n\nexport async function getSuggestions(month?: string) {\n  const qs = month ? `?month=${encodeURIComponent(month)}` : \"\";\n  return fetchJSON('ml/suggest', { query: month ? { month } : undefined });\n}\n\n// Rule Suggestions config (thresholds + window)\nexport type RuleSuggestConfig = {\n  min_support: number;\n  min_positive: number;\n  window_days: number | null;\n};\nexport const fetchRuleSuggestConfig = () => http<RuleSuggestConfig>(`/rules/suggestions/config`);\n\n// If you have explain/categorize helpers, keep them as-is\nexport const categorizeTxn = (id: number, category: string) => http(`/txns/${id}/categorize`, { method: 'POST', body: JSON.stringify({ category }) })\n\n// ---- ML feedback (incremental learning) ----\n// New ML feedback shape aligned to backend\nexport type FeedbackIn = {\n  txn_id: number;\n  merchant?: string;\n  category: string;\n  action: \"accept\" | \"reject\";\n};\nexport async function mlFeedback(body: FeedbackIn) {\n  return http<{ ok: boolean; id: number; suggestion_id?: number }>(\n    '/ml/feedback',\n    {\n      method: 'POST',\n      body: JSON.stringify(body),\n      headers: { 'Content-Type': 'application/json' },\n    }\n  );\n}\n// Legacy helper retained as no-op wrapper if still referenced elsewhere\nexport async function sendFeedback(txnId: number, label: string, source: string = \"user_change\", notes?: string) {\n  try {\n    await mlFeedback({ txn_id: txnId, category: label, action: 'accept' });\n  } catch {\n    // soft ignore in UI\n  }\n}\n\n// ---------- Rules ----------\n// Strongly-typed Rules API\nexport type Rule = {\n  id: number;\n  name: string;\n  enabled: boolean;\n  when: Record<string, unknown>;\n  then: { category?: string };\n  created_at?: string;\n  updated_at?: string;\n};\n\nexport type RuleInput = Omit<Rule, 'id' | 'created_at' | 'updated_at'>;\nexport type RuleCreateResponse = { id: string; display_name: string };\nexport type RuleListItem = { id: number; display_name: string; category?: string; active?: boolean };\n\nexport type RuleTestResult = {\n  matched_count?: number; // legacy\n  count?: number;         // new backend\n  month?: string;\n  sample: Array<{\n    id: number;\n    date: string;\n    merchant?: string;\n    description?: string;\n    amount: number;\n    category?: string | null;\n  }>;\n};\n\n// Unified test payload/response for POST /rules/test\nexport type RuleTestPayload = { rule: RuleInput; month?: string };\nexport type RuleTestResponse = { count: number; sample: any[]; month?: string };\n\n/**\n * Test a rule against transactions for a month (YYYY-MM).\n * Backend route: POST /rules/test  -> { count, sample: [...] }\n * Also tolerates legacy shapes and normalizes to { count, sample }.\n */\nexport async function testRule(payload: RuleTestPayload): Promise<RuleTestResponse> {\n  const res = await http<any>(`/rules/test`, {\n    method: 'POST',\n    body: JSON.stringify(payload),\n  });\n  // Normalize result\n  if (Array.isArray(res)) {\n    return { count: res.length, sample: res };\n  }\n  if (res && typeof res === 'object') {\n    const count = Number((res as any).count ?? (res as any).matched_count ?? (res as any).total ?? (res as any).matches ?? 0) || 0;\n    const sample = Array.isArray((res as any).sample) ? (res as any).sample : [];\n    const month = (res as any).month;\n    return { count, sample, month };\n  }\n  return { count: 0, sample: [] };\n}\n\nexport type GetRulesParams = { active?: boolean; q?: string; limit?: number; offset?: number };\nexport type GetRulesResponse = { items: RuleListItem[]; total: number; limit: number; offset: number };\nexport async function getRules(params: GetRulesParams = {}): Promise<GetRulesResponse> {\n  const usp = new URLSearchParams();\n  if (params.active !== undefined) usp.set(\"active\", String(params.active));\n  if (params.q) usp.set(\"q\", params.q);\n  if (params.limit !== undefined) usp.set(\"limit\", String(params.limit));\n  if (params.offset !== undefined) usp.set(\"offset\", String(params.offset));\n  const qs = usp.toString();\n  return http<GetRulesResponse>(`/rules${qs ? `?${qs}` : ''}`);\n}\nexport const listRules = getRules;\n// New brief list endpoint returning items[] with optional active filter\nexport const deleteRule = (id: number) => http(`/rules/${id}`, { method: 'DELETE' });\n// Enhanced createRule with richer FastAPI error reporting (e.g., 422 validation errors)\nexport async function createRule(body: RuleInput): Promise<RuleCreateResponse> {\n  const url = apiUrl('/rules');\n  const r = await fetch(url, withCreds({\n    method: 'POST',\n    headers: withAuthHeaders({ 'Content-Type': 'application/json' }),\n    body: JSON.stringify(body),\n  }));\n  if (!r.ok) {\n    let msg = `createRule failed: ${r.status}`;\n    try {\n      const data = await r.json();\n      if (data?.detail) {\n        const text = Array.isArray(data.detail)\n          ? data.detail.map((d: any) => d?.msg || JSON.stringify(d)).join('; ')\n          : JSON.stringify(data.detail);\n        msg += ` — ${text}`;\n      }\n    } catch {\n      // Try to append response text if JSON parse fails\n      try {\n        const t = await r.text();\n        if (t) msg += ` — ${t}`;\n      } catch {}\n    }\n    throw new Error(msg);\n  }\n  return r.json() as Promise<RuleCreateResponse>; // { id, display_name }\n}\n\n// ---------- ML ----------\nexport const mlSuggest = (month: string, limit=100, topk=3) => http(`/ml/suggest${q({ month, limit, topk })}`)\n\n// ---------- Rule Suggestions (persistent) ----------\nexport type PersistedRuleSuggestion = {\n  id: number;\n  merchant_norm: string;\n  category: string;\n  support: number;\n  positive_rate: number;\n  last_seen: string | null;\n  created_at: string | null;\n};\nexport async function listRuleSuggestions(params: { merchant_norm?: string; category?: string; limit?: number; offset?: number } = {}) {\n  const qs = q(params as any);\n  return http<PersistedRuleSuggestion[]>(`/rules/suggestions${qs}`);\n}\nexport const acceptRuleSuggestion = (id: number) => http<{ ok: boolean; rule_id: number }>(`/rules/suggestions/${id}/accept`, { method: 'POST' });\nexport const dismissRuleSuggestion = (id: number) => http<{ ok: boolean }>(`/rules/suggestions/${id}/dismiss`, { method: 'POST' });\n\n// ---------- Suggestion Ignores (DB-backed) ----------\nexport const listSuggestionIgnores = (cached = true) =>\n  http<{ ignores: { merchant: string; category: string }[] }>(`/rules/suggestions/ignores?cached=${cached ? \"true\" : \"false\"}`);\n\nexport const addSuggestionIgnore = (merchant: string, category: string) =>\n  http<{ ignores: { merchant: string; category: string }[] }>(`/rules/suggestions/ignores`, {\n    method: \"POST\", headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({ merchant, category }),\n  });\n\nexport const removeSuggestionIgnore = (merchant: string, category: string) =>\n  http<{ ignores: { merchant: string; category: string }[] }>(\n    `/rules/suggestions/ignores/${encodeURIComponent(merchant)}/${encodeURIComponent(category)}`,\n    { method: \"DELETE\" }\n  );\n\n// ---------- Rule Suggestions (mined summary) ----------\nexport type MinedRuleSuggestion = {\n  merchant: string;\n  category: string;\n  count: number;\n  window_days: number;\n  sample_txn_ids: number[];\n  recent_month_key?: string | null;\n};\nexport type RuleSuggestionsSummary = {\n  window_days: number;\n  min_count: number;\n  suggestions: MinedRuleSuggestion[];\n};\n\nexport function listRuleSuggestionsSummary(params?: {\n  windowDays?: number;\n  minCount?: number;\n  maxResults?: number;\n  excludeMerchants?: string[];\n  excludeCategories?: string[];\n}) {\n  const qp: Record<string, string> = {};\n  if (params?.windowDays != null) qp.window_days = String(params.windowDays);\n  if (params?.minCount != null) qp.min_count = String(params.minCount);\n  if (params?.maxResults != null) qp.max_results = String(params.maxResults);\n  if (params?.excludeMerchants?.length) qp.exclude_merchants = params.excludeMerchants.join(\",\");\n  if (params?.excludeCategories?.length) qp.exclude_categories = params.excludeCategories.join(\",\");\n  const qs = q(qp);\n  return http<RuleSuggestionsSummary>(`/rules/suggestions${qs}`);\n}\n\nexport const applyRuleSuggestion = (payload: { merchant: string; category: string; backfill_month?: string | null }) =>\n  http<{ ok: boolean; rule_id: number; merchant: string; category: string; applied_backfill_month?: string | null }>(\n    `/rules/suggestions/apply`,\n    { method: 'POST', body: JSON.stringify(payload) }\n  );\n\nexport const ignoreRuleSuggestion = (payload: { merchant: string; category: string }) =>\n  http<{ ignored: Array<{ merchant: string; category: string }> }>(\n    `/rules/suggestions/ignore`,\n    { method: 'POST', body: JSON.stringify(payload) }\n  );\n\n// Convenience: persistent-style wrapper that always returns an object with `.suggestions` array\nexport const listRuleSuggestionsPersistent = async (params?: { windowDays?: number; minCount?: number; maxResults?: number }): Promise<{ suggestions: MinedRuleSuggestionStrict[] }> => {\n  const p = new URLSearchParams();\n  if (params?.windowDays) p.set(\"window_days\", String(params.windowDays));\n  if (params?.minCount) p.set(\"min_count\", String(params.minCount));\n  if (params?.maxResults) p.set(\"max_results\", String(params.maxResults));\n  const res = await http<any>(`/rules/suggestions${p.toString() ? `?${p.toString()}` : ''}`);\n  return { suggestions: normalizeSuggestions(res) };\n};\n\n// ---- Persisted suggestions helpers (optional; 404-safe) ----\nexport type PersistedSuggestion = {\n  id: number;\n  merchant: string;\n  category: string;\n  status: \"new\" | \"accepted\" | \"dismissed\";\n  count?: number;\n  window_days?: number;\n};\n\nexport const listPersistedSuggestions = async (): Promise<PersistedSuggestion[]> => {\n  try {\n    const res = await http<{ suggestions: PersistedSuggestion[] }>(\"/rules/suggestions/persistent\");\n    return Array.isArray((res as any)?.suggestions) ? (res as any).suggestions : [];\n  } catch (e: any) {\n    // Fallback on 404 or any error\n    return [];\n  }\n};\n\nexport const acceptSuggestion = (id: number) =>\n  http<{ ok: boolean; id: number; status: \"accepted\" }>(`/rules/suggestions/${id}/accept`, { method: \"POST\" });\n\nexport const dismissSuggestion = (id: number) =>\n  http<{ ok: boolean; id: number; status: \"dismissed\" }>(`/rules/suggestions/${id}/dismiss`, { method: \"POST\" });\n// ---------- ML Train ----------\nexport async function mlTrain(month?: string, passes = 1, min_samples = 25) {\n  const body = { month, passes, min_samples };\n  return http(`/ml/train`, {\n    method: \"POST\",\n    body: JSON.stringify(body),\n    headers: { \"Content-Type\": \"application/json\" },\n  });\n}\n\n// ---------- ML / Reclassify helpers ----------\nexport async function trainModel(params?: { min_samples?: number; test_size?: number }) {\n  return http(`/ml/train`, {\n    method: 'POST',\n    body: JSON.stringify(params ?? { min_samples: 6, test_size: 0.2 }),\n  });\n}\n\nexport async function reclassifyAll(month?: string): Promise<{\n  status: string;\n  month?: string;\n  applied?: number;\n  skipped?: number;\n  details?: any;\n  updated?: number;\n}> {\n  return http(`/txns/reclassify${month ? `?month=${encodeURIComponent(month)}` : ''}`,\n    {\n      method: 'POST',\n      body: JSON.stringify({}),\n    }\n  );\n}\n\n// One-click: Save → Train → Reclassify (no client-side fallback; unified endpoint is required)\nexport async function saveTrainReclassify(\n  payload: { rule: RuleInput; month?: string }\n): Promise<{ rule_id: string; display_name: string; reclassified: number }> {\n  const res = await http<{ rule_id: string; display_name: string; reclassified: number }>(`/rules/save-train-reclass`, {\n    method: 'POST',\n    body: JSON.stringify(payload),\n  });\n  return res;\n}\n\n// ---------- Explain & Agent ----------\n// (Moved agent chat types & function earlier to satisfy references)\nexport type ChatMessage = { role: \"system\" | \"user\" | \"assistant\"; content: string };\nexport type AgentChatRequest = {\n  messages: { role: 'system'|'user'|'assistant', content: string }[];\n  context?: any;\n  intent?: 'general'|'explain_txn'|'budget_help'|'rule_seed';\n  txn_id?: string | null;\n  model?: string;\n  temperature?: number;\n  top_p?: number;\n};\nexport type AgentChatResponse = {\n  mode?: string;\n  reply: string;\n  summary?: string;\n  rephrased?: string | null;\n  nlq?: any;\n  citations: { type: string; id?: string; count?: number }[];\n  used_context: { month?: string };\n  tool_trace: any[];\n  model: string;\n};\nexport async function agentChat(\n  input: string | ChatMessage[] | AgentChatRequest,\n  opts?: { system?: string }\n): Promise<AgentChatResponse> {\n  let request: AgentChatRequest;\n  if (typeof input === 'object' && 'messages' in input) {\n    request = input;\n  } else {\n    let messages: ChatMessage[];\n    if (Array.isArray(input)) {\n      messages = input;\n    } else {\n      messages = [];\n      if (opts?.system) messages.push({ role: \"system\", content: opts.system });\n      messages.push({ role: \"user\", content: input });\n    }\n    request = { messages, intent: 'general' };\n  }\n  return fetchJSON<AgentChatResponse>('agent/chat', {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify(request),\n  } as any);\n}\n\n// ---------- Agent status ----------\nexport async function agentStatus() {\n  return fetchJSON('agent/status').catch(() => ({}));\n}\n\n// ---------- Reports (Excel/PDF) ----------\nfunction parseDispositionFilename(disposition: string | null) {\n  if (!disposition) return null;\n  const m = /filename=\"([^\"]+)\"/i.exec(disposition);\n  return m?.[1] ?? null;\n}\n\nexport async function downloadReportExcel(\n  month?: string,\n  includeTransactions: boolean = true,\n  opts?: { start?: string; end?: string; splitAlpha?: boolean }\n) {\n  const params = new URLSearchParams();\n  if (month) params.set('month', month);\n  if (opts?.start) params.set('start', opts.start);\n  if (opts?.end) params.set('end', opts.end);\n  params.set('include_transactions', String(includeTransactions));\n  if (opts?.splitAlpha) params.set('split_transactions_alpha', String(!!opts.splitAlpha));\n  const url = apiUrl(`/report/excel${params.toString() ? `?${params.toString()}` : ''}`);\n  const res = await fetch(url, withCreds({ method: 'GET', headers: withAuthHeaders() }));\n  if (!res.ok) throw new Error(`Excel export failed: ${res.status}`);\n  const blob = await res.blob();\n  const filename = parseDispositionFilename(res.headers.get('Content-Disposition')) || 'finance_report.xlsx';\n  return { blob, filename };\n}\n\nexport async function downloadReportPdf(month?: string, opts?: { start?: string; end?: string }) {\n  const params = new URLSearchParams();\n  if (month) params.set('month', month);\n  if (opts?.start) params.set('start', opts.start);\n  if (opts?.end) params.set('end', opts.end);\n  const url = apiUrl(`/report/pdf${params.toString() ? `?${params.toString()}` : ''}`);\n  const res = await fetch(url, withCreds({ method: 'GET', headers: withAuthHeaders() }));\n  if (!res.ok) throw new Error(`PDF export failed: ${res.status}`);\n  const blob = await res.blob();\n  const filename = parseDispositionFilename(res.headers.get('Content-Disposition')) || 'finance_report.pdf';\n  return { blob, filename };\n}\n\n// ---------- Natural-language Transactions Query ----------\nexport type TransactionsNlRequest = {\n  query?: string;\n  filters?: Record<string, any>;\n};\n\nexport type TransactionsNlResponse = {\n  reply: string;\n  rephrased?: boolean;\n  meta: Record<string, any>;\n};\n\nexport const transactionsNl = async (\n  payload: TransactionsNlRequest = {}\n): Promise<TransactionsNlResponse> => {\n  return http<TransactionsNlResponse>(\"/transactions/nl\", {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify(payload ?? {}),\n  });\n};\n\nexport type TxnQueryResult =\n  | { intent: \"sum\"; filters: any; result: { total_abs: number }; meta?: any }\n  | { intent: \"count\"; filters: any; result: { count: number }; meta?: any }\n  | { intent: \"top_merchants\"; filters: any; result: { merchant: string; spend: number }[]; meta?: any }\n  | { intent: \"top_categories\"; filters: any; result: { category: string; spend: number }[]; meta?: any }\n  | { intent: \"average\"; filters: any; result: { average_abs: number }; meta?: any }\n  | { intent: \"by_day\"; filters: any; result: { bucket: string; spend: number }[]; meta?: any }\n  | { intent: \"by_week\"; filters: any; result: { bucket: string; spend: number }[]; meta?: any }\n  | { intent: \"by_month\"; filters: any; result: { bucket: string; spend: number }[]; meta?: any }\n  | { intent: \"list\"; filters: any; result: any[]; meta?: any };\n\nexport async function txnsQuery(\n  q: string,\n  opts?: { start?: string; end?: string; limit?: number; page?: number; page_size?: number; flow?: 'expenses'|'income'|'all' }\n): Promise<TxnQueryResult> {\n  return http<TxnQueryResult>(\"/agent/txns_query\", {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({ q, ...opts }),\n  });\n}\n\n// Download CSV for an NL transactions query. Server forces list intent and caps size.\nexport async function txnsQueryCsv(\n  q: string,\n  opts?: { start?: string; end?: string; page_size?: number; flow?: 'expenses'|'income'|'all' }\n): Promise<{ blob: Blob; filename: string }> {\n  const url = apiUrl('/agent/txns_query/csv');\n  const res = await fetch(url, withCreds({\n    method: 'POST',\n    headers: withAuthHeaders({ 'Content-Type': 'application/json' }),\n    body: JSON.stringify({ q, ...opts }),\n  }));\n  if (!res.ok) throw new Error(`CSV export failed: ${res.status} ${res.statusText}`);\n  const blob = await res.blob();\n  const filename = parseDispositionFilename(res.headers.get('Content-Disposition')) || 'txns_query.csv';\n  return { blob, filename };\n}\n\n// ---------- Budget Recommendations ----------\nexport type BudgetRecommendation = {\n  category: string;\n  median: number;\n  p75: number;\n  avg: number;\n  sample_size: number;\n  current_month?: number | null;\n  over_p75?: boolean | null;\n};\n\nexport type BudgetRecommendationsResp = {\n  months: number;\n  recommendations: BudgetRecommendation[];\n};\n\nexport const getBudgetRecommendations = (\n  months = 6,\n  opts?: { include_current?: boolean; include_only_over_p75?: boolean; include?: string[]; exclude?: string[] }\n) => {\n  const params = new URLSearchParams();\n  params.set(\"months\", String(months));\n  if (opts?.include_current !== undefined) params.set(\"include_current\", String(!!opts.include_current));\n  if (opts?.include_only_over_p75) params.set(\"include_only_over_p75\", \"true\");\n  if (opts?.include?.length) params.set(\"include\", opts.include.join(\",\"));\n  if (opts?.exclude?.length) params.set(\"exclude\", opts.exclude.join(\",\"));\n  return http<BudgetRecommendationsResp>(`/budget/recommendations?${params.toString()}`);\n};\n\nexport type ApplyBudgetsReq = {\n  strategy: \"median\" | \"p75\" | \"median_plus_10\";\n  categories_include?: string[] | null;\n  categories_exclude?: string[] | null;\n  months?: number;\n};\n\n// ---------- Transactions (Edit & Manage) ----------\n// Backend routes live under /txns/edit to avoid conflicts with legacy /txns\nexport async function listTxns(params: {\n  q?: string;\n  month?: string;\n  category?: string;\n  merchant?: string;\n  include_deleted?: boolean;\n  limit?: number;\n  offset?: number;\n  sort?: string;\n}) {\n  const usp = new URLSearchParams();\n  for (const [k, v] of Object.entries(params)) {\n    if (v === undefined || v === null || v === \"\") continue;\n    usp.set(k, String(v));\n  }\n  const qs = usp.toString();\n  return http<{ items: any[]; total: number; limit: number; offset: number }>(`/txns/edit${qs ? `?${qs}` : \"\"}`);\n}\n\nexport function getTxn(id: number) {\n  return http(`/txns/edit/${id}`);\n}\n\nexport function patchTxn(id: number, patch: any) {\n  return http(`/txns/edit/${id}`, { method: \"PATCH\", body: JSON.stringify(patch) });\n}\n\nexport function bulkPatchTxns(ids: number[], patch: any) {\n  return http(`/txns/edit/bulk`, { method: \"POST\", body: JSON.stringify({ ids, patch }) });\n}\n\nexport function deleteTxn(id: number) {\n  return http(`/txns/edit/${id}`, { method: \"DELETE\" });\n}\n\nexport function restoreTxn(id: number) {\n  return http(`/txns/edit/${id}/restore`, { method: \"POST\" });\n}\n\nexport function splitTxn(\n  id: number,\n  parts: { amount: number | string; category?: string; note?: string }[]\n) {\n  return http(`/txns/edit/${id}/split`, { method: \"POST\", body: JSON.stringify({ parts }) });\n}\n\nexport function mergeTxns(ids: number[], merged_note?: string) {\n  return http(`/txns/edit/merge`, { method: \"POST\", body: JSON.stringify({ ids, merged_note }) });\n}\n\nexport function linkTransfer(id: number, counterpart_id: number, group?: string) {\n  return http(`/txns/edit/${id}/transfer`, { method: \"POST\", body: JSON.stringify({ counterpart_id, group }) });\n}\nexport type ApplyBudgetsResp = {\n  ok: boolean;\n  applied: Array<{ category: string; amount: number }>;\n  applied_count: number;\n  applied_total: number;\n};\nexport const applyBudgets = (req: ApplyBudgetsReq) =>\n  http<ApplyBudgetsResp>(`/budget/apply`, { method: \"POST\", body: JSON.stringify(req) });\n\n// Set a single budget cap (upsert)\nexport const setBudget = (category: string, amount: number) =>\n  http<{ ok: boolean; budget: { category: string; amount: number; updated_at?: string | null } }>(\n    \"/budget/set\",\n    {\n      method: \"POST\",\n      body: JSON.stringify({ category, amount }),\n      headers: { \"Content-Type\": \"application/json\" },\n    }\n  );\n\nexport const deleteBudget = (category: string) =>\n  http<{ ok: boolean; deleted: { category: string; amount: number } }>(\n    `/budget/${encodeURIComponent(category)}`,\n    { method: \"DELETE\" }\n  );\n\n// Clear a temporary budget overlay for a given month/category\nexport const clearTempBudget = (category: string, month?: string) =>\n  http<{ ok: boolean; deleted: { month: string; category: string; amount: number; existed: boolean } }>(\n    `/budgets/temp/${encodeURIComponent(category)}${month ? `?month=${encodeURIComponent(month)}` : \"\"}`,\n    { method: \"DELETE\" }\n  );\n\n// ---------- Anomalies ----------\nexport type Anomaly = {\n  category: string;\n  current: number;\n  median: number;\n  pct_from_median: number; // +0.42 => +42%\n  sample_size: number;\n  direction: \"high\" | \"low\";\n};\nexport const getAnomalies = (params?: { months?: number; min?: number; threshold?: number; max?: number; month?: string }) => {\n  const p = new URLSearchParams();\n  if (params?.months) p.set(\"months\", String(params.months));\n  if (params?.min != null) p.set(\"min_spend_current\", String(params.min));\n  if (params?.threshold != null) p.set(\"threshold_pct\", String(params.threshold));\n  if (params?.max) p.set(\"max_results\", String(params.max));\n  if (params?.month) p.set(\"month\", String(params.month));\n  const qs = p.toString();\n  return http<{ month: string | null; anomalies: Anomaly[] }>(`/insights/anomalies${qs ? `?${qs}` : ''}`);\n};\n\n// Remove a category from the anomalies ignore list\nexport const unignoreAnomaly = (category: string) =>\n  http<{ ignored: string[] }>(`/insights/anomalies/ignore/${encodeURIComponent(category)}`, { method: \"DELETE\" });\n\n// ---- Planner helpers expected by Dev panel ----\nexport type AgentPlanAction = { kind: string; [k: string]: any };\nexport type PlannerPlanItem = {\n  kind: 'categorize_unknowns' | 'seed_rule' | 'budget_limit' | 'export_report' | string;\n  title?: string;\n  txn_ids?: number[];\n  category?: string;\n  limit?: number;\n  impact?: string | number;\n  [k: string]: any;\n};\n\nexport async function agentPlanPreview(body: {\n  month: string | null;\n  prompt?: string;\n  actions?: AgentPlanAction[];\n}) {\n  return api(\"/agent/plan/preview\", {\n    method: \"POST\",\n    body: JSON.stringify(body),\n  });\n}\n\nexport async function agentPlanApply(body: {\n  month: string | null;\n  actions: AgentPlanAction[];\n}) {\n  return api(\"/agent/plan/apply\", {\n    method: \"POST\",\n    body: JSON.stringify(body),\n  });\n}\n\n// Optional; some panels read a status card. If it 404s, return benign default.\nexport async function agentPlanStatus() {\n  try {\n    return await api(\"/agent/plan/status\");\n  } catch (e: any) {\n    // If 404 or route missing, return a benign default without throwing\n    const msg = String(e?.message || e || \"\");\n    if (/\\b404\\b/.test(msg) || /Not Found/i.test(msg)) {\n      return { mode: \"deterministic\", steps: 0, throttle: null, available: false };\n    }\n    // For other errors, still return default to avoid dev console noise\n    return { mode: \"deterministic\", steps: 0, throttle: null, available: false };\n  }\n}\n\n// ---- Save Rule endpoint helper ----\nexport type SaveRulePayload = {\n  rule?: { name?: string; when?: Record<string, any>; then?: { category?: string } };\n  scenario?: string;\n  month?: string;\n  backfill?: boolean;\n};\n\nexport async function saveRule(payload: SaveRulePayload, opts?: { idempotencyKey?: string }) {\n  const headers: Record<string, string> = { 'Content-Type': 'application/json' };\n  if (opts?.idempotencyKey) headers['Idempotency-Key'] = opts.idempotencyKey;\n  return http('/agent/tools/rules/save', {\n    method: 'POST',\n    headers,\n    body: JSON.stringify(payload),\n    credentials: 'include',\n  });\n}\n\n// ---------- Agent models ----------\nexport type AgentModelsResponse = {\n  provider?: string;\n  default?: string;\n  models?: { id: string }[];\n  primary?: { provider?: string; reachable?: boolean; model?: string };\n  fallback?: { provider?: string; reachable?: boolean; model?: string };\n  models_ok?: boolean; // legacy / server-supplied if present\n};\n\nexport async function fetchModels(refresh = false): Promise<AgentModelsResponse & { models_ok: boolean }> {\n  const url = `/agent/models${refresh ? '?refresh=1' : ''}`;\n  const res = await fetch(url, { headers: { Accept: 'application/json' }, credentials: 'include' });\n  if (!res.ok) throw new Error(`models fetch failed: ${res.status}`);\n  const d = await res.json();\n  const primaryOk = !!(d?.primary?.reachable && d?.primary?.model);\n  const fallbackOk = !!(d?.fallback?.reachable && d?.fallback?.model);\n  return { ...d, models_ok: primaryOk || fallbackOk };\n}\n\n// Lightweight agentTools wrapper (reintroduced)\nexport const agentTools = {\n  // Charts\n  chartsSummary: (body: any, signal?: AbortSignal) => http('/agent/tools/charts/summary', { method: 'POST', body: JSON.stringify(body), headers: { 'Content-Type': 'application/json' }, signal }),\n  chartsMerchants: (body: any, signal?: AbortSignal) => http('/agent/tools/charts/merchants', { method: 'POST', body: JSON.stringify(body), headers: { 'Content-Type': 'application/json' }, signal }),\n  chartsFlows: (body: any, signal?: AbortSignal) => http('/agent/tools/charts/flows', { method: 'POST', body: JSON.stringify(body), headers: { 'Content-Type': 'application/json' }, signal }),\n  chartsSpendingTrends: (body: any, signal?: AbortSignal) => http('/agent/tools/charts/spending-trends', { method: 'POST', body: JSON.stringify(body), headers: { 'Content-Type': 'application/json' }, signal }),\n  // Insights\n  insightsExpanded: (body: any, signal?: AbortSignal) => http('/agent/tools/insights/expanded', { method: 'POST', body: JSON.stringify(body), headers: { 'Content-Type': 'application/json' }, signal }),\n  // Transactions\n  searchTransactions: (body: any, signal?: AbortSignal) => http('/agent/tools/transactions/search', { method: 'POST', body: JSON.stringify(body), headers: { 'Content-Type': 'application/json' }, signal }),\n  categorizeTransactions: (body: any, signal?: AbortSignal) => http('/agent/tools/transactions/categorize', { method: 'POST', body: JSON.stringify(body), headers: { 'Content-Type': 'application/json' }, signal }),\n  getTransactionsByIds: (body: any, signal?: AbortSignal) => http('/agent/tools/transactions/get_by_ids', { method: 'POST', body: JSON.stringify(body), headers: { 'Content-Type': 'application/json' }, signal }),\n  // Budget\n  budgetSummary: (body: any, signal?: AbortSignal) => http('/agent/tools/budget/summary', { method: 'POST', body: JSON.stringify(body), headers: { 'Content-Type': 'application/json' }, signal }),\n  budgetCheck: (body: any, signal?: AbortSignal) => http('/agent/tools/budget/check', { method: 'POST', body: JSON.stringify(body), headers: { 'Content-Type': 'application/json' }, signal }),\n  // Rules\n  rulesTest: (body: any, signal?: AbortSignal) => http('/agent/tools/rules/test', { method: 'POST', body: JSON.stringify(body), headers: { 'Content-Type': 'application/json' }, signal }),\n  rulesApply: (body: any, signal?: AbortSignal) => http('/agent/tools/rules/apply', { method: 'POST', body: JSON.stringify(body), headers: { 'Content-Type': 'application/json' }, signal }),\n  rulesApplyAll: (body: any, signal?: AbortSignal) => http('/agent/tools/rules/apply_all', { method: 'POST', body: JSON.stringify(body), headers: { 'Content-Type': 'application/json' }, signal }),\n};\n\n// ---- Legacy / compatibility helpers expected by components ----\nexport async function getAgentModels(refresh = false) { return fetchModels(refresh); }\n\n// Explain endpoint wrappers\nexport type ExplainResponse = {\n  reply: string;\n  meta?: any;\n  model?: string;\n  llm_rationale?: string;\n  rationale?: string;\n  mode?: string;\n  evidence?: any;\n};\nexport async function getExplain(txnId: number | string, opts?: { use_llm?: boolean }) {\n  const use = opts?.use_llm ? '?use_llm=1' : '';\n  return http<ExplainResponse>(`/txns/${encodeURIComponent(String(txnId))}/explain${use}`);\n}\nexport async function explainTxnForChat(txnId: number | string) {\n  return getExplain(txnId, { use_llm: true });\n}\n\n// Rephrase (fallback implementation uses /agent/chat with a system prompt if dedicated endpoint absent)\nexport async function agentRephrase(text: string, _opts?: any): Promise<{ reply: string; model?: string }> {\n  try {\n    // Try a hypothetical fast endpoint first (ignore failure)\n    const r = await fetch(apiUrl('/agent/rephrase'), withCreds({\n      method: 'POST',\n      headers: withAuthHeaders({ 'Content-Type': 'application/json' }),\n      body: JSON.stringify({ text })\n    }));\n    if (r.ok) {\n      const d: any = await r.json();\n      return { reply: d.reply || d.text || '', model: d.model };\n    }\n  } catch { /* swallow */ }\n  // Fallback: call agentChat with a system instruction\n  const resp = await agentChat({ messages: [\n    { role: 'system', content: 'Rephrase user content clearly and concisely without changing factual meaning.' },\n    { role: 'user', content: text }\n  ]});\n  return { reply: resp.reply, model: resp.model };\n}\n\n// ML status + selftest\nexport async function getMlStatus() { return http('/ml/status'); }\nexport async function mlSelftest() { return http('/ml/selftest', { method: 'POST', body: JSON.stringify({}) }); }\n\n// Simple CSV upload (auto-detect month server side). Backend expected route: /ingest/csv\nexport async function uploadCsv(file: File, replace = true): Promise<any> {\n  const form = new FormData();\n  form.append('file', file);\n  form.append('replace', String(!!replace));\n  // If backend only accepts raw file under a specific field, keep 'file'\n  const res = await fetch(apiUrl('/ingest/csv'), withCreds({ method: 'POST', body: form } as any));\n  if (!res.ok) throw new Error(`Upload failed ${res.status}`);\n  const ct = res.headers.get('content-type') || '';\n  return ct.includes('application/json') ? res.json() : res.text();\n}\nexport async function fetchLatestMonth(): Promise<string | null> {\n  try { const ms = await getMonthSummary(); return (ms as any)?.month ?? null; } catch { return null; }\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\lib\\explainFallback.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\lib\\flags.ts","messages":[{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":11,"column":11,"nodeType":"BlockStatement","messageId":"unexpected","endLine":11,"endColumn":13,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[428,428],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[455,458],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[455,458],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Runtime dev flag is centralized via fa.dev localStorage key; build-time VITE_DEV_UI can bootstrap it.\nfunction runtimeDevFlag(): boolean {\n  try {\n    if (localStorage.getItem('fa.dev') === '1') return true;\n    // Migrate legacy DEV_UI key transparently\n    if (localStorage.getItem('DEV_UI') === '1') {\n      localStorage.setItem('fa.dev', '1');\n      localStorage.removeItem('DEV_UI');\n      return true;\n    }\n  } catch {}\n  return (import.meta as any).env?.VITE_DEV_UI === '1';\n}\n\nexport const flags = {\n  dev: runtimeDevFlag(),\n\n  planner:\n    import.meta.env.VITE_FEATURE_PLANNER === '1' ||\n    localStorage.getItem('FEATURE_PLANNER') === '1',\n  ruleTester:\n    import.meta.env.VITE_FEATURE_RULE_TESTER === '1' ||\n    localStorage.getItem('FEATURE_RULE_TESTER') === '1' ||\n    runtimeDevFlag(),\n  mlSelftest:\n    import.meta.env.VITE_FEATURE_ML_SELFTEST === '1' ||\n    localStorage.getItem('FEATURE_ML_SELFTEST') === '1',\n} as const;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\lib\\formatters.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[74,77],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[74,77],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[80,83],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[80,83],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[388,391],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[388,391],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[483,486],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[483,486],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[547,550],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[547,550],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[611,614],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[611,614],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[671,674],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[671,674],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[775,778],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[775,778],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[970,973],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[970,973],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1324,1327],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1324,1327],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1596,1599],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1596,1599],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1641,1644],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1641,1644],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1833,1836],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1833,1836],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":47,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2079,2082],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2079,2082],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":51,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2278,2281],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2278,2281],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2519,2522],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2519,2522],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2676,2679],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2676,2679],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":17,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Robust helpers to normalize varying payload shapes\nconst asArray = (x: any): any[] =>\n  Array.isArray(x) ? x :\n  Array.isArray(x?.list) ? x.list :\n  Array.isArray(x?.items) ? x.items :\n  Array.isArray(x?.data) ? x.data :\n  Array.isArray(x?.rows) ? x.rows :\n  Array.isArray(x?.merchants) ? x.merchants :\n  (x && typeof x === \"object\") ? Object.values(x) : [];\n\nconst asSeries = (input: any): Array<{ month: string; spend: number }> => {\n  if (Array.isArray(input)) return input as any;\n  if (Array.isArray(input?.trends)) return input.trends as any;\n  if (Array.isArray(input?.series)) return input.series as any;\n  if (Array.isArray(input?.data)) return input.data as any;\n  if (input && typeof input === \"object\") {\n    return Object.entries(input).map(([k, v]: [string, any]) => ({\n      month: k,\n      spend: Number(typeof v === \"object\" ? (v?.spend ?? v?.amount ?? v?.value ?? 0) : v),\n    }));\n  }\n  return [];\n};\n\nexport const fmtMonthSummary = (m: string, d: any) => {\n  const income = d?.income_total ?? d?.total_inflows ?? d?.income ?? 0;\n  const spend = d?.spend_total ?? d?.total_outflows ?? d?.spend ?? 0;\n  const net = d?.net ?? (Number(income) - Math.abs(Number(spend)));\n  const catsSrc = d?.top_categories ?? d?.categories;\n  const cats = asArray(catsSrc).slice(0, 5);\n  const catStr = cats\n    .map((c: any) => `${c?.name ?? c?.category}:${c?.amount ?? c?.total ?? c?.spend ?? 0}`)\n    .join(\", \");\n  return `Summarize ${m} for a household budget. income=${income}, spend=${spend}, net=${net}. Top categories: ${catStr}.`;\n};\n\nexport const fmtTopMerchants = (m: string, raw: any) => {\n  const arr = asArray(raw).map((x: any) => (x && typeof x === \"object\" ? x : { merchant: String(x), spend: 0 }));\n  if (!arr.length) return `There are no top merchants for ${m}.`;\n  const s = arr\n    .slice(0, 10)\n    .map((x: any, i: number) => `${i + 1}. ${x.merchant ?? x.name} $${x.spend ?? x.amount ?? x.total ?? 0}`)\n    .join(\"; \");\n  return `Summarize top merchants for ${m} in 3 bullets and one actionable tip: ${s}`;\n};\n\nexport const fmtCashflow = (m: string, f: any) => {\n  const inflow = f?.income_total ?? f?.income ?? 0;\n  const outflow = f?.spend_total ?? f?.expense ?? f?.spend ?? 0;\n  const buckets = asArray(f?.buckets ?? f?.top_categories)\n    .map((b: any) => `${b?.name ?? b?.bucket ?? b?.category}:${b?.amount ?? b?.total ?? 0}`)\n    .join(\", \");\n  return `Explain ${m} cashflow in two lines: inflows=${inflow}, outflows=${outflow}. Buckets: ${buckets}.`;\n};\n\nexport const fmtTrends = (raw: any) => {\n  const series = asSeries(raw);\n  if (!series.length) return \"There are no trend points for the selected period.\";\n  const points = series.map((p: any) => `${p.month}:${p.spend}`).join(\", \");\n  return `Describe the spending trend and call out spikes: ${points}`;\n};\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\lib\\hashFilters.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[99,102],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[99,102],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":1,"message":"'len' is never reassigned. Use 'const' instead.","line":6,"column":23,"nodeType":"Identifier","messageId":"useConst","endLine":6,"endColumn":26},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[471,474],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[471,474],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[477,480],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[477,480],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":100,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":103,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[668,671],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[668,671],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Simple stable hash for filters object for analytics grouping.\r\nexport function hashFilters(obj: any): string {\r\n  if (!obj || typeof obj !== 'object') return 'none';\r\n  try {\r\n    const stable = JSON.stringify(sortObj(obj));\r\n    let h = 0, i = 0, len = stable.length;\r\n    for (; i < len; i++) {\r\n      h = (Math.imul(31, h) + stable.charCodeAt(i)) | 0;\r\n    }\r\n    return 'f' + (h >>> 0).toString(16);\r\n  } catch {\r\n    return 'none';\r\n  }\r\n}\r\n\r\nfunction sortObj(o: any): any {\r\n  if (Array.isArray(o)) return o.map(sortObj);\r\n  if (o && typeof o === 'object') {\r\n    return Object.keys(o).sort().reduce((acc, k) => { acc[k] = sortObj(o[k]); return acc; }, {} as any);\r\n  }\r\n  return o;\r\n}\r\n\r\nexport default hashFilters;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\lib\\helpBaseText.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\lib\\helpTooltip.d.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":8,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":11,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[338,341],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[338,341],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Ambient type declarations for helpTooltip.js\r\n\r\nexport interface HelpResponse {\r\n  mode: 'what' | 'why';\r\n  source?: string;\r\n  text: string;\r\n  etag?: string;\r\n  cached?: boolean;\r\n  stale?: boolean;\r\n  error?: string;\r\n}\r\n\r\nexport interface GetHelpArgs {\r\n  cardId: string;\r\n  mode: 'what' | 'why';\r\n  month?: string | null;\r\n  ctx: any;\r\n  baseText?: string | null;\r\n}\r\n\r\nexport function getHelp(args: GetHelpArgs): Promise<HelpResponse>;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\lib\\helpTooltip.js","messages":[{"ruleId":"no-useless-catch","severity":2,"message":"Unnecessary try/catch wrapper.","line":73,"column":7,"nodeType":"TryStatement","messageId":"unnecessaryCatch","endLine":92,"endColumn":8}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Unified help tooltip fetcher with memory + localStorage cache and ETag awareness.\r\n// Usage: import { getHelp } from '../lib/helpTooltip';\r\n\r\nconst mem = new Map();\r\nconst TTL = 24 * 60 * 60 * 1000; // 24h\r\nconst inflight = new Map(); // key -> AbortController\r\n\r\nfunction k(obj) {\r\n  return 'help:' + JSON.stringify(obj);\r\n}\r\n\r\nfunction loadLS(key) {\r\n  try {\r\n    const raw = localStorage.getItem(key);\r\n    if (!raw) return null;\r\n    const parsed = JSON.parse(raw);\r\n    if (!parsed || typeof parsed !== 'object') return null;\r\n    if (Date.now() - parsed.t > TTL) return null;\r\n    return parsed.d;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nfunction saveLS(key, data) {\r\n  try {\r\n    localStorage.setItem(key, JSON.stringify({ t: Date.now(), d: data }));\r\n  } catch {\r\n    // ignore quota or serialization errors\r\n  }\r\n}\r\n\r\nexport async function getHelp({ cardId, mode, month, ctx, baseText }) {\r\n  const key = k({ cardId, mode, month: month || null, ctx, baseText: mode === 'why' ? baseText : null });\r\n\r\n  if (mem.has(key)) return { ...mem.get(key), cached: true };\r\n  const ls = loadLS(key);\r\n  if (ls) {\r\n    mem.set(key, ls);\r\n    return { ...ls, cached: true, stale: true };\r\n  }\r\n\r\n  // Cancel existing inflight (only keep one latest request per key)\r\n  if (inflight.has(key)) {\r\n    try { inflight.get(key).abort(); } catch { /* noop */ }\r\n    inflight.delete(key);\r\n  }\r\n  const ctrl = new AbortController();\r\n  inflight.set(key, ctrl);\r\n\r\n  let etag = mem.get(key)?.etag || ls?.etag;\r\n  const headers = { 'content-type': 'application/json' };\r\n  if (etag) headers['If-None-Match'] = etag;\r\n\r\n  try {\r\n    const res = await fetch('/help', {\r\n      method: 'POST',\r\n      headers,\r\n      body: JSON.stringify({ card_id: cardId, mode, month: month || null, deterministic_ctx: ctx, base_text: baseText || null }),\r\n      signal: ctrl.signal,\r\n    });\r\n\r\n    if (res.status === 304) {\r\n      // Return memory or storage cached version\r\n      const cached = mem.get(key) || ls;\r\n      if (cached) return { ...cached, cached: true };\r\n      // Edge case: 304 but we lost cache; treat as soft miss -> refetch without ETag\r\n      return await getHelp({ cardId, mode, month, ctx, baseText });\r\n    }\r\n\r\n    if (!res.ok) {\r\n      // Retry once via /api/help for forward compatibility with canonical /api path\r\n      try {\r\n        const res2 = await fetch('/api/help', {\r\n          method: 'POST',\r\n          headers: { 'content-type': 'application/json', ...(etag ? { 'If-None-Match': etag } : {}) },\r\n            body: JSON.stringify({ card_id: cardId, mode, month: month || null, deterministic_ctx: ctx, base_text: baseText || null }),\r\n          signal: ctrl.signal,\r\n        });\r\n        if (res2.status === 304) {\r\n          const cached = mem.get(key) || ls;\r\n          if (cached) return { ...cached, cached: true };\r\n        }\r\n        if (!res2.ok) throw new Error('help ' + res.status + '/' + res2.status);\r\n        const data2 = await res2.json();\r\n        data2.etag = res2.headers.get('ETag') || undefined;\r\n        mem.set(key, data2);\r\n        saveLS(key, data2);\r\n        return data2;\r\n      } catch (e) {\r\n        throw e;\r\n      }\r\n    }\r\n    const data = await res.json();\r\n    data.etag = res.headers.get('ETag') || undefined;\r\n    mem.set(key, data);\r\n    saveLS(key, data);\r\n    return data;\r\n  } catch (err) {\r\n    return { mode, source: 'client-fallback', text: 'Help is temporarily unavailable. Please try again soon.', error: String(err) };\r\n  } finally {\r\n    inflight.delete(key);\r\n  }\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\lib\\http.auth.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'url' is defined but never used. Allowed unused args must match /^_/u.","line":11,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'init' is defined but never used. Allowed unused args must match /^_/u.","line":11,"column":65,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":69},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[517,520],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[517,520],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[793,796],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[793,796],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';\r\nimport { fetchAuth } from './http';\r\n\r\nconst restore = () => {\r\n  vi.unstubAllGlobals();\r\n  vi.restoreAllMocks();\r\n};\r\n\r\ndescribe('fetchAuth joins /api/auth/*', () => {\r\n  beforeEach(() => {\r\n    vi.stubGlobal('fetch', vi.fn(async (url: RequestInfo | URL, init?: RequestInit) => {\r\n      return new Response(JSON.stringify({ ok: true }), {\r\n        status: 200,\r\n        headers: { 'Content-Type': 'application/json' },\r\n      });\r\n    }) as any);\r\n  });\r\n\r\n  afterEach(restore);\r\n\r\n  it('calls /api/auth/login with expected init', async () => {\r\n    const body = { email: 'a@b', password: 'x' };\r\n    await fetchAuth('/auth/login', { method: 'POST', body: JSON.stringify(body) });\r\n    const calls = (global.fetch as any).mock.calls;\r\n    expect(calls.length).toBe(1);\r\n    const [url, init] = calls[0];\r\n    expect(String(url)).toBe('/api/auth/login');\r\n    expect(init.credentials).toBe('same-origin');\r\n    expect(init.cache).toBe('no-store');\r\n    expect(init.method).toBe('POST');\r\n    expect(init.body).toBe(JSON.stringify(body));\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\lib\\http.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\lib\\http.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[242,245],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[242,245],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[321,324],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[321,324],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Centralized HTTP helpers splitting non-auth and auth bases.\r\n// Non-auth calls go to root (/) while auth stays under /api/auth/*.\r\n// This aligns with migration away from the nginx /api/* shim (except auth).\r\n\r\nconst RAW = (import.meta as any).env?.VITE_API_BASE?.toString() ?? \"/\";\r\nconst AUTH_BASE = (import.meta as any).env?.VITE_AUTH_API_BASE?.toString() ?? \"/api\";\r\n\r\n// Derive non-auth base: strip trailing '/api' if present; fallback to '/'\r\nexport const NON_AUTH_BASE = (RAW.endsWith(\"/api\") ? RAW.slice(0, -4) : RAW) || \"/\";\r\n\r\nfunction join(base: string, path: string) {\r\n  return `${base.replace(/\\/+$/, \"\")}/${String(path).replace(/^\\/+/, \"\")}`;\r\n}\r\nfunction withQuery(url: string, qs?: Record<string, string | number | boolean>) {\r\n  if (!qs) return url;\r\n  const u = new URL(url, typeof window !== 'undefined' ? window.location.origin : 'http://localhost');\r\n  for (const [k, v] of Object.entries(qs)) u.searchParams.set(k, String(v));\r\n  return u.pathname + (u.search || \"\");\r\n}\r\n\r\nexport type FetchOpts = RequestInit & { query?: Record<string, string | number | boolean> };\r\n\r\nexport async function fetchJSON<T>(path: string, opts: FetchOpts = {}): Promise<T> {\r\n  const url = withQuery(join(NON_AUTH_BASE, path), opts.query);\r\n  const r = await fetch(url, {\r\n    credentials: 'same-origin',\r\n    headers: { 'Content-Type': 'application/json', ...(opts.headers || {}) },\r\n    method: opts.method ?? 'GET',\r\n    body: opts.body,\r\n    cache: 'no-store',\r\n  });\r\n  if (!r.ok) throw new Error(`HTTP ${r.status} ${r.statusText} ${url}`);\r\n  return (await r.json()) as T;\r\n}\r\n\r\n// Auth endpoints stay under /api/auth/* (path argument should begin with /auth)\r\nexport async function fetchAuth<T>(path: string, opts: FetchOpts = {}): Promise<T> {\r\n  const url = withQuery(join(AUTH_BASE, path), opts.query);\r\n  const r = await fetch(url, {\r\n    credentials: 'same-origin',\r\n    headers: { 'Content-Type': 'application/json', ...(opts.headers || {}) },\r\n    method: opts.method ?? 'GET',\r\n    body: opts.body,\r\n    cache: 'no-store',\r\n  });\r\n  if (!r.ok) throw new Error(`AUTH ${r.status} ${r.statusText} ${url}`);\r\n  return (await r.json()) as T;\r\n}\r\n\r\n// Utility: chart slug normalization (shared usage)\r\nexport const dashSlug = (s: string) => s.replace(/_/g, '-');\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\lib\\i18n-persist.ts","messages":[{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":19,"column":52,"nodeType":"BlockStatement","messageId":"unexpected","endLine":19,"endColumn":54,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[606,606],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { setLocale, getLocale, type Locales } from './i18n';\r\n\r\nconst LS_KEY = 'lm_locale';\r\n\r\nexport function initLocale() {\r\n  try {\r\n    const saved = localStorage.getItem(LS_KEY) as Locales | null;\r\n    if (saved) { setLocale(saved); return; }\r\n    const nav = (navigator.language || 'en').toLowerCase();\r\n    const cand: Locales = nav.startsWith('es') ? 'en' /* placeholder until es added */ : 'en';\r\n    setLocale(cand);\r\n  } catch {\r\n    // ignore (SSR / restricted env)\r\n  }\r\n}\r\n\r\nexport function chooseLocale(loc: Locales) {\r\n  setLocale(loc);\r\n  try { localStorage.setItem(LS_KEY, loc); } catch {}\r\n  // simplest strategy: full reload to ensure root-level providers rerender with new strings\r\n  window.location.reload();\r\n}\r\n\r\nexport function currentLocale(): Locales { return getLocale(); }\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\lib\\i18n.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":289,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":289,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13999,14002],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13999,14002],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":289,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":289,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14032,14035],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14032,14035],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":289,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":289,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14044,14047],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14044,14047],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":289,"column":92,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":289,"endColumn":95,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14058,14061],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14058,14061],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Strongly-typed i18n layer with key + variable inference.\r\n// Extend dictionaries in-place; keys become part of I18nKey union automatically.\r\n\r\nexport interface Dict {\r\n  [k: string]: string | Dict;\r\n}\r\n\r\nexport const dictionaries = {\r\n  en: {\r\n    cards: {\r\n      overview: { base: 'Overview of total spend, income, and net for {month}.' },\r\n      budgets: { base: 'Budget performance vs configured limits for {month}.' },\r\n      budget_recommendations: { base: 'Automatically generated budget targets derived from historical spend patterns.' },\r\n      insights: { base: 'Spending anomalies vs historical baselines for recent months.' },\r\n      ml_status: { base: 'Status of the ML classification model, classes, feedback counts, and update info.' },\r\n      rule_suggestions: { base: 'AI and mined suggestions for new categorization rules based on patterns.' },\r\n      unknowns: { base: 'Transactions lacking a category that need review and classification.' },\r\n    },\r\n    charts: {\r\n      top_categories: { base: 'Top spending categories ranked by amount for {month}.' },\r\n      month_merchants: { base: 'Top merchants ranked by spending for {month}.' },\r\n      daily_flows: { base: 'Daily inflows and outflows with net trend for {month}.' },\r\n      spending_trends: { base: 'Historical spending trend over the recent months window.' }\r\n    },\r\n    ui: {\r\n      help: {\r\n        what: 'What',\r\n        why: 'Why',\r\n        close: 'Close',\r\n        cached: 'cached',\r\n        ai: 'AI'\r\n      },\r\n      status: {\r\n        deterministic: 'deterministic'\r\n      },\r\n      toast: {\r\n        csv_ingested_title: 'CSV ingested',\r\n        csv_ingested_description: 'Transactions imported. Panels refreshed.',\r\n        dev_ui_soft_on: 'Dev UI (soft) on',\r\n        dev_ui_soft_off: 'Dev UI (soft) off',\r\n        dev_ui_enabled: 'Dev UI enabled',\r\n        dev_ui_disabled: 'Dev UI disabled',\r\n        category_applied: 'Set category → {category}',\r\n        ml_feedback_failed: 'ML feedback failed ({error}). DB updated.',\r\n        seed_rule_title: 'Seeded into Rule Tester',\r\n        seed_rule_description: 'Merchant & description copied — adjust and test.',\r\n        seed_rule_action_open: 'Open tester',\r\n        budget_single_applied_title: 'Budget applied',\r\n        budget_single_applied_description: '{category} = {amount}',\r\n        budget_single_apply_failed_title: 'Failed to apply {category}',\r\n        budget_bulk_applied_title: 'Budgets applied',\r\n        budget_bulk_applied_description: '{count} categories — Total {total}',\r\n        budget_bulk_apply_failed_title: 'Failed to apply budgets',\r\n        ml_refresh_failed: 'Refresh failed: {error}',\r\n        ml_selftest_ok: 'Selftest OK in {ms}ms — label={label}, txn={txn}, classes=[{classes}]',\r\n        ml_selftest_no_bump: 'Selftest ran but model timestamp didn’t change (check incremental save).',\r\n        ml_selftest_failed: 'Selftest failed: {error}',\r\n        rule_accepted: 'Accepted: {merchant} → {category}',\r\n        rule_accept_failed: 'Failed to accept',\r\n        rule_dismissed: 'Dismissed: {merchant} → {category}',\r\n        rule_dismiss_failed: 'Failed to dismiss',\r\n        rule_added: 'Rule added: {merchant} → {category}',\r\n        rule_apply_failed: 'Failed to apply',\r\n        rule_ignored: 'Ignored {merchant} → {category}',\r\n        rule_ignore_failed: 'Failed to ignore',\r\n        signed_out_title: 'Signed out',\r\n        sign_out_failed_title: 'Sign out failed',\r\n        email_copied_title: 'Email copied',\r\n        temp_budget_removed_title: 'Temporary budget removed',\r\n        anomaly_unignored_title: 'Anomaly unignored',\r\n        rule_created_title: 'Rule created',\r\n        rule_created_description: '“{name}” saved successfully.',\r\n        rules_list_load_failed: 'Could not load rules list',\r\n        budget_inline_invalid_amount: 'Enter a valid amount > 0',\r\n        budget_inline_saved_title: 'Saved {category} = {amount}',\r\n        budget_inline_save_failed: 'Failed to save',\r\n        budget_inline_restore_failed: 'Failed to restore',\r\n        budget_inline_delete_failed: 'Failed to delete budget',\r\n        rule_tested_title: 'Rule tested',\r\n        rule_tested_matches_description: 'Matched {count} transaction(s). Will set category: “{category}”.',\r\n        rule_tested_no_matches_description: 'No matches for the selected month. Category would be: “{category}”.',\r\n        rule_test_failed_title: 'Test failed',\r\n        rule_saved_retrained_title: 'Rule saved + retrained',\r\n        rule_saved_retrained_description: 'Reclassified {count} txn(s) to “{category}”.',\r\n        rule_saved_retrained_no_changes_description: 'No existing transactions required changes.',\r\n        rule_saved_title: 'Rule saved',\r\n        rule_saved_description: 'Saved “{name}”.',\r\n        rule_save_failed_title: 'Save failed',\r\n        save_rule_modal_saved_title: 'Saved: {name}',\r\n        save_rule_modal_save_failed_title: 'Failed to save rule',\r\n        suggestion_ignore_removed_title: 'Removed ignore for {merchant} → {category}',\r\n        suggestion_ignore_remove_failed_title: 'Failed to remove',\r\n        import_complete_title: 'Import complete',\r\n        import_complete_description: 'Transactions imported successfully.',\r\n        tx_deleted_title: 'Deleted',\r\n        tx_delete_failed_title: 'Delete failed',\r\n        tx_restored_title: 'Restored',\r\n        tx_updated_title: 'Updated',\r\n        tx_bulk_updated_title: 'Bulk updated',\r\n        tx_split_created_title: 'Split created',\r\n        tx_merged_into_title: 'Merged',\r\n        tx_merged_multi_title: 'Merged',\r\n        tx_linked_title: 'Linked'\r\n      },\r\n      charts: {\r\n        overview_title: 'Overview — {month}',\r\n        top_categories_title: 'Top Categories — {month}',\r\n        merchants_title: 'Top Merchants — {month}',\r\n        daily_flows_title: 'Daily Flows — {month}',\r\n        spending_trends_title: 'Spending Trends — last {months} months',\r\n        axis_spend: 'Spend',\r\n        axis_amount: 'Amount',\r\n        legend_spend: 'Spend',\r\n        line_in: 'In',\r\n        line_out: 'Out',\r\n        line_net: 'Net',\r\n        empty_categories: 'No category data.',\r\n        empty_merchants: 'No merchant data.',\r\n        empty_flows: 'No flow data.',\r\n        empty_trends: 'No historical data.'\r\n      },\r\n      metrics: {\r\n        total_spend: 'Total Spend',\r\n        total_income: 'Total Income',\r\n        net: 'Net'\r\n      },\r\n      empty: {\r\n        no_transactions_title: 'No transactions yet',\r\n        charts_note: 'Once you upload, charts will populate automatically.',\r\n        unknowns_note: 'Upload a CSV to view and categorize unknowns.',\r\n        no_budgets_title: 'No budgets to show',\r\n        no_budgets_note: 'Upload a CSV and/or add budget rules to see this panel.',\r\n        upload_csv_banner: 'Upload a CSV to begin. Use the Upload CSV card.',\r\n        upload_csv_above: 'Upload a CSV to begin. Use the Upload CSV card above.'\r\n      },\r\n      cards: {\r\n        unknowns_title: 'Unknowns — {month}',\r\n        budgets_title: 'Budgets — {month}'\r\n      },\r\n      unknowns: {\r\n        header_label: 'Uncategorized transactions',\r\n        tooltip_info: 'These are transactions without a category. Use “Seed rule” to quickly create a rule in the Rule Tester.',\r\n        workflow_hint: 'Review → Seed → Categorize',\r\n        seed_rule: 'Seed rule',\r\n        seed_rule_aria: 'Seed rule (prefill Rule Tester)',\r\n        seed_rule_tooltip: 'Sends merchant/description (and current month) into Rule Tester so you can test & save a rule quickly.',\r\n        explain: 'Explain',\r\n        apply_category: 'Apply {category}'\r\n      },\r\n      insights: {\r\n        title: 'Insights',\r\n        item_fallback: 'Insight'\r\n      },\r\n      ml: {\r\n        title: 'ML Status',\r\n        refresh: 'Refresh',\r\n        refreshing: 'Refreshing…',\r\n        classes: 'Classes:',\r\n        feedback_count: 'Feedback count:',\r\n        updated: 'Updated:',\r\n        selftest_run: 'Run Selftest',\r\n        selftest_running: 'Running Selftest…',\r\n        selftest_run_title: 'Run an end-to-end incremental learning smoke test'\r\n      },\r\n      rule_suggestions: {\r\n        title: 'Rule Suggestions',\r\n        loading: 'Loading…',\r\n        none: 'No suggestions right now.',\r\n        show_ignores: 'Show ignores',\r\n        hide_ignores: 'Hide ignores',\r\n        refresh: 'Refresh',\r\n        refreshing: 'Refreshing…',\r\n        seen_meta: 'Seen {count}× in last {days} days',\r\n        accept: 'Accept',\r\n        accepting: 'Accepting…',\r\n        dismiss: 'Dismiss',\r\n        dismissing: 'Dismissing…',\r\n        apply: 'Apply',\r\n        applying: 'Applying…',\r\n        ignore: 'Ignore',\r\n        ignoring: 'Ignoring…'\r\n      },\r\n      categories: {\r\n        groceries: 'Groceries',\r\n        dining: 'Dining',\r\n        shopping: 'Shopping'\r\n      },\r\n      common: {\r\n        dismiss: 'Dismiss'\r\n      }\r\n    }\r\n  }\r\n  , es: {\r\n    // Partial Spanish scaffold (fall back to en for missing keys)\r\n    ui: {\r\n      toast: {\r\n        csv_ingested_title: 'CSV ingerido',\r\n        csv_ingested_description: 'Transacciones importadas. Paneles actualizados.',\r\n        dev_ui_soft_on: 'Dev UI (soft) activado',\r\n        dev_ui_soft_off: 'Dev UI (soft) desactivado',\r\n        dev_ui_enabled: 'Dev UI habilitado',\r\n        dev_ui_disabled: 'Dev UI deshabilitado',\r\n        category_applied: 'Categoría establecida → {category}',\r\n        ml_feedback_failed: 'Feedback ML falló ({error}). BD actualizada.',\r\n        seed_rule_title: 'Sembrado en Rule Tester',\r\n        seed_rule_description: 'Comerciante y descripción copiados — ajustar y probar.',\r\n        seed_rule_action_open: 'Abrir tester',\r\n        budget_single_applied_title: 'Presupuesto aplicado',\r\n        budget_single_applied_description: '{category} = {amount}',\r\n        budget_single_apply_failed_title: 'Error al aplicar {category}',\r\n        budget_bulk_applied_title: 'Presupuestos aplicados',\r\n        budget_bulk_applied_description: '{count} categorías — Total {total}',\r\n        budget_bulk_apply_failed_title: 'Error al aplicar presupuestos',\r\n        ml_refresh_failed: 'Actualización falló: {error}',\r\n        ml_selftest_ok: 'Selftest OK en {ms}ms — etiqueta={label}, txn={txn}, clases=[{classes}]',\r\n        ml_selftest_no_bump: 'Selftest corrió pero timestamp no cambió (revisar guardado incremental).',\r\n        ml_selftest_failed: 'Selftest falló: {error}',\r\n        rule_accepted: 'Aceptado: {merchant} → {category}',\r\n        rule_accept_failed: 'Error al aceptar',\r\n        rule_dismissed: 'Descartado: {merchant} → {category}',\r\n        rule_dismiss_failed: 'Error al descartar',\r\n        rule_added: 'Regla agregada: {merchant} → {category}',\r\n        rule_apply_failed: 'Error al aplicar',\r\n        rule_ignored: 'Ignorado {merchant} → {category}',\r\n        rule_ignore_failed: 'Error al ignorar',\r\n        signed_out_title: 'Sesión cerrada',\r\n        sign_out_failed_title: 'Error al cerrar sesión',\r\n        email_copied_title: 'Email copiado',\r\n        temp_budget_removed_title: 'Presupuesto temporal eliminado',\r\n        anomaly_unignored_title: 'Anomalía restaurada',\r\n        rule_created_title: 'Regla creada',\r\n        rule_created_description: '“{name}” guardada correctamente.',\r\n        rules_list_load_failed: 'No se pudo cargar la lista de reglas',\r\n        budget_inline_invalid_amount: 'Ingrese un monto válido > 0',\r\n        budget_inline_saved_title: 'Guardado {category} = {amount}',\r\n        budget_inline_save_failed: 'Error al guardar',\r\n        budget_inline_restore_failed: 'Error al restaurar',\r\n        budget_inline_delete_failed: 'Error al eliminar presupuesto',\r\n        rule_tested_title: 'Regla probada',\r\n        rule_tested_matches_description: 'Coincidió {count} transacción(es). Categoría: “{category}”.',\r\n        rule_tested_no_matches_description: 'Sin coincidencias. Categoría sería: “{category}”.',\r\n        rule_test_failed_title: 'Prueba falló',\r\n        rule_saved_retrained_title: 'Regla guardada + reentrenada',\r\n        rule_saved_retrained_description: 'Reclasificadas {count} txn(s) a “{category}”.',\r\n        rule_saved_retrained_no_changes_description: 'No se requirieron cambios.',\r\n        rule_saved_title: 'Regla guardada',\r\n        rule_saved_description: 'Guardada “{name}”.',\r\n        rule_save_failed_title: 'Error al guardar',\r\n        save_rule_modal_saved_title: 'Guardado: {name}',\r\n        save_rule_modal_save_failed_title: 'Error al guardar regla',\r\n        suggestion_ignore_removed_title: 'Ignorado eliminado {merchant} → {category}',\r\n        suggestion_ignore_remove_failed_title: 'Error al eliminar',\r\n        import_complete_title: 'Importación completa',\r\n        import_complete_description: 'Transacciones importadas correctamente.',\r\n        tx_deleted_title: 'Eliminado',\r\n        tx_delete_failed_title: 'Error al eliminar',\r\n        tx_restored_title: 'Restaurado',\r\n        tx_updated_title: 'Actualizado',\r\n        tx_bulk_updated_title: 'Actualización masiva',\r\n        tx_split_created_title: 'División creada',\r\n        tx_merged_into_title: 'Fusionado',\r\n        tx_merged_multi_title: 'Fusionado',\r\n        tx_linked_title: 'Vinculado'\r\n      }\r\n    }\r\n  }\r\n} as const;\r\n\r\nexport type Locales = keyof typeof dictionaries;\r\nlet currentLocale: Locales = 'en';\r\nexport function setLocale(loc: Locales) { currentLocale = loc; }\r\nexport function getLocale(): Locales { return currentLocale; }\r\n\r\n// ----- Key + var typing -----\r\ntype Leaves<T, P extends string = ''> =\r\n  T extends string ? P : {\r\n    [K in keyof T & string]: Leaves<T[K], `${P}${P extends '' ? '' : '.'}${K}`>\r\n  }[keyof T & string];\r\n\r\nexport type I18nKey = Leaves<typeof dictionaries['en']>;\r\n\r\ntype VarsFrom<S extends string> =\r\n  string extends S ? Record<string, string | number> :\r\n  S extends `${string}{${infer V}}${infer R}`\r\n    ? ({ [K in V | keyof VarsFrom<R>]: string | number })\r\n    : Record<string, never>;\r\n\r\nfunction getFromDict(dict: Dict, path: string): string | undefined {\r\n  return path.split('.').reduce<any>((acc, k) => (acc && (acc as any)[k]) as any, dict) as any;\r\n}\r\n\r\nconst cache = new Map<string, string>();\r\n\r\nexport function t<K extends I18nKey>(key: K, vars?: VarsFrom<NonNullable<ReturnType<typeof getFromDict>> & string>): string {\r\n  const dict = dictionaries[currentLocale] as unknown as Dict;\r\n  const cacheKey = `${currentLocale}::${key}::${vars ? JSON.stringify(vars) : ''}`;\r\n  const cached = cache.get(cacheKey);\r\n  if (cached) return cached;\r\n  const tmpl = getFromDict(dict, key) ?? getFromDict(dictionaries.en as unknown as Dict, key);\r\n  if (typeof tmpl !== 'string') return key; // fallback to key sentinel\r\n  const out = tmpl.replace(/\\{(\\w+)\\}/g, (_, k) => (vars && k in vars ? String(vars[k]) : `{${k}}`));\r\n  cache.set(cacheKey, out);\r\n  return out;\r\n}\r\n\r\nexport function clearI18nCache() { cache.clear(); }\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\lib\\money.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\lib\\name.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\lib\\rulesSeed.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[109,112],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[109,112],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[160,163],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[160,163],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[934,937],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[934,937],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1003,1006],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1003,1006],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export type SeedDraft = {\r\n  name?: string;\r\n  when: { merchant?: string; description?: string; [k: string]: any };\r\n  then?: { category?: string; [k: string]: any };\r\n  month?: string;\r\n};\r\n\r\nexport type TxnLike = {\r\n  id?: string | number;\r\n  merchant?: string;\r\n  description?: string;\r\n  category_guess?: string;\r\n};\r\n\r\n/** Seed a RuleTester draft from a transaction and open the tester if available. */\r\nexport function seedRuleFromTxn(txn: TxnLike, opts?: { month?: string }) {\r\n  const draft: SeedDraft = {\r\n    name: txn.merchant ? `If merchant contains \"${txn.merchant}\"` : \"New rule\",\r\n    when: {\r\n      ...(txn.merchant ? { merchant: txn.merchant } : {}),\r\n      ...(txn.description ? { description: txn.description } : {}),\r\n    },\r\n    then: { ...(txn.category_guess ? { category: txn.category_guess } : {}) },\r\n    ...(opts?.month ? { month: opts.month } : {}),\r\n  };\r\n\r\n  // Queue for late-mounted panel\r\n  (window as any).__pendingRuleSeed = draft;\r\n  // Best-effort open\r\n  (window as any).__openRuleTester?.(draft);\r\n  // Dispatch event for listeners\r\n  window.dispatchEvent(new CustomEvent('ruleTester:seed', { detail: draft }));\r\n  return draft;\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\lib\\schemas.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\lib\\scroll.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\lib\\toast-helpers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\lib\\tools-runner.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[209,212],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[209,212],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[304,307],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[304,307],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[571,574],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[571,574],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1232,1235],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1232,1235],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { agentRephrase } from \"./api\";\n\nexport async function runToolWithRephrase<T>(\n  tool: string,\n  fetcher: () => Promise<T>,\n  promptBuilder: (data: T) => string,\n  appendAssistant: (msg: string, meta?: any) => void,\n  setThinking: (on: boolean) => void,\n  buildRephraseMeta?: () => Record<string, any>\n) {\n  console.debug(`[tools] ${tool} → fetch`);\n  setThinking(true);\n  try {\n  // No text placeholder; rely on UI spinner via setThinking(true)\n\n    const data = await fetcher();\n    let prompt = \"\";\n    try {\n      prompt = promptBuilder(data);\n    } catch (e: any) {\n      console.error(`[tools] ${tool} promptBuilder failed`, e);\n      prompt = `Explain briefly why there is no data or an error for ${tool}: ${e?.message ?? e}`;\n    }\n  console.debug(`[tools] ${tool} → /agent/chat`, { prompt: (prompt || '').slice(0, 160) });\n  const extra = (typeof buildRephraseMeta === 'function' ? (buildRephraseMeta() || {}) : {});\n  const llm = await agentRephrase(prompt);\n  console.debug(`[tools] ${tool} ← /agent/chat ok`, { model: llm?.model });\n\n    // Surface mode/args/tool to the UI so ModeChip can render\n  appendAssistant(llm.reply ?? \"\", { model: llm.model, grounded: true, tool, mode: tool, ...extra });\n  } catch (e: any) {\n    console.error(`[tools] ${tool} failed`, e);\n    appendAssistant(`Sorry, ${tool} failed: ${e?.message ?? e}`, { severity: \"error\", tool });\n  } finally {\n    setThinking(false);\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\lib\\usePersistentFlag.ts","messages":[{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":12,"column":60,"nodeType":"BlockStatement","messageId":"unexpected","endLine":12,"endColumn":62,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[456,456],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from 'react'\r\n\r\nexport function usePersistentFlag(key: string, initial = false): [boolean, (v: boolean) => void] {\r\n  const [val, setVal] = React.useState<boolean>(() => {\r\n    try {\r\n      const s = localStorage.getItem(key)\r\n      return s === null ? initial : s === '1'\r\n    } catch { return initial }\r\n  })\r\n  const set = React.useCallback((v: boolean) => {\r\n    setVal(v)\r\n    try { localStorage.setItem(key, v ? '1' : '0') } catch {}\r\n  }, [])\r\n  return [val, set]\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\main.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[586,589],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[586,589],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[645,648],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[645,648],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[715,718],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[715,718],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[786,789],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[786,789],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":10,"column":1,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":10,"endColumn":40,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[397,436],"text":"// @ts-expect-error - generated at build time"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react'\nimport ReactDOM from 'react-dom/client'\nimport './index.css'\nimport App from './App'\nimport { Toaster } from \"@/components/ui/toaster\";\nimport Providers from \"@/components/Providers\";\nimport { initLocale } from '@/lib/i18n-persist';\n// Build metadata injected during Docker build (file created in Dockerfile)\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore - generated at build time\nimport buildStamp from './build-stamp.json';\n\n(() => {\n  try {\n    // Attach structured metadata for debugging & cache-bust influence\n    (window as any).__LEDGERMIND_BUILD__ = {\n      branch: (globalThis as any).__WEB_BRANCH__ ?? '__WEB_BRANCH__',\n      commit: (globalThis as any).__WEB_COMMIT__ ?? '__WEB_COMMIT__',\n      buildId: (globalThis as any).__WEB_BUILD_ID__ ?? '__WEB_BUILD_ID__',\n      stamp: buildStamp,\n    };\n    const meta = document.createElement('meta');\n    meta.name = 'x-ledgermind-build';\n    meta.content = `${buildStamp.branch || 'unknown'}@${buildStamp.commit || 'unknown'}#${buildStamp.buildId || 'unknown'}`;\n    document.head.appendChild(meta);\n  } catch {\n    // swallow\n  }\n})();\n\n// Initialize locale (persisted or inferred) before app render\ninitLocale();\n\nReactDOM.createRoot(document.getElementById('root')!).render(\n  <React.StrictMode>\n    <Providers>\n      <App />\n      <Toaster />\n    </Providers>\n  </React.StrictMode>\n)\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\pages\\__dev.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[174,177],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[174,177],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[231,234],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[231,234],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":11,"column":54,"nodeType":"BlockStatement","messageId":"unexpected","endLine":11,"endColumn":56,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[343,343],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":12,"column":58,"nodeType":"BlockStatement","messageId":"unexpected","endLine":12,"endColumn":60,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[403,403],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { flags } from '@/lib/flags';\nimport { apiGet } from '@/lib/api';\n\nexport default function DevPage() {\n  const [me, setMe] = React.useState<any>(null);\n  const [health, setHealth] = React.useState<any>(null);\n\n  React.useEffect(() => {\n    (async () => {\n      try { setMe(await apiGet('/auth/me')); } catch {}\n      try { setHealth(await apiGet('/healthz')); } catch {}\n    })();\n  }, []);\n\n  return (\n    <div className=\"p-4 space-y-3\">\n      <h2 className=\"text-xl font-semibold\">__dev</h2>\n      <div className=\"grid gap-3 md:grid-cols-2\">\n        <div className=\"border rounded-xl p-3\">\n          <h3 className=\"font-medium\">Env</h3>\n          <pre className=\"text-xs mt-2\">{JSON.stringify({\n            VITE_API_BASE: import.meta.env.VITE_API_BASE,\n          }, null, 2)}</pre>\n        </div>\n        <div className=\"border rounded-xl p-3\">\n          <h3 className=\"font-medium\">Flags</h3>\n          <pre className=\"text-xs mt-2\">{JSON.stringify(flags, null, 2)}</pre>\n        </div>\n        <div className=\"border rounded-xl p-3 md:col-span-2\">\n          <h3 className=\"font-medium\">Current User</h3>\n          <pre className=\"text-xs mt-2\">{JSON.stringify(me, null, 2)}</pre>\n        </div>\n        <div className=\"border rounded-xl p-3 md:col-span-2\">\n          <h3 className=\"font-medium\">Health</h3>\n          <pre className=\"text-xs mt-2\">{JSON.stringify(health, null, 2)}</pre>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\phantom_Toaster_singleton.phantom.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\selectors\\__tests__\\explain.selectTopMerchantCat.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[917,920],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[917,920],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1022,1025],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1022,1025],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect } from 'vitest'\nimport { selectTopMerchantCat } from '@/selectors/explain'\nimport type { ExplainResponse } from '@/lib/api'\n\nfunction makeData(byCategory: Array<{ category: string; count: number }>, total?: number): ExplainResponse {\n  return {\n    txn: { id: 1, date: '2025-08-01', merchant: 'Starbucks', amount: -4.5, category: 'Coffee' },\n    evidence: {\n      merchant_norm: 'starbucks',\n      rule_match: null,\n      similar: {\n        total: total ?? byCategory.reduce((a, b) => a + (b.count || 0), 0),\n        by_category: byCategory,\n        recent_samples: [],\n      },\n      feedback: { txn_feedback: [], merchant_feedback: [] },\n    },\n    candidates: [],\n    rationale: 'd',\n    llm_rationale: null,\n    mode: 'deterministic',\n    actions: [],\n  }\n}\n\ndescribe('selectTopMerchantCat', () => {\n  it('returns null for null data', () => {\n    expect(selectTopMerchantCat(null as any)).toBeNull()\n  })\n\n  it('returns null when similar absent', () => {\n    const data = makeData([]) as any\n    data.evidence.similar = undefined\n    expect(selectTopMerchantCat(data)).toBeNull()\n  })\n\n  it('picks the first (highest count) from by_category', () => {\n    const data = makeData([{ category: 'Coffee', count: 12 }, { category: 'Snacks', count: 3 }], 16)\n    const res = selectTopMerchantCat(data)\n    expect(res).toEqual({ cat: 'Coffee', count: 12, total: 16 })\n  })\n\n  it('returns null when by_category is empty', () => {\n    const data = makeData([])\n    expect(selectTopMerchantCat(data)).toBeNull()\n  })\n})\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\selectors\\explain.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[254,257],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[254,257],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { ExplainResponse } from \"@/lib/api\";\n\n/** Returns { cat, count, total } for the merchant history top category or null. */\nexport function selectTopMerchantCat(data: ExplainResponse | null) {\n  if (!data) return null;\n  const hist = (data as any)?.evidence?.similar;\n  if (!hist || !Array.isArray(hist.by_category)) return null;\n  const top = hist.by_category[0] as { category: string; count: number } | undefined;\n  if (!top) return null;\n  const total = Number(hist.total || 0) || 0;\n  return { cat: top.category, count: top.count, total };\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\state\\auth.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Move your React context(s) to a separate file.","line":9,"column":14,"nodeType":"Identifier","messageId":"reactContext","endLine":9,"endColumn":25},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":51,"column":50,"nodeType":"BlockStatement","messageId":"unexpected","endLine":51,"endColumn":52,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[1611,1611],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":71,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":71,"endColumn":24},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":77,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":77,"endColumn":24},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":83,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":83,"endColumn":32},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":89,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":89,"endColumn":27}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createContext, useContext, useMemo, useState, useEffect } from \"react\";\nimport type { ReactNode } from \"react\";\nimport { apiGet, apiPost } from \"../lib/api\";\n\nexport type User = { email: string; roles: string[]; is_active?: boolean } | null;\n\n// Simple POST helper uses apiPost from lib\n\nexport const AuthContext = createContext<{\n  user: User;\n  authReady: boolean;\n  login: (email: string, password: string) => Promise<void>;\n  register: (email: string, password: string) => Promise<void>;\n  logout: () => void;\n  refresh: () => Promise<boolean>;\n} | null>(null);\n\nexport function AuthProvider({ children }: { children: ReactNode }) {\n  const [user, setUser] = useState<User>(null);\n  const [authReady, setAuthReady] = useState(false);\n\n  // On boot: simply probe /auth/me (cookies set by login or OAuth callback)\n  useEffect(() => {\n    let alive = true;\n    (async () => {\n      try {\n        const me = await apiGet<User>(\"/auth/me\");\n        if (alive) setUser(me);\n      } finally {\n        if (alive) setAuthReady(true);\n      }\n    })();\n    return () => { alive = false; };\n  }, []);\n\n  const login = async (email: string, password: string) => {\n    await apiPost(\"/auth/login\", { email, password });\n    const me = await apiGet<User>(\"/auth/me\");\n    setUser(me);\n    setAuthReady(true);\n  };\n\n  const register = async (email: string, password: string) => {\n    await apiPost(\"/auth/register\", { email, password });\n    const me = await apiGet<User>(\"/auth/me\");\n    setUser(me);\n    setAuthReady(true);\n  };\n\n  const logout = async () => {\n    try { await apiPost(\"/auth/logout\"); } catch {}\n    setUser(null);\n  };\n\n  const refresh = async (): Promise<boolean> => {\n    try {\n      await apiPost(\"/auth/refresh\");\n      const me = await apiGet<User>(\"/auth/me\");\n      setUser(me);\n      setAuthReady(true);\n      return true;\n    } catch {\n      return false;\n    }\n  };\n\n  const value = useMemo(() => ({ user, authReady, login, register, logout, refresh }), [user, authReady]);\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\n}\n\nexport function useAuth() {\n  const ctx = useContext(AuthContext);\n  if (!ctx) throw new Error(\"useAuth must be used within <AuthProvider>\");\n  return ctx;\n}\n\nexport function hasRole(user: User, ...roles: string[]) {\n  if (!user) return false;\n  return user.roles?.some(r => roles.includes(r));\n}\n\n// Simple readiness gate: dashboards should render only when a user exists\nexport function useAuthRequired(): boolean {\n  const { user } = useAuth();\n  return !!user;\n}\n\n// Hook: check if current user has any of the roles\nexport function useHasRole(...roles: string[]): boolean {\n  const { user } = useAuth();\n  return !!user?.roles?.some(r => roles.includes(r));\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\state\\chat\\__tests__\\handlers.micro.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\state\\chat\\__tests__\\ui.micro.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\state\\chat\\index.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[89,92],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[89,92],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[120,123],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[120,123],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[308,311],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[308,311],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[325,328],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[325,328],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1209,1212],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1209,1212],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export type AssistantPayload = {\n  reply: string;\n  rephrased?: boolean;\n  suggestions?: any[];\n  meta?: Record<string, any>;\n};\n\ntype PushAssistantHandler = (payload: AssistantPayload) => void;\ntype PushUserHandler = (content: string) => void;\ntype CallToolHandler = (tool: string, payload?: Record<string, any>) => Promise<any>;\n\ntype ChatHandlers = {\n  pushAssistant: PushAssistantHandler;\n  pushUser: PushUserHandler;\n  callTool: CallToolHandler;\n};\n\nconst fallbackHandlers: ChatHandlers = {\n  pushAssistant() {\n    console.warn(\"Chat assistant handler not registered.\");\n  },\n  pushUser() {\n    console.warn(\"Chat user handler not registered.\");\n  },\n  async callTool() {\n    throw new Error(\"Chat tool handler not registered.\");\n  },\n};\n\nlet handlers: ChatHandlers = fallbackHandlers;\n\nexport function registerChatHandlers(next: ChatHandlers) {\n  handlers = next;\n  return () => {\n    if (handlers === next) {\n      handlers = fallbackHandlers;\n    }\n  };\n}\n\nexport function pushAssistant(payload: AssistantPayload) {\n  handlers.pushAssistant(payload);\n}\n\nexport function pushUser(content: string) {\n  handlers.pushUser(content);\n}\n\nexport async function callTool(tool: string, payload?: Record<string, any>) {\n  return handlers.callTool(tool, payload);\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\state\\chat\\ui.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\state\\llmStore.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[794,797],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[794,797],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[888,891],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[888,891],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[943,946],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[943,946],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1220,1223],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1220,1223],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { create } from 'zustand';\r\nimport { getLlmHealth, fetchModels } from '@/lib/api';\r\n\r\nexport type LlmState = {\r\n  modelsOk?: boolean;\r\n  path?: 'primary' | 'fallback-openai' | string;\r\n  lastRefreshed?: number;\r\n  refreshing: boolean;\r\n  error?: string;\r\n  refresh: (opts?: { refreshModels?: boolean }) => Promise<void>;\r\n};\r\n\r\nexport const useLlmStore = create<LlmState>()((set) => ({\r\n  modelsOk: undefined,\r\n  path: undefined,\r\n  lastRefreshed: undefined,\r\n  refreshing: false,\r\n  error: undefined,\r\n  refresh: async ({ refreshModels = true } = {}) => {\r\n    set({ refreshing: true, error: undefined });\r\n    try {\r\n      const health = await getLlmHealth();\r\n      const models = await fetchModels(refreshModels);\r\n      const primaryOk = !!(models?.primary?.reachable && (models as any)?.primary?.model);\r\n      const fallbackOk = !!(models?.fallback?.reachable && (models as any)?.fallback?.model);\r\n      const path = (health as any)?.path ?? (primaryOk ? 'primary' : (fallbackOk ? 'fallback-openai' : undefined));\r\n      set({\r\n        modelsOk: primaryOk || fallbackOk,\r\n        path,\r\n        lastRefreshed: Date.now(),\r\n        refreshing: false,\r\n        error: undefined,\r\n      });\r\n    } catch (e: any) {\r\n      set({ refreshing: false, error: e?.message || 'Failed to refresh LLM status' });\r\n    }\r\n  }\r\n}));\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\state\\month.ts","messages":[{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":9,"column":47,"nodeType":"BlockStatement","messageId":"unexpected","endLine":9,"endColumn":49,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[298,298],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[460,463],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[460,463],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const KEY = 'globalMonth'; // format: \"YYYY-MM\"\nconst EVT = 'global-month-changed';\n\nexport function getGlobalMonth(): string | '' {\n  try { return localStorage.getItem(KEY) || ''; } catch { return ''; }\n}\n\nexport function setGlobalMonth(m: string) {\n  try { localStorage.setItem(KEY, m); } catch {}\n  window.dispatchEvent(new CustomEvent(EVT, { detail: { month: m } }));\n}\n\nexport function onGlobalMonthChange(cb: (m: string) => void) {\n  function handler(e: any) {\n    const m = e?.detail?.month ?? getGlobalMonth();\n    cb(m);\n  }\n  window.addEventListener(EVT, handler);\n  return () => window.removeEventListener(EVT, handler);\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\state\\rules.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\state\\rulesDraft.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\state\\useDevUI.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1174,1177],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1174,1177],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2161,2164],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2161,2164],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\r\n\r\nexport function isDevUIEnabled(): boolean {\r\n  try {\r\n    return localStorage.getItem('fa.dev') === '1';\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport function setDevUIEnabled(on: boolean) {\r\n  try {\r\n    if (on) localStorage.setItem('fa.dev', '1');\r\n    else localStorage.removeItem('fa.dev');\r\n    // Fire a custom event so soft listeners can react without storage event (same tab)\r\n    window.dispatchEvent(new CustomEvent('devui:changed', { detail: { value: on } }));\r\n  } catch {\r\n    /* no-op */\r\n  }\r\n}\r\n\r\n// Soft toggle that does not mutate localStorage (session-only) – for previewing.\r\nexport function setDevUIEnabledSoft(on: boolean) {\r\n  window.dispatchEvent(new CustomEvent('devui:soft', { detail: { value: on } }));\r\n  window.dispatchEvent(new CustomEvent('devui:changed', { detail: { value: on, soft: true } }));\r\n}\r\n\r\n/** Hook form (recomputes on visibilitychange / storage so another tab toggle is picked up) */\r\nexport function useDevUI(): boolean {\r\n  const [flag, setFlag] = useState(isDevUIEnabled());\r\n  useEffect(() => {\r\n    const sync = () => setFlag(isDevUIEnabled());\r\n    const onChanged = (e: any) => {\r\n      if (e?.detail?.soft) {\r\n        // Reflect soft value without altering persisted state indicator (flag semantics: persisted OR soft value)\r\n        setFlag(true);\r\n      } else {\r\n        sync();\r\n      }\r\n    };\r\n    document.addEventListener('visibilitychange', sync);\r\n    window.addEventListener('storage', sync);\r\n    window.addEventListener('devui:changed', onChanged as EventListener);\r\n    return () => {\r\n      document.removeEventListener('visibilitychange', sync);\r\n      window.removeEventListener('storage', sync);\r\n      window.removeEventListener('devui:changed', onChanged as EventListener);\r\n    };\r\n  }, []);\r\n  return flag;\r\n}\r\n\r\nexport function useDevUISoftStatus(): { active: boolean; soft: boolean } {\r\n  const [state, setState] = useState<{active:boolean;soft:boolean}>(() => ({ active: isDevUIEnabled(), soft: false }));\r\n  useEffect(() => {\r\n    const sync = () => setState({ active: isDevUIEnabled(), soft: false });\r\n    const onChanged = (e: any) => {\r\n      if (e?.detail?.soft) {\r\n        setState({ active: true, soft: true });\r\n      } else {\r\n        sync();\r\n      }\r\n    };\r\n    document.addEventListener('visibilitychange', sync);\r\n    window.addEventListener('storage', sync);\r\n    window.addEventListener('devui:changed', onChanged as EventListener);\r\n    return () => {\r\n      document.removeEventListener('visibilitychange', sync);\r\n      window.removeEventListener('storage', sync);\r\n      window.removeEventListener('devui:changed', onChanged as EventListener);\r\n    };\r\n  }, []);\r\n  return state;\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\stores\\chatdock.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[185,188],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[185,188],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { create } from \"zustand\";\n\ntype S = {\n  visible: boolean;\n  show: () => void;\n  hide: () => void;\n  toggle: () => void;\n};\n\nexport const useChatDockStore = create<S>((set: (fn: any) => void) => ({\n  visible: true,\n  show: () => set({ visible: true }),\n  hide: () => set({ visible: false }),\n  toggle: () => set((s: S) => ({ visible: !s.visible })),\n}));\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\test\\setup.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\test\\setupTests.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":4,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[112,115],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[112,115],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/ban-types","severity":2,"message":"Don't use `Function` as a type. The `Function` type accepts any function-like value.\nIt provides no type safety when calling the function, which can be a common source of bugs.\nIt also accepts things like class declarations, which will throw at runtime as they will not be called with `new`.\nIf you are expecting the function to accept certain arguments, you should explicitly define the function shape.","line":10,"column":37,"nodeType":"Identifier","messageId":"bannedTypeMessage","endLine":10,"endColumn":45},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[602,605],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[602,605],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[686,689],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[686,689],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[826,829],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[826,829],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1120,1123],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1120,1123],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1158,1161],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1158,1161],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1179,1182],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1179,1182],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1225,1228],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1225,1228],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1473,1476],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1473,1476],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1552,1555],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1552,1555],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1573,1576],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1573,1576],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":117,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":120,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1647,1650],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1647,1650],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":39,"column":11,"nodeType":"BlockStatement","messageId":"unexpected","endLine":39,"endColumn":13,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[1671,1671],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import '@testing-library/jest-dom';\r\n\r\n// Enhanced EventSource mock with global registry helpers\r\nconst ES_REG: any[] = [];\r\nclass MockEventSource {\r\n  static instances = ES_REG;\r\n  url: string;\r\n  withCredentials: boolean;\r\n  readyState = 0; // 0 connecting, 1 open, 2 closed\r\n  private listeners: Record<string, Function[]> = {};\r\n\r\n  constructor(url: string, init?: EventSourceInit) {\r\n    this.url = url;\r\n    this.withCredentials = !!init?.withCredentials;\r\n    ES_REG.push(this);\r\n    setTimeout(() => { this.readyState = 1; this._dispatch('open'); }, 0);\r\n  }\r\n  addEventListener(t: string, cb: any) { (this.listeners[t] ||= []).push(cb); }\r\n  removeEventListener(t: string, cb: any) { this.listeners[t] = (this.listeners[t]||[]).filter(x => x!==cb); }\r\n  close() { this.readyState = 2; }\r\n  _emit(type: string, data?: any) {\r\n    const e = new MessageEvent(type, { data: data != null ? JSON.stringify(data) : '' });\r\n    (this.listeners[type] || []).forEach(cb => cb(e));\r\n  }\r\n  _dispatch(type: string) { const e = new MessageEvent(type); (this.listeners[type] || []).forEach(cb => cb(e)); }\r\n}\r\n(globalThis as any).EventSource = MockEventSource as any;\r\n(globalThis as any).__ES_INSTANCES = ES_REG;\r\n(globalThis as any).__ES_LAST = () => ES_REG[ES_REG.length - 1];\r\n\r\n// Fallback fetch mock (avoid accidental real network in unit tests)\r\n// Use top-level await style guard via immediately invoked async function\r\n((async () => {\r\n  try {\r\n    if (!(globalThis as any).fetch) {\r\n      const mod = await import('vitest');\r\n      (globalThis as any).fetch = (mod as any).vi.fn(() => Promise.resolve(new Response('{}', { status: 200 }))) as any;\r\n    }\r\n  } catch {}\r\n})());\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\types\\agentTools.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[441,444],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[441,444],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// --- src/types/agentTools.ts ---\nexport type ToolKey =\n  | \"transactions.search\"\n  | \"transactions.categorize\"\n  | \"transactions.get_by_ids\"\n  | \"budget.summary\"\n  | \"budget.check\"\n  | \"insights.expanded\"\n  | \"charts.summary\"\n  | \"charts.merchants\"\n  | \"charts.flows\"\n  | \"charts.trends\"\n  | \"rules.test\"\n  | \"rules.apply\"\n  | \"rules.apply_all\";\n\nexport type ToolSpec = {\n  key: ToolKey;\n  label: string;\n  path: string;\n  examplePayload: any;\n};\n\nexport type ToolRunState<T = unknown> = {\n  loading: boolean;\n  error: string | null;\n  data: T | null;\n};\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\types\\agentToolsResults.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\types\\rules.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[619,622],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[619,622],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[669,672],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[669,672],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[719,722],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[719,722],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[766,769],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[766,769],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Persisted rule suggestion (server-stored)\nexport type PersistedRuleSuggestion = {\n  id: number;\n  merchant_norm: string;\n  category: string;\n  support: number;\n  positive_rate: number;\n  last_seen: string | null;\n  created_at: string | null;\n};\n\n// Mined rule suggestion (summary list)\nexport type RuleSuggestion = {\n  merchant: string;\n  category: string;\n  count: number;\n  window_days: number;\n  sample_txn_ids?: number[];\n  recent_month_key?: string;\n};\n\nexport function isRuleSuggestionArray(x: unknown): x is RuleSuggestion[] {\n  return Array.isArray(x) && x.every(\n    (it) =>\n      it &&\n      typeof (it as any).merchant === \"string\" &&\n      typeof (it as any).category === \"string\" &&\n      typeof (it as any).count === \"number\" &&\n      typeof (it as any).window_days === \"number\"\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\types\\sonner.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\ui\\HelpTarget.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[301,304],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[301,304],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\r\nimport type { HelpKey } from \"../help/helpRegistry\";\r\n\r\ntype Props = React.HTMLAttributes<HTMLElement> & { helpKey: HelpKey; as?: keyof JSX.IntrinsicElements };\r\n\r\nexport default function HelpTarget({ helpKey, as = \"div\", children, ...rest }: Props) {\r\n  const Tag = as as any;\r\n  return (\r\n    <Tag data-help-key={helpKey} data-help=\"1\" {...rest}>\r\n      {children}\r\n    </Tag>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\utils\\__tests__\\chatStore.test.ts","messages":[{"ruleId":"@typescript-eslint/ban-types","severity":2,"message":"Don't use `Function` as a type. The `Function` type accepts any function-like value.\nIt provides no type safety when calling the function, which can be a common source of bugs.\nIt also accepts things like class declarations, which will throw at runtime as they will not be called with `new`.\nIf you are expecting the function to accept certain arguments, you should explicitly define the function shape.","line":6,"column":42,"nodeType":"Identifier","messageId":"bannedTypeMessage","endLine":6,"endColumn":50},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[413,416],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[413,416],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[524,527],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[524,527],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":13,"column":1,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":13,"endColumn":14,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[592,605],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[627,630],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[627,630],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[665,668],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[665,668],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":107,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":110,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[713,716],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[713,716],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, beforeEach } from 'vitest';\r\nimport { chatStore, snapshot, hasSnapshot, restoreFromSnapshot, discardSnapshot, BasicMsg } from '../chatStore';\r\n\r\n// Provide minimal localStorage + BroadcastChannel polyfills for happy-dom\r\nclass MockBroadcastChannel {\r\n  name: string; handlers: Record<string, Function[]> = {};\r\n  constructor(name: string) { this.name = name; }\r\n  postMessage(_msg: any) { (this.handlers['message']||[]).forEach(fn=>fn({ data: _msg })); }\r\n  addEventListener(type: string, fn: any) { (this.handlers[type] ||= []).push(fn); }\r\n  close() {}\r\n}\r\n\r\n// @ts-ignore\r\nif (!(globalThis as any).BroadcastChannel) (globalThis as any).BroadcastChannel = MockBroadcastChannel as any;\r\n\r\nfunction make(role: string, content: string): BasicMsg { return { role, content, createdAt: Date.now() }; }\r\n\r\ndescribe('chatStore basic operations', () => {\r\n  beforeEach(() => {\r\n    localStorage.clear();\r\n    // Re-init listeners side effects not required for these tests\r\n  });\r\n\r\n  it('append & get roundtrip', () => {\r\n    const m1 = make('user','hi');\r\n    chatStore.append(m1);\r\n    const m2 = make('assistant','hello');\r\n    chatStore.append(m2);\r\n    const all = chatStore.get();\r\n    expect(all.length).toBe(2);\r\n    expect(all[0].content).toBe('hi');\r\n    expect(all[1].role).toBe('assistant');\r\n  });\r\n\r\n  it('set replaces messages & clear empties', () => {\r\n    chatStore.set([make('user','one'), make('user','two')]);\r\n    expect(chatStore.get().length).toBe(2);\r\n    chatStore.clear();\r\n    expect(chatStore.get().length).toBe(0);\r\n  });\r\n\r\n  it('snapshot + restore workflow', () => {\r\n    chatStore.set([make('user','alpha'), make('assistant','beta')]);\r\n    const snapMeta = snapshot();\r\n    expect(snapMeta.count).toBe(2);\r\n    expect(hasSnapshot()).toBe(true);\r\n    chatStore.clear();\r\n    expect(chatStore.get().length).toBe(0);\r\n    const restored = restoreFromSnapshot();\r\n    expect(restored.ok).toBe(true);\r\n    expect(restored.count).toBe(2);\r\n    expect(chatStore.get().length).toBe(2);\r\n    discardSnapshot();\r\n    expect(hasSnapshot()).toBe(false);\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\utils\\chatExport.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\utils\\chatStore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\utils\\debounce.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[45,48],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[45,48],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export function debounce<T extends (...args: any[]) => void>(fn: T, wait = 400) {\n  let t: ReturnType<typeof setTimeout> | null = null;\n  return (...args: Parameters<T>) => {\n    if (t) clearTimeout(t);\n    t = setTimeout(() => fn(...args), wait);\n  };\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\utils\\download.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\utils\\format.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\utils\\hashTokens.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\utils\\prettyToolName.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\utils\\refreshBus.ts","messages":[{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":20,"column":34,"nodeType":"BlockStatement","messageId":"unexpected","endLine":20,"endColumn":36,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[740,740],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":82,"column":29,"nodeType":"BlockStatement","messageId":"unexpected","endLine":82,"endColumn":31,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[2573,2573],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from 'react';\n\n// Coalesces many \"refresh soon\" requests under the same key into one call.\n// Each key gets a single timer; the latest fn is executed when it fires.\ntype Fn = () => void;\n\nconst timers = new Map<string, ReturnType<typeof setTimeout>>();\nconst fns = new Map<string, Fn>();\nconst pendingCounts = new Map<string, number>(); // track how many requests merged\n\n// --- simple listeners for dev blips ---\ntype Listener = (key: string, count: number) => void;\nconst listeners = new Set<Listener>();\nexport function onRefreshFire(fn: Listener) {\n  listeners.add(fn);\n  return () => listeners.delete(fn);\n}\nfunction emit(key: string, count: number) {\n  for (const l of listeners) {\n    try { l(key, count); } catch {}\n  }\n}\n\nexport function coalesceRefresh(key: string, fn: Fn, wait = 450) {\n  // store latest fn (so most recent refresh logic runs)\n  fns.set(key, fn);\n\n  // if a timer exists, reset it\n  const existing = timers.get(key);\n  if (existing) clearTimeout(existing);\n\n  // bump how many requests we’re coalescing for this key\n  pendingCounts.set(key, (pendingCounts.get(key) ?? 0) + 1);\n\n  const t = setTimeout(() => {\n    timers.delete(key);\n    const toRun = fns.get(key);\n    const count = pendingCounts.get(key) ?? 1;\n    pendingCounts.delete(key);\n    if (toRun) {\n      try { toRun(); } finally { fns.delete(key); }\n    }\n    emit(key, count); // notify listeners for dev blips with count\n  }, wait);\n\n  timers.set(key, t);\n}\n\nexport function cancelCoalesced(key: string) {\n  const t = timers.get(key);\n  if (t) clearTimeout(t);\n  timers.delete(key);\n  fns.delete(key);\n  pendingCounts.delete(key);\n}\n\n// React hook for a stable scheduler you can call: schedule()\nexport function useCoalescedRefresh(key: string, fn: Fn, wait = 450) {\n  const fnRef = React.useRef(fn);\n  React.useEffect(() => { fnRef.current = fn; }, [fn]);\n\n  const schedule = React.useCallback(() => {\n    coalesceRefresh(key, () => fnRef.current(), wait);\n  }, [key, wait]);\n\n  React.useEffect(() => () => cancelCoalesced(key), [key]);\n  return schedule;\n}\n\n// ---- Simple global trigger/subscribe (legacy-style) ----\n// Provides a basic coalesced refresh without keys.\nlet _simpleTimer: ReturnType<typeof setTimeout> | null = null;\nlet _simpleQueued = false;\nconst _simpleListeners = new Set<() => void>();\n\nexport function triggerRefresh(delay = 450) {\n  _simpleQueued = true;\n  if (_simpleTimer) return; // already scheduled\n  _simpleTimer = setTimeout(() => {\n    if (_simpleQueued) {\n      for (const fn of _simpleListeners) {\n        try { fn(); } catch {}\n      }\n      _simpleQueued = false;\n    }\n    _simpleTimer = null;\n  }, delay);\n}\n\nexport function onRefresh(fn: () => void) {\n  _simpleListeners.add(fn);\n  return () => _simpleListeners.delete(fn);\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\utils\\save.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\utils\\suggestions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\ai-finance-agent-oss-clean\\apps\\web\\src\\vite-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]}]
